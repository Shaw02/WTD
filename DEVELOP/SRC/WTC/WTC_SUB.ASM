;=======================================================================|
;									|
;		Wander Swan Total Sound Driver				|
;				MML Compiler Program			|
;				SUB Routine				|
;									|
;					Programmed by			|
;						A.Watanabe		|
;									|
;=======================================================================|
;---------------------------------------------------------------|
;		^CgAo[W̕\			|
;---------------------------------------------------------------|
WTD_TITLE	DB	'Wonder Swan Total Souund Driver',0Dh,0Ah,24h
VER_P		DB	'Version '
		DB	WtdIL_Version
		DB	0Dh,0Ah,24h
TPRINT:					;
	MOV	AX,CS			;
	MOV	DS,AX			;
	MOV	AH,09H			;
	MOV	DX,OFFSET WTD_TITLE	;
	INT	21H			;
	MOV	DX,OFFSET P_TAB		;
	INT	21H			;
	MOV	DX,OFFSET VER_P		;
	INT	21H			;
	MOV	DX,OFFSET P		;
	MOV	AH,09H			;
	INT	21H			;
	RET
;---------------------------------------------------------------|
;		RpC[`				|
;---------------------------------------------------------------|
COMPAIL:				;RpC
	MOV	AX,CS:[segWTD_File]	;
	MOV	DS,AX			;DSWTD SEGMENT
	MOV	AX,CS:[segMML_File]	;
	MOV	ES,AX			;ESMML SEGMENT

	CALL	c_Head_first		;wb_[ݒ
	CALL	c_voice			;F]
	CALL	c_Command		;p[gRpC
	CALL	c_Head_end		;wb_[ݒ(ԍŌɌĂԁB)

	cmp	cs:[cHCD_FlagFx],00h	;FX`tOĂ邩H
	jnz	COMPAIL_Step0		;ĂȂAIB
	call	WTD_SAVE		;vsc`ŃZ[u
COMPAIL_Step0:				;

	cmp	cs:[cHCD_FlagFx],01h	;FX`tOĂ邩H
	jnz	COMPAIL_Step1		;ĂȂAIB
	call	FX_SAVE			;ew`ŃZ[uB
COMPAIL_Step1:				;

COMPAIL_End:				;
	ret				;RETURN
;---------------------------------------------------------------|
;		RpCf[^̂ero`Z[u		|
;---------------------------------------------------------------|
WTD_SAVE:
	call	SOPEN			;
	mov	dx,cs:[pWTD_File]	;
	call	MSAVE			;
	call	SCLOSE			;
	ret				;
FX_SAVE:
	call	FXopen			;
	mov	dx,07Fh			;
	call	FXsave			;
	mov	dx,cs:[pWTD_File]	;
	call	MSAVE			;
	call	SCLOSE			;
	ret
;---------------------------------------------------------------|
;		PUiR[h`ASCII CODE(255)			|
;---------------------------------------------------------------|
;								|
;		PUiR[hPOĩAXL[R[hɕϊ	|
;								|
;		AHϊl				|
;	Ԃl							|
;		DXϊ̐擪AhX		|
;---------------------------------------------------------------|
	DB	'-'			;
ASC_8	DB	'$$$$$'			;
HEX2ASC8:
	PUSH	AX			
	PUSH	BX			
	PUSH	CX			;WX^ۑ
	MOV	BX,OFFSET ASC_8		
	MOV	AL,'$'			
	MOV	CS:[BX],AL		
	INC	BX			
	MOV	CS:[BX],AL		
	INC	BX			
	MOV	CS:[BX],AL		
	INC	BX			
	MOV	CS:[BX],AL		
	INC	BX			
	MOV	CS:[BX],AL		

	MOV	BX,OFFSET ASC_8		
	MOV	AL,' '			;
	CMP	AH,100			;
	JC	H2A8L3			;POÖʂH
	
	MOV	AL,AH			
	XOR	AH,AH			
	MOV	CH,100			
	DIV	CH			
	ADD	AL,30H			
	MOV	CS:[BX],AL		
	INC	BX			
H2A8L3:	
	CMP	AL,' '			;AL=" "POÖʂ͖
	JNZ	H2A8E2			
	CMP	AH,10			;PÖʂH
	JC	H2A8L2			
	
H2A8E2:	MOV	AL,AH			
	XOR	AH,AH			
	MOV	CH,10			
	DIV	CH			
	ADD	AL,30H			
	MOV	CS:[BX],AL		
	INC	BX			
H2A8L2:	
	ADD	AH,30H			;̈ʂ͕K
	MOV	CS:[BX],AH		;
	
	MOV	DX,OFFSET ASC_8		;AhX
	POP	CX			
	POP	BX			
	POP	AX			
	RET				
;---------------------------------------------------------------|
;		PUiR[h`ASCII CODE(65535)		|
;---------------------------------------------------------------|
;								|
;		PUiR[hPOĩAXL[R[hɕϊ	|
;								|
;		AXϊl				|
;	Ԃl							|
;		DXϊ̐擪AhX		|
;---------------------------------------------------------------|
	DB	'-'			;
ASC_16	DB	'$$$$$$$'
HEX2ASC16:
	PUSH	AX			
	PUSH	BX			
	PUSH	CX			

	PUSH	AX			
	MOV	BX,OFFSET ASC_16	
	MOV	AL,'$'			
	MOV	CS:[BX],AL		
	INC	BX			
	MOV	CS:[BX],AL		
	INC	BX			
	MOV	CS:[BX],AL		
	INC	BX			
	MOV	CS:[BX],AL		
	INC	BX			
	MOV	CS:[BX],AL		
	INC	BX			
	MOV	CS:[BX],AL		
	INC	BX			
	MOV	CS:[BX],AL		
;	INC	BX			
;	MOV	CS:[BX],AL		
	POP	AX			

	MOV	BX,OFFSET ASC_16	
	MOV	CL,' '			
	MOV	DX,AX			
	CMP	DX,10000		;POOOÖʂ͂H
	JC	H2A6L5			
	
	XOR	DX,DX			
	MOV	CX,10000		
	DIV	CX			
	ADD	AL,30H			
	MOV	CL,AL			
	MOV	CS:[BX],CL		
	INC	BX			
H2A6L5:	
	CMP	CL,' '			
	JNZ	H2A6E4			
	CMP	DX,1000			;POOÖʂ́H
	JC	H2A6L4			
	
H2A6E4:	MOV	AX,DX			
	XOR	DX,DX			
	MOV	CX,1000			
	DIV	CX			
	ADD	AL,30H			
	MOV	CL,AL			
	MOV	CS:[BX],CL		
	INC	BX			
H2A6L4:	
	CMP	CL,' '			
	JNZ	H2A6E3			
	CMP	DX,100			;POÖ
	JC	H2A6L3			
	
H2A6E3:	MOV	AX,DX			
	XOR	DX,DX			
	MOV	CX,100			
	DIV	CX			
	ADD	AL,30H			
	MOV	CL,AL			
	MOV	CS:[BX],CL		
	INC	BX			
H2A6L3:	
	CMP	CL,' '			
	JNZ	H2A6E2			
	CMP	DX,10			;PÖʂ́H
	JC	H2A6L2			

H2A6E2:	MOV	AX,DX			
	XOR	DX,DX			
	MOV	CX,10			
	DIV	CX			
	ADD	AL,30H			
	MOV	CL,AL			
	MOV	CS:[BX],CL		
	INC	BX			
H2A6L2:	
	MOV	AX,DX			
	ADD	AL,30H			
	MOV	CS:[BX],AL		;P̈ʂ͕K
	
	MOV	DX,OFFSET ASC_16	
	POP	CX			
	POP	BX			
	POP	AX			
	RET				
;---------------------------------------------------------------|
;		ASCII CODEPUiR[h(-127`255)		|
;			lf[^܂ł		|
;---------------------------------------------------------------|
;								|
;		CS:[pMML_File] ϊ擪AhX	|
;		ESMML DatâZOg			|
;	Ԃl							|
;		AHf[^					|
;		CS:[pMML_File] ̃AhX			|
;---------------------------------------------------------------|
A2H8R:
	PUSH	BX			;
	PUSH	CX			;
	PUSH	DX			;
	PUSH	DS			;
	MOV	CL,AL			;AL̕ۑ
	PUSH	AX			;
	MOV	AX,ES			;
	MOV	DS,AX			;
	POP	AX			;
	MOV	DX,CS:[pMML_File]	;
A2H8R1:	CALL	COMMENT_CHK		;Rg`FbN
	CALL	ASC2HEX8		;ASC Code 16iCodeϊ
	MOV	DX,BX			;
	JNC	A2H8RR			;ϊs\H
	JMP	A2H8R1			;蒼B
A2H8RR:	MOV	CS:[pMML_File],DX	;
	MOV	AL,CL			;AL̕A
	POP	DS			;
	POP	DX			;
	POP	CX			;
	POP	BX			;
	RET				;RETURN
;---------------------------------------------------------------|
;		ASCII CODEPUiR[h(-32767`65535)		|
;			lf[^܂ł		|
;---------------------------------------------------------------|
;								|
;		CS:[pMML_File] ϊ擪AhX	|
;		ESMML DatâZOg			|
;	Ԃl							|
;		AXf[^					|
;		CS:[pMML_File] ̃AhX			|
;---------------------------------------------------------------|
A2H16R:
	CALL	COMMENT_CHK		;Rg`FbN

	PUSH	BX			;
	PUSH	DX			;
	PUSH	DS			;
	PUSH	AX			;
	MOV	AX,ES			;
	MOV	DS,AX			;
	POP	AX			;
	MOV	DX,CS:[pMML_File]	;
A2H16R1:CALL	ASC2HEX16		;ASC Code 16iCodeϊ
	MOV	DX,BX			;
	JNC	A2H16RR			;ϊs\H
	JMP	A2H16R1			;蒼B
A2H16RR:MOV	CS:[pMML_File],DX	;
	POP	DS			;
	POP	DX			;
	POP	BX			;
	RET				;RETURN
;---------------------------------------------------------------|
;		ASCII CODEPUiR[h(-127`255)		|
;---------------------------------------------------------------|
;								|
;		DS:DXϊ擪AhX		|
;	Ԃl							|
;		AHϊ					|
;		DS:BX̃AhX				|
;---------------------------------------------------------------|
HEX_8	DB	00H,00H,00H		;
DHEX8	DB	00H			;
F8FLAG	DB	00H			;
ASC2HEX8:				;
	PUSH	CX			;
	PUSH	DX			;
	XOR	CX,CX			;CX0
	MOV	BX,DX			;BXDXi擪AhXj
	MOV	DX,OFFSET HEX_8		;DXϊpf[^obt@
	XOR	AX,AX			;
	MOV	CS:[F8FLAG],AH		;tÕZbg
	MOV	AH,DS:[BX]		;
	CMP	AH,'-'			;
	JNZ	A2H8L0			;
	INC	BX			;
	MOV	AH,0F8H			;Flag
	MOV	CS:[F8FLAG],AH		;Set
A2H8L0:	MOV	AH,DS:[BX]		;
	INC	BX			;
	SUB	AH,30H			;CHR CODEHEX CODE
	JNC	A2H8L1			;AH<0@ꎞϊI
	JMP	A2H8E1			;
A2H8L1:	CMP	AH,10			;
	JC	A2H8L2			;AH>10 ꎞϊI
	JMP	A2H8E1			;
A2H8L2:	XCHG	BX,DX			;
	MOV	CS:[BX],AH		;ۑ
	INC	BX			;
	XCHG	BX,DX			
	INC	CL			;
	CMP	CL,3			;RϊꎞϊI
	JZ	A2H8E0			;iőR( 0~255)j
	JMP	A2H8L0			;
A2H8E1:
	DEC	BX			;
A2H8E0:
	CMP	CL,0			;li-, 0~9jꍇ
	JNZ	A2H8L3			;Wv
	STC				;ȊOA
	INC	BX			;G[Ŗ߂
	JMP	A2H8EE			;
A2H8L3:					;
	MOV	CH,0			;
	MOV	CS:[DHEX8],CH		;
	MOV	CH,CL			;CHꎞϊŕϊ
	MOV	CL,3			;CLvZp
	XCHG	BX,DX			;	310^0	210^1	110^2
A2H8L4:	
	DEC	BX			;
	MOV	AH,CS:[BX]		;
	CALL	A2H8AA			;vZ
	DEC	CL			;
	DEC	CH			;
	JNZ	A2H8L4			;
	XCHG	BX,DX			;
	MOV	AH,CS:[DHEX8]		;
	CMP	CS:[F8FLAG],00H		;
	JZ	A2H8L5			;
	NEG	AH			;
A2H8L5:	CLC				;
A2H8EE:	POP	DX			;
	POP	CX			;
	RET				;

;	*	*	*	*	*	*	*	*

A2H8AA:					;
	CMP	CL,1			;CL	P̏ꍇ
	JNZ	A2H8C1			;AXAH*100
	MOV	AL,100			;
	JMP	A2H8C3			;
A2H8C1:	CMP	CL,2			;	Q̏ꍇ
	JNZ	A2H8C2			;AXAH*10
	MOV	AL,10			;
	JMP	A2H8C3			;
A2H8C2:	CMP	CL,3			;	Ȑꍇ
	JNZ	A2H8C4			;AXAH*1
	MOV	AL,1			;
;	JMP	A2H8C3			;
A2H8C3:	CALL	KAKE8			;
	ADD	CS:[DHEX8],AL		;[DHEX8][DHEX8]*AX
	RET				;
A2H8C4:	MOV	CL,0			;bkȊȌꍇ
	XCHG	BX,DX			;G[
	POP	DX			;
	MOV	DX,OFFSET A2H8EE	;
	PUSH	DX			;
	STC				;
	RET				;
;---------------------------------------------------------------|
;		Z[`					|
;---------------------------------------------------------------|
;								|
;		AH鐔				|
;		AL鐔					|
;	Ԃl							|
;		AX						|
;---------------------------------------------------------------|
KAKE8:					;
	PUSH	CX			;
	PUSH	DX			;WX^ۑ
	XOR	DX,DX			;DX0000<h>
	MOV	CH,0			;CH0
	MOV	CL,1			;CL00000001<h>
KLOOP0:	TEST	AH,CL			;Bit check
	JZ	KLOOP1			;if 'L' then *KLOOP1
	CALL	KADD			;Z(DX+AL*2^CL)
KLOOP1:	INC	CH			;CHCH+1
	SHL	CL,1			;CL Bit shift 
	JNC	KLOOP0			;CL>128ŏI
	MOV	AX,DX			;
	POP	DX			;
	POP	CX			;WX^A
	RET				;RETURN
;		*************************
;		*	Z	*
;		*************************
KADD:					;
	PUSH	AX			;
	XOR	AH,AH			;AH00h
	CMP	CH,1			;CH=1ȂΉẐ
	JC	KADD1			;
	PUSH	CX			;
	MOV	CL,CH			;
	SHL	AX,CL			;AXAX*2^CH
	POP	CX			;
KADD1:	ADD	DX,AX			;DXDX+AX
	POP	AX			;
	RET				;
;---------------------------------------------------------------|
;		ASCII CODEPUiR[h(-32767`65535)		|
;---------------------------------------------------------------|
;								|
;		DS:DXϊ擪AhX		|
;	Ԃl							|
;		AXϊ					|
;		DS:BX̃AhX				|
;---------------------------------------------------------------|
HEX_16	DB	00H,00H,00H,00H,00H	;
DHEX16	DW	0000H			;
F6FLAG	DB	00H			;
ASC2HEX16:				;
	PUSH	CX			;
	PUSH	DX			;
	XOR	CX,CX			;CX0
	MOV	BX,DX			;BXDXi擪AhXj
	MOV	DX,OFFSET HEX_16	;DXϊpf[^obt@
	XOR	AX,AX
	MOV	CS:[F6FLAG],AH
	MOV	AH,DS:[BX]
	CMP	AH,'-'
	JNZ	A2H6L0
	INC	BX
	MOV	AH,0F6H
	MOV	CS:[F6FLAG],AH
A2H6L0:	MOV	AH,DS:[BX]		;
	INC	BX			;
	SUB	AH,30H			;CHR CODEHEX CODE
	JNC	A2H6L1			;AH<0@ꎞϊI
	JMP	A2H6E1			;
A2H6L1:	CMP	AH,10			;
	JC	A2H6L2			;AH>10 ꎞϊI
	JMP	A2H6E1			;
A2H6L2:	XCHG	BX,DX			
	MOV	CS:[BX],AH		;ۑ
	INC	BX			;
	XCHG	BX,DX			
	INC	CL			;
	CMP	CL,5			;TϊꎞϊI
	JZ	A2H6E0			;
	JMP	A2H6L0			;
A2H6E1:
	DEC	BX			
A2H6E0:
	CMP	CL,0			
	JNZ	A2H6L3			
	STC				
	INC	BX			
	JMP	A2H6EE			
A2H6L3:					
	XOR	AX,AX			
	MOV	CS:[DHEX16],AX		
	MOV	CH,CL			
	MOV	CL,5			
	XCHG	BX,DX			
A2H6L4:	
	DEC	BX			
	XOR	AH,AH			
	MOV	AL,CS:[BX]		
	CALL	A2H6AA			
	DEC	CL			
	DEC	CH			
	JNZ	A2H6L4			
	XCHG	BX,DX			
	MOV	AX,CS:[DHEX16]		
	CMP	CS:[F6FLAG],00H		
	JZ	A2H6L5			
	NEG	AX			
A2H6L5:	CLC				
A2H6EE:	POP	DX			
	POP	CX			
	RET				

;	*	*	*	*	*	*	*	*

A2H6AA:					
	PUSH	DX			
	CMP	CL,1			
	JNZ	A2H6C1			
	MOV	DX,10000		
	JMP	A2H6C5			
A2H6C1:	CMP	CL,2			
	JNZ	A2H6C2			
	MOV	DX,1000			
	JMP	A2H6C5			
A2H6C2:	CMP	CL,3			
	JNZ	A2H6C3			
	MOV	DX,100			
	JMP	A2H6C5			
A2H6C3:	CMP	CL,4			
	JNZ	A2H6C4			
	MOV	DX,10			
	JMP	A2H6C5			
A2H6C4:	CMP	CL,5			
	JNZ	A2H6C6			
	MOV	DX,1			
;	JMP	A2H6C5			
A2H6C5:	MUL	DX			
	POP	DX			
	ADD	CS:[DHEX16],AX		
	RET				
A2H6C6:	MOV	CL,0			
	POP	DX			
	XCHG	BX,DX			
	POP	DX			
	MOV	DX,OFFSET A2H6EE	
	PUSH	DX			
	STC				
	RET				
;---------------------------------------------------------------|
;		RpCf[^ǂݍ			|
;---------------------------------------------------------------|
;								|
;		CS:[pMML_File]FRpCAhX		|
;		ESMML DatâZOg			|
;	Ԃl							|
;		AH	 @Ff[^				|
;		CS:[pMML_File]F̃AhX			|
;---------------------------------------------------------------|
CREAD:	
	call	COMMENT_CHK		;

	PUSH	BX			;
	MOV	BX,CS:[pMML_File]	;BXRpCAhX
	MOV	AH,ES:[BX]		;AH̃f[^
	INC	BX			;BXi|C^j𑝉
	PUSH	AX			;
	MOV	AX,CS:[szMml_File]	;AX *.MML̃TCY
	CMP	AX,BX			;|C^TCYzĂ
	MOV	CS:[pMML_File],BX	;Cy'H'
	POP	AX			;
	POP	BX			;
	RET				;
;---------------------------------------------------------------|
;		RpCf[^			|
;---------------------------------------------------------------|
;								|
;		AH	 @Ff[^				|
;		CS:[pWTD_File]FRpCAhX		|
;		DSFSP f[^ZOg			|
;	Ԃl							|
;		CS:[pWTD_File]F̃AhX			|
;---------------------------------------------------------------|
CSET:	PUSH	BX			;
	MOV	BX,CS:[pWTD_File]	;BXRpCAhX
	MOV	DS:[BX],AH		;
	INC	BX			;BXi|C^j
	MOV	CS:[pWTD_File],BX	;
	POP	BX			;
	RET				;
;---------------------------------------------------------------
CSET16:	PUSH	BX			;
	MOV	BX,CS:[pWTD_File]	;BXRpCAhX
	MOV	DS:[BX],ax		;
	add	bx,2			;BXi|C^j
	MOV	CS:[pWTD_File],BX	;
	POP	BX			;
	RET				;
;---------------------------------------------------------------|
;		Rg`FbN				|
;---------------------------------------------------------------|
COMMENT_CHK:				;
	PUSH	AX			;
	PUSH	BX			;
	MOV	BX,CS:[pMML_File]	;BXRpCAhX
	MOV	AH,ES:[BX]		;AH̃f[^
	CMP	AH,';'			;Rgs܂ŃWv
	JNZ	REMCHK			;
	CALL	CRJUMP			;
REMCHK:	POP	BX			;
	POP	AX			;
	RET				;
;---------------------------------------------------------------|
;		s܂Ŕ΂					|
;---------------------------------------------------------------|
CRJUMP:	PUSH	AX			;
	push	bx			;

CR_JMP:	
	MOV	BX,CS:[pMML_File]	;BXRpCAhX
	MOV	AH,ES:[BX]		;AH̃f[^
	inc	CS:[pMML_File]		;|C^𑝉

	CMP	AH,0DH			;sH
	JNZ	CR_JMP			;łȂ灪

	dec	CS:[pMML_File]		;|C^𑝉

	pop	bx			;
	POP	AX			;
	RET				;
;****************************************************************
;								*
;			t@C֘A				*
;								*
;****************************************************************
;---------------------------------------------------------------|
;		CN[ht@C`FbN			|
;---------------------------------------------------------------|
INCFILE	DB	'            ',000,00DH,00AH,024H
CHK_INCLUDE:				;CN[h`̏
	CALL	IOPEN			;t@Cǂݍݗp̃
	xor	bx,bx			;
	MOV	CS:[pMML_File],BX	;llkf[^擪AhX
	MOV	AX,CS:[segMml_File]	;
	MOV	ES,AX			;
	JMP	INCL01			;
INCLOOP:				;
	CALL	CREAD			;
	JNC	INCL00			;TCYI[o
	JMP	INCEOF			;
INCL00:	CMP	AH,00AH			;sH
	JNZ	INCLOOP			;
INCL01:	CALL	CREAD			;
	CMP	AH,'I'			;I
	JNZ	INCLOOP			;
INCL02:	CALL	CREAD			;
	CMP	AH,'N'			;N
	JNZ	INCLOOP			;s̐擪'IN'̕邩H
INCL03:	CALL	CREAD			;
	CMP	AH,21H			;
	JC	INCL03			;QÕR[h͔΂
INCL04:	MOV	BX,OFFSET INCFILE	;BXt@Ci[AhX
	MOV	CL,13			;
	MOV	AX,CS:[pMML_File]	;
	DEC	AX			;
	MOV	CS:[pMML_File],AX	;
INCL05:	CALL	CREAD			;
	CMP	AH,0DH			;s
	JZ	INCL06			;i[I
	MOV	CS:[BX],AH		;
	INC	BX			;
	DEC	CL			;
	JNZ	INCL05			;I[o
	JMP	INC_ERROR		;݂Ȃt@C
INCL06:	MOV	AH,00H			;
	MOV	CS:[BX],AH		;
	CALL	CREAD			;|C^i܂
	CALL	INC_FILE_OPEN		;CN[ht@CI[v
	CALL	INC_MREAD		;ǂݍ
	CALL	INC_FILE_CLOSE		;CN[ht@CN[Y
	CALL	INC_SCROOL		;CN[h̑}
	JMP	INCLOOP			;
INCEOF:	
	CALL	ICLOSE			;蓖Ẳ
	RET				;
;---------------------------------------------------------------|
;		CN[ht@C}			|
;---------------------------------------------------------------|
INC_SCROOL:
	STD				;ubN]fBNg
	MOV	SI,0FFFFH		;
	SUB	SI,CS:[szInclude_File]	;
	MOV	DI,0FFFFH		;
	MOV	AX,CS:[segMml_File]	;
	MOV	DS,AX			;
	MOV	ES,AX			;
INC_SCROOL_L0:				;
	MOVSB				;
	CMP	SI,CS:[pMML_File]	;
	JNC	INC_SCROOL_L0		;TCYɂ炷B

	MOV	CX,CS:[szInclude_File]	;CX ]TCY
	MOV	SI,0000H		;DS:SI ]
	MOV	DI,CS:[pMML_File]	;ES:DI 
	MOV	AX,CS:[segInclude_File]	;
	MOV	DS,AX			;
	MOV	AX,CS:[segMml_File]	;
	MOV	ES,AX			;
	
	CLD				;ubN]CNg
	REP	MOVSB			;ubN]
	
	DEC	DI			;
	MOV	AH,ES:[DI]		;CN[ht@C̍ŌEOF
	CMP	AH,1AH			;ĂA20h 
	JNZ	INC_SCROOL_L1		;
	MOV	AH,20H			;
	MOV	ES:[DI],AH		;
INC_SCROOL_L1:				;
	MOV	AX,CS:[szMml_File]	;llkTCYCN[ht@C
	ADD	AX,CS:[szInclude_File]	;TCY傫B
	MOV	CS:[szMml_File],AX	;
	RET				;
;---------------------------------------------------------------|
;		Z[upt@C̃I[v			|
;---------------------------------------------------------------|
SOPEN:
	PUSH	DS			;
	PUSH	AX			;
	PUSH	BX			;
	PUSH	CX			;
	PUSH	DX			;

	MOV	AX,CS			;
	MOV	DS,AX			;DSCS

	MOV	AX,CS:[F_ADD]		;
	MOV	SI,AX			;SIt@CAhX
	MOV	BX,AX			;
SFLP1:					;gq'.WTD'ƂB
	INC	BX			;
	CMP	BYTE PTR CS:[BX],'.'	;
	JNZ	SFLP1			;
SFLP2:	INC	BX			;
	MOV	AH,'W'			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,'T'			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,'D'			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,00H			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,0AH			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,0DH			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,24H			;
	MOV	CS:[BX],AH		;

SFL20:	MOV	AX,3C00H		;t@C̃I[v
	MOV	DX,SI			;DXt@CAhX
	MOV	CX,00H			;
	INT	21H			;
	JNC	SFL02			;
	JMP	SOPEN_ERROR		;
SFL02:	MOV	WORD PTR CS:[hWtd_File],AX	;

	POP	DX			;
	POP	CX			;
	POP	BX			;
	POP	AX			;
	POP	DS			;
	RET				;
;---------------------------------------------------------------|
;		Z[upt@C̃I[v	FX		|
;---------------------------------------------------------------|
FXOPEN:
	PUSH	DS			;
	PUSH	AX			;
	PUSH	BX			;
	PUSH	CX			;
	PUSH	DX			;

	MOV	AX,CS			;
	MOV	DS,AX			;DSCS

	MOV	AX,CS:[F_ADD]		;
	MOV	SI,AX			;SIt@CAhX
	MOV	BX,AX			;
FXFLP1:					;gq'.FX'ƂB
	INC	BX			;
	CMP	BYTE PTR CS:[BX],'.'	;
	JNZ	FXFLP1			;
FXFLP2:	INC	BX			;
	MOV	AH,'F'			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,'X'			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,00H			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,0AH			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,0DH			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,24H			;
	MOV	CS:[BX],AH		;

FXFL20:	MOV	AX,3C00H		;t@C̃I[v
	MOV	DX,SI			;DXt@CAhX
	MOV	CX,00H			;
	INT	21H			;
	JNC	FXFL02			;
	JMP	SOPEN_ERROR		;
FXFL02:	MOV	WORD PTR CS:[hWtd_File],AX	;

	POP	DX			;
	POP	CX			;
	POP	BX			;
	POP	AX			;
	POP	DS			;
	RET				;
;---------------------------------------------------------------|
;		Z[upt@C̃I[vieXgj		|
;---------------------------------------------------------------|
TSOPEN:
	PUSH	DS			;
	PUSH	AX			;
	PUSH	BX			;
	PUSH	CX			;
	PUSH	DX			;

	MOV	AX,CS			;
	MOV	DS,AX			;DSCS

	MOV	AX,CS:[F_ADD]		;
	MOV	SI,AX			;SIt@CAhX
	MOV	BX,AX			;
TSFLP1:					;gq'.TCM'ƂB
	INC	BX			;
	CMP	BYTE PTR CS:[BX],'.'	;
	JNZ	TSFLP1			;
TSFLP2:	INC	BX			;
	MOV	AH,'T'			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,'C'			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,'M'			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,00H			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,0AH			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,0DH			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,24H			;
	MOV	CS:[BX],AH		;

TSFL20:	MOV	AX,3C00H		;t@C̃I[v
	MOV	DX,SI			;DXt@CAhX
	MOV	CX,00H			;
	INT	21H			;
	JNC	TSFL02			;
	JMP	SOPEN_ERROR		;
TSFL02:	MOV	WORD PTR CS:[hTest_File],AX

	POP	DX			;
	POP	CX			;
	POP	BX			;
	POP	AX			;
	POP	DS			;
	RET				;
;---------------------------------------------------------------|
;		t@C̃I[v				|
;---------------------------------------------------------------|
FOPEN:					;
	MOV	BX,0081H		;
	MOV	CH,CS:[BX - 1]		;
	ADD	BL,CH			;
	MOV	CS:[BX],BH		;
	MOV	BX,0081H		;
FLOOP:	CMP	CH,0			;
	JNZ	FL001			;
	JMP	FILE_ERROR		;
FL001:	DEC	CH			;
	INC	BX			;
	CMP	BYTE PTR CS:[BX],21H	;
	JC	FLOOP			;
	MOV	DX,BX			;
	MOV	CS:[F_ADD],BX		;t@C擪AhX̕ۑ

FLOP1:	CMP	CH,0			;gqŵȂꍇ
	JNZ	FL012			;'.MML'ƂB
	MOV	AH,'.'			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,'M'			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,'M'			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,'L'			;
	MOV	CS:[BX],AH		;
	INC	BX			;
	MOV	AH,00			;
	MOV	CS:[BX],AH		;
	
	JMP	FL020			;
FL012:	DEC	CH			;
	INC	BX			;
	CMP	BYTE PTR CS:[BX],'.'	;
	JNZ	FLOP1			;

FL020:	MOV	AX,3D00H		;t@C̃I[v
	INT	21H			;
	JNC	FL002			;
	JMP	LOAD_ERROR		;
FL002:	MOV	WORD PTR CS:[hMml_File],AX
	RET				;
;---------------------------------------------------------------|
;		CN[ht@C̃I[v			|
;---------------------------------------------------------------|
INC_FILE_OPEN:				;CN[ht@C
	PUSH	DS			;
	PUSH	CS			;
	POP	DS			;
	MOV	DX,OFFSET INCFILE	;DS:DXt@C|C^
	MOV	AX,3D00H		;
	INT	21H			;
	JNC	INC_FILE_OPEN_L0	;
	JMP	INC_ERROR		;悧`
INC_FILE_OPEN_L0:			;
	MOV	WORD PTR CS:[hInclude_File],AX	;nhۑƂB
	POP	DS			;
	RET				;
;---------------------------------------------------------------|
;		Ft@C̃I[v				|
;---------------------------------------------------------------|
VOI_FILE_OPEN:				;Ft@C
	PUSH	DS			;
	PUSH	CS			;
	POP	DS			;
	MOV	DX,OFFSET c_Voice_File	;DS:DXt@C|C^
	MOV	AX,3D00H		;
	INT	21H			;
	JNC	VOI_FILE_OPEN_L0	;
	JMP	VOI_ERROR		;悧`
VOI_FILE_OPEN_L0:			;
	MOV	WORD PTR CS:[hVoice_File],AX	;nhۑƂB
	POP	DS			;
	RET				;
;---------------------------------------------------------------|
;		mہiOPN Dataj				|
;---------------------------------------------------------------|
MOPEN:					;
	MOV	AH,48H			;
	MOV	BX,1000H		;64KByte ̃f[^̈̊m
	INT	21H			;
	JNC	NOPERR			;蓖ĎsɔԁB
	JMP	MOPEN_ERROR		;
NOPERR:	MOV	CS:[segMml_File],AX	;蓖ĂZOgAhX̕ۑB
	MOV	DS,AX			;DSSegment̐ݒ
	RET				;
;---------------------------------------------------------------|
;		mہiWTD Dataj				|
;---------------------------------------------------------------|
WOPEN:					;
	MOV	AH,48H			;
	MOV	BX,1000H		;64KByte ̃f[^̈̊m
	INT	21H			;
	JNC	WOPERR			;蓖ĎsɔԁB
	JMP	MOPEN_ERROR		;
WOPERR:	MOV	CS:[segWtd_File],AX	;蓖ĂZOgAhX̕ۑB
	MOV	DS,AX			;DSSegment̐ݒ
	RET				;
;---------------------------------------------------------------|
;		mہiINC Dataj				|
;---------------------------------------------------------------|
IOPEN:					;
	MOV	AH,48H			;
	MOV	BX,0800H		;32KByte ̃f[^̈̊m
	INT	21H			;
	JNC	IOPERR			;蓖ĎsɔԁB
	JMP	MOPEN_ERROR		;
IOPERR:	MOV	CS:[segInclude_File],AX	;蓖ĂZOgAhX̕ۑB
	MOV	DS,AX			;DSSegment̐ݒ
	RET				;
;---------------------------------------------------------------|
;		mہiVOI Dataj				|
;---------------------------------------------------------------|
VOPEN:					;
	MOV	AH,48H			;
	MOV	BX,0200H		;8KByte ̃f[^̈̊m
	INT	21H			;
	JNC	VOPERR			;蓖ĎsɔԁB
	JMP	MOPEN_ERROR		;
VOPERR:	MOV	CS:[segVoice_File],AX	;蓖ĂZOgAhX̕ۑB
	RET				;
;---------------------------------------------------------------|
;		JiOPN Dataj				|
;---------------------------------------------------------------|
MCLOSE:					;
	MOV	AX,CS:[segMml_File]	;
	MOV	ES,AX			;ZOgǂށB
	MOV	AH,49H			;
	INT	21H			;f[^̈̊J
	JNC	MCLRET			;
	JMP	CLOSE_ERROR		;
MCLRET:	RET				;
;---------------------------------------------------------------|
;		JiOPN Dataj				|
;---------------------------------------------------------------|
WCLOSE:					;
	MOV	AX,CS:[segWtd_File]	;
	MOV	ES,AX			;ZOgǂށB
	MOV	AH,49H			;
	INT	21H			;f[^̈̊J
	JNC	WCLRET			;
	JMP	CLOSE_ERROR		;
WCLRET:	RET				;
;---------------------------------------------------------------|
;		JiINC Dataj				|
;---------------------------------------------------------------|
ICLOSE:					;
	push	es			;
	MOV	AX,CS:[segInclude_File]	;
	MOV	ES,AX			;ZOgǂށB
	MOV	AH,49H			;
	INT	21H			;f[^̈̊J
	JNC	ICLRET			;
	JMP	CLOSE_ERROR		;
ICLRET:	pop	es			;
	RET				;
;---------------------------------------------------------------|
;		JiVOI Dataj				|
;---------------------------------------------------------------|
VCLOSE:					;
	push	es
	MOV	AX,CS:[segVoice_File]	;
	MOV	ES,AX			;ZOgǂށB
	MOV	AH,49H			;
	INT	21H			;f[^̈̊J
	JNC	VCLRET			;
	JMP	CLOSE_ERROR		;
VCLRET:	pop	es
	RET				;
;---------------------------------------------------------------|
;		t@C]iOPN Dataj		|
;---------------------------------------------------------------|
MREAD:					;
	MOV	AX,CS:[segMml_File]	;
	MOV	DS,AX			;
	mov	dx,00002h		;
	MOV	CX,0FFFFH		;
	MOV	BX,WORD PTR CS:[hMml_File]
	MOV	AH,3FH			;
	INT	21H			;
	JNC	FL003			;
	JMP	READ_ERROR		;
FL003:	add	ax,2			;
	MOV	CS:[szMml_File],AX	;
	mov	bx,0000h		;
	mov	ds:[bx],0a0dh		;
	RET				;
;---------------------------------------------------------------|
;		t@C]iINC Dataj		|
;---------------------------------------------------------------|
INC_MREAD:				;
	MOV	AX,CS:[segInclude_File]	;
	MOV	DS,AX			;
	xor	dx,dx			;
	MOV	CX,07FFFH		;
	MOV	BX,WORD PTR CS:[hInclude_File]	;
	MOV	AH,3FH			;
	INT	21H			;
	JNC	INC_MREAD_L0		;
	JMP	READ_ERROR		;
INC_MREAD_L0:				;
	MOV	BX,AX			;
	DEC	BX			;
	CMP	DS:[BX],BYTE PTR 01AH	;[EOF] ŌɂĂH
	JNZ	INC_MREAD_L1		;
	DEC	AX			;Ȃ΁At@CTCYPa
INC_MREAD_L1:				;B
	MOV	CS:[szInclude_File],AX	;
	RET				;
;---------------------------------------------------------------|
;		t@C]iOPN Dataj		|
;---------------------------------------------------------------|
VOI_MREAD:				;
	PUSH	DS			;
	MOV	AX,CS:[segVoice_File]	;
	MOV	DS,AX			;DSFt@CpZOgAhX
	MOV	DX,0000H		;DS:0000
	MOV	CX,01FFFH		;1FFFh]B
	MOV	BX,WORD PTR CS:[hVoice_File]	;
	MOV	AH,3FH			;
	INT	21H			;
	JNC	VOI_MREAD_L1		;
	JMP	READ_ERROR		;
VOI_MREAD_L1:				;
	POP	DS			;
	RET				;
;---------------------------------------------------------------|
;		t@C]				|
;---------------------------------------------------------------|
MSAVE:					;
	PUSH	AX			;
	PUSH	BX			;
	PUSH	CX			;
	PUSH	DX			;
	PUSH	DS			;

	MOV	CX,DX			;
	xor	dx,dx
	MOV	BX,CS:[hWtd_File]	;
	MOV	AH,40H			;
	INT	21H			;
	JNC	SFL03			;
	JMP	READ_ERROR		;

SFL03:	POP	DS			;
	POP	DX			;
	POP	CX			;
	POP	BX			;
	POP	AX			;
	RET				;
;---------------------------------------------------------------|
;		t@C]	FX			|
;---------------------------------------------------------------|
FXSAVE:					;
	PUSH	AX			;
	PUSH	BX			;
	PUSH	CX			;
	PUSH	DX			;
	PUSH	DS			;

	push	cs			;
	pop	ds			;
	mov	dx,offset FX		;ds:dxt@CAhX
	mov	cx,128			;cxt@CTCY
	mov	bx,cs:[hWtd_File]	;bxt@Cnh
	mov	ah,40h			;axẽZ[u
	INT	21H			;
	JNC	FXFL03			;
	JMP	READ_ERROR		;

FXFL03:	POP	DS			;
	POP	DX			;
	POP	CX			;
	POP	BX			;
	POP	AX			;
	RET				;
;---------------------------------------------------------------|
;		t@C]				|
;---------------------------------------------------------------|
TMSAVE:					;
	PUSH	AX			;
	PUSH	BX			;
	PUSH	CX			;
	PUSH	DX			;
	PUSH	DS			;

	MOV	AX,CS:[segMml_File]	;
	MOV	DS,AX			;
	MOV	CX,CS:[szMml_File]	;
	xor	dx,dx			;
	MOV	BX,CS:[hTest_File]	;
	MOV	AH,40H			;
	INT	21H			;
	JNC	TSFL03			;
	JMP	READ_ERROR		;

TSFL03:	POP	DS			;
	POP	DX			;
	POP	CX			;
	POP	BX			;
	POP	AX			;
	RET				;
;---------------------------------------------------------------|
;		t@C̃N[Y				|
;---------------------------------------------------------------|
FCLOSE:
	MOV	BX,WORD PTR CS:[hMml_File]	;
	MOV	AH,3EH			;
	INT	21H			;
	JNC	FL004			;
	JMP	CLOSE_ERROR		;
FL004:	RET				;
;---------------------------------------------------------------|
;		Z[upt@C̃N[Y			|
;---------------------------------------------------------------|
SCLOSE:	
	PUSH	AX			;
	PUSH	BX			;
	
	MOV	BX,WORD PTR CS:[hWtd_File]	;
	MOV	AH,3EH			;
	INT	21H			;
	JNC	SFL04			;
	JMP	CLOSE_ERROR		;

SFL04:	POP	BX			;
	POP	AX			;
	RET				;
;---------------------------------------------------------------|
;		Z[upt@C̃N[Y			|
;---------------------------------------------------------------|
TSCLOSE:
	PUSH	AX			;
	PUSH	BX			;
	
	MOV	BX,WORD PTR CS:[hTest_File]	;
	MOV	AH,3EH			;
	INT	21H			;
	JNC	TSFL04			;
	JMP	CLOSE_ERROR		;

TSFL04:	POP	BX			;
	POP	AX			;
	RET				;
;---------------------------------------------------------------|
;		CN[ht@C̃N[Y			|
;---------------------------------------------------------------|
INC_FILE_CLOSE:				;
	PUSH	AX			;
	PUSH	BX			;
	
	MOV	BX,WORD PTR CS:[hInclude_File]	;
	MOV	AH,3EH			;
	INT	21H			;
	JNC	INC_FILE_CLOSE_L0	;
	JMP	CLOSE_ERROR		;
INC_FILE_CLOSE_L0:			;

	POP	BX			;
	POP	AX			;
	RET				;
;---------------------------------------------------------------|
;		Ft@C̃N[Y				|
;---------------------------------------------------------------|
VOI_FILE_CLOSE:				;
	PUSH	AX			;
	PUSH	BX			;
	
	MOV	BX,WORD PTR CS:[hVoice_File]	;
	MOV	AH,3EH			;
	INT	21H			;
	JNC	VOI_FILE_CLOSE_L0	;
	JMP	CLOSE_ERROR		;
VOI_FILE_CLOSE_L0:			;

	POP	BX			;
	POP	AX			;
	RET				;
;---------------------------------------------------------------|
;		JgfBNg̕ύX			|
;---------------------------------------------------------------|
Current_Directory_Mess1	DB	'JgfBNg'
Current_Directory	DB	132	DUP(00h)
Current_Directory_Mess2	DB	'ɕύX܂B',0dh,0ah,24h
Change_Current_Directory:
	pusha				;
	push	ds			;
	push	es			;

	;-------------------------------
	;ZOg̐ݒ
	mov	ax,cs			;
	mov	ds,ax			;
	mov	es,ax			;

	;-------------------------------
	;JgfBNg
	MOV	BX,0081H		;
	MOV	CH,CS:[BX - 1]		;
	ADD	BL,CH			;BXt@CĂŌB

Change_Current_Directory_Loop:		;
	cmp	bx,0081h		;
	jc	Change_Current_Directory_End
	mov	al,cs:[bx]		;
	dec	bx			;
	cmp	al,'\'			;
	jnz	Change_Current_Directory_Loop

	;-------------------------------
	;JgfBNgݒ
	mov	cx,bx			;
	sub	cx,0081h		;
	mov	si,CS:[F_ADD]		;]
	mov	di,offset Current_Directory
	cld				;
	rep	movsb			;
	MOV	AH,00H			;
	MOV	CS:[di],AH		;
	INC	di			;
	MOV	AH,24H			;
	MOV	CS:[di],AH		;

	;-------------------------------
	;JgfBNgύXB
	mov	dx,offset Current_Directory
	mov	ah,3BH			;
	int	21h			;

	mov	dx,offset Current_Directory_Mess1
	mov	ah,09H			;
	int	21h			;

	mov	dx,offset Current_Directory_Mess2
	mov	ah,09H			;
	int	21h			;

	;-------------------------------
	;I
Change_Current_Directory_End:
	pop	es			;
	pop	ds			;
	popa				;
	ret				;
;---------------------------------------------------------------|
;								|
;		bnlt@C̃[ŏ			|
;---------------------------------------------------------------|
;								|
;		bnlvOsɃ[		|
;		ŏɂ					|
;								|
;								|
;	Ԃl							|
;		DSCS						|
;		Cy'L' ̂ƂBiIj			|
;		BXύX[̑傫B			|
;		Cy'H' ̂ƂBiG[j			|
;		BXύXłő̑傫			|
;		AXINT21H ̧ݸ4AHQ			|
;---------------------------------------------------------------|
ComSmoleMessage7	DB	"vOɂ郁[̃f[^[̔jB",0DH,0AH,"$"
ComSmoleMessage8	DB	"\ȋ󂫃[B",0DH,0AH,"$"
ComSmoleMessage9	DB	"sȃ[ubN̎gpB",0DH,0AH,"$"
ComSmole:			;[̍ŏ
	PUSH	DX		;
	PUSH	CX		;WX^̕ۑ
	
	MOV	ES,CS:[002CH]	;ZOg̊J
	MOV	AH,49H		;
	INT	21H		;
	
	MOV	AX,CS		;
	MOV	DS,AX		;DSCS
	MOV	ES,AX		;ESCS
	MOV	BX,OFFSET WTD_MML_Compiler_End+BSTACK
	MOV	CL,4		;
	SHR	BX,CL		;
	INC	BX		;BXvȎ傫ipOtPʁj
	MOV	AH,04AH		;
	INT	21H		;ŏ
	PUSH	BX		;
	PUSH	AX		;Ԃl̕ۑ
	JC	ComSmoleERR	;G[ɔ
	CLC			;Cy'L'
	JMP	ComSmoleRET	;RETURN
;===============================================================|
ComSmoleERR:			;t@NV4AH ̂dqqnq
	CMP	AX,07H		;
	JNZ	ComSmoleER8	;ERROR CODE=07H
	MOV	AH,09H		;
	MOV	DX,OFFSET ComSmoleMessage7
	INT	21H		;bZ[W̕\
	STC			;Cy'H'
	JMP	ComSmoleRET	;RETURN
ComSmoleER8:
	CMP	AX,08H		;
	JNZ	ComSmoleER9	;ERROR CODE=08H
	MOV	AH,09H		;
	MOV	DX,OFFSET ComSmoleMessage8
	INT	21H		;bZ[W̕\
	STC			;Cy'L'
	JMP	ComSmoleRET	;RETURN
ComSmoleER9:
	MOV	AH,09H		;ERROR CODE=09H
	MOV	DX,OFFSET ComSmoleMessage9
	INT	21H		;bZ[W̕\
	STC			;Cy'H'
	JMP	ComSmoleRET	;RETURN
;===============================================================|
ComSmoleRET:			;qdstqm
	POP	AX		;
	POP	BX		;
	POP	CX		;WX^[̕A
	POP	DX		;
	RET			;RETURN
;---------------------------------------------------------------|
;		G[					|
;---------------------------------------------------------------|
P_TAB	DB	"	$"
P	DB	0DH,0AH,'$'
ERROR	DB	't@C܂B',0DH,0AH,'$'
FERROR	DB	'WTC[32;4m t@C[.mml][32;0m [m',0DH,0AH,'$'
RERROR	DB	't@Cǂ߂܂B',0AH,0DH,24H
MEMERR	DB	'܂B',0AH,0DH,24H
ZERROR	DB	'ero풓Ă܂B',0AH,0DH,'$'
OERROR	DB	'I[vɎs܂',0DH,0AH,'$'
CERROR	DB	'N[YɎs܂',0DH,0AH,'$'
LERROR	DB	'[v֌WłB',0DH,0AH,'$'
MACERR	DB	'}NŃ}NĂяo߂łB',0DH,0AH,'$'
MACERR2	DB	'`ĂȂ}NgpĂ܂B',0DH,0AH,'$'
INCERR	DB	'݂ȂCN[ht@Cw肵Ă܂B',0DH,0AH,'$'
VOIERR	DB	'݂ȂFt@Cw肵Ă܂B',0DH,0AH,'$'

D_SEG:	MOV	AX,ES			;
	MOV	DS,AX			;DSData
	ADD	DX,1000H		;
	RET				;
C_SEG:	MOV	AX,CS			;
	MOV	DS,AX			;DSProgram
	RET				;
LPRINT:	MOV	AH,09H			;
	INT	21H			;PRINT
	RET				;
LOAD_ERROR:
	MOV	DX,OFFSET ERROR		;
PRINT:	MOV	AX,CS			;
	MOV	DS,AX			;
	MOV	AH,09H			;
	INT	21H			;
	JMP	COMEND			;
FILE_ERROR:
	MOV	DX,OFFSET FERROR	;
	JMP	PRINT			;
MOPEN_ERROR:
	MOV	DX,OFFSET MEMERR	;
	JMP	PRINT			;
OPEN_ERROR:
	MOV	DX,OFFSET OERROR	;
	JMP	PRINT			;
CLOSE_ERROR:
	MOV	DX,OFFSET CERROR	;
	JMP	PRINT			;
READ_ERROR:
	MOV	DX,OFFSET RERROR	;
	JMP	PRINT			;
ZYO_ERROR:
	MOV	DX,OFFSET ZERROR	;
	JMP	PRINT			;
LOOP_ERROR:
	MOV	DX,OFFSET LERROR	;[v肪
	JMP	PRINT			;
MACRO_ERROR:
	MOV	DX,OFFSET MACERR	;݂Ȃ}Ňďo
	JMP	PRINT			;
MACRO_ERROR2:
	MOV	DX,OFFSET MACERR2	;}NŃ}NĂт
	JMP	PRINT			;
INC_ERROR:
	MOV	DX,OFFSET INCERR	;݂ȂCN[ht@C
	MOV	AX,CS			;
	MOV	DS,AX			;
	MOV	AH,09H			;
	INT	21H			;
	MOV	DX,OFFSET INCFILE	;
	JMP	PRINT			;
VOI_ERROR:
	MOV	DX,OFFSET VOIERR	;݂ȂFt@C
	MOV	AX,CS			;
	MOV	DS,AX			;
	MOV	AH,09H			;
	INT	21H			;
	MOV	DX,OFFSET c_Voice_File	;
	JMP	PRINT			;
SOPEN_ERROR:
	PUSH	AX
	MOV	AH,09H
	MOV	DX,SI
	INT	21H
	POP	AX
	CMP	AX,3
	MOV	DX,OFFSET FSERR3
	JMP	PRINT
	CMP	AX,4
	MOV	DX,OFFSET FSERR4
	JMP	PRINT
	CMP	AX,5
	MOV	DX,OFFSET FSERR5
	JMP	PRINT
	JMP	OPEN_ERROR
FSERR3	DB	'ȃpXEt@C',0AH,0DH,24H
FSERR4	DB	'ɃI[vĂt@C',0AH,0DH,24H
FSERR5	DB	'ANZX̔ے',0AH,0DH,24H


