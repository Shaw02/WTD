Microsoft (R) Macro Assembler Version 6.11		    04/22/12 02:03:04
WTD.asm							     Page 1 - 1


				;=======================================================================|
				;									|
				;		Wander Swan Total Sound Driver				|
				;				Main program				|
				;									|
				;					Programmed by			|
				;						A.Watanabe		|
				;									|
				;=======================================================================|

					.186

				;=======================================================================|
				;				define					|
				;=======================================================================|
				include process.inc			;定義ファイル　プロセス
			      C ;=======================================================================|
			      C ;									|
			      C ;			ＷａｎｄｅｒＳｗａｎ				|
			      C ;				汎用定義ファイル			|
			      C ;				ＯＳ編　−プロセス			|
			      C ;									|
			      C ; Copyright (c) 1999-2000, Qute Corporation. All rights reserved.	|
			      C ;									|
			      C ; FreyaOS process control block structure				|
			      C ;	$Id: process.h,v 1.4 2001/09/27 07:39:36 satoo Exp $		|
			      C ;									|
			      C ;						A.Watanabe (S.W.)	|
			      C ;									|
			      C ;=======================================================================|
			      C ;===============ProcIL return codes
 = 0000			      C E_PROC_SUCCESS		equ	0
 =-0001			      C E_PROC_CANTLOAD		equ	-1
			      C 
			      C ;===============process status codes */
 = 0000			      C S_PCB_NOT_USED		equ	0
 = 0001			      C S_PCB_LOAD		equ	1
 = 0002			      C S_PCB_RUN		equ	2
 = 0003			      C S_PCB_SUSPEND		equ	3
			      C 
			      C ;===============maximum process count: 0 for FreyaOS itself */
 = 0003			      C MAXPROCESSES		equ	3
			      C 
 0010			      C ProcControl		struc			;
 0000  0000		      C ProcControl_status	dw	?		;status of process
 0002  0000		      C ProcControl_exit_code	dw	?		;process exit code
			      C ;if			HOLD_TIME_INFO
 0004  00000000		      C ProcControl_born	dd	?		;process born time
 0008  00000000		      C ProcControl_started	dd	?		;recent starting time
 000C  00000000		      C ProcControl_ellapse	dd	?		;total ellapse time
			      C ;endif
			      C ProcControl		ends			;
			      C 
 0060			      C ProcContext		struc			;
 0000  0004 [		      C ProcContext_id		db	4	dup(?)	; mark: "LCC"/"TCC"
        00
       ]
 0004  0000		      C ProcContext_pid		dw	?		; pid of process
 0006  0000		      C ProcContext_ppid	dw	?		; pid of parent process
 0008  0000		      C ProcContext_pcbid	dw	?		; pcbid of process
 000A  0000		      C ProcContext_ppcbib	dw	?		; parent's pcbid
 000C  00000000		      C ProcContext_ilib	dd	?		; IlibIL for this process
 0010  00000000		      C ProcContext_proc	dd	?		; ProcIL for this process
 0014  00000000		      C ProcContext_cwfs	dd	?		; current working filesystem
 0018  0040 [		      C ProcContext_currentdir	db	64	dup(?)	; current working directory
        00
       ]
 0058  0000		      C ProcContext_argv	dw 	?		; execution arguments
 005A  00000000		      C ProcContext_resource	dd	?		; poiter to resource
 005E  0000		      C ProcContext_heap	dw	?		; poiter to free heap area
			      C ProcContext		ends			;
			      C 
			      C ;手動で書いて！！
			      C ;#define pcbid2bankno(id)	(BANK_OSWORK - (id))
			      C 
			      C ;使う命令のコメントを外して！！
			      C ;int near pcb_get_pcbid(void);
			      C ;EXTRN	_pcb_get_pcbid:near
			      C ;int near pcb_get_ppcbid(int id);
			      C ;EXTRN	_pcb_get_ppcbid:near
			      C ;int near pcb_get_pid(int id);
			      C ;EXTRN	_pcb_get_pid:near
			      C ;int near pcb_get_ppid(int id);
			      C ;EXTRN	_pcb_get_ppid:near
			      C ;int near pcb_get_status(int id);
			      C ;EXTRN	_pcb_get_status:near
			      C ;int near pcb_get_argv(int id, int index, char far *buf, int len);
			      C ;EXTRN	_pcb_get_argv:near
			      C ;int near pcb_get_srambank(void);
			      C ;EXTRN	_pcb_get_srambank:near
			      C 
			      C ;if	HOLD_TIME_INFO
			      C 
			      C ;time_t near pcb_get_born_time(int id);
			      C ;EXTRN	_pcb_get_born_time:near
			      C ;unsigned long near pcb_get_started_tick(int id);
			      C ;EXTRN	_pcb_get_started_tick:near
			      C ;unsigned long near pcb_get_ellapsed_tick(int id);
			      C ;EXTRN	_pcb_get_ellapsed_tick:near
			      C 
			      C ;endif
			      C 
			      C 
			      C 
				include	service.inc			;定義ファイル　割り込み
			      C ;=======================================================================|
			      C ;									|
			      C ;			ＷａｎｄｅｒＳｗａｎ				|
			      C ;				汎用定義ファイル			|
			      C ;				割り込み編				|
			      C ;									|
			      C ;						A.Watanabe (S.W.)	|
			      C ;									|
			      C ;=======================================================================|
			      C ;************************************************************************
			      C ;*									*
			      C ;*			ＢＩＯＳファンクション定義			*
			      C ;*									*
			      C ;************************************************************************
 = 0010			      C INT_BIOS_VECTOR_BASE		equ	010h
			      C ;===============割り込み番号定義
 = 0010			      C INT_EXIT	equ	INT_BIOS_VECTOR_BASE + 0	;プログラムの終了
 = 0011			      C INT_KEY		equ	INT_BIOS_VECTOR_BASE + 1	;キー制御
 = 0012			      C INT_DISP	equ	INT_BIOS_VECTOR_BASE + 2	;画面制御
 = 0013			      C INT_TEXT	equ	INT_BIOS_VECTOR_BASE + 3	;テキスト制御
 = 0014			      C INT_COMM	equ	INT_BIOS_VECTOR_BASE + 4	;シリアル通信制御
 = 0015			      C INT_SOUND	equ	INT_BIOS_VECTOR_BASE + 5	;サウンド制御
 = 0016			      C INT_TIMER	equ	INT_BIOS_VECTOR_BASE + 6	;カレンダ／タイマ制御
 = 0017			      C INT_SYSTEM	equ	INT_BIOS_VECTOR_BASE + 7	;システム制御
 = 0018			      C INT_BANK	equ	INT_BIOS_VECTOR_BASE + 8	;バンク制御
			      C 
			      C 
			      C ;************************************************************************
			      C ;*									*
			      C ;*			ハードウェア割り込み定義			*
			      C ;*									*
			      C ;************************************************************************
 = 0028			      C INT_HARDHAEW_VECTOR_BASE	equ	028h
			      C ;===============割り込み番号定義
 = 0000			      C SYS_INT_SENDREADY		equ	0	;シリアル送信データエンプティー
 = 0001			      C SYS_INT_KEY			equ	1	;キー割り込み
 = 0002			      C SYS_INT_CASETTE			equ	2	;カセット割り込み
 = 0003			      C SYS_INT_RECEIVEREADY		equ	3	;シリアル受信データレディー
 = 0004			      C SYS_INT_DISPLINE		equ	4	;描画ライン番号検知割り込み
 = 0005			      C SYS_INT_VBLANK_COUNTUP		equ	5	;垂直同期タイマー割り込み
 = 0006			      C SYS_INT_VBLANK			equ	6	;垂直同期期間開始
 = 0007			      C SYS_INT_HBLANK_COUNTUP		equ	7	;水平同期タイマー割り込み
			      C 
 = 0028			      C INT_SENDREADY		equ INT_HARDHAEW_VECTOR_BASE + SYS_INT_SENDREADY
 = 0029			      C INT_KEY_PUSH		equ INT_HARDHAEW_VECTOR_BASE + SYS_INT_KEY
 = 002A			      C INT_CASETTE		equ INT_HARDHAEW_VECTOR_BASE + SYS_INT_CASETTE
 = 002B			      C INT_RECEIVEREADY	equ INT_HARDHAEW_VECTOR_BASE + SYS_INT_RECEIVEREADY
 = 002C			      C INT_DISPLINE		equ INT_HARDHAEW_VECTOR_BASE + SYS_INT_DISPLINE
 = 002D			      C INT_VBLANK_COUNTUP	equ INT_HARDHAEW_VECTOR_BASE + SYS_INT_VBLANK_COUNTUP
 = 002E			      C INT_VBLANK		equ INT_HARDHAEW_VECTOR_BASE + SYS_INT_VBLANK
 = 002F			      C INT_HBLANK_COUNTUP	equ INT_HARDHAEW_VECTOR_BASE + SYS_INT_HBLANK_COUNTUP
			      C 
			      C 
			      C ;************************************************************************
			      C ;*									*
			      C ;*			システム割り込み定義				*
			      C ;*									*
			      C ;************************************************************************
 = 0030			      C INT_SYSCALL_VECTOR_BASE		equ	030h
			      C ;===============割り込み番号定義
 = 0030			      C INT_PROCESS	equ	INT_SYSCALL_VECTOR_BASE + 0	;不明
 = 0031			      C INT_FILESYS	equ	INT_SYSCALL_VECTOR_BASE + 1	;不明
 = 0032			      C INT_ILIB	equ	INT_SYSCALL_VECTOR_BASE + 2	;不明
			      C 
			      C 
			      C 
				include	timer.inc			;定義ファイル　タイマー
			      C ;=======================================================================|
			      C ;									|
			      C ;			ＷａｎｄｅｒＳｗａｎ				|
			      C ;				汎用定義ファイル			|
			      C ;				ＢＩＯＳ編　−カレンダ／タイマー制御	|
			      C ;									|
			      C ;						A.Watanabe (S.W.)	|
			      C ;									|
			      C ;=======================================================================|
			      C ;===============機能番号定義	（AHレジスタに代入し、割り込みをかける。）
 = 0000			      C RTC_RESET			equ	00h	;RTCリセット
 = 0001			      C RTC_GET_DATETIME		equ	01h	;RTC日付時間取得
 = 0002			      C RTC_SET_DATETIME		equ	02h	;RTC日付時間設定
 = 0003			      C RTC_SET_DATETIME_STRUCT		equ	03h	;RTC日付時間一括設定
 = 0004			      C RTC_GET_DATETIME_STRUCT		equ	04h	;RTC日付時間一括取得
 = 0005			      C RTC_ENABLE_ALARM		equ	05h	;RTCアラーム割り込み設定
 = 0006			      C RTC_DISABLE_ALARM		equ	06h	;RTC割り込み解除
 = 0007			      C TIMER_ENABLE			equ	07h	;タイマー割り込み設定
 = 0008			      C TIMER_DISABLE			equ	08h	;タイマー割り込み禁止
 = 0009			      C TIMER_GET_COUNT			equ	09h	;タイマーカウント値取得
			      C ;===============カレンダ・時計
 = 0000			      C RTC_YEAR			equ	00h	;年
 = 0001			      C RTC_MONTH			equ	01h	;月
 = 0002			      C RTC_DATE			equ	02h	;日
 = 0003			      C RTC_DAY_OF_WEEK			equ	03h	;曜日
 = 0004			      C RTC_HOUR			equ	04h	;時間
 = 0005			      C RTC_MIN				equ	05h	;分
 = 0006			      C RTC_SEC				equ	06h	;秒
			      C ;===============timer_type
 = 0000			      C TIMER_HBLANK			equ	00h	;HBLANK_CoundUp
 = 0001			      C TIMER_VBLANK			equ	01h	;VBLANK_CountUp
			      C ;===============timer_preset_type
 = 0000			      C TIMER_ONESHOT			equ	00h	;OneShotType
 = 0001			      C TIMER_AUTOPRESET		equ	01h	;AutoPresetType
			      C 
				include	comm.inc			;定義ファイル　通信
			      C ;=======================================================================|
			      C ;									|
			      C ;			ＷａｎｄｅｒＳｗａｎ				|
			      C ;				汎用定義ファイル			|
			      C ;				ＢＩＯＳ編　−シリアル制御		|
			      C ;									|
			      C ;						A.Watanabe (S.W.)	|
			      C ;									|
			      C ;=======================================================================|
			      C ;===============機能番号定義	（AHレジスタに代入し、割り込みをかける。）
 = 0000			      C COMM_OPEN			equ	00h	;通信開始
 = 0001			      C COMM_CLOSE			equ	01h	;通信終了
 = 0002			      C COMM_SEND_CHAR			equ	02h	;１バイト送信
 = 0003			      C COMM_RECEIVE_CHAR		equ	03h	;１バイト受信
 = 0004			      C COMM_RECEIVE_WITH_TIMEOUT	equ	04h	;ﾀｲﾑｱｳﾄ指定１バイト受信
 = 0005			      C COMM_SEND_STRING		equ	05h	;文字列送信
 = 0006			      C COMM_SEND_BLOCK			equ	06h	;ブロック送信
 = 0007			      C COMM_RECEIVE_BLOCK		equ	07h	;ブロック受信
 = 0008			      C COMM_SET_TIMEOUT		equ	08h	;タイムアウト設定
 = 0009			      C COMM_SET_BAUDRATE		equ	09h	;通信ボーレート設定
 = 000A			      C COMM_GET_BAUDRATE		equ	0ah	;通信ボーレート所得
 = 000B			      C COMM_SET_CANCEL_KEY		equ	0bh	;通信キャンセルキーパターン設定
 = 000C			      C COMM_GET_CANCEL_KEY		equ	0ch	;通信キャンセルキーパターン所得
 = 000D			      C COMM_XMODEM			equ	0dh	;X-modem送受信
			      C ;===============ボーレート
 = 0000			      C COMM_SPEED_9600			equ	0	; 9600[bps]
 = 0001			      C COMM_SPEED_38400		equ	1	;38400[bps]
			      C ;===============XMODEM structure
 0010			      C xmodeminfo			struc
 0000  0000		      C xmodeminfo_state		dw	?	;メーカ未公開
 0002  00		      C xmodeminfo_mode			db	?	;
 0003  00		      C xmodeminfo_retry_c		db	?	;
 0004  0000		      C xmodeminfo_block_c		dw	?	;
 0006  0000		      C xmodeminfo_block_max		dw	?	;
 0008  0000		      C xmodeminfo_block_sixa		dw	?	;
 000A  0000		      C xmodeminfo_bank			dw	?	;
 000C  0000		      C xmodeminfo_offset		dw	?	;
 000E  0000		      C xmodeminfo_timeout_c		dw	?	;
			      C xmodeminfo			ends
			      C ;===============XMODEM state codes
 = 0001			      C XM_START			equ	1	;メーカ未公開
 = 0002			      C XM_NEGO				equ	2	;
 = 0003			      C XM_BLOCK			equ	3	;
 = 0004			      C XM_BLOCK_RETRY			equ	4	;
 = 0005			      C XM_CLOSE			equ	5	;
 = 0006			      C XM_ABORT			equ	6	;
 = 0007			      C XM_DONE				equ	7	;
 = 0008			      C XM_ERASE_BANK			equ	8	;
			      C ;===============XMODEM transfer modes
 = 0000			      C XMODE_SEND			equ	0	;送信　メーカ未公開
 = 0001			      C XMODE_RECEIVE			equ	1	;受信
 = 0002			      C XMODE_SEND_ENCRYPTED		equ	2	;
 = 0003			      C XMODE_RECEIVE_ENCRYPTED		equ	3	;
 = 0004			      C XMODE_AUTO_ERASE		equ	4	;
			      C ;===============SIO error codes
 = 0000			      C ERR_SIO_OK			equ	0000h	;エラー無し
 = 8100			      C ERR_SIO_BUSY			equ	8100h	;ビジー
 = 8101			      C ERR_SIO_TIMEOUT			equ	8101h	;タイムアウト
 = 8102			      C ERR_SIO_OVERRUN			equ	8102h	;オーバーラン
 = 8103			      C ERR_SIO_CANCEL			equ	8103h	;キャンセル
			      C ;===============XMODEM error codes
 = 8104			      C ERR_XM_STATECODE		equ	8104h	;ステータスコード
 = 8105			      C ERR_XM_CANCELED			equ	8105h	;キャンセルされた。
 = 8106			      C ERR_XM_BLOCK_LOST		equ	8106h	;ブロックが消えた。
 = 8107			      C ERR_XM_TOO_LARGE		equ	8107h	;大きすぎ。
			      C 
				include	sound.inc			;定義ファイル　サウンド
			      C ;=======================================================================|
			      C ;									|
			      C ;			ＷａｎｄｅｒＳｗａｎ				|
			      C ;				汎用定義ファイル			|
			      C ;				ＢＩＯＳ編　−サウンド制御		|
			      C ;									|
			      C ;						A.Watanabe (S.W.)	|
			      C ;									|
			      C ;=======================================================================|
			      C ;===============機能番号定義	（AHレジスタに代入し、割り込みをかける。）
 = 0000			      C SOUND_INIT			equ	00h		;サウンド初期化
 = 0001			      C SOUND_SET_CHANNEL		equ	01h		;出力・モード設定
 = 0002			      C SOUND_GET_CHANNEL		equ	02h		;出力・モード取得
 = 0003			      C SOUND_SET_OUTPUT		equ	03h		;サウンド出力設定
 = 0004			      C SOUND_GET_OUTPUT		equ	04h		;サウンド出力取得
 = 0005			      C SOUND_SET_WAVE			equ	05h		;波形設定
 = 0006			      C SOUND_SET_PITCH			equ	06h		;サウンド周波数設定
 = 0007			      C SOUND_GET_PITCH			equ	07h		;サウンド周波数所得
 = 0008			      C SOUND_SET_VOLUME		equ	08h		;サウンド音量設定
 = 0009			      C SOUND_GET_VOLUME		equ	09h		;サウンド音量所得
 = 000A			      C SOUND_SET_SWEEP			equ	0Ah		;ﾁｬﾝﾈﾙ3ｽｳｨｰﾌﾟ設定
 = 000B			      C SOUND_GET_SWEEP			equ	0Bh		;ﾁｬﾝﾈﾙ3ｽｳｨｰﾌﾟ所得
 = 000C			      C SOUND_SET_NOISE			equ	0Ch		;ﾁｬﾝﾈﾙ4ﾉｲｽﾞ設定
 = 000D			      C SOUND_GET_NOISE			equ	0Dh		;ﾁｬﾝﾈﾙ4ﾉｲｽﾞ所得
 = 000E			      C SOUND_GET_RANDOM		equ	0Eh		;ﾁｬﾝﾈﾙ4疑似乱数ﾃﾞｰﾀ所得
			      C 
				include	bank.inc			;定義ファイル　バンク
			      C ;=======================================================================|
			      C ;									|
			      C ;			ＷａｎｄｅｒＳｗａｎ				|
			      C ;				汎用定義ファイル			|
			      C ;				ＢＩＯＳ編　−バンク制御		|
			      C ;									|
			      C ;						A.Watanabe (S.W.)	|
			      C ;									|
			      C ;=======================================================================|
			      C ;===============機能番号定義	（AHレジスタに代入し、割り込みをかける。）
 = 0000			      C BANK_SET_MAP			equ	00h	;バンクマッピング設定
 = 0001			      C BANK_GET_MAP			equ	01h	;バンクマッピング取得
 = 0002			      C BANK_READ_BYTE			equ	02h	;バンク指定１バイト読みこみ
 = 0003			      C BANK_WRITE_BYTE			equ	03h	;バンク指定１バイト書きこみ
 = 0004			      C BANK_READ_WORD			equ	04h	;バンク指定１ワード読みこみ
 = 0005			      C BANK_WRITE_WORD			equ	05h	;バンク指定１ワード書きこみ
 = 0006			      C BANK_READ_BLOCK			equ	06h	;バンク指定ブロック読みこみ
 = 0007			      C BANK_WRITE_BLOCK		equ	07h	;バンク指定ブロック書きこみ
 = 0008			      C BANK_FILL_BLOCK			equ	08h	;バンク指定ブロックフィル
 = 0009			      C BANK_ERASE_FLASH		equ	09h	;ﾌﾗｯｼｭﾛﾑのﾌﾗｯｼｭ（メーカ未公開）
			      C ;===============bank identifiers
 = 0000			      C BANK_SRAM			equ	0	;バンク SRAM
 = 0001			      C BANK_ROM0			equ	1	;バンク ROM0
 = 0002			      C BANK_ROM1			equ	2	;バンク ROM1
			      C 
 = 1000			      C BANK_SRAM_ADDRESS		equ	01000h	;SRAM　のセグメントアドレス
 = 2000			      C BANK_ROM0_ADDRESS		equ	02000h	;ROM0　のセグメントアドレス
 = 3000			      C BANK_ROM1_ADDRESS		equ	03000h	;ROM1　のセグメントアドレス
			      C 
 = 007F			      C BANK_MAX_BANKS			equ	7Fh	;バンクの最大
			      C 
 = 0000			      C BANK_SOFTFS			equ	00h	;SRAM FreyaOS Filesys
 = 0001			      C BANK_USERDS1			equ	01h	;SRAM FreyaOS Process 2
 = 0002			      C BANK_USERDS0			equ	02h	;SRAM FreyaOS Peocess 1
 = 0003			      C BANK_OSWORK			equ	03h	;SRAM FreyaOS Work
			      C 
			      C ;#define sram_get_map()		bank_get_map(BANK_SRAM)
			      C SRAM_GET_MAP	macro
			      C 		mov	ah,BANK_GET_MAP		;ファンクション番号
			      C 		mov	bl,BANK_SRAM		;バンクの種類　SRAM
			      C 		int	INT_BANK		;ファンクション呼び出し
			      C 		endm
			      C 
			      C ;#define sram_set_map(bank)	bank_set_map(BANK_SRAM, bank)
			      C SRAM_SET_MAP	macro	bank
			      C 		mov	ah,BANK_SET_MAP		;ファンクション番号
			      C 		mov	bl,BANK_SRAM		;バンクの種類　SRAM
			      C 		mov	cx,bank			;バンク番号
			      C 		int	INT_BANK		;ファンクション呼び出し
			      C 		endm
			      C 
			      C ;#define rom0_get_map()		bank_get_map(BANK_ROM0)
			      C ROM0_GET_MAP	macro
			      C 		mov	ah,BANK_GET_MAP		;ファンクション番号
			      C 		mov	bl,BANK_ROM0		;バンクの種類　ROM0
			      C 		int	INT_BANK		;ファンクション呼び出し
			      C 		endm
			      C 
			      C ;#define rom0_set_map(bank)	bank_set_map(BANK_ROM0, bank)
			      C ROM0_SET_MAP	macro	bank
			      C 		mov	ah,BANK_SET_MAP		;ファンクション番号
			      C 		mov	bl,BANK_ROM0		;バンクの種類　ROM0
			      C 		mov	cx,bank			;バンク番号
			      C 		int	INT_BANK		;ファンクション呼び出し
			      C 		endm
			      C 
			      C ;#define rom1_get_map()		bank_get_map(BANK_ROM1)
			      C ROM1_GET_MAP	macro
			      C 		mov	ah,BANK_GET_MAP		;ファンクション番号
			      C 		mov	bl,BANK_ROM1		;バンクの種類　ROM1
			      C 		int	INT_BANK		;ファンクション呼び出し
			      C 		endm
			      C 
			      C ;#define rom1_set_map(bank)	bank_set_map(BANK_ROM1, bank)
			      C ROM1_SET_MAP	macro	bank
			      C 		mov	ah,BANK_SET_MAP		;ファンクション番号
			      C 		mov	bl,BANK_ROM1		;バンクの種類　ROM1
			      C 		mov	cx,bank			;バンク番号
			      C 		int	INT_BANK		;ファンクション呼び出し
			      C 		endm
			      C 
				include	wtd_def.inc			;定義ファイル　ドライバー
			      C ;=======================================================================|
			      C ;									|
			      C ;		Wander Swan Total Sound Driver				|
			      C ;				define file				|
			      C ;					for Assemble Language		|
			      C ;									|
			      C ;					Programmed by			|
			      C ;						A.Watanabe		|
			      C ;									|
			      C ;=======================================================================|
			      C ;****************************************************************
			      C ;*								*
			      C ;*			マクロ定義				*
			      C ;*								*
			      C ;****************************************************************
			      C ;===============================================================|
			      C ;	マクロ	ワークエリアのアドレスを取得する		|
			      C ;===============================================================|
			      C ;	●マクロ書式						|
			      C ;		WTD_WorkGet	reg1,reg2			|
			      C ;	●引数							|
			      C ;		DS	DGROUP					|
			      C ;	●返値							|
			      C ;		reg1	Segment Address				|
			      C ;		reg2	Offset  Address				|
			      C ;===============================================================|
			      C WTD_WorkGet	macro	seg,off		;
			      C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			      C 
			      C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
			      C 		push	IRAM_Segment		;
			      C 		pop	seg			;
			      C 		mov	off,offset DGROUP:_WTD_Work
			      C 
			      C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			      C 		push	SRAM_Segment		;（WonderWitch等）
			      C 		pop	seg			;
			      C 		mov	off,offset DGROUP:_WTD_Work
			      C endif	;-----------------------
			      C 
			      C else	;--------------------------------	;WonderWitch版
			      C 		push	SRAM_Segment		;
			      C 		pop	seg			;
			      C 		mov	off,ds:[ProcContext_heap]
			      C endif	;--------------------------------
			      C 		endm				;
			      C 
			      C ;****************************************************************
			      C ;*								*
			      C ;*			定数					*
			      C ;*								*
			      C ;****************************************************************
			      C ;===============================================================|
			      C ;		ハードウェア割り込み				|
			      C ;===============================================================|
 = INT_HARDHAEW_VECTOR_BASE   C InterruptVectorBase_WW	equ	INT_HARDHAEW_VECTOR_BASE	;WonderWitch
 = InterruptVectorBase_WW     C InterruptVectorBase	equ	InterruptVectorBase_WW		;割り込みベクタ
			      C 
			      C ;===============================================================|
			      C ;		Wander Swan Segment Address			|
			      C ;===============================================================|
			      C ;セグメントアドレス定義
 = 0000			      C IRAM_Segment		equ	0000h			;本体RAM
 = BANK_SRAM_ADDRESS	      C SRAM_Segment		equ	BANK_SRAM_ADDRESS	;SRAM
 = BANK_ROM0_ADDRESS	      C FROM_Segment		equ	BANK_ROM0_ADDRESS	;ROM
			      C 
			      C ;===============================================================|
			      C ;		本体RAM Work Address				|
			      C ;===============================================================|
			      C ;CommEnpty_intvector	equ	000a0h		;割り込みベクタ(028h×4)
			      C ;Hblank_intvector	equ	000bch		;割り込みベクタ(02fh×4)
			      C 
 = 0180			      C IRAM_SoundVoiceTable_WW	equ	00180h			;WonderWitch設定
 = IRAM_SoundVoiceTable_WW    C IRAM_SoundVoiceTable	equ	IRAM_SoundVoiceTable_WW	;音色テーブル
			      C 
			      C ;===============================================================|
			      C ;		ワーク領域アドレス				|
			      C ;===============================================================|
			      C ;構造体位置
 = 0000			      C WTD_WorkAdd_User	equ	0000h		;ユーザ用ワーク
 = 0100			      C WTD_WorkAdd_Wave	equ	0100h		;音色
 = 0200			      C WTD_WorkAdd_Emb		equ	0200h		;エンベロープ
 = 0380			      C WTD_WorkAdd_System	equ	0380h		;パート共通構造体
			      C 
 = 0400			      C WTD_WorkAdd_Ech0	equ	0400h		;Effect ch1
 = 0480			      C WTD_WorkAdd_Ech1	equ	0480h		;Effect ch2
 = 0500			      C WTD_WorkAdd_Ech2	equ	0500h		;Effect ch3
 = 0580			      C WTD_WorkAdd_PCM		equ	0580h		;Effect PCM Voice
			      C 
 = 0600			      C WTD_WorkAdd_Ch0		equ	0600h		;ch0
 = 0680			      C WTD_WorkAdd_Ch1		equ	0680h		;ch1
 = 0700			      C WTD_WorkAdd_Ch2		equ	0700h		;ch2
 = 0780			      C WTD_WorkAdd_Ch3		equ	0780h		;ch3
 = 0800			      C WTD_WorkAdd_Ch4		equ	0800h		;ch4
 = 0880			      C WTD_WorkAdd_Ch5		equ	0880h		;ch5
 = 0900			      C WTD_WorkAdd_Ch6		equ	0900h		;ch6
 = 0980			      C WTD_WorkAdd_Ch7		equ	0980h		;ch7
 = 0A00			      C WTD_WorkAdd_Ch8		equ	0a00h		;ch8
 = 0A80			      C WTD_WorkAdd_Ch9		equ	0a80h		;ch9
 = 0B00			      C WTD_WorkAdd_Ch10	equ	0b00h		;ch10
 = 0B80			      C WTD_WorkAdd_Ch11	equ	0b80h		;ch11
 = 0C00			      C WTD_WorkAdd_Ch12	equ	0c00h		;ch12
 = 0C80			      C WTD_WorkAdd_Ch13	equ	0c80h		;ch13
 = 0D00			      C WTD_WorkAdd_Ch14	equ	0d00h		;ch14
 = 0D80			      C WTD_WorkAdd_Ch15	equ	0d80h		;ch15
 = 0E00			      C WTR_WorkAdd_Ch16	equ	0e00h		;ch16
 = 0E80			      C WTD_WorkAdd_Ch17	equ	0e80h		;ch17
 = 0F00			      C WTD_WorkAdd_Ch18	equ	0f00h		;ch18
 = 0F80			      C WTD_WorkAdd_Ch19	equ	0f80h		;ch19
			      C 
 = 0080			      C WTD_WorkChSize		equ	080h		;ワークのサイズ
 = 1000			      C WTD_WorkSize		equ	1000h		;ワークのサイズ
			      C 
 = WTD_WorkSize		      C WTD_WorkAdd_End		equ	WTD_WorkSize	;ワークの最後＋１
			      C 
			      C ;****************************************************************
			      C ;*								*
			      C ;*			構造体定義				*
			      C ;*								*
			      C ;****************************************************************
			      C ;===============================================================|
			      C ;		Micro Soft  RIFF and Wave data formats		|
			      C ;===============================================================|
			      C ;構造体定義 RIFF Header
 000D			      C Riff			struc			;
 0000  0004 [		      C Riff_Head		db	4	dup(?)	;'RIFF'
        00
       ]
 0004  00000000		      C Riff_Size		dd	?		;File Size(全体-8)
 0008  0004 [		      C Riff_Type		db	4	dup(?)	;'WAVE'
        00
       ]
 000C  00		      C Riff_Data		db	?		;データ
			      C Riff			ends
			      C 
			      C ;構造体定義	RIFF struct
 0009			      C RiffHed			struc			;
 0000  0004 [		      C RiffHed_Head		db	4	dup(?)	;ヘッダ
        00
       ]
 0004  00000000		      C RiffHed_Size		dd	?		;ヘッダのデータのサイズ
 0008  00		      C RiffHed_Data		db	?		;ヘッダのデータ
			      C RiffHed			ends			;
			      C 
			      C ;構造体定義	WAVE fmt
 0018			      C WaveFmt			struc			;
 0000  0004 [		      C WaveFmt_Head		db	4	dup(?)	;'fmt '
        00
       ]
 0004  00000000		      C WaveFmt_Size		dd	?		;16	[byte]
 0008  0000		      C WaveFmt_Type		dw	?		;1	(wave)
 000A  0000		      C WaveFmt_Channel		dw	?		;1	(mono)
 000C  00000000		      C WaveFmt_SamplingRate	dd	?		;11025	[Hz]
 0010  00000000		      C WaveFmt_SamplingSec	dd	?		;11025	[Byte]
 0014  0000		      C WaveFmt_DataSize	dw	?		;1	[Byte]
 0016  0000		      C WaveFmt_ChannelSize	dw	?		;8	[bit]
			      C WaveFmt			ends			;
			      C 
			      C ;構造体定義	WAVE Data
 0009			      C WaveData		struc			;
 0000  0004 [		      C WaveData_Head		db	4	dup(?)	;'data'
        00
       ]
 0004  00000000		      C WaveData_Size		dd	?		;Data Size
 0008  00		      C WaveData_Data		db	?		;wave data
			      C WaveData		ends			;
			      C 
			      C ;===============================================================|
			      C ;		パート個別ワーク構造体				|
			      C ;===============================================================|
			      C ;構造体定数定義
 = WTD_SweepLevel	      C WTD_NoiseMode		equ	WTD_SweepLevel	;
 = WTD_Program		      C WTD_Voice		equ	WTD_Program	;
 = WTD_ProgramRate	      C WTD_VoiceRate		equ	WTD_ProgramRate	;
 = WTD_ProgramCnt	      C WTD_VoiceCnt		equ	WTD_ProgramCnt	;
 = WTD_Program1st	      C WTD_Voice1st		equ	WTD_Program1st	;
 = WTD_Program2nd	      C WTD_Voice2nd		equ	WTD_Program2nd	;
 = WTD_Program3rd	      C WTD_Voice3rd		equ	WTD_Program3rd	;
 = WTD_Bend		      C WTD_Frection		equ	WTD_Bend	;
 = WTD_BendSet		      C WTD_FrectionSet		equ	WTD_BendSet	;
 = WTD_ExprPanSet	      C WTD_Velocity		equ	WTD_ExprPanSet	;
 = WTD_LoopCount	      C WTD_PcmAddress		equ	WTD_LoopCount	;発生中アドレス
 = WTD_LoopCount+4	      C WTD_PcmSize		equ	WTD_LoopCount+4	;発生終了アドレス
			      C ;---------------------------------------------------------------
			      C ;パート個別構造体定義
 007A			      C WTD			struc			;各パート個別用	
 0000  0000		      C WTD_FlagControl		dw	?		;00-01	フラグ
 0002  00		      C WTD_FlagTai		db	?		;02	タイフラグ
 0003  00		      C WTD_FlagSharp		db	?		;03	#フラグ
 0004  00		      C WTD_FlagFlat		db	?		;04	bフラグ
 0005  00		      C WTD_Channel		db	?		;05	ﾁｬﾝﾈﾙ/ﾄﾗｯｸ
 0006  0000		      C WTD_Address		dw	?		;06-07	演奏中のｱﾄﾞﾚｽ
 0008  0008 [		      C WTD_LoopCount		db	8	dup(?)	;08-0F	ループ回数/PCM Address
        00
       ]
 0010  00		      C WTD_LoopCountPointer	db	?		;10	上記ﾎﾟｲﾝﾀ
 0011  00		      C WTD_Program		db	?		;11	出力した音色
 0012  00		      C WTD_SweepLevel		db	?		;12	ｽｳｨｰﾌﾟ値/ﾉｲｽﾞﾓｰﾄﾞ
 0013  00		      C WTD_SweepTime		db	?		;13	ｽｳｨｰﾌﾟ時間
 0014  0000		      C WTD_Leng		dw	?		;14-15	音長
 0016  0000		      C WTD_LengCounter		dw	?		;16-17	音長カウンター
 0018  0000		      C WTD_LengDefault		dw	?		;18-19	ﾃﾞﾌｫﾙﾄの音長
 001A  0000		      C WTD_KeyOffTime		dw	?		;1A-1B	ｹﾞｰﾄﾀｲﾑ制御値
 001C  0000		      C WTD_KeyOnDelay		dw	?		;1C-1D	ｷｰｵﾝﾃﾞｨﾚｲ
 001E  00		      C WTD_KeyShift		db	?		;1E	移調値
 001F  00		      C WTD_Key			db	?		;1F	音程
 0020  0008 [		      C WTD_KeySet		db	8	dup(?)	;20-27	出力した音程
        00
       ]
 0028  00		      C WTD_KeySetPointer	db	?		;28	上記ﾎﾟｲﾝﾀ
 0029  00		      C WTD_AcsentVelocity	db	?		;29	アクセント値
 002A  0000		      C WTD_BendSet		dw	?		;2A-2B	出力した周波数
 002C  0000		      C WTD_Bend		dw	?		;2C-2D	指定周波数
 002E  0000		      C WTD_BendDetune		dw	?		;2E-2F	ディチューン
 0030  00		      C WTD_BendLfoDecayRate	db	?		;30	LFOディケイレイト
 0031  00		      C WTD_BendLfoSpeedRate	db	?		;31	LFOスピード
 0032  0000		      C WTD_BendLfoLevel	dw	?		;32-33	LFO変位ﾚﾍﾞﾙ
 0034  00		      C WTD_BendLfoCount	db	?		;34	LFO変化回数
 0035  00		      C WTD_BendLfoRateCounter	db	?		;35	LFOレイト用カウンタ
 0036  0000		      C WTD_BendLfoLevelSet	dw	?		;36-37	LFO現在の変位ﾚﾍﾞﾙ
 0038  00		      C WTD_BendLfoCountCounter	db	?		;38	LFO回数用カウンタ
 0039  00		      C WTD_BendEmbAddress	db	?		;39	EMB番号（ｱﾄﾞﾚｽ）
 003A  00		      C WTD_BendEmbRate		db	?		;3A	EMBレイト
 003B  00		      C WTD_BendEmbCounter	db	?		;3B	EMBカウンター
 003C  00		      C WTD_BendEmbMaxMin	db	?		;3C	EMB最大／最小値
 003D  00		      C WTD_BendEmbLevelSet	db	?		;3D	EMB変位ﾚﾍﾞﾙ
 003E  00		      C WTD_ReleaseVolume	db	?		;3E	KeyOff時の音量
 003F  00		      C WTD_ExprPanSet		db	?		;3F	出力/ｳﾞｪﾛｼﾃｨｰ
 0040  00		      C WTD_ExprSet		db	?		;40	出力音量/ｴｸｽﾌﾟﾚｯｼｮﾝ
 0041  00		      C WTD_Expr		db	?		;41	音量/ｴｸｽﾌﾟﾚｯｼｮﾝ
 0042  0000		      C WTD_ExprDetune		dw	?		;42-43	音量増減値
 0044  00		      C WTD_ExprLfoDecayRate	db	?		;44	LFOディケイレイト
 0045  00		      C WTD_ExprLfoSpeedRate	db	?		;45	LFOスピード
 0046  0000		      C WTD_ExprLfoLevel	dw	?		;46-47	LFO変位ﾚﾍﾞﾙ
 0048  00		      C WTD_ExprLfoCount	db	?		;48	LFO変化回数
 0049  00		      C WTD_ExprLfoRateCounter	db	?		;49	LFOレイト用カウンタ
 004A  0000		      C WTD_ExprLfoLevelSet	dw	?		;4A-4B	LFO現在の変位ﾚﾍﾞﾙ
 004C  00		      C WTD_ExprLfoCountCounter	db	?		;4C	LFO回数用カウンタ
 004D  00		      C WTD_ExprEmbAddress	db	?		;4D	EMB番号（ｱﾄﾞﾚｽ）
 004E  00		      C WTD_ExprEmbRate		db	?		;4E	EMBレイト
 004F  00		      C WTD_ExprEmbCounter	db	?		;4F	EMBカウンター
 0050  00		      C WTD_ExprEmbMaxMin	db	?		;50	EMB最大／最小値
 0051  00		      C WTD_ExprEmbLevelSet	db	?		;51	EMB変位ﾚﾍﾞﾙ
 0052  00		      C WTD_WorkAddress		db	?		;52	ワークｱﾄﾞﾚｽ上位8BIT
 0053  00		      C WTD_OctaveSet		db	?		;53	出力したオクターブ
 0054  00		      C WTD_Octave		db	?		;54	指定オクターブ
 0055  00		      C WTD_GateTime8		db	?		;55	ｹﾞｰﾄﾀｲﾑ（Q,U)
 0056  0000		      C WTD_GateTimeStepLast	dw	?		;56-57	ｹﾞｰﾄﾀｲﾑ(q)
 0058  0000		      C WTD_GateTimeStepFirst	dw	?		;58-59	ｹﾞｰﾄﾀｲﾑ(u)
 005A  00		      C WTD_VolumeUpDown	db	?		;5A	相対ボリュームの増減値
 005B  0000		      C WTD_ModDecay		dw	?		;5B-5C	ﾓｼﾞｭﾚｰｼｮﾝ ﾃﾞｨｹｲﾚｲﾄ
 005D  00		      C WTD_ModLevel		db	?		;5D	ﾓｼﾞｭﾚｰｼｮﾝ ﾚﾍﾞﾙ
 005E  00		      C WTD_ModLevelSet		db	?		;5E	現在のﾓｼﾞｭﾚｰｼｮﾝ ﾚﾍﾞﾙ
 005F  00		      C WTD_Null_5F		db	?		;5F	未使用
 0060  00		      C WTD_PanSet		db	?		;60	出力パンポット
 0061  00		      C WTD_Pan			db	?		;61	パンポット
 0062  0000		      C WTD_PanDetune		dw	?		;62-63	音量増減値
 0064  00		      C WTD_PanLfoDecayRate	db	?		;64	LFOディケイレイト
 0065  00		      C WTD_PanLfoSpeedRate	db	?		;65	LFOスピード
 0066  0000		      C WTD_PanLfoLevel		dw	?		;66-67	LFO変位ﾚﾍﾞﾙ
 0068  00		      C WTD_PanLfoCount		db	?		;68	LFO変化回数
 0069  00		      C WTD_PanLfoRateCounter	db	?		;69	LFOレイト用カウンタ
 006A  0000		      C WTD_PanLfoLevelSet	dw	?		;6A-6B	LFO現在の変位ﾚﾍﾞﾙ
 006C  00		      C WTD_PanLfoCountCounter	db	?		;6C	LFO回数用カウンタ
 006D  00		      C WTD_PanEmbAddress	db	?		;6D	EMB番号（ｱﾄﾞﾚｽ）
 006E  00		      C WTD_PanEmbRate		db	?		;6E	EMBレイト
 006F  00		      C WTD_PanEmbCounter	db	?		;6F	EMBカウンター
 0070  00		      C WTD_PanEmbMaxMin	db	?		;60	EMB最大／最小値
 0071  00		      C WTD_PanEmbLevelSet	db	?		;61	EMB変位ﾚﾍﾞﾙ
 0072  0000		      C WTD_ProgramRate		dw	?		;62-63	音色を変える。
 0074  00		      C WTD_Program1st		db	?		;64	音色の初期値
 0075  00		      C WTD_Program2nd		db	?		;65	経時変化
 0076  00		      C WTD_Program3rd		db	?		;66	KeyOff後音色
 0077  00		      C WTD_ProgramDecay	db	?		;67	経時変化２
 0078  0000		      C WTD_ProgramDecayRate	dw	?		;68-69	音色を変える２
			      C 
			      C WTD			ends
			      C ;---------------------------------------------------------------
			      C ;構造体位置
 = WTD_BendLfoDecayRate	      C WTD_BendLFO		equ	WTD_BendLfoDecayRate	;ChLFO構造体先頭
 = WTD_ExprLfoDecayRate	      C WTD_ExprLFO		equ	WTD_ExprLfoDecayRate	;ChLFO構造体先頭
 = WTD_PanLfoDecayRate	      C WTD_PanLFO		equ	WTD_PanLfoDecayRate	;ChLFO構造体先頭
 = WTD_BendEmbAddress	      C WTD_BendEmb		equ	WTD_BendEmbAddress	;ChEmb構造体先頭
 = WTD_ExprEmbAddress	      C WTD_ExprEmb		equ	WTD_ExprEmbAddress	;ChEmb構造体先頭
 = WTD_PanEmbAddress	      C WTD_PanEmb		equ	WTD_PanEmbAddress	;ChEmb構造体先頭
			      C 
			      C ;ChLFO構造体
 0009			      C WTD_ChLfo		struc
 0000  00		      C WTD_ChLfo_DecayRate	db	?		;	LFOディケイレイト
 0001  00		      C WTD_ChLfo_SpeedRate	db	?		;	LFOスピード
 0002  0000		      C WTD_ChLfo_Level		dw	?		;	LFO変位ﾚﾍﾞﾙ
 0004  00		      C WTD_ChLfo_Count		db	?		;	LFO変化回数
 0005  00		      C WTD_ChLfo_RateCounter	db	?		;	LFOレイト用カウンタ
 0006  0000		      C WTD_ChLfo_LevelSet	dw	?		;	LFO現在の変位ﾚﾍﾞﾙ
 0008  00		      C WTD_ChLfo_CountCounter	db	?		;	LFO回数用カウンタ
			      C WTD_ChLfo		ends
			      C ;ChEmb構造体
 0005			      C WTD_ChEmb		struc
 0000  00		      C WTD_ChEmb_Address	db	?		;	EMB番号（ｱﾄﾞﾚｽ）
 0001  00		      C WTD_ChEmb_Rate		db	?		;	EMBレイト
 0002  00		      C WTD_ChEmb_Counter	db	?		;	EMBカウンター
 0003  00		      C WTD_ChEmb_MaxMin	db	?		;	EMB最大／最小値
 0004  00		      C WTD_ChEmb_LevelSet	db	?		;	EMB変位ﾚﾍﾞﾙ
			      C WTD_ChEmb		ends
			      C ;---------------------------------------------------------------
			      C ;フラグビット・セット
 = 0001			      C WTD_Ctrl_BendLfo	equ	00001h		;音程ＬＦＯスイッチ
 = 0002			      C WTD_Ctrl_BendEmb	equ	00002h		;音程エンベロープスイッチ
 = 0004			      C WTD_Ctrl_ExprLfo	equ	00004h		;音量ＬＦＯスイッチ
 = 0008			      C WTD_Ctrl_ExprEmb	equ	00008h		;音量エンベロープスイッチ
 = 0010			      C WTD_Ctrl_PanLfo		equ	00010h		;パンＬＦＯスイッチ
 = 0020			      C WTD_Ctrl_PanEmb		equ	00020h		;パンエンベロープスイッチ
 = 0040			      C WTD_Ctrl_Acsent		equ	00040h		;次の音階はアクセント
 = 0080			      C WTD_Ctrl_EmbFreq	equ	00080h		;音程エンベロープ 上位bit
 = 0100			      C WTD_Ctrl_EmbVol		equ	00100h		;音量エンベロープ 上位bit
 = 0200			      C WTD_Ctrl_EmbPan		equ	00200h		;パンエンベロープ 上位bit
 = 0400			      C WTD_Ctrl_Vol0		equ	00400h		;音量＝０ & Relase
 = 0800			      C WTD_Ctrl_WorkSw		equ	00800h		;次のコマンドは、ワーク参照
 = 1000			      C WTD_Ctrl_WorkCy		equ	01000h		;ワーク演算結果、オーバーフロー
 = 2000			      C WTD_Ctrl_WorkZe		equ	02000h		;ワーク演算結果、０になった。
 = 4000			      C WTD_Ctrl_Effect		equ	04000h		;このパートは効果音か？
 = 8000			      C WTD_Ctrl_PlayEnd	equ	08000h		;演奏終了
			      C ;---------------------------------------------------------------
			      C ;フラグビット・リセット
 = FFFE			      C WTD_Ctrl_BendLfoR	equ	0fffeh		;音程ＬＦＯスイッチ
 = FFFD			      C WTD_Ctrl_BendEmbR	equ	0fffdh		;音程エンベロープスイッチ
 = FFFB			      C WTD_Ctrl_ExprLfoR	equ	0fffbh		;音量ＬＦＯスイッチ
 = FFF7			      C WTD_Ctrl_ExprEmbR	equ	0fff7h		;音量エンベロープスイッチ
 = FFEF			      C WTD_Ctrl_PanLfoR	equ	0ffefh		;パンＬＦＯスイッチ
 = FFDF			      C WTD_Ctrl_PamEmbR	equ	0ffdfh		;パンエンベロープスイッチ
 = FFBF			      C WTD_Ctrl_AcsentR	equ	0ffbfh		;次の音階はアクセント
 = FF7F			      C WTD_Ctrl_EmbFreqR	equ	0ff7fh		;音程エンベロープ 上位bit
 = FEFF			      C WTD_Ctrl_EmbVolR	equ	0feffh		;音量エンベロープ 上位bit
 = FDFF			      C WTD_Ctrl_EmbPanR	equ	0fdffh		;パンエンベロープ 上位bit
 = FBFF			      C WTD_Ctrl_Vol0R		equ	0fbffh		;音量＝０ & Relase
 = F7FF			      C WTD_Ctrl_WorkSwR	equ	0f7ffh		;次のコマンドは、ワーク参照
 = EFFF			      C WTD_Ctrl_WorkCyR	equ	0efffh		;ワーク演算結果、オーバーフロー
 = DFFF			      C WTD_Ctrl_WorkZeR	equ	0dfffh		;ワーク演算結果、０になった。
 = BFFF			      C WTD_Ctrl_EffectR	equ	0bfffh		;このパートは効果音か？
 = 7FFF			      C WTD_Ctrl_PlayEndR	equ	07fffh		;演奏終了
			      C 
			      C ;===============================================================|
			      C ;		パート共通ワーク構造体				|
			      C ;===============================================================|
 0034			      C WTD_Sys			struc			;システム全体	
 0000  0000		      C WTD_Sys_Flag		dw	?		;00	Flag
 0002  0000		      C WTD_Sys_ProgramOffset	dw	?		;02	Program Offset Address
 0004  0000		      C WTD_Sys_ProgramSegment	dw	?		;04	Program Segment Address
 0006  0000		      C WTD_Sys_MusicOffset	dw	?		;06	Music Offset Address
 0008  0000		      C WTD_Sys_MusicSegment	dw	?		;08	Music Segment Address
 000A  0000		      C WTD_Sys_EffectOffset	dw	?		;0a	Effect Offset Address
 000C  0000		      C WTD_Sys_EffectSegment	dw	?		;0c	Effect Segment Address
 000E  0000		      C WTD_Sys_PcmOffset	dw	?		;0e	Pcm Offset Address
 0010  0000		      C WTD_Sys_PcmSegment	dw	?		;10	Pcm Segment Address
 0012  0000		      C WTD_Sys_StayOutMask	dw	?		;12	常駐解除禁止
 0014  0002 [		      C WTD_Sys_OldIntvector	dw	2	dup(?)	;14-17	前の割り込みベクタ
        0000
       ]
 0018  0002 [		      C WTD_Sys_OldIntvectorCom	dw	2	dup(?)	;18-1B	前の割り込みベクタ
        0000
       ]
 001C  0000		      C WTD_Sys_ComFIFO_Offset	dw	?		;1C-1D	FIFO Offset Address
 001E  0000		      C WTD_Sys_ComFIFO_Segment	dw	?		;1E-1F	FIFO Segment Address
 0020  00		      C WTD_Sys_Null_20		db	?		;20	未使用
 0021  00		      C WTD_Sys_VolumeMusic	db	?		;21	ソフトウェア音量 演奏
 0022  00		      C WTD_Sys_VolumeEffect	db	?		;22	ソフトウェア音量 効果音
 0023  00		      C WTD_Sys_VolumePCM	db	?		;23	ソフトウェア音量 PCM
 0024  0000		      C WTD_Sys_Tempo		dw	?		;24	テンポ
 0026  0000		      C WTD_Sys_TempoCounter	dw	?		;26	テンポカウンタ
 0028  00		      C WTD_Sys_MusicPart	db	?		;28	演奏のパート数(最大20)
 0029  00		      C WTD_Sys_EffectPart	db	?		;29	効果音のパート数(最大3)
 002A  0000		      C WTD_Sys_ComFIFO_Cnt	dw	?		;2A-2B	FIFO ポインタ 書き込み
 002C  0000		      C WTD_Sys_ComFIFO_Adr	dw	?		;2C-2D	FIFO ポインタ 送信
 002E  0000		      C WTD_Sys_ComFIFO_Size	dw	?		;2E-2F	FIFO サイズ
 0030  00		      C WTD_Sys_RunningStatus	db	?		;30	MIDI Running Status
 0031  00		      C WTD_Sys_InterruptBase	db	?		;31	割り込みベースベクタ
 0032  0000		      C WTD_Sys_VoiceTableOffset dw	?		;32	音色Table(IRAM)Address
			      C WTD_Sys			ends			
			      C ;---------------------------------------------------------------
			      C ;フラグビット・セット
 = 0001			      C WTD_Sys_Music		equ	00001h		;演奏中
 = 0002			      C WTD_Sys_Effect		equ	00002h		;効果音発声中
 = 0004			      C WTD_Sys_Pcm		equ	00004h		;PCMボイス発生中
 = 0008			      C WTD_Sys_3		equ	00008h		;	(元：PCM Voice終了)
 = 0010			      C WTD_Sys_Midi		equ	00010h		;MIDIモード(システムでは未使用)
 = 0020			      C WTD_Sys_5		equ	00020h		;
 = 0040			      C WTD_Sys_6		equ	00040h		;
 = 0080			      C WTD_Sys_TimerEmulate	equ	00080h		;タイマーをエミュレート中
 = 0100			      C WTD_Sys_ChannelMode1	equ	00100h		;チャンネルモード ch1
 = 0200			      C WTD_Sys_ChannelMode2	equ	00200h		;チャンネルモード ch2
 = 0400			      C WTD_Sys_ChannelMode3	equ	00400h		;チャンネルモード ch3
 = 0800			      C WTD_Sys_ChannelMode4	equ	00800h		;チャンネルモード ch4
 = 1000			      C WTD_Sys_EffectMask1	equ	01000h		;効果音パートマスク ch1
 = 2000			      C WTD_Sys_EffectMask2	equ	02000h		;効果音パートマスク ch2
 = 4000			      C WTD_Sys_EffectMask3	equ	04000h		;効果音パートマスク ch3
 = 8000			      C WTD_Sys_EffectMask4	equ	08000h		;効果音パートマスク ch4
			      C ;---------------------------------------------------------------
			      C ;フラグビット・リセット
 = FFFE			      C WTD_Sys_MusicR		equ	0fffeh		;演奏中
 = FFFD			      C WTD_Sys_EffectR		equ	0fffdh		;効果音発声中
 = FFFB			      C WTD_Sys_PcmR		equ	0fffbh		;PCMボイス発生中
 = FFF7			      C WTD_Sys_3R		equ	0fff7h		;	(元：PCM Voice終了)
 = FFEF			      C WTD_Sys_MidiR		equ	0ffefh		;MIDIモード(システムでは未使用)
 = FFDF			      C WTD_Sys_5R		equ	0ffdfh		;
 = FFBF			      C WTD_Sys_6R		equ	0ffbfh		;
 = FF7F			      C WTD_Sys_TimerEmulateR	equ	0ff7fh		;タイマーをエミュレート中
 = FEFF			      C WTD_Sys_ChannelMode1R	equ	0feffh		;チャンネルモード ch1
 = FDFF			      C WTD_Sys_ChannelMode2R	equ	0fdffh		;チャンネルモード ch2
 = FBFF			      C WTD_Sys_ChannelMode3R	equ	0fbffh		;チャンネルモード ch3
 = F7FF			      C WTD_Sys_ChannelMode4R	equ	0f7ffh		;チャンネルモード ch4
 = EFFF			      C WTD_Sys_EffectMask1R	equ	0efffh		;効果音パートマスク ch1
 = DFFF			      C WTD_Sys_EffectMask2R	equ	0dfffh		;効果音パートマスク ch2
 = BFFF			      C WTD_Sys_EffectMask3R	equ	0bfffh		;効果音パートマスク ch3
 = 7FFF			      C WTD_Sys_EffectMask4R	equ	07fffh		;効果音パートマスク ch4
			      C 
			      C ;===============================================================|
			      C ;		ソフトウェアエンベロープ構造体			|
			      C ;===============================================================|
 0010			      C WTD_Emb			struc
 0000  00		      C WTD_Emb_AR		db	?		;00h	:Attack Rate
 0001  00		      C WTD_Emb_AS		db	?		;01h	:Attack Speed (001h)
 0002  00		      C WTD_Emb_AL		db	?		;02h	:Attack Level (0FFh)
 0003  00		      C WTD_Emb_FL		db	?		;03h	:First Level
 0004  00		      C WTD_Emb_DR		db	?		;04h	:Decay Rate
 0005  00		      C WTD_Emb_DS		db	?		;05h	:Decay Speed (081h)
 0006  00		      C WTD_Emb_DL		db	?		;06h	:Decay Level
 0007  00		      C WTD_Emb_Null1		db	?		;07h	:未使用
 0008  00		      C WTD_Emb_SR		db	?		;08h	:Sustain Rate
 0009  00		      C WTD_Emb_SS		db	?		;09h	:Sustain Speed (081h)
 000A  00		      C WTD_Emb_SL		db	?		;0Ah	:Sustain Level (000h)
 000B  00		      C WTD_Emb_Null2		db	?		;0Bh	:未使用
 000C  00		      C WTD_Emb_RR		db	?		;0Ch	:Relase Rate
 000D  00		      C WTD_Emb_RS		db	?		;0Dh	:Relase Speed (081h)
 000E  00		      C WTD_Emb_RL		db	?		;0Eh	:Relase Level (000h)
 000F  00		      C WTD_Emb_Null3		db	?		;0Fh	:未使用
			      C WTD_Emb			ends				
			      C 
			      C ;===============================================================|
			      C ;			曲データ構造体				|
			      C ;===============================================================|
 0012			      C WTD_Mus			struc
 0000  0004 [		      C WTD_Mus_Name		db	4	dup(?)	;00-03h	:選別子
        00
       ]
 0004  0000		      C WTD_Mus_Version		dw	?		;04-05h	:Version
 0006  0000		      C WTD_Mus_Extr		dw	?		;06-07h	:拡張ヘッダサイズ
 0008  00		      C WTD_Mus_Emb		db	?		;08h	:エンベロープ数量
 0009  00		      C WTD_Mus_Voice		db	?		;09h	:波形データ数量
 000A  00		      C WTD_Mus_Part		db	?		;0Ah	:パート数
 000B  00		      C WTD_Mus_TimeBase	db	?		;0Bh	:４部音符の分割数
 000C  0000		      C WTD_Mus_ExtrAdr		dw	?		;0Ch	:拡張ヘッダのアドレス
 000E  0000		      C WTD_Mus_DataAdr		dw	?		;0Eh	:データのアドレス
 0010  0000		      C WTD_Mus_PartAdr		dw	?		;10h	:曲データアドレス
			      C WTD_Mus			ends
			      C 
			      C ;===============================================================|
			      C ;			拡張ヘッダー構造体定義			|
			      C ;===============================================================|
 0000			      C WTD_MusEx		struc
			      C ;
			      C ;			現在、未使用
			      C ;
			      C WTD_MusEx		ends
			      C 
			      C 
				include	wtd_ver.inc			;定義ファイル　バージョン情報
			      C ;=======================================================================|
			      C ;									|
			      C ;		Wander Swan Total Sound Driver				|
			      C ;				IL Struct define			|
			      C ;				IL Function Routine			|
			      C ;					Programmed by			|
			      C ;						A.Watanabe		|
			      C ;									|
			      C ;=======================================================================|
 = '1.0d',0		      C WtdIL_Version		equ	'1.0d',0	;文字列
 = 010D			      C WTdIL_Version_N		equ	010dh		;数値
			      C 
				;
				;	　演奏開始ファンクションのところで、チェックする。
				;	パート数を追加する場合は、その分だけワークを確保する事。
				;
				ifdef	hyoka	;------------------------
				WtdIL_Name		equ	'WTD_h',0
				MusicMaxPart		equ	4	;廉価版は4 パート
				else	;--------------------------------
 = 'WTD',0			WtdIL_Name		equ	'WTD',0
 = 0014				MusicMaxPart		equ	20	;製品版は20パート
				endif	;--------------------------------
 = 0003				EffectMaxPart		equ	3	;効果音は3 パート

				;=======================================================================|
				;				Segment define				|
				;=======================================================================|
				ifdef	library	;---------------------	※　ライブラリ版

 0000				_TEXT	segment	para public 'CODE'
 0000				_TEXT	ends

 0000				DATA	segment	para public 'DATA'
 0000				DATA	ends

 0000				_BSS	segment	para public 'BSS'
 0000				_BSS	ends

				CGROUP	group	_TEXT
				DGROUP	group	DATA,_BSS

					assume	cs:CGROUP, ds:DGROUP, es:DGROUP

				else		;---------------------	※　IL版

				_TEXT	segment para public 'CODE'
				_TEXT	ends

				CGROUP	group	_TEXT
					assume	cs:CGROUP

				endif		;---------------------

				;=======================================================================|
				;				プログラム・コード			|
				;=======================================================================|
 0000				_TEXT	segment para public 'CODE'

					org	0000h			;明示の必要性？

					public	WanderSwanTotalSoundDriver_
 0000				WanderSwanTotalSoundDriver_:

				include	wtd_ilf.asm			;IL構造体,ILinfo構造体,ILファンクション
			      C ;=======================================================================|
			      C ;									|
			      C ;		Wander Swan Total Sound Driver				|
			      C ;				IL Struct define			|
			      C ;				IL Function Routine			|
			      C ;									|
			      C ;					Programmed by			|
			      C ;						A.Watanabe		|
			      C ;									|
			      C ;=======================================================================|
			      C ;****************************************************************
			      C ;*								*
			      C ;*		ＩＬの定義／データ群				*
			      C ;*								*
			      C ;****************************************************************
			      C ;===============================================================|
			      C ;		IL構造体定義					|
			      C ;===============================================================|
 0000			      C IL:							;IL構造体先頭
 0000 0000		      C IL_Link_Pos	dw	0				;未使用
 0002  0000		      C 		dw	0				;
 0004 0019		      C IL_N_Methods	dw	((offset IL_F_End)-(offset IL_GetInfo))/4	;ファンクション数
 0006 00C2 R		      C IL_GetInfo	dw	offset CGROUP:_GetInfo		;ILinfo構造体を得る
 0008  0000		      C 		dw	0				;far *TEST_GetInfo();
 000A 00C8 R		      C IL_F00		dw	offset CGROUP:_Stay		;
 000C  0000		      C 		dw	0				;
 000E 0178 R		      C IL_F01		dw	offset CGROUP:_StayOut		;
 0010  0000		      C 		dw	0				;
 0012 01C4 R		      C IL_F02		dw	offset CGROUP:_Init		;
 0014  0000		      C 		dw	0				;
 0016 01F4 R		      C IL_F03		dw	offset CGROUP:_MusicPlay	;
 0018  0000		      C 		dw	0				;
 001A 036E R		      C IL_F04		dw	offset CGROUP:_MusicStop	;
 001C  0000		      C 		dw	0				;
 001E 0407 R		      C IL_F05		dw	offset CGROUP:_EffectPlay	;
 0020  0000		      C 		dw	0				;
 0022 0576 R		      C IL_F06		dw	offset CGROUP:_EffectStop	;
 0024  0000		      C 		dw	0				;
 0026 05DB R		      C IL_F07		dw	offset CGROUP:_PcmPlay		;
 0028  0000		      C 		dw	0				;
 002A 06CF R		      C IL_F08		dw	offset CGROUP:_PcmStop		;
 002C  0000		      C 		dw	0				;
 002E 06F5 R		      C IL_F09		dw	offset CGROUP:_PcmVoiceSet	;
 0030  0000		      C 		dw	0				;
 0032 0731 R		      C IL_F10		dw	offset CGROUP:_SoftEmbSet	;
 0034  0000		      C 		dw	0				;
 0036 076D R		      C IL_F11		dw	offset CGROUP:_ChangeFar	;
 0038  0000		      C 		dw	0				;
 003A 0780 R		      C IL_F12		dw	offset CGROUP:_SoundSetChannel	;
 003C  0000		      C 		dw	0				;
 003E 078D R		      C IL_F13		dw	offset CGROUP:_SoundGetChannel	;
 0040  0000		      C 		dw	0				;
 0042 0791 R		      C IL_F14		dw	offset CGROUP:_SoundSetOutput	;
 0044  0000		      C 		dw	0				;
 0046 079E R		      C IL_F15		dw	offset CGROUP:_SoundGetOutput	;
 0048  0000		      C 		dw	0				;
 004A 07A2 R		      C IL_F16		dw	offset CGROUP:_SoundGetRandom	;
 004C  0000		      C 		dw	0				;
 004E 07A6 R		      C IL_F17		dw	offset CGROUP:_SetMusicVolume	;
 0050  0000		      C 		dw	0				;
 0052 07C3 R		      C IL_F18		dw	offset CGROUP:_GetMusicVolume	;
 0054  0000		      C 		dw	0				;
 0056 07D9 R		      C IL_F19		dw	offset CGROUP:_SetEffectVolume	;
 0058  0000		      C 		dw	0				;
 005A 07F6 R		      C IL_F20		dw	offset CGROUP:_GetEffectVolume	;
 005C  0000		      C 		dw	0				;
 005E 080C R		      C IL_F21		dw	offset CGROUP:_SetPcmVolume	;
 0060  0000		      C 		dw	0				;
 0062 082E R		      C IL_F22		dw	offset CGROUP:_GetPcmVolume	;
 0064  0000		      C 		dw	0				;
 0066 0844 R		      C IL_F23		dw	offset CGROUP:_SetFIFO		;
 0068  0000		      C 		dw	0				;
 006A			      C IL_F_End:
			      C ;===============================================================|
			      C ;		ILinfo構造体定義（全てポインタ）		|
			      C ;===============================================================|
 006A			      C ILinfo:							;ILinfo構造体先頭
 006A 007E R		      C ILinfo_ClassName	dw	offset CGROUP:ILinfoD_ClassName	;未使用
 006C  0000		      C 			dw	0				;
 006E 0085 R		      C ILinfo_Name		dw	offset CGROUP:ILinfoD_Name	;名前
 0070  0000		      C 			dw	0				;
 0072 0089 R		      C ILinfo_Version		dw	offset CGROUP:ILinfoD_Version	;バージョン
 0074  0000		      C 			dw	0				;
 0076 008E R		      C ILinfo_Description	dw	offset CGROUP:ILinfoD_Description
 0078  0000		      C 			dw	0				;
 007A 008F R		      C ILinfo_Depends		dw	offset CGROUP:ILinfoD_Depends	;未使用
 007C  0000		      C 			dw	0				;
			      C ;===============================================================|
			      C ;		ILinfo構造体の内容				|
			      C ;===============================================================|
 007E			      C ILinfoD_WTD:					;内容
 007E 57 54 44 5F 49 4C	      C ILinfoD_ClassName	db	'WTD_IL',0	;未使用
       00
 0085 57 54 44 00	      C ILinfoD_Name		db	wtdIL_Name	;名前
 0089 31 2E 30 64 00	      C ILinfoD_Version		db	wtdIL_Version	;バージョン
 008E 00		      C ILinfoD_Description	db	0		;未使用
 008F 0000		      C ILinfoD_Depends		dw	0		;未使用（ポインタ）
 0091  0000		      C 			dw	0		;
			      C ;****************************************************************
			      C ;*								*
			      C ;*		IL構造体の設定					*
			      C ;*								*
			      C ;****************************************************************
			      C ;===============================================================|
			      C ;		void	WTD_FucntionLoad()			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		WtdIL	Wtd_Function	/*構造体のポインタを*/	|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		・WtdIL構造体の設定				|
			      C ;		　WtdIL構造体は、ライブラリを呼ぶ側が用意する。	|
			      C ;===============================================================|
			      C ifdef	library				;※　ライブラリ版のみ必要
			      C 
			      C 	public	WTD_FunctionLoad	;外部宣言
			      C 
 0093			      C WTD_FunctionLoad	proc	near c	uses ax cx si di ds es,
			      C 	Wtd_Function:word
			      C 
 0093  55		   *	    push   bp
 0094  8B EC		   *	    mov    bp, sp
 0096  50		   *	    push   ax
 0097  51		   *	    push   cx
 0098  56		   *	    push   si
 0099  57		   *	    push   di
 009A  1E		   *	    push   ds
 009B  06		   *	    push   es
 009C  1E		      C 	push	ds			;
 009D  07		      C 	pop	es			;es←DGROUP
 009E  8B 7E 04		      C 	mov	di,Wtd_Function		;di←Wtd_Functionのポインタ
			      C 
 00A1  0E		      C 	push	cs			;
 00A2  1F		      C 	pop	ds			;ds←CGROUP
 00A3  BE 0000 R	      C 	mov	si,offset CGROUP:IL	;di←IL構造体用のデータ
			      C 
 00A6  FC		      C 	cld				;インクリメントモード
 00A7  B9 0003		      C 	mov	cx,3			;
 00AA  F3/ A5		      C 	rep	movsw			;IL_Link_Pos, IL_Link_Methodの転送
			      C 
 00AC  2E: 8B 0E 0004 R	      C 	mov	cx,word ptr CS:[IL_N_Methods]	;構造体のサイズ計算
 00B1  8C C8		      C 	mov	ax,cs			;
			      C 	.repeat
 00B3			   *@C0001:
 00B3  A5		      C 		movsw			;
 00B4  AB		      C 		stosw			;
 00B5  83 C6 02		      C 		add	si,2		;
			      C 	.untilcxz
 00B8  E2 F9		   *	    loop   @C0001
			      C 
			      C 	ret				;
 00BA  07		   *	    pop    es
 00BB  1F		   *	    pop    ds
 00BC  5F		   *	    pop    di
 00BD  5E		   *	    pop    si
 00BE  59		   *	    pop    cx
 00BF  58		   *	    pop    ax
 00C0  5D		   *	    pop    bp
 00C1  C3		   *	    ret    00000h
 00C2			      C WTD_FunctionLoad	endp		;
			      C endif
			      C ;****************************************************************
			      C ;*								*
			      C ;*		ＩＬのファンクション				*
			      C ;*								*
			      C ;****************************************************************
			      C ;===============================================================|
			      C ;		far *TEST_GetInfo()				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		dx,ax←ILinfo構造体のポインタ			|
			      C ;	処理							|
			      C ;		ILinfoポインタの取得				|
			      C ;===============================================================|
 00C2			      C _GetInfo	proc far c		;
 00C2  0E		      C 	push	cs			;
 00C3  5A		      C 	pop	dx			;LSI-C86
 00C4  B8 006A R	      C 	mov	ax,offset CGROUP:ILinfo	;dx:ax←far pointer
 00C7  CB		      C 	ret				;
 00C8			      C _GetInfo	endp			;
			      C ;===============================================================|
			      C ;	int	(far *Stay)();					|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		ax	00h	正常終了			|
			      C ;		ax	01h	heap領域が足りない		|
			      C ;	処理							|
			      C ;		WTD本体の常駐					|
			      C ;===============================================================|
 00C8			      C _Stay		proc far c	uses bx cx dx si di ds es	;
			      C 
 00C8  53		   *	    push   bx
 00C9  51		   *	    push   cx
 00CA  52		   *	    push   dx
 00CB  56		   *	    push   si
 00CC  57		   *	    push   di
 00CD  1E		   *	    push   ds
 00CE  06		   *	    push   es
 00CF  9C		      C 	pushf				;レジスタ保存
			      C 
 00D0  FA		      C 	cli				;割り込み禁止
			      C 
			      C ;---------------------------------------------------------------
			      C ;ワークエリアアドレスの取得
			      C 
			      C ;ワークエリアの取得
			      C 	WTD_WorkGet	ds,bx		;ワークエリアアドレス
			     1C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			     1C 
			     1C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
 00D1  6A 00		     1C 		push	IRAM_Segment		;
 00D3  1F		     1C 		pop	ds			;
 00D4  BB 0000 R	     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C 
			     1C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			     1C 		push	SRAM_Segment		;（WonderWitch等）
			     1C 		pop	ds			;
			     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C endif	;-----------------------
			     1C 
			     1C else	;--------------------------------	;WonderWitch版
			     1C 		push	SRAM_Segment		;
			     1C 		pop	ds			;
			     1C 		mov	bx,ds:[ProcContext_heap]
			     1C endif	;--------------------------------
			      C 
			      C ;エラーチェック
 00D7  81 FB F000	      C 	cmp	bx,0f000h		;/* S-RAMは4096byte以上ある？ */
 00DB  72 06		      C 	jc	_Stay_00		;if (bx>0xF000) then ax=1:Retuen
 00DD  B8 0001		      C 	mov	ax,0001h		;/* 本体RAM容量が足りない。 */
 00E0  E9 008C		      C 	jmp	_Stay_End		;
 00E3			      C _Stay_00:
			      C 
			      C 
			      C ;ワーク全体の初期化(00hで埋める)
			      C ;メモリ書き込み
 00E3  FC		      C 	cld				;インクリメントモード
 00E4  1E		      C 	push	ds
 00E5  07		      C 	pop	es
 00E6  8D 3F		      C 	lea	di,[bx]			;es:di←ワークファーアドレス
 00E8  B9 1000		      C 	mov	cx,WTD_WorkSize		;ワークのサイズ分(1000h)
 00EB  33 C0		      C 	xor	ax,ax			;ax←0
 00ED  F3/ AA		      C 	rep	stosb			;書き込み
			      C 
			      C ;構造体アドレスの設定
 00EF  8D B7 0380	      C 	lea	si,[bx + WTD_WorkAdd_System]	;ds:si←System
			      C 
			      C ;---------------------------------------------------------------
			      C ;共通ワークの初期化
			      C 
			      C ;レジスタの設定　構造体のベースポインタの設定。
 00F3  6A 00		      C 	push	IRAM_Segment		;
 00F5  07		      C 	pop	es			;es←本体RAMセグメント
			      C 
			      C ;IntVectorの設定
 00F6  53		      C 	push	bx					;
			      C 
 00F7  B8 0000		      C 	mov	ax,0					;
 00FA  E8 1823		      C 	call	IntVector_Get				;al←割り込みベクタ
 00FD  88 44 31		      C 	mov	ds:[si].WTD_Sys_InterruptBase,al	;保存
 0100  C1 E0 02		      C 	shl	ax,2			;読み込んだ値を4倍
 0103  8B D8		      C 	mov	bx,ax			;割り込みベクタのアドレス
			      C 
 0105  26: 8B 47 1C	      C 	mov	ax,es:[bx+SYS_INT_HBLANK_COUNTUP*4+0]	;タイマー
 0109  89 44 14		      C 	mov	ds:[si].WTD_Sys_OldIntvector+0,ax	;割り込み
 010C  26: 8B 47 1E	      C 	mov	ax,es:[bx+SYS_INT_HBLANK_COUNTUP*4+2]	;
 0110  89 44 16		      C 	mov	ds:[si].WTD_Sys_OldIntvector+2,ax	;復帰用に保存
			      C 
 0113  26: C7 47 1C 0000      C 	mov	es:[bx+SYS_INT_HBLANK_COUNTUP*4+0],offset CGROUP:I_Start
 0119  26: 8C 4F 1E	      C 	mov	es:[bx+SYS_INT_HBLANK_COUNTUP*4+2],cs	;アドレスの設定
			      C 
			      C ifndef	hyoka	;------------------------廉価版は無し
 011D  26: 8B 07	      C 	mov	ax,es:[bx+SYS_INT_SENDREADY*4+0]	;シリアルエンプティー
 0120  89 44 18		      C 	mov	ds:[si].WTD_Sys_OldIntvectorCom+0,ax	;割り込み
 0123  26: 8B 47 02	      C 	mov	ax,es:[bx+SYS_INT_SENDREADY*4+2]	;
 0127  89 44 1A		      C 	mov	ds:[si].WTD_Sys_OldIntvectorCom+2,ax	;復帰用に保存
			      C 
 012A  26: C7 07 1904 R	      C 	mov	es:[bx+SYS_INT_SENDREADY*4+0],offset CGROUP:IC_Start
 012F  26: 8C 4F 02	      C 	mov	es:[bx+SYS_INT_SENDREADY*4+2],cs	;アドレスの設定
			      C endif	;--------------------------------
 0133  5B		      C 	pop	bx					;
			      C 
			      C ;タイマー
 0134  B8 007D		      C 	mov	ax,Timer_Tempo120			;
 0137  89 44 24		      C 	mov	ds:[si].WTD_Sys_Tempo,ax		;
 013A  33 C0		      C 	xor	ax,ax					;
 013C  89 44 26		      C 	mov	ds:[si].WTD_Sys_TempoCounter,ax		;
			      C 
			      C ;音色テーブル
 013F  B8 0180		      C 	mov	ax,IRAM_SoundVoiceTable			;
 0142  89 44 32		      C 	mov	ds:[si].WTD_Sys_VoiceTableOffset,ax	;
			      C 
			      C ;ソフト音量
 0145  B8 FFFF		      C 	mov	ax,0ffffh				;音量設定
 0148  88 44 21		      C 	mov	ds:[si].WTD_Sys_VolumeMusic,al		;
 014B  88 44 22		      C 	mov	ds:[si].WTD_Sys_VolumeEffect,al		;
 014E  B0 0F		      C 	mov	al,0fh					;
 0150  88 44 23		      C 	mov	ds:[si].WTD_Sys_VolumePcm,al		;
			      C 
			      C ;	mov	ax,bx					;
			      C ;	add	ax,WTD_WorkSize				;
 0153  8D 87 1000	      C 	lea	ax,[bx + WTD_WorkSize]			;FIFOバッファの設定
 0157  1E		      C 	push	ds					;ワークエリアの次
 0158  50		      C 	push	ax					;
 0159  68 1000		      C 	push	4096					;4096[Byte]確保
 015C  0E		      C 	push	cs					;
 015D  E8 06E4		      C 	call	near ptr _SetFIFO			;
 0160  83 C4 06		      C 	add	sp,+6					;
			      C 
			      C ;
			      C ;	その他、ワーク内容の初期化をする。
			      C ;
			      C 
			      C ;---------------------------------------------------------------
			      C ;デバイスの初期化
			      C 
			      C ifndef	hyoka	;------------------------廉価版は無し
 0163  E8 1A6E		      C 	call	C_open			;通信回線の初期化
			      C endif	;--------------------------------
			      C 
 0166  0E		      C 	push	cs			;
 0167  E8 005A		      C 	call	near ptr _Init		;ドライバーの初期化
 016A  E8 17B7		      C 	call	T_open			;タイマーの初期化
			      C 
			      C ;---------------------------------------------------------------
			      C 
			      C ;正常終了
 016D  33 C0		      C 	xor	ax,ax			;正常終了(ax=0000h)
			      C 
 016F			      C _Stay_End:
			      C 
 016F  9D		      C 	popf				;レジスタ復帰
			      C 
			      C 	ret				;終了
 0170  07		   *	    pop    es
 0171  1F		   *	    pop    ds
 0172  5F		   *	    pop    di
 0173  5E		   *	    pop    si
 0174  5A		   *	    pop    dx
 0175  59		   *	    pop    cx
 0176  5B		   *	    pop    bx
 0177  CB		   *	    ret    00000h
 0178			      C _Stay		endp			;
			      C ;===============================================================|
			      C ;	int	(far *StayOut)();				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		ax	00h	正常終了			|
			      C ;		ax	01h	常駐していない。		|
			      C ;	処理							|
			      C ;		WTD本体の常駐解除				|
			      C ;===============================================================|
 0178			      C _StayOut	proc far c	uses bx di si ds es
 0178  53		   *	    push   bx
 0179  57		   *	    push   di
 017A  56		   *	    push   si
 017B  1E		   *	    push   ds
 017C  06		   *	    push   es
 017D  9C		      C 	pushf				;
			      C 
 017E  FA		      C 	cli				;割り込み禁止
			      C 
			      C ;---------------------------------------------------------------
			      C ;デバイスの初期化
			      C 
 017F  E8 17B4		      C 	call	T_close			;タイマー割り込みの停止、復帰
 0182  0E		      C 	push	cs			;
 0183  E8 003E		      C 	call	near ptr _Init		;ドライバーの初期化
			      C 
			      C ifndef	hyoka	;------------------------廉価版は無し
 0186  E8 1A53		      C 	call	C_close			;通信回線の遮断
			      C endif	;--------------------------------
			      C 
			      C ;---------------------------------------------------------------
			      C ;ワークエリアの取得
			      C 
			      C 	WTD_WorkGet	ds,bx			;ワークエリアアドレスの取得
			     1C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			     1C 
			     1C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
 0189  6A 00		     1C 		push	IRAM_Segment		;
 018B  1F		     1C 		pop	ds			;
 018C  BB 0000 R	     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C 
			     1C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			     1C 		push	SRAM_Segment		;（WonderWitch等）
			     1C 		pop	ds			;
			     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C endif	;-----------------------
			     1C 
			     1C else	;--------------------------------	;WonderWitch版
			     1C 		push	SRAM_Segment		;
			     1C 		pop	ds			;
			     1C 		mov	bx,ds:[ProcContext_heap]
			     1C endif	;--------------------------------
			      C 
			      C 	;構造体アドレスの設定
 018F  8D B7 0380	      C 	lea	si,[bx + WTD_WorkAdd_System]
			      C 
			      C ;---------------------------------------------------------------
			      C ;割り込み設定の復帰
			      C 
			      C ;レジスタの設定　構造体のベースポインタの設定。
 0193  6A 00		      C 	push	IRAM_Segment		;
 0195  07		      C 	pop	es			;es←本体RAMセグメント
			      C 
			      C ;IntVectorの復帰
 0196  53		      C 	push	bx					;
			      C 
 0197  33 DB		      C 	xor	bx,bx					;
 0199  8A 5C 31		      C 	mov	bl,ds:[si].WTD_Sys_InterruptBase	;bx←割り込みベクタ
 019C  C1 E3 02		      C 	shl	bx,2					;読み込んだ値を4倍(割り込みベクタのアドレス)
			      C ;	mov	bx,ax					;
			      C 
 019F  8B 44 14		      C 	mov	ax,ds:[si].WTD_Sys_OldIntvector+0	;
 01A2  26: 89 47 1C	      C 	mov	es:[bx+SYS_INT_HBLANK_COUNTUP*4+0],ax	;
 01A6  8B 44 16		      C 	mov	ax,ds:[si].WTD_Sys_OldIntvector+2	;
 01A9  26: 89 47 1E	      C 	mov	es:[bx+SYS_INT_HBLANK_COUNTUP*4+2],ax	;
			      C 
			      C ifndef	hyoka	;------------------------廉価版は無し
 01AD  8B 44 18		      C 	mov	ax,ds:[si].WTD_Sys_OldIntvectorCom+0	;
 01B0  26: 89 07	      C 	mov	es:[bx+SYS_INT_SENDREADY*4+0],ax	;
 01B3  8B 44 1A		      C 	mov	ax,ds:[si].WTD_Sys_OldIntvectorCom+2	;
 01B6  26: 89 47 02	      C 	mov	es:[bx+SYS_INT_SENDREADY*4+2],ax	;
			      C endif	;--------------------------------
 01BA  5B		      C 	pop	bx					;
			      C 
			      C ;
			      C ;	その他、設定の復帰を行う。
			      C ;
			      C ;---------------------------------------------------------------
			      C ;正常終了
			      C 
 01BB  33 C0		      C 	xor	ax,ax			;正常終了(ax=0000h)
			      C ;	jmp	_StayOut_End		;
			      C 
			      C ;---------------------------------------------------------------
 01BD			      C _StayOut_End:
			      C 
 01BD  9D		      C 	popf				;
			      C 	ret				;終了
 01BE  07		   *	    pop    es
 01BF  1F		   *	    pop    ds
 01C0  5E		   *	    pop    si
 01C1  5F		   *	    pop    di
 01C2  5B		   *	    pop    bx
 01C3  CB		   *	    ret    00000h
 01C4			      C _StayOut	endp			;
			      C ;===============================================================|
			      C ;	void	(far *Init)();					|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		デバイスの初期化				|
			      C ;===============================================================|
 01C4			      C _Init	proc far c	uses bp ax si ds
			      C 
			      C ;---------------------------------------------------------------
			      C ;ワークエリアの取得
			      C 
			      C 	WTD_WorkGet	ds,bp			;ワークエリアアドレスの取得
			     1C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			     1C 
			     1C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
 01C4  55		   *	    push   bp
 01C5  50		   *	    push   ax
 01C6  56		   *	    push   si
 01C7  1E		   *	    push   ds
 01C8  6A 00		     1C 		push	IRAM_Segment		;
 01CA  1F		     1C 		pop	ds			;
 01CB  BD 0000 R	     1C 		mov	bp,offset DGROUP:_WTD_Work
			     1C 
			     1C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			     1C 		push	SRAM_Segment		;（WonderWitch等）
			     1C 		pop	ds			;
			     1C 		mov	bp,offset DGROUP:_WTD_Work
			     1C endif	;-----------------------
			     1C 
			     1C else	;--------------------------------	;WonderWitch版
			     1C 		push	SRAM_Segment		;
			     1C 		pop	ds			;
			     1C 		mov	bp,ds:[ProcContext_heap]
			     1C endif	;--------------------------------
			      C 
			      C 	;構造体アドレスの設定
 01CE  8D B6 0380	      C 	lea	si,[bp + WTD_WorkAdd_System]
			      C 
			      C 
			      C ;---------------------------------------------------------------
			      C ;演奏・効果音・PCMの停止。個別ワークの初期化
			      C 
 01D2  0E		      C 	push	cs			;
 01D3  E8 0198		      C 	call	near ptr _MusicStop	;演奏停止・割込周期の初期化
 01D6  0E		      C 	push	cs			;
 01D7  E8 039C		      C 	call	near ptr _EffectStop	;効果音発生停止
 01DA  0E		      C 	push	cs			;
 01DB  E8 04F1		      C 	call	near ptr _PcmStop	;PcmVoice発生停止
			      C 
			      C ;---------------------------------------------------------------
			      C ;デバイスの初期化
			      C 
 01DE  E8 1781		      C 	call	SP_init			;デバイスの初期化
			      C 
			      C ifndef	hyoka	;------------------------廉価版は無し
 01E1  E8 1912		      C 	call	SM_init			;GM Resetの送信
			      C 
			      C 	;FIFO送信まで待つ。		;
			      C 	.repeat
 01E4			   *@C0002:
 01E4  E8 1A83		      C 		call	IC_Send			;送信
 01E7  8B 44 2A		      C 		mov	ax,ds:[si].WTD_Sys_ComFIFO_Cnt
			      C 	.until	(ax==ds:[si].WTD_Sys_ComFIFO_Adr)
 01EA  3B 44 2C		   *	    cmp    ax, ds : [si] . WTD_Sys_ComFIFO_Adr
 01ED  75 F5		   *	    jne    @C0002
			      C endif	;--------------------------------
			      C 
			      C ;---------------------------------------------------------------
			      C 	ret				;終了
 01EF  1F		   *	    pop    ds
 01F0  5E		   *	    pop    si
 01F1  58		   *	    pop    ax
 01F2  5D		   *	    pop    bp
 01F3  CB		   *	    ret    00000h
 01F4			      C _Init	endp				;
			      C ;===============================================================|
			      C ;	char	(far *MusicPlay)(char far *Music);		|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		char far *Music		曲データのアドレス	|
			      C ;	返り値							|
			      C ;		ax		Error Code			|
			      C ;				00h	正常終了		|
			      C ;				01h	曲データじゃ無い。	|
			      C ;				02h	ヴァージョンが違う。	|
			      C ;	処理							|
			      C ;		演奏を開始する					|
			      C ;===============================================================|
 01F4			      C _MusicPlay	proc far c	uses bx cx dx di si ds es,
			      C 	fptMusic:far ptr byte
			      C 
 01F4  55		   *	    push   bp
 01F5  8B EC		   *	    mov    bp, sp
 01F7  53		   *	    push   bx
 01F8  51		   *	    push   cx
 01F9  52		   *	    push   dx
 01FA  57		   *	    push   di
 01FB  56		   *	    push   si
 01FC  1E		   *	    push   ds
 01FD  06		   *	    push   es
 01FE  55		      C 	push	bp
			      C 
			      C ;---------------------------------------------------------------
			      C ;演奏の停止
			      C 
 01FF  0E		      C 	push	cs			;
 0200  E8 016B		      C 	call	near ptr _MusicStop	;演奏停止・割込周期の初期化
			      C 
			      C ;---------------------------------------------------------------
			      C ;割り込み禁止
			      C 
 0203  E4 B2		      C 	in	al,Int_Enable		;
 0205  24 7F		      C 	and	al,Int_HblankReset	;
 0207  E6 B2		      C 	out	Int_Enable,al		;
			      C 
			      C ;---------------------------------------------------------------
			      C ;ワークアドレスの取得
			      C 
			      C 	WTD_WorkGet	ds,bx			;ワークエリアアドレスの取得
			     1C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			     1C 
			     1C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
 0209  6A 00		     1C 		push	IRAM_Segment		;
 020B  1F		     1C 		pop	ds			;
 020C  BB 0000 R	     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C 
			     1C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			     1C 		push	SRAM_Segment		;（WonderWitch等）
			     1C 		pop	ds			;
			     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C endif	;-----------------------
			     1C 
			     1C else	;--------------------------------	;WonderWitch版
			     1C 		push	SRAM_Segment		;
			     1C 		pop	ds			;
			     1C 		mov	bx,ds:[ProcContext_heap]
			     1C endif	;--------------------------------
			      C 
			      C ;構造体アドレスの設定
 020F  8D BF 0600	      C 	lea	di,[bx + WTD_WorkAdd_Ch0]
 0213  8D B7 0380	      C 	lea	si,[bx + WTD_WorkAdd_System]
			      C 
			      C ;---------------------------------------------------------------
			      C ;演奏アドレスの設定
			      C 
 0217  C4 46 06		      C 	les	ax,fptMusic
 021A  06		      C 	push	es
 021B  50		      C 	push	ax
 021C  0E		      C 	push	cs			;データ変換
 021D  E8 054D		      C 	call	near ptr _ChangeFar	;dxax = wtdIL.ChangeFar(*Music);
 0220  83 C4 04		      C 	add	sp,+4			;
 0223  89 44 06		      C 	mov	ds:[si].WTD_Sys_MusicOffset,ax	;アドレスの設定
 0226  89 54 08		      C 	mov	ds:[si].WTD_Sys_MusicSegment,dx	;
			      C 
 0229  8B EB		      C 	mov	bp, bx
			      C 
			      C ;ポインタの設定
 022B  8E C2		      C 	mov	es,dx			;
 022D  8B D8		      C 	mov	bx,ax			;es:bx←曲データ先頭アドレス
			      C 
			      C ;---------------------------------------------------------------
			      C ;データ形式チェック
			      C 
			      C 	;ヘッダー文字列チェック
			      C 	.if	(word ptr es:[bx].WTD_Mus_Name!='TW')	;'WTD',0
 022F  26: 81 3F 5457	   *	    cmp    word ptr es : [bx] . WTD_Mus_Name, 'TW'
 0234  74 06		   *	    je     @C0004
 0236  B8 0001		      C 		mov	ax,1				;
 0239  E9 0122		      C 		jmp	_MusicPlay_End			;
			      C 	.endif
 023C			   *@C0004:
			      C 
			      C 	;バージョンチェック
 023C  26: 8B 47 04	      C 	mov	ax,es:[bx].WTD_Mus_Version	;
 0240  86 E0		      C 	xchg	ah,al				;ax←Music Data Version
			      C 	.if	(ax>WTdIL_Version_N)
 0242  3D 010D		   *	    cmp    ax, WTdIL_Version_N
 0245  76 06		   *	    jbe    @C0006
 0247  B8 0002		      C 		mov	ax,2			;
 024A  E9 0111		      C 		jmp	_MusicPlay_End		;
			      C 	.endif
 024D			   *@C0006:
 024D			      C _MusicPlay_Chk2:
			      C 
			      C 
			      C ;---------------------------------------------------------------
			      C ;データ登録
			      C 
			      C 	;初期設定
 024D  26: 8A 6F 09	      C 	mov	ch,es:[bx].WTD_Mus_Voice	;数の取得 Voice
 0251  26: 8A 4F 08	      C 	mov	cl,es:[bx].WTD_Mus_Emb		;数の取得 Emb
 0255  53		      C 	push	bx				;
 0256  26: 8B 5F 0E	      C 	mov	bx,es:[bx].WTD_Mus_DataAdr	;
			      C 
			      C 	;WS内蔵PCM波形データの登録
			      C 	.while	(ch!=0)
 025A  EB 15		   *	    jmp    @C0008
 025C			   *@C0009:
 025C  33 C0		      C 		xor	ax,ax				;
 025E  26: 8A 07	      C 		mov	al,es:[bx]			;音色番号
 0261  43		      C 		inc	bx				;
 0262  06		      C 		push	es				;
 0263  53		      C 		push	bx				;波形データ
 0264  50		      C 		push	ax				;
 0265  0E		      C 		push	cs				;
 0266  E8 048C		      C 		call	near ptr _PcmVoiceSet		;登録
 0269  83 C4 06		      C 		add	sp,+6				;
 026C  83 C3 10		      C 		add	bx,16				;
 026F  FE CD		      C 		dec	ch				;
			      C 	.endw
 0271			   *@C0008:
 0271  0A ED		   *	    or	ch, ch
 0273  75 E7		   *	    jne    @C0009
			      C 
			      C 	;エンベロープデータの登録
			      C 	.while	(cl!=0)
 0275  EB 15		   *	    jmp    @C000B
 0277			   *@C000C:
 0277  33 C0		      C 		xor	ax,ax				;
 0279  26: 8A 07	      C 		mov	al,es:[bx]			;音色番号
 027C  43		      C 		inc	bx				;
 027D  06		      C 		push	es				;
 027E  53		      C 		push	bx				;エンベロープデータ
 027F  50		      C 		push	ax				;
 0280  0E		      C 		push	cs				;
 0281  E8 04AD		      C 		call	near ptr _SoftEmbSet		;登録
 0284  83 C4 06		      C 		add	sp,+6				;
 0287  83 C3 10		      C 		add	bx,16				;
 028A  FE C9		      C 		dec	cl				;
			      C 	.endw
 028C			   *@C000B:
 028C  0A C9		   *	    or	cl, cl
 028E  75 E7		   *	    jne    @C000C
			      C 
 0290  5B		      C 	pop	bx				;レジスタ復帰
			      C 
			      C ;---------------------------------------------------------------
			      C ;個別ワークの設定
			      C 
			      C ;チャンネル数の取得
 0291  26: 8A 6F 0A	      C 	mov	ch,es:[bx].WTD_Mus_Part	;チャンネル数の取得
			      C 	.if	(ch>MusicMaxPart)	;パート数チェック
 0295  80 FD 14		   *	    cmp    ch, MusicMaxPart
 0298  76 02		   *	    jbe    @C000E
 029A  B5 14		      C 		mov	ch,MusicMaxPart		;最大値を越えてたら最大値に。
			      C 	.endif
 029C			   *@C000E:
			      C 
			      C ;演奏パート数保存
 029C  51		      C 	push	cx			;レジスタ保存
 029D  B1 00		      C 	mov	cl,0			;トラック番号用カウンタ
 029F  83 C3 10		      C 	add	bx,WTD_Mus_PartAdr	;演奏アドレス
			      C 
			      C ;ワーク全体の初期化(00hで埋める)
			      C ;メモリ書き込み
 02A2  FC		      C 	cld				;インクリメントモード
 02A3  57		      C 	push	di			;es:di←ワークファーアドレス
 02A4  51		      C 	push	cx			;
 02A5  06		      C 	push	es			;
			      C ;	mov	ax,ds			;
			      C ;	mov	es,ax			;
 02A6  1E		      C 	push	ds
 02A7  07		      C 	pop	es
 02A8  B0 40		      C 	mov	al,WTD_WorkChSize / 2	;Wordなので、2で割る。
 02AA  F6 E5		      C 	mul	ch			;
 02AC  8B C8		      C 	mov	cx,ax			;パート個別構造体(080h * 20 / 2)
 02AE  33 C0		      C 	xor	ax,ax			;ax←0
 02B0  F3/ AB		      C 	rep	stosw			;書き込み
 02B2  07		      C 	pop	es			;
 02B3  59		      C 	pop	cx			;
 02B4  5F		      C 	pop	di			;
			      C 
			      C 	.repeat
 02B5			   *@C0010:
			      C ;	xor	ax,ax				;Stosbによる初期化
			      C ;	mov	ds:[di].WTD_FlagControl,ax	;
			      C ;	mov	ds:[di].WTD_FlagTai,al		;
			      C ;	mov	ds:[di].WTD_FlagSharp,al	;
			      C ;	mov	ds:[di].WTD_FlagFlat,al		;
			      C ;	mov	ds:[di].WTD_Channel,cl		;
			      C ;	mov	ds:[di].WTD_KeyOffTime,ax	;
			      C ;	mov	ds:[di].WTD_KeyOnDelay,ax	;
			      C ;	mov	ds:[di].WTD_KeyShift,al		;
			      C ;	mov	ds:[di].WTD_KeySetPointer,al	;
			      C ;	mov	ds:[di].WTD_ModDecay,ax		;
			      C ;	mov	ds:[di].WTD_ModLevel,al		;
			      C ;	mov	ds:[di].WTD_BendDetune,ax	;
			      C ;	mov	ds:[di].WTD_BendEmbRate,al	;
			      C ;	mov	ds:[di].WTD_BendEmbMaxMin,al	;
			      C ;	mov	ds:[di].WTD_BendEmbLevelSet,al	;
			      C ;	mov	ds:[di].WTD_ExprDetune,ax	;
			      C ;	mov	ds:[di].WTD_ExprEmbRate,al	;
			      C ;	mov	ds:[di].WTD_ExprEmbMaxMin,al	;
			      C ;	mov	ds:[di].WTD_ExprEmbLevelSet,al	;
			      C ;	mov	ds:[di].WTD_PanDetune,ax	;
			      C ;	mov	ds:[di].WTD_PanEmbRate,al	;
			      C ;	mov	ds:[di].WTD_PanEmbMaxMin,al	;
			      C ;	mov	ds:[di].WTD_PanEmbLevelSet,al	;
			      C ;	mov	ds:[di].WTD_GateTimeStepLast,ax	;
			      C ;	mov	ds:[di].WTD_GateTimeStepFirst,ax
			      C ;	mov	ds:[di].WTD_Expr,al		;
			      C ;	mov	ds:[di].WTD_ExprSet,al		;初期値0にしておくこと。
 02B5  B8 0001		      C 	mov	ax,1				;
 02B8  88 45 3B		      C 	mov	ds:[di].WTD_BendEmbCounter,al	;
 02BB  88 45 4F		      C 	mov	ds:[di].WTD_ExprEmbCounter,al	;
 02BE  88 45 6F		      C 	mov	ds:[di].WTD_PanEmbCounter,al	;
 02C1  89 45 14		      C 	mov	ds:[di].WTD_Leng,ax		;
 02C4  89 45 16		      C 	mov	ds:[di].WTD_LengCounter,ax	;
 02C7  88 45 5A		      C 	mov	ds:[di].WTD_VolumeUpDown,al	;
 02CA  B8 0004		      C 	mov	ax,04h				;
 02CD  88 45 54		      C 	mov	ds:[di].WTD_Octave,al		;
 02D0  B8 0008		      C 	mov	ax,08h				;
 02D3  88 45 55		      C 	mov	ds:[di].WTD_GateTime8,al	;
 02D6  B8 000C		      C 	mov	ax,0ch				;
 02D9  88 45 39		      C 	mov	ds:[di].WTD_BendEmbAddress,al	;
 02DC  88 45 4D		      C 	mov	ds:[di].WTD_ExprEmbAddress,al	;
 02DF  88 45 6D		      C 	mov	ds:[di].WTD_PanEmbAddress,al	;
 02E2  B8 0030		      C 	mov	ax,48				;
 02E5  89 45 18		      C 	mov	ds:[di].WTD_LengDefault,ax	;
 02E8  B8 0040		      C 	mov	ax,64				;
 02EB  88 45 61		      C 	mov	ds:[di].WTD_Pan,al		;
 02EE  B8 0064		      C 	mov	ax,100				;
 02F1  88 45 3F		      C 	mov	ds:[di].WTD_Velocity,al		;ExprPanと同一
 02F4  B8 007F		      C 	mov	ax,127				;
 02F7  88 45 29		      C 	mov	ds:[di].WTD_AcsentVelocity,al	;
 02FA  B8 2000		      C 	mov	ax,8192				;
 02FD  89 45 2C		      C 	mov	ds:[di].WTD_Bend,ax		;
 0300  B8 FFFF		      C 	mov	ax,0ffffh			;
 0303  88 45 11		      C 	mov	ds:[di].WTD_Program,al		;
 0306  88 45 75		      C 	mov	ds:[di].WTD_Program2nd,al	;
 0309  88 45 76		      C 	mov	ds:[di].WTD_Program3rd,al	;
 030C  88 45 77		      C 	mov	ds:[di].WTD_ProgramDecay,al	;
 030F  88 45 10		      C 	mov	ds:[di].WTD_LoopCountPointer,al	;
 0312  88 45 1F		      C 	mov	ds:[di].WTD_Key,al		;
 0315  88 45 20		      C 	mov	ds:[di].WTD_KeySet + 0,al	;
			      C ifndef	hyoka	;--------------------------------廉価版は無し
 0318  88 45 21		      C 	mov	ds:[di].WTD_KeySet + 1,al	;
 031B  88 45 22		      C 	mov	ds:[di].WTD_KeySet + 2,al	;
 031E  88 45 23		      C 	mov	ds:[di].WTD_KeySet + 3,al	;
 0321  88 45 24		      C 	mov	ds:[di].WTD_KeySet + 4,al	;
 0324  88 45 25		      C 	mov	ds:[di].WTD_KeySet + 5,al	;
 0327  88 45 26		      C 	mov	ds:[di].WTD_KeySet + 6,al	;
 032A  88 45 27		      C 	mov	ds:[di].WTD_KeySet + 7,al	;
			      C endif	;----------------------------------------
 032D  88 45 3E		      C 	mov	ds:[di].WTD_ReleaseVolume, al	;
 0330  26: 8B 07	      C 	mov	ax,es:[bx]			;
 0333  89 45 06		      C 	mov	ds:[di].WTD_Address,ax		;
			      C 
			      C ;	その他の設定
 0336  81 C7 0080	      C 	add	di,WTD_WorkChSize	;構造体分、加算
 033A  83 C3 02		      C 	add	bx,2			;アドレスインクリメント
 033D  FE C1		      C 	inc	cl			;
 033F  FE CD		      C 	dec	ch			;
			      C 	.until	(zero?)
 0341  74 03 E9 FF6F	   *	    jne    @C0010
			      C 
 0346  59		      C 	pop	cx			;レジスタ復帰
			      C ;---------------------------------------------------------------
			      C ;共通ワークの設定
			      C 
			      C ;演奏フラグのセット
 0347  8B 04		      C 	mov	ax,ds:[si].WTD_Sys_Flag			;
 0349  83 C8 01		      C 	or	ax,WTD_Sys_Music			;演奏イネーブル
 034C  89 04		      C 	mov	ds:[si].WTD_Sys_Flag,ax			;終了リセット
			      C 
 034E  88 6C 28		      C 	mov	ds:[si].WTD_Sys_MusicPart,ch		;パート数
			      C ;
			      C ;	その他の設定
			      C ;
			      C 
			      C ;タイマー（効果音、PCMは必要無し）
 0351  B8 007D		      C 	mov	ax,Timer_Tempo120			;
 0354  89 44 24		      C 	mov	ds:[si].WTD_Sys_Tempo,ax		;
 0357  33 C0		      C 	xor	ax,ax					;
 0359  89 44 26		      C 	mov	ds:[si].WTD_Sys_TempoCounter,ax		;
			      C 
			      C ;---------------------------------------------------------------
			      C 
			      C ;エラー無し
 035C  33 C0		      C 	xor	ax,ax			;ax←0
			      C 
 035E			      C _MusicPlay_End:
			      C 
 035E  E4 B2		      C 	in	al,Int_Enable		;
 0360  0C 80		      C 	or	al,Int_HblankSet	;
 0362  E6 B2		      C 	out	Int_Enable,al		;
			      C 
 0364  5D		      C 	pop	bp
			      C 
			      C 	ret				;終了
 0365  07		   *	    pop    es
 0366  1F		   *	    pop    ds
 0367  5E		   *	    pop    si
 0368  5F		   *	    pop    di
 0369  5A		   *	    pop    dx
 036A  59		   *	    pop    cx
 036B  5B		   *	    pop    bx
 036C  5D		   *	    pop    bp
 036D  CB		   *	    ret    00000h
 036E			      C _MusicPlay	endp			;
			      C ;===============================================================|
			      C ;	void	(far *MusicStop)();				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		演奏の終了					|
			      C ;===============================================================|
 036E			      C _MusicStop	proc far c	uses bp ax cx dx di si ds
			      C 
 036E  55		   *	    push   bp
 036F  50		   *	    push   ax
 0370  51		   *	    push   cx
 0371  52		   *	    push   dx
 0372  57		   *	    push   di
 0373  56		   *	    push   si
 0374  1E		   *	    push   ds
 0375  E4 B2		      C 	in	al,Int_Enable		;
 0377  24 7F		      C 	and	al,Int_HblankReset	;
 0379  E6 B2		      C 	out	Int_Enable,al		;
			      C 
			      C ;---------------------------------------------------------------
			      C ;ワークアドレスの取得
			      C 
			      C 	WTD_WorkGet	ds,bp			;ワークエリアアドレスの取得
			     1C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			     1C 
			     1C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
 037B  6A 00		     1C 		push	IRAM_Segment		;
 037D  1F		     1C 		pop	ds			;
 037E  BD 0000 R	     1C 		mov	bp,offset DGROUP:_WTD_Work
			     1C 
			     1C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			     1C 		push	SRAM_Segment		;（WonderWitch等）
			     1C 		pop	ds			;
			     1C 		mov	bp,offset DGROUP:_WTD_Work
			     1C endif	;-----------------------
			     1C 
			     1C else	;--------------------------------	;WonderWitch版
			     1C 		push	SRAM_Segment		;
			     1C 		pop	ds			;
			     1C 		mov	bp,ds:[ProcContext_heap]
			     1C endif	;--------------------------------
			      C 
			      C ;構造体アドレスの設定
 0381  8D BE 0600	      C 	lea	di,[bp + WTD_WorkAdd_Ch0]
 0385  8D B6 0380	      C 	lea	si,[bp + WTD_WorkAdd_System]
			      C 
			      C ;---------------------------------------------------------------
			      C ;個別構造体設定
			      C 
			      C ;チャンネル数
 0389  33 C9		      C 	xor	cx,cx					;
 038B  8A 6C 28		      C 	mov	ch,ds:[si].WTD_Sys_MusicPart		;使用トラック数
			      C 	.while	(ch!=0)
 038E  EB 53		   *	    jmp    @C0012
 0390			   *@C0013:
 0390  8A 4D 05		      C 		mov	cl,ds:[di].WTD_Channel		;
			      C 
			      C 		;初期化すべき事項
 0393  B8 003F		      C 		mov	ax,003Fh		;演奏終了
 0396  09 05		      C 		or	ds:[di].WTD_FlagControl,ax
			      C 
 0398  BA 1716 R	      C 		mov	dx,offset CGROUP:I_Table_KeyOff
 039B  E8 12EC		      C 		call	I_Table_Jump		;キーオフ
			      C 
 039E  B8 0000		      C 		mov	ax,0			;エクスプレッション = 0
 03A1  BA 173E R	      C 		mov	dx,offset CGROUP:I_Table_Volume
 03A4  E8 12E3		      C 		call	I_Table_Jump		;(エンベロープ音量。)
			      C 
 03A7  B8 2000		      C 		mov	ax,8192			;ベンド = 8192
 03AA  BA 17D0 R	      C 		mov	dx,offset CGROUP:I_Table_Frection
 03AD  E8 12DA		      C 		call	I_Table_Jump		;
			      C 
 03B0  B8 0000		      C 		mov	ax,0			;音色 = 0
 03B3  BA 1804 R	      C 		mov	dx,offset CGROUP:I_Table_Voice
 03B6  E8 12D1		      C 		call	I_Table_Jump		;
			      C 
			      C ifndef	hyoka	;------------------------廉価版は無し
 03B9  B8 0040		      C 		mov	ax,64			;パンポット = 64
 03BC  B1 0A		      C 		mov	cl,MIDI_Ctrl_Pan	;
 03BE  BA 189E R	      C 		mov	dx,offset CGROUP:I_Table_CtrlChgB
 03C1  E8 12C6		      C 		call	I_Table_Jump		;
			      C endif	;--------------------------------
			      C 
			      C ifndef	hyoka	;------------------------廉価版は無し
 03C4  B8 0064		      C 		mov	ax,100			;音量 = 100
 03C7  B1 07		      C 		mov	cl,MIDI_Ctrl_Volume	;
 03C9  BA 189E R	      C 		mov	dx,offset CGROUP:I_Table_CtrlChgB
 03CC  E8 12BB		      C 		call	I_Table_Jump		;
			      C endif	;--------------------------------
			      C 
 03CF  B8 0000		      C 		mov	ax,0			;モード　初期化
 03D2  BA 18CA R	      C 		mov	dx,offset CGROUP:I_Table_Mode
 03D5  E8 12B2		      C 		call	I_Table_Jump		;
			      C 
 03D8  B8 8000		      C 		mov	ax,8000h		;演奏終了
 03DB  09 05		      C 		or	ds:[di].WTD_FlagControl,ax
			      C 
			      C ;		その他
			      C ;		to do	あれば
			      C 
 03DD  81 C7 0080	      C 		add	di,WTD_WorkChSize	;構造体分、加算
 03E1  FE CD		      C 		dec	ch			;
			      C 	.endw
 03E3			   *@C0012:
 03E3  0A ED		   *	    or	ch, ch
 03E5  75 A9		   *	    jne    @C0013
			      C 
			      C ;---------------------------------------------------------------
			      C ;共通構造体設定
			      C 
 03E7  8B 04		      C 	mov	ax,ds:[si].WTD_Sys_Flag			;
 03E9  83 E0 FE		      C 	and	ax,WTD_Sys_MusicR			;演奏ディセーブル
 03EC  89 04		      C 	mov	ds:[si].WTD_Sys_Flag,ax			;終了リセット
			      C ;
			      C ;	その他
			      C ;
			      C 
			      C ;タイマー（効果音、PCMは必要無し）
 03EE  B8 007D		      C 	mov	ax,Timer_Tempo120			;
 03F1  89 44 24		      C 	mov	ds:[si].WTD_Sys_Tempo,ax		;
 03F4  33 C0		      C 	xor	ax,ax					;
 03F6  89 44 26		      C 	mov	ds:[si].WTD_Sys_TempoCounter,ax		;
			      C 
			      C ;---------------------------------------------------------------
			      C 
 03F9  E4 B2		      C 	in	al,Int_Enable		;
 03FB  0C 80		      C 	or	al,Int_HblankSet	;
 03FD  E6 B2		      C 	out	Int_Enable,al		;
			      C 
			      C 	ret				;終了
 03FF  1F		   *	    pop    ds
 0400  5E		   *	    pop    si
 0401  5F		   *	    pop    di
 0402  5A		   *	    pop    dx
 0403  59		   *	    pop    cx
 0404  58		   *	    pop    ax
 0405  5D		   *	    pop    bp
 0406  CB		   *	    ret    00000h
 0407			      C _MusicStop	endp			;
			      C ;===============================================================|
			      C ;	char	(far *EffectPlay)(char far *Effect);		|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		char far *Effect	効果音データのアドレス	|
			      C ;	返り値							|
			      C ;		ax			Error Code		|
			      C ;				00h	正常終了		|
			      C ;				01h	曲データじゃ無い。	|
			      C ;				02h	ヴァージョンが違う。	|
			      C ;	処理							|
			      C ;		効果音の発生					|
			      C ;===============================================================|
 0407			      C _EffectPlay	proc far c	uses bx cx dx di si ds es,
			      C 	fptEffect:far ptr byte
			      C 
			      C ;---------------------------------------------------------------
			      C ;演奏の停止
			      C 
 0407  55		   *	    push   bp
 0408  8B EC		   *	    mov    bp, sp
 040A  53		   *	    push   bx
 040B  51		   *	    push   cx
 040C  52		   *	    push   dx
 040D  57		   *	    push   di
 040E  56		   *	    push   si
 040F  1E		   *	    push   ds
 0410  06		   *	    push   es
 0411  0E		      C 	push	cs			;
 0412  E8 0161		      C 	call	near ptr _EffectStop	;演奏停止・割込周期の初期化
			      C 
			      C ;---------------------------------------------------------------
			      C ;割り込み禁止
			      C 
 0415  E4 B2		      C 	in	al,Int_Enable		;
 0417  24 7F		      C 	and	al,Int_HblankReset	;
 0419  E6 B2		      C 	out	Int_Enable,al		;
			      C 
			      C ;---------------------------------------------------------------
			      C ;ワークアドレスの取得
			      C 
			      C 	WTD_WorkGet	ds,bx			;ワークエリアアドレスの取得
			     1C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			     1C 
			     1C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
 041B  6A 00		     1C 		push	IRAM_Segment		;
 041D  1F		     1C 		pop	ds			;
 041E  BB 0000 R	     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C 
			     1C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			     1C 		push	SRAM_Segment		;（WonderWitch等）
			     1C 		pop	ds			;
			     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C endif	;-----------------------
			     1C 
			     1C else	;--------------------------------	;WonderWitch版
			     1C 		push	SRAM_Segment		;
			     1C 		pop	ds			;
			     1C 		mov	bx,ds:[ProcContext_heap]
			     1C endif	;--------------------------------
			      C 
			      C ;構造体アドレスの設定
 0421  8D BF 0400	      C 	lea	di,[bx + WTD_WorkAdd_ECh0]
 0425  8D B7 0380	      C 	lea	si,[bx + WTD_WorkAdd_System]
			      C 
			      C ;---------------------------------------------------------------
			      C ;演奏アドレスの設定
			      C 
 0429  C4 46 06		      C 	les	ax,fptEffect
 042C  06		      C 	push	es
 042D  50		      C 	push	ax
 042E  0E		      C 	push	cs			;データ変換
 042F  E8 033B		      C 	call	near ptr _ChangeFar	;dxax = wtdIL.ChangeFar(*Effect);
 0432  83 C4 04		      C 	add	sp,+4			;
 0435  89 44 0A		      C 	mov	ds:[si].WTD_Sys_EffectOffset,ax		;アドレスの設定
 0438  89 54 0C		      C 	mov	ds:[si].WTD_Sys_EffectSegment,dx	;
			      C 
			      C ;ポインタの設定
 043B  8E C2		      C 	mov	es,dx			;
 043D  8B D8		      C 	mov	bx,ax			;es:bx←曲データ先頭アドレス
			      C 
			      C ;---------------------------------------------------------------
			      C ;データ形式チェック
			      C 
			      C 	;ヘッダー文字列チェック
			      C 	.if	(word ptr es:[bx].WTD_Mus_Name!='TW')	;'WTD',0
 043F  26: 81 3F 5457	   *	    cmp    word ptr es : [bx] . WTD_Mus_Name, 'TW'
 0444  74 06		   *	    je     @C0015
 0446  B8 0001		      C 		mov	ax,1					;
 0449  E9 011B		      C 		jmp	_EffectPlay_End				;
			      C 	.endif
 044C			   *@C0015:
			      C 
			      C 	;バージョンチェック
 044C  26: 8B 47 04	      C 	mov	ax,es:[bx].WTD_Mus_Version	;
 0450  86 E0		      C 	xchg	ah,al				;ax←Effect Data Version
			      C 	.if	(ax>WTdIL_Version_N)
 0452  3D 010D		   *	    cmp    ax, WTdIL_Version_N
 0455  76 06		   *	    jbe    @C0017
 0457  B8 0002		      C 		mov	ax,2			;
 045A  E9 010A		      C 		jmp	_EffectPlay_End		;
			      C 	.endif
 045D			   *@C0017:
			      C 
			      C 
			      C ;---------------------------------------------------------------
			      C ;データ登録
			      C 
			      C 	;初期設定
 045D  26: 8A 6F 09	      C 	mov	ch,es:[bx].WTD_Mus_Voice	;数の取得 Voice
 0461  26: 8A 4F 08	      C 	mov	cl,es:[bx].WTD_Mus_Emb		;数の取得 Emb
 0465  53		      C 	push	bx				;
 0466  26: 8B 5F 0E	      C 	mov	bx,es:[bx].WTD_Mus_DataAdr	;
			      C 
			      C 	;WS内蔵PCM波形データの登録
			      C 	.while	(ch!=0)
 046A  EB 15		   *	    jmp    @C0019
 046C			   *@C001A:
 046C  33 C0		      C 		xor	ax,ax				;
 046E  26: 8A 07	      C 		mov	al,es:[bx]			;音色番号
 0471  43		      C 		inc	bx				;
 0472  06		      C 		push	es				;
 0473  53		      C 		push	bx				;波形データ
 0474  50		      C 		push	ax				;
 0475  0E		      C 		push	cs				;
 0476  E8 027C		      C 		call	near ptr _PcmVoiceSet		;登録
 0479  83 C4 06		      C 		add	sp,+6				;
 047C  83 C3 10		      C 		add	bx,16				;
 047F  FE CD		      C 		dec	ch				;
			      C 	.endw
 0481			   *@C0019:
 0481  0A ED		   *	    or	ch, ch
 0483  75 E7		   *	    jne    @C001A
			      C 
			      C 	;エンベロープデータの登録
			      C 	.while	(cl!=0)
 0485  EB 15		   *	    jmp    @C001C
 0487			   *@C001D:
 0487  33 C0		      C 		xor	ax,ax				;
 0489  26: 8A 07	      C 		mov	al,es:[bx]			;音色番号
 048C  43		      C 		inc	bx				;
 048D  06		      C 		push	es				;
 048E  53		      C 		push	bx				;エンベロープデータ
 048F  50		      C 		push	ax				;
 0490  0E		      C 		push	cs				;
 0491  E8 029D		      C 		call	near ptr _SoftEmbSet		;登録
 0494  83 C4 06		      C 		add	sp,+6				;
 0497  83 C3 10		      C 		add	bx,16				;
 049A  FE C9		      C 		dec	cl				;
			      C 	.endw
 049C			   *@C001C:
 049C  0A C9		   *	    or	cl, cl
 049E  75 E7		   *	    jne    @C001D
			      C 
 04A0  5B		      C 	pop	bx				;レジスタ復帰
			      C 
			      C ;---------------------------------------------------------------
			      C ;個別ワークの設定
			      C 
			      C ;チャンネル数の取得
 04A1  26: 8A 6F 0A	      C 	mov	ch,es:[bx].WTD_Mus_Part	;チャンネル数の取得
 04A5  80 FD 03		      C 	cmp	ch,EffectMaxPart	;パート数チェック
 04A8  72 02		      C 	jc	_EffectPlay_Step2	;
 04AA  B5 03		      C 	mov	ch,EffectMaxPart	;最大値を越えてたら最大値に。
 04AC			      C _EffectPlay_Step2:			;
			      C 
			      C ;演奏パート数保存
 04AC  51		      C 	push	cx			;レジスタ保存
 04AD  B1 00		      C 	mov	cl,0			;トラック番号用カウンタ
 04AF  83 C3 10		      C 	add	bx,WTD_Mus_PartAdr	;演奏アドレス
			      C 
			      C ;ワーク全体の初期化(00hで埋める)
			      C ;メモリ書き込み
 04B2  FC		      C 	cld				;インクリメントモード
 04B3  57		      C 	push	di			;es:di←ワークファーアドレス
 04B4  51		      C 	push	cx			;
 04B5  06		      C 	push	es			;
			      C ;	mov	ax,ds			;
			      C ;	mov	es,ax			;
 04B6  1E		      C 	push	ds
 04B7  07		      C 	pop	es
 04B8  B0 40		      C 	mov	al,WTD_WorkChSize / 2	;Wordなので、2で割る。
 04BA  F6 E5		      C 	mul	ch			;
 04BC  8B C8		      C 	mov	cx,ax			;パート個別構造体(080h * 20 / 2)
 04BE  33 C0		      C 	xor	ax,ax			;ax←0
 04C0  F3/ AB		      C 	rep	stosw			;書き込み
 04C2  07		      C 	pop	es			;
 04C3  59		      C 	pop	cx			;
 04C4  5F		      C 	pop	di			;
			      C 
			      C 	.repeat
 04C5			   *@C001F:
 04C5  C7 05 4000	      C 	mov	ds:[di].WTD_FlagControl,WTD_Ctrl_Effect
			      C ;	xor	ax,ax				;Stosbによる初期化
			      C ;	mov	ds:[di].WTD_FlagControl,ax	;
			      C ;	mov	ds:[di].WTD_FlagTai,al		;
			      C ;	mov	ds:[di].WTD_FlagSharp,al	;
			      C ;	mov	ds:[di].WTD_FlagFlat,al		;
			      C ;	mov	ds:[di].WTD_Channel,cl		;
			      C ;	mov	ds:[di].WTD_KeyOffTime,ax	;
			      C ;	mov	ds:[di].WTD_KeyOnDelay,ax	;
			      C ;	mov	ds:[di].WTD_KeyShift,al		;
			      C ;	mov	ds:[di].WTD_KeySetPointer,al	;
			      C ;	mov	ds:[di].WTD_ModDecay,ax		;
			      C ;	mov	ds:[di].WTD_ModLevel,al		;
			      C ;	mov	ds:[di].WTD_BendDetune,ax	;
			      C ;	mov	ds:[di].WTD_BendEmbRate,al	;
			      C ;	mov	ds:[di].WTD_BendEmbMaxMin,al	;
			      C ;	mov	ds:[di].WTD_BendEmbLevelSet,al	;
			      C ;	mov	ds:[di].WTD_ExprDetune,ax	;
			      C ;	mov	ds:[di].WTD_ExprEmbRate,al	;
			      C ;	mov	ds:[di].WTD_ExprEmbMaxMin,al	;
			      C ;	mov	ds:[di].WTD_ExprEmbLevelSet,al	;
			      C ;	mov	ds:[di].WTD_PanDetune,ax	;
			      C ;	mov	ds:[di].WTD_PanEmbRate,al	;
			      C ;	mov	ds:[di].WTD_PanEmbMaxMin,al	;
			      C ;	mov	ds:[di].WTD_PanEmbLevelSet,al	;
			      C ;	mov	ds:[di].WTD_GateTimeStepLast,ax	;
			      C ;	mov	ds:[di].WTD_GateTimeStepFirst,ax
			      C ;	mov	ds:[di].WTD_Expr,al		;
			      C ;	mov	ds:[di].WTD_ExprSet,al		;初期値0にしておくこと。
 04C9  B8 0001		      C 	mov	ax,1				;
 04CC  88 45 3B		      C 	mov	ds:[di].WTD_BendEmbCounter,al	;
 04CF  88 45 4F		      C 	mov	ds:[di].WTD_ExprEmbCounter,al	;
 04D2  88 45 6F		      C 	mov	ds:[di].WTD_PanEmbCounter,al	;
 04D5  89 45 14		      C 	mov	ds:[di].WTD_Leng,ax		;
 04D8  89 45 16		      C 	mov	ds:[di].WTD_LengCounter,ax	;
 04DB  88 45 5A		      C 	mov	ds:[di].WTD_VolumeUpDown,al	;
 04DE  B8 0004		      C 	mov	ax,04h				;
 04E1  88 45 54		      C 	mov	ds:[di].WTD_Octave,al		;
 04E4  B8 0008		      C 	mov	ax,08h				;
 04E7  88 45 55		      C 	mov	ds:[di].WTD_GateTime8,al	;
 04EA  B8 000C		      C 	mov	ax,0ch				;
 04ED  88 45 39		      C 	mov	ds:[di].WTD_BendEmbAddress,al	;
 04F0  88 45 4D		      C 	mov	ds:[di].WTD_ExprEmbAddress,al	;
 04F3  88 45 6D		      C 	mov	ds:[di].WTD_PanEmbAddress,al	;
 04F6  B8 0030		      C 	mov	ax,48				;
 04F9  89 45 18		      C 	mov	ds:[di].WTD_LengDefault,ax	;
 04FC  B8 0040		      C 	mov	ax,64				;
 04FF  88 45 61		      C 	mov	ds:[di].WTD_Pan,al		;
 0502  B8 0064		      C 	mov	ax,100				;
 0505  88 45 3F		      C 	mov	ds:[di].WTD_Velocity,al		;ExprPanと同一
 0508  B8 007F		      C 	mov	ax,127				;
 050B  88 45 29		      C 	mov	ds:[di].WTD_AcsentVelocity,al	;
 050E  B8 2000		      C 	mov	ax,8192				;
 0511  89 45 2C		      C 	mov	ds:[di].WTD_Bend,ax		;
 0514  B8 FFFF		      C 	mov	ax,0ffffh			;
 0517  88 45 11		      C 	mov	ds:[di].WTD_Program,al		;
 051A  88 45 75		      C 	mov	ds:[di].WTD_Program2nd,al	;
 051D  88 45 76		      C 	mov	ds:[di].WTD_Program3rd,al	;
 0520  88 45 77		      C 	mov	ds:[di].WTD_ProgramDecay,al	;
 0523  88 45 10		      C 	mov	ds:[di].WTD_LoopCountPointer,al	;
 0526  88 45 1F		      C 	mov	ds:[di].WTD_Key,al		;
 0529  88 45 20		      C 	mov	ds:[di].WTD_KeySet + 0,al	;
			      C ifndef	hyoka	;--------------------------------廉価版は無し
 052C  88 45 21		      C 	mov	ds:[di].WTD_KeySet + 1,al	;
 052F  88 45 22		      C 	mov	ds:[di].WTD_KeySet + 2,al	;
 0532  88 45 23		      C 	mov	ds:[di].WTD_KeySet + 3,al	;
 0535  88 45 24		      C 	mov	ds:[di].WTD_KeySet + 4,al	;
 0538  88 45 25		      C 	mov	ds:[di].WTD_KeySet + 5,al	;
 053B  88 45 26		      C 	mov	ds:[di].WTD_KeySet + 6,al	;
 053E  88 45 27		      C 	mov	ds:[di].WTD_KeySet + 7,al	;
			      C endif	;----------------------------------------
 0541  88 45 3E		      C 	mov	ds:[di].WTD_ReleaseVolume, al	;
 0544  26: 8B 07	      C 	mov	ax,es:[bx]			;
 0547  89 45 06		      C 	mov	ds:[di].WTD_Address,ax		;
			      C 
			      C ;	その他の設定
 054A  81 C7 0080	      C 	add	di,WTD_WorkChSize	;構造体分、加算
 054E  83 C3 02		      C 	add	bx,2			;アドレスインクリメント
 0551  FE C1		      C 	inc	cl			;
 0553  FE CD		      C 	dec	ch			;
			      C 	.until	(zero?)
 0555  74 03 E9 FF6B	   *	    jne    @C001F
			      C 
 055A  59		      C 	pop	cx			;レジスタ復帰
			      C ;---------------------------------------------------------------
			      C ;共通ワークの設定
			      C 
			      C ;演奏フラグのセット
 055B  8B 04		      C 	mov	ax,ds:[si].WTD_Sys_Flag			;
 055D  83 C8 02		      C 	or	ax,WTD_Sys_Effect			;演奏イネーブル
 0560  89 04		      C 	mov	ds:[si].WTD_Sys_Flag,ax			;終了リセット
			      C 
 0562  88 6C 29		      C 	mov	ds:[si].WTD_Sys_EffectPart,ch		;パート数
			      C ;
			      C ;	その他の設定
			      C ;
			      C 
			      C ;	現在は、特に無し
			      C 
			      C ;---------------------------------------------------------------
			      C 
			      C ;エラー無し
 0565  33 C0		      C 	xor	ax,ax			;ax←0
			      C 
 0567			      C _EffectPlay_End:
			      C 
 0567  E4 B2		      C 	in	al,Int_Enable		;
 0569  0C 80		      C 	or	al,Int_HblankSet	;
 056B  E6 B2		      C 	out	Int_Enable,al		;
			      C 
			      C 	ret				;終了
 056D  07		   *	    pop    es
 056E  1F		   *	    pop    ds
 056F  5E		   *	    pop    si
 0570  5F		   *	    pop    di
 0571  5A		   *	    pop    dx
 0572  59		   *	    pop    cx
 0573  5B		   *	    pop    bx
 0574  5D		   *	    pop    bp
 0575  CB		   *	    ret    00000h
 0576			      C _EffectPlay	endp			;
			      C ;===============================================================|
			      C ;	void	(far *EffectStop)();				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		効果音の発生終了				|
			      C ;===============================================================|
 0576			      C _EffectStop	proc far c	uses bp ax bx cx dx di ds es
			      C 
 0576  55		   *	    push   bp
 0577  50		   *	    push   ax
 0578  53		   *	    push   bx
 0579  51		   *	    push   cx
 057A  52		   *	    push   dx
 057B  57		   *	    push   di
 057C  1E		   *	    push   ds
 057D  06		   *	    push   es
 057E  E4 B2		      C 	in	al,Int_Enable		;
 0580  24 7F		      C 	and	al,Int_HblankReset	;
 0582  E6 B2		      C 	out	Int_Enable,al		;
			      C 
			      C ;---------------------------------------------------------------
			      C ;ワークアドレスの取得
			      C 
			      C 	WTD_WorkGet	ds,bp			;ワークエリアアドレスの取得
			     1C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			     1C 
			     1C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
 0584  6A 00		     1C 		push	IRAM_Segment		;
 0586  1F		     1C 		pop	ds			;
 0587  BD 0000 R	     1C 		mov	bp,offset DGROUP:_WTD_Work
			     1C 
			     1C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			     1C 		push	SRAM_Segment		;（WonderWitch等）
			     1C 		pop	ds			;
			     1C 		mov	bp,offset DGROUP:_WTD_Work
			     1C endif	;-----------------------
			     1C 
			     1C else	;--------------------------------	;WonderWitch版
			     1C 		push	SRAM_Segment		;
			     1C 		pop	ds			;
			     1C 		mov	bp,ds:[ProcContext_heap]
			     1C endif	;--------------------------------
			      C 
			      C ;構造体アドレスの設定
 058A  8D 9E 0380	      C 	lea	bx,[bp + WTD_WorkAdd_System]
			      C 
 058E  8D BE 0400	      C 	lea	di,[bp + WTD_WorkAdd_Ech0]
			      C ;	mov	es,ds:[bx].WTD_Sys_MusicSegment	;es←効果音データセグメント
			      C 
			      C ;---------------------------------------------------------------
			      C ;個別構造体設定
			      C 
			      C ;チャンネル数
 0592  33 C9		      C 	xor	cx,cx					;
 0594  8A 6F 29		      C 	mov	ch,ds:[bx].WTD_Sys_EffectPart		;使用トラック数
			      C 	.while	(ch!=0)
 0597  EB 28		   *	    jmp    @C0021
 0599			   *@C0022:
 0599  8A 4D 05		      C 		mov	cl,ds:[di].WTD_Channel			;
			      C 
			      C 		;初期化すべき事項
 059C  B8 003F		      C 		mov	ax,003Fh			;
 059F  09 05		      C 		or	ds:[di].WTD_FlagControl,ax	;演奏終了
			      C 
 05A1  BA 1716 R	      C 		mov	dx,offset CGROUP:I_Table_KeyOff	;
 05A4  E8 10E3		      C 		call	I_Table_Jump			;キーオフ
			      C 
 05A7  B8 0000		      C 		mov	ax,0			;エクスプレッション = 0
 05AA  BA 173E R	      C 		mov	dx,offset CGROUP:I_Table_Volume
 05AD  E8 10DA		      C 		call	I_Table_Jump		;(エンベロープ音量。)
			      C 
 05B0  51		      C 		push	cx				;
 05B1  8A E9		      C 		mov	ch, cl				;
 05B3  E8 0962		      C 		call	I_Effect_Return			;効果音復帰処理
 05B6  59		      C 		pop	cx				;
			      C 
 05B7  81 0D 8000	      C 		or	ds:[di].WTD_FlagControl,WTD_Ctrl_PlayEnd
			      C 	;	mov	ax,8000h			;
			      C 	;	or	ds:[di].WTD_FlagControl,ax	;演奏終了
			      C 
			      C ;		その他
			      C ;		to do	あれば
			      C 
 05BB  81 C7 0080	      C 		add	di,WTD_WorkChSize		;構造体分、加算
 05BF  FE CD		      C 		dec	ch				;
			      C 	.endw
 05C1			   *@C0021:
 05C1  0A ED		   *	    or	ch, ch
 05C3  75 D4		   *	    jne    @C0022
			      C 
			      C ;---------------------------------------------------------------
			      C ;共通構造体設定
			      C 
 05C5  8B 07		      C 	mov	ax,ds:[bx].WTD_Sys_Flag		;
 05C7  83 E0 FD		      C 	and	ax,WTD_Sys_EffectR		;演奏ディセーブル
 05CA  89 07		      C 	mov	ds:[bx].WTD_Sys_Flag,ax		;終了リセット
			      C ;
			      C ;	その他
			      C ;
			      C 
			      C ;	現在は、処理無し。
			      C 
			      C ;---------------------------------------------------------------
			      C 
 05CC  E4 B2		      C 	in	al,Int_Enable		;
 05CE  0C 80		      C 	or	al,Int_HblankSet	;
 05D0  E6 B2		      C 	out	Int_Enable,al		;
			      C 
			      C 	ret				;終了
 05D2  07		   *	    pop    es
 05D3  1F		   *	    pop    ds
 05D4  5F		   *	    pop    di
 05D5  5A		   *	    pop    dx
 05D6  59		   *	    pop    cx
 05D7  5B		   *	    pop    bx
 05D8  58		   *	    pop    ax
 05D9  5D		   *	    pop    bp
 05DA  CB		   *	    ret    00000h
 05DB			      C _EffectStop	endp			;
			      C ;===============================================================|
			      C ;	char	(far *PcmPlay)(char far *Pcm);			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		char far*Pcm	ファイルのあるアドレス		|
			      C ;	返り値							|
			      C ;		ax	0	正常				|
			      C ;			1	Waveデータじゃない。		|
			      C ;			   or	データ形式が違う。		|
			      C ;			2	'fmt 'が見つからない。		|
			      C ;			3	'data'が見つからない。		|
			      C ;	処理							|
			      C ;		Waveファイルの解析と、発生準備			|
			      C ;===============================================================|
 05DB			      C _PcmPlay	proc far c	uses bx cx dx di si ds es,
			      C 	fptPCM:far ptr byte
			      C 
			      C ;---------------------------------------------------------------
			      C ;演奏の停止
			      C 
 05DB  55		   *	    push   bp
 05DC  8B EC		   *	    mov    bp, sp
 05DE  53		   *	    push   bx
 05DF  51		   *	    push   cx
 05E0  52		   *	    push   dx
 05E1  57		   *	    push   di
 05E2  56		   *	    push   si
 05E3  1E		   *	    push   ds
 05E4  06		   *	    push   es
 05E5  0E		      C 	push	cs			;
 05E6  E8 00E6		      C 	call	near ptr _PcmStop	;演奏停止・割込周期の初期化
			      C 
			      C ;---------------------------------------------------------------
			      C ;割り込み禁止
			      C 
 05E9  E4 B2		      C 	in	al,Int_Enable		;
 05EB  24 7F		      C 	and	al,Int_HblankReset	;
 05ED  E6 B2		      C 	out	Int_Enable,al		;
			      C 
			      C ;---------------------------------------------------------------
			      C ;ワークアドレスの取得
			      C 
			      C 	WTD_WorkGet	ds,bx			;ワークエリアアドレスの取得
			     1C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			     1C 
			     1C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
 05EF  6A 00		     1C 		push	IRAM_Segment		;
 05F1  1F		     1C 		pop	ds			;
 05F2  BB 0000 R	     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C 
			     1C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			     1C 		push	SRAM_Segment		;（WonderWitch等）
			     1C 		pop	ds			;
			     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C endif	;-----------------------
			     1C 
			     1C else	;--------------------------------	;WonderWitch版
			     1C 		push	SRAM_Segment		;
			     1C 		pop	ds			;
			     1C 		mov	bx,ds:[ProcContext_heap]
			     1C endif	;--------------------------------
			      C 
			      C ;構造体アドレスの設定
 05F5  8D BF 0580	      C 	lea	di,[bx + WTD_WorkAdd_PCM]
 05F9  8D B7 0380	      C 	lea	si,[bx + WTD_WorkAdd_System]
			      C 
			      C ;---------------------------------------------------------------
			      C ;演奏アドレスの設定
			      C 
 05FD  C4 46 06		      C 	les	ax,fptPCM
 0600  06		      C 	push	es
 0601  50		      C 	push	ax
 0602  0E		      C 	push	cs			;データ変換
 0603  E8 0167		      C 	call	near ptr _ChangeFar	;dxax = wtdIL.ChangeFar(*Pcm);
 0606  83 C4 04		      C 	add	sp,+4			;
 0609  89 44 0E		      C 	mov	ds:[si].WTD_Sys_PcmOffset,ax	;アドレスの設定
 060C  89 54 10		      C 	mov	ds:[si].WTD_Sys_PcmSegment,dx	;
			      C 
			      C ;ポインタの設定
 060F  8E C2		      C 	mov	es,dx			;
 0611  8B D8		      C 	mov	bx,ax			;es:bx←RIFF構造体
			      C 
			      C ;---------------------------------------------------------------
			      C ;'Wave'ファイルの解析	データ形式のチェック
			      C ;※下位16bitのみのチェック・解析・演算である。
			      C ;　上位16bitは無視している。
			      C 
			      C ;FileCheck
			      C ;・RIFF形式、且つ、WAVEデータであか？
 0613  26: 81 3F 4952	      C 	cmp	word ptr es:[bx].RIFF_Head,'IR'		;RIFF ?
 0618  75 43		      C 	jnz	_PcmPlay_EndJmp				;
 061A  26: 81 7F 08 4157      C 	cmp	word ptr es:[bx].RIFF_Type,'AW'		;WAVE ?
 0620  75 3B		      C 	jnz	_PcmPlay_EndJmp				;
			      C ;次アドレス設定
 0622  83 C3 0C		      C 	add	bx,RIFF_Data				;bx←RIFFのData部。
			      C 
			      C ;Wavefmt構造体の検索
			      C ;文字列チェック
 0625			      C _PcmPlay_FileChkLoop:					;
 0625  26: 81 3F 6D66	      C 	cmp	word ptr es:[bx].RiffHed_Head,'mf'	;fmt  ?
 062A  74 13		      C 	jz	_PcmPlay_FileChkEnd			;
 062C  26: 8B 47 04	      C 	mov	ax,word ptr es:[bx].RiffHed_Size	;ヘッド、サイズ分を加算
 0630  83 C3 08		      C 	add	bx,RiffHed_Data				;64KByte越えたら、
 0633  72 04		      C 	jc	_PcmPlay_FileChkStep1			;エラーにする。
 0635  03 D8		      C 	add	bx,ax					;
 0637  73 EC		      C 	jnc	_PcmPlay_FileChkLoop			;
 0639			      C _PcmPlay_FileChkStep1:					;
 0639  B8 0002		      C 	mov	ax,2					;'fmt 'が無い。
 063C  E9 0081		      C 	jmp	_PcmPlay_End				;
 063F			      C _PcmPlay_FileChkEnd:					;
			      C 
			      C ;ファイル形式チェック
			      C ;・モノラルか？
			      C ;・量子化数＝8bitか？
			      C ;サンプリングレイトは面倒だから確認しない。（遊べるし。）
 063F  26: 83 7F 08 01	      C 	cmp	word ptr es:[bx].WaveFmt_Type,1		;Wave type ?
 0644  75 17		      C 	jnz	_PcmPlay_EndJmp				;
 0646  26: 83 7F 0A 01	      C 	cmp	word ptr es:[bx].WaveFmt_Channel,1	;mono(1ch) ?
 064B  75 10		      C 	jnz	_PcmPlay_EndJmp				;
 064D  26: 83 7F 14 01	      C 	cmp	word ptr es:[bx].WaveFmt_DataSize,1	;1byte ?
 0652  75 09		      C 	jnz	_PcmPlay_EndJmp				;
 0654  26: 83 7F 16 08	      C 	cmp	word ptr es:[bx].WaveFmt_ChannelSize,8	;8bit ?
 0659  75 02		      C 	jnz	_PcmPlay_EndJmp				;
 065B  EB 05		      C 	jmp	short _PcmPlay_EndJmpStep
 065D			      C _PcmPlay_EndJmp:
 065D  B8 0001		      C 	mov	ax,1					;Error 
 0660  EB 5E		      C 	jmp	_PcmPlay_End				;
 0662			      C _PcmPlay_EndJmpStep:
			      C ;次アドレス設定
 0662  26: 8B 47 04	      C 	mov	ax,word ptr es:[bx].WaveFmt_Size	;ヘッド、サイズ分を加算
 0666  83 C3 08		      C 	add	bx,WaveFmt_Type				;64KByte越えたら、
 0669  72 F2		      C 	jc	_PcmPlay_EndJmp				;エラーにする。
 066B  03 D8		      C 	add	bx,ax					;
 066D  72 EE		      C 	jc	_PcmPlay_EndJmp				;
			      C 
			      C ;WaveData構造体の検索
			      C ;文字列チェック
 066F			      C _PcmPlay_FileChkLoop2:					;
 066F  26: 81 3F 6164	      C 	cmp	word ptr es:[bx].RiffHed_Head,'ad'	;data ?
 0674  74 12		      C 	jz	_PcmPlay_FileChkEnd2			;
 0676  26: 8B 47 04	      C 	mov	ax,word ptr es:[bx].RiffHed_Size	;ヘッド、サイズ分を加算
 067A  83 C3 08		      C 	add	bx,RiffHed_Data				;64KByte越えたら、
 067D  72 04		      C 	jc	_PcmPlay_FileChkStep2			;エラーにする。
 067F  03 D8		      C 	add	bx,ax					;
 0681  73 EC		      C 	jnc	_PcmPlay_FileChkLoop2			;
 0683			      C _PcmPlay_FileChkStep2:					;
 0683  B8 0003		      C 	mov	ax,3					;
 0686  EB 38		      C 	jmp	_PcmPlay_End				;
 0688			      C _PcmPlay_FileChkEnd2:					;
			      C 
			      C ;---------------------------------------------------------------
			      C ;個別ワークの設定
			      C 
			      C ;構造体設定
			      C ;データサイズ
 0688  26: 8B 47 04	      C 	mov	ax,word ptr es:[bx].WaveData_Size+0	;
 068C  89 45 0C		      C 	mov	word ptr ds:[di].WTD_PcmSize+0,ax	;
 068F  26: 8B 47 06	      C 	mov	ax,word ptr es:[bx].WaveData_Size+2	;
 0693  89 45 0E		      C 	mov	word ptr ds:[di].WTD_PcmSize+2,ax	;
			      C ;発生アドレス
			      C ;	mov	ax,WaveData_Data			;
			      C ;	add	ax,bx					;
 0696  8D 47 08		      C 	lea	ax,[bx + WaveData_Data]			;
 0699  8C C2		      C 	mov	dx,es					;dx:ax←Data Address
 069B  89 45 08		      C 	mov	word ptr ds:[di].WTD_PcmAddress+0,ax	;
 069E  89 55 0A		      C 	mov	word ptr ds:[di].WTD_PcmAddress+2,dx	;
			      C ;フラグ設定
 06A1  8B 05		      C 	mov	ax,word ptr ds:[di].WTD_FlagControl	;
 06A3  0D 4000		      C 	or	ax,WTD_Ctrl_Effect			;
 06A6  25 7FFF		      C 	and	ax,WTD_Ctrl_PlayEndR			;
 06A9  89 05		      C 	mov	word ptr ds:[di].WTD_FlagControl,ax	;
			      C 
			      C ;
			      C ;	その他の設定
			      C ;
			      C 
			      C ;---------------------------------------------------------------
			      C ;共通ワークの設定
			      C 
			      C ;テンポカウンター
 06AB  B8 0001		      C 	mov	ax,1					;
 06AE  89 44 26		      C 	mov	ds:[si].WTD_Sys_TempoCounter,ax		;TempoCounter = 1
			      C 
			      C ;演奏フラグのセット
 06B1  8B 04		      C 	mov	ax,ds:[si].WTD_Sys_Flag			;
			      C 	;PCMVoice効果音On, Musicch2Mask, Timer Emulate on
 06B3  0D 2084		      C 	or	ax,WTD_Sys_Pcm + WTD_Sys_EffectMask2 + WTD_Sys_TimerEmulate
			      C ;	and	ax,WTD_Sys_PcmEndR			;このフラグは廃止
 06B6  89 04		      C 	mov	ds:[si].WTD_Sys_Flag,ax			;終了リセット
			      C 
			      C ;
			      C ;	その他の設定
			      C ;
			      C 
			      C ;---------------------------------------------------------------
			      C ;デバイスの設定
			      C 
			      C ;PCM Voice mode
 06B8  B8 2020		      C 	mov	ax,PcmVoiceMode_Set	;
 06BB  E8 1376		      C 	call	SP_Set_Channel		;PcmVoice Modeにする。
			      C 
			      C ;---------------------------------------------------------------
			      C 
			      C ;エラー無し
 06BE  33 C0		      C 	xor	ax,ax			;ax←0
			      C 
 06C0			      C _PcmPlay_End:
 06C0  E4 B2		      C 	in	al,Int_Enable		;
 06C2  0C 80		      C 	or	al,Int_HblankSet	;
 06C4  E6 B2		      C 	out	Int_Enable,al		;
			      C 
			      C 	ret				;終了
 06C6  07		   *	    pop    es
 06C7  1F		   *	    pop    ds
 06C8  5E		   *	    pop    si
 06C9  5F		   *	    pop    di
 06CA  5A		   *	    pop    dx
 06CB  59		   *	    pop    cx
 06CC  5B		   *	    pop    bx
 06CD  5D		   *	    pop    bp
 06CE  CB		   *	    ret    00000h
 06CF			      C _PcmPlay	endp			;
			      C ;===============================================================|
			      C ;	void	(far *PcmStop)();				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		PCM Voice の発生終了準備			|
			      C ;===============================================================|
 06CF			      C _PcmStop	proc far c	uses bp ax bx cx dx di si ds
			      C 
			      C ;---------------------------------------------------------------
			      C ;ワークアドレスの取得
			      C 
			      C 	WTD_WorkGet	ds,bx			;ワークエリアアドレスの取得
			     1C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			     1C 
			     1C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
 06CF  55		   *	    push   bp
 06D0  50		   *	    push   ax
 06D1  53		   *	    push   bx
 06D2  51		   *	    push   cx
 06D3  52		   *	    push   dx
 06D4  57		   *	    push   di
 06D5  56		   *	    push   si
 06D6  1E		   *	    push   ds
 06D7  6A 00		     1C 		push	IRAM_Segment		;
 06D9  1F		     1C 		pop	ds			;
 06DA  BB 0000 R	     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C 
			     1C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			     1C 		push	SRAM_Segment		;（WonderWitch等）
			     1C 		pop	ds			;
			     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C endif	;-----------------------
			     1C 
			     1C else	;--------------------------------	;WonderWitch版
			     1C 		push	SRAM_Segment		;
			     1C 		pop	ds			;
			     1C 		mov	bx,ds:[ProcContext_heap]
			     1C endif	;--------------------------------
			      C 
			      C ;構造体アドレスの設定
 06DD  8D BF 0580	      C 	lea	di,[bx + WTD_WorkAdd_PCM]
 06E1  8D B7 0380	      C 	lea	si,[bx + WTD_WorkAdd_System]
			      C 
			      C ;---------------------------------------------------------------
			      C ;構造体設定
			      C 
			      C ;
			      C ;	　タイマー割り込みアルゴリズムの都合上、
			      C ;	割り込み処理内で復帰処理を行う。
			      C ;
			      C 
			      C ;---------------------------------------------------------------
			      C ;共通ワークの設定
			      C 
			      C ;演奏フラグのセット
 06E5  8B 04		      C 	mov	ax,ds:[si].WTD_Sys_Flag			;
 06E7  83 E0 FB		      C 	and	ax,WTD_Sys_PcmR				;終了
 06EA  89 04		      C 	mov	ds:[si].WTD_Sys_Flag,ax			;終了リセット
			      C 
			      C ;	タイマーは、割り込みルーチンでいじる。
			      C 
			      C 
			      C ;
			      C ;	その他の設定
			      C ;
			      C 
			      C ;---------------------------------------------------------------
			      C 
			      C 	ret				;終了
 06EC  1F		   *	    pop    ds
 06ED  5E		   *	    pop    si
 06EE  5F		   *	    pop    di
 06EF  5A		   *	    pop    dx
 06F0  59		   *	    pop    cx
 06F1  5B		   *	    pop    bx
 06F2  58		   *	    pop    ax
 06F3  5D		   *	    pop    bp
 06F4  CB		   *	    ret    00000h
 06F5			      C _PcmStop	endp			;
			      C ;===============================================================|
			      C ;	char	(far *PcmVoiceSet)(char no,char far *wave);	|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		char	no	音色番号			|
			      C ;		char far *wave	波形データ			|
			      C ;	返り値							|
			      C ;		Error Code					|
			      C ;	処理							|
			      C ;		WS内蔵PCM波形データをドライバーに登録する。	|
			      C ;===============================================================|
 06F5			      C _PcmVoiceSet	proc far c	uses bx cx dx di si ds es,
			      C 	cNumber:byte,
			      C 	fptWave:far ptr byte
			      C 
			      C ;---------------------------------------------------------------
			      C ;ワークアドレスの取得
			      C 
			      C 	WTD_WorkGet	ds,bx			;ワークエリアアドレスの取得
			     1C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			     1C 
			     1C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
 06F5  55		   *	    push   bp
 06F6  8B EC		   *	    mov    bp, sp
 06F8  53		   *	    push   bx
 06F9  51		   *	    push   cx
 06FA  52		   *	    push   dx
 06FB  57		   *	    push   di
 06FC  56		   *	    push   si
 06FD  1E		   *	    push   ds
 06FE  06		   *	    push   es
 06FF  6A 00		     1C 		push	IRAM_Segment		;
 0701  1F		     1C 		pop	ds			;
 0702  BB 0000 R	     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C 
			     1C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			     1C 		push	SRAM_Segment		;（WonderWitch等）
			     1C 		pop	ds			;
			     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C endif	;-----------------------
			     1C 
			     1C else	;--------------------------------	;WonderWitch版
			     1C 		push	SRAM_Segment		;
			     1C 		pop	ds			;
			     1C 		mov	bx,ds:[ProcContext_heap]
			     1C endif	;--------------------------------
 0705  1E		      C 	push	ds
 0706  07		      C 	pop	es
			      C 
			      C ;構造体アドレスの設定
 0707  8D BF 0100	      C 	lea	di,[bx + WTD_WorkAdd_Wave]
			      C 
			      C ;---------------------------------------------------------------
			      C ;設定
			      C 
			      C 	;音色番号取得
 070B  33 C0		      C 	xor	ax,ax			;
 070D  8A 46 06		      C 	mov	al,cNumber		;ax←音色番号
			      C 
			      C 	;音色番号チェック
			      C 	.if	(al>15)			;16以下？
 0710  3C 0F		   *	    cmp    al, 00Fh
 0712  76 05		   *	    jbe    @C0024
 0714  B8 000B		      C 		mov	ax,11		;でなかったら、エラー
 0717  EB 0F		      C 		jmp	_PCMVoiceSet_End
			      C 	.endif
 0719			   *@C0024:
			      C 
			      C 	;音色転送
 0719  C1 E0 04		      C 	shl	ax,4			;
 071C  03 F8		      C 	add	di,ax			;di＝di＋ax×16
 071E  C5 76 08		      C 	lds	si,fptWave		;ds:si←送り元
 0721  B9 0008		      C 	mov	cx,8			;16Byte転送
 0724  F3/ A5		      C 	rep	movsw			;ブロック転送
			      C 
			      C ;---------------------------------------------------------------
			      C 
			      C 	;エラー無し
 0726  33 C0		      C 	xor	ax,ax			;ax←0
			      C 
 0728			      C _PCMVoiceSet_End:
			      C 
			      C 	ret				;終了
 0728  07		   *	    pop    es
 0729  1F		   *	    pop    ds
 072A  5E		   *	    pop    si
 072B  5F		   *	    pop    di
 072C  5A		   *	    pop    dx
 072D  59		   *	    pop    cx
 072E  5B		   *	    pop    bx
 072F  5D		   *	    pop    bp
 0730  CB		   *	    ret    00000h
 0731			      C _PcmVoiceSet	endp			;
			      C ;===============================================================|
			      C ;	char	(far *SoftEmbSet)(char no,char far *emb);	|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		char	no	音色番号			|
			      C ;		char far *wave	エンベロープデータ		|
			      C ;	返り値							|
			      C ;		Error Code					|
			      C ;	処理							|
			      C ;		エンベロープデータをドライバーに登録する。	|
			      C ;===============================================================|
 0731			      C _SoftEmbSet	proc far c	uses bx cx dx di si ds es,
			      C 	cNumber:byte,
			      C 	fptWave:far ptr byte
			      C 
			      C ;---------------------------------------------------------------
			      C ;ワークアドレスの取得
			      C 
			      C 	WTD_WorkGet	ds,bx			;ワークエリアアドレスの取得
			     1C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			     1C 
			     1C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
 0731  55		   *	    push   bp
 0732  8B EC		   *	    mov    bp, sp
 0734  53		   *	    push   bx
 0735  51		   *	    push   cx
 0736  52		   *	    push   dx
 0737  57		   *	    push   di
 0738  56		   *	    push   si
 0739  1E		   *	    push   ds
 073A  06		   *	    push   es
 073B  6A 00		     1C 		push	IRAM_Segment		;
 073D  1F		     1C 		pop	ds			;
 073E  BB 0000 R	     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C 
			     1C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			     1C 		push	SRAM_Segment		;（WonderWitch等）
			     1C 		pop	ds			;
			     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C endif	;-----------------------
			     1C 
			     1C else	;--------------------------------	;WonderWitch版
			     1C 		push	SRAM_Segment		;
			     1C 		pop	ds			;
			     1C 		mov	bx,ds:[ProcContext_heap]
			     1C endif	;--------------------------------
 0741  1E		      C 	push	ds
 0742  07		      C 	pop	es
			      C 
			      C ;構造体アドレスの設定
 0743  8D BF 0200	      C 	lea	di,[bx + WTD_WorkAdd_Emb]
			      C 
			      C ;---------------------------------------------------------------
			      C ;設定
			      C 
			      C 	;音色番号取得
 0747  33 C0		      C 	xor	ax,ax			;
 0749  8A 46 06		      C 	mov	al,cNumber		;ax←音色番号
			      C 
			      C 	;音色番号チェック
			      C 	.if	(al>23)			;24以下？
 074C  3C 17		   *	    cmp    al, 017h
 074E  76 05		   *	    jbe    @C0026
 0750  B8 000B		      C 		mov	ax,11		;でなかったら、エラー
 0753  EB 0F		      C 		jmp	_SoftEmbSet_End	
			      C 	.endif
 0755			   *@C0026:
			      C 
			      C 	;転送
 0755  C1 E0 04		      C 	shl	ax,4			;
 0758  03 F8		      C 	add	di,ax			;di＝di＋ax×16
 075A  C5 76 08		      C 	lds	si,fptWave		;ds:si←送り元
 075D  B9 0008		      C 	mov	cx,8			;16Byte転送
 0760  F3/ A5		      C 	rep	movsw			;ブロック転送
			      C 
			      C ;---------------------------------------------------------------
			      C 
			      C ;エラー無し
 0762  33 C0		      C 	xor	ax,ax			;ax←0
			      C 
 0764			      C _SoftEmbSet_End:
			      C 	ret				;終了
 0764  07		   *	    pop    es
 0765  1F		   *	    pop    ds
 0766  5E		   *	    pop    si
 0767  5F		   *	    pop    di
 0768  5A		   *	    pop    dx
 0769  59		   *	    pop    cx
 076A  5B		   *	    pop    bx
 076B  5D		   *	    pop    bp
 076C  CB		   *	    ret    00000h
 076D			      C _SoftEmbSet	endp			;
			      C ;===============================================================|
			      C ;	void far *(far *ChangeFar)(void far *add);		|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		void far *add	far pointer			|
			      C ;	返り値							|
			      C ;		dxax		far pointer			|
			      C ;	処理							|
			      C ;		far pointerの変換。offset=0x000?にする。	|
			      C ;===============================================================|
 076D			      C _ChangeFar	proc far c,
			      C 	fptData:far ptr byte
			      C 
			      C ;---------------------------------------------------------------
			      C ;ファーポインタ変換
			      C 
			      C ;	mov	ax,word ptr [bp + 06h]	;ax←far pointer offset
 076D  55		   *	    push   bp
 076E  8B EC		   *	    mov    bp, sp
 0770  8B 46 06		      C 	mov	ax,word ptr fptData	;ax←far pointer offset
 0773  8B D0		      C 	mov	dx,ax			;
 0775  83 E0 0F		      C 	and	ax,000Fh		;ax←残りの16byte分
 0778  C1 EA 04		      C 	shr	dx,4			;
			      C ;	add	dx,word ptr [bp + 08h]	;dx←ax / 16 + far pointer segment
 077B  03 56 08		      C 	add	dx,word ptr fptData+2	;dx←ax / 16 + far pointer segment
			      C 
			      C ;---------------------------------------------------------------
			      C 
			      C 	ret				;終了
 077E  5D		   *	    pop    bp
 077F  CB		   *	    ret    00000h
 0780			      C _ChangeFar	endp			;
			      C ;===============================================================|
			      C ;	void	(far *SoundSetChannel)(int mode);		|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		mode bit 0- 7	Set Data			|
			      C ;		mode bit 8-15	Set Data bit			|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		Channel modeの設定				|
			      C ;===============================================================|
 0780			      C _SoundSetChannel	proc far c	uses ax,
			      C 	iMode:word
			      C 
 0780  55		   *	    push   bp
 0781  8B EC		   *	    mov    bp, sp
 0783  50		   *	    push   ax
 0784  8B 46 06		      C 	mov	ax,iMode		;ax←mode
 0787  E8 12AA		      C 	call	SP_Set_Channel		;Chennel modeの設定
			      C 
			      C 	ret				;終了
 078A  58		   *	    pop    ax
 078B  5D		   *	    pop    bp
 078C  CB		   *	    ret    00000h
 078D			      C _SoundSetChannel	endp		;
			      C ;===============================================================|
			      C ;	int	(far *SoundGetChannel)();			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		ax		Channel mode			|
			      C ;	処理							|
			      C ;		Channel modeの取得				|
			      C ;===============================================================|
 078D			      C _SoundGetChannel	proc far c	;
 078D  E8 1304		      C 	call	SP_Get_Channel		;Channel mode の取得
 0790  CB		      C 	ret				;終了
 0791			      C _SoundGetChannel	endp		;
			      C ;===============================================================|
			      C ;	void	(far *SoundSetOutput)(int mode);		|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		mode bit 0- 7	Set Data			|
			      C ;		mode bit 8-15	Set Data bit			|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		Output modeの設定				|
			      C ;===============================================================|
 0791			      C _SoundSetOutput	proc far c	uses ax,
			      C 	iMode:word
			      C 
 0791  55		   *	    push   bp
 0792  8B EC		   *	    mov    bp, sp
 0794  50		   *	    push   ax
 0795  8B 46 06		      C 	mov	ax,iMode		;ax←mode
 0798  E8 12FF		      C 	call	SP_Set_Output		;Output modeの設定
			      C 
			      C 	ret				;終了
 079B  58		   *	    pop    ax
 079C  5D		   *	    pop    bp
 079D  CB		   *	    ret    00000h
 079E			      C _SoundSetOutput	endp			;
			      C ;===============================================================|
			      C ;	int	(far *SoundGetOutput)();			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		ax		Output mode			|
			      C ;	処理							|
			      C ;		Output modeの取得				|
			      C ;===============================================================|
 079E			      C _SoundGetOutput	proc far c		;
 079E  E8 1303		      C 	call	SP_Get_Output		;Output modeの取得
 07A1  CB		      C 	ret				;終了
 07A2			      C _SoundGetOutput	endp			;
			      C ;===============================================================|
			      C ;	int	(far *SoundGetRandom)();			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		AX		疑似乱数(0〜32767)		|
			      C ;	処理							|
			      C ;		疑似乱数を得る					|
			      C ;===============================================================|
 07A2			      C _SoundGetRandom	proc far c		;
 07A2  E8 1305		      C 	call	SP_Get_Random		;乱数の取得
 07A5  CB		      C 	ret				;終了
 07A6			      C _SoundGetRandom	endp			;
			      C ;===============================================================|
			      C ;	void	(far *SetMusicVolume)(char volume);		|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		cVolume						|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		マスターボリュームの設定			|
			      C ;===============================================================|
 07A6			      C _SetMusicVolume	proc far c	uses ax bx si ds,
			      C 	cVolume:byte
			      C 
			      C ;---------------------------------------------------------------
			      C ;ワークアドレスの取得
			      C 
			      C 	WTD_WorkGet	ds,bx			;ワークエリアアドレスの取得
			     1C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			     1C 
			     1C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
 07A6  55		   *	    push   bp
 07A7  8B EC		   *	    mov    bp, sp
 07A9  50		   *	    push   ax
 07AA  53		   *	    push   bx
 07AB  56		   *	    push   si
 07AC  1E		   *	    push   ds
 07AD  6A 00		     1C 		push	IRAM_Segment		;
 07AF  1F		     1C 		pop	ds			;
 07B0  BB 0000 R	     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C 
			     1C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			     1C 		push	SRAM_Segment		;（WonderWitch等）
			     1C 		pop	ds			;
			     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C endif	;-----------------------
			     1C 
			     1C else	;--------------------------------	;WonderWitch版
			     1C 		push	SRAM_Segment		;
			     1C 		pop	ds			;
			     1C 		mov	bx,ds:[ProcContext_heap]
			     1C endif	;--------------------------------
			      C 
			      C ;構造体アドレスの設定
 07B3  8D B7 0380	      C 	lea	si,[bx + WTD_WorkAdd_System]
			      C 
			      C ;---------------------------------------------------------------
			      C ;設定
 07B7  8A 46 06		      C 	mov	al,cVolume			;
 07BA  88 44 21		      C 	mov	ds:[si].WTD_Sys_VolumeMusic,al	;
			      C 
			      C ;---------------------------------------------------------------
			      C 
			      C 	ret				;終了
 07BD  1F		   *	    pop    ds
 07BE  5E		   *	    pop    si
 07BF  5B		   *	    pop    bx
 07C0  58		   *	    pop    ax
 07C1  5D		   *	    pop    bp
 07C2  CB		   *	    ret    00000h
 07C3			      C _SetMusicVolume	endp			;
			      C ;===============================================================|
			      C ;	char	(far *GetMusicVoluem)();			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		ax	Volume					|
			      C ;	処理							|
			      C ;		マスターボリュームの取得			|
			      C ;===============================================================|
 07C3			      C _GetMusicVolume	proc far c	uses bx si ds
			      C 
			      C ;---------------------------------------------------------------
			      C ;ワークアドレスの取得
			      C 
			      C 	WTD_WorkGet	ds,bx			;ワークエリアアドレスの取得
			     1C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			     1C 
			     1C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
 07C3  53		   *	    push   bx
 07C4  56		   *	    push   si
 07C5  1E		   *	    push   ds
 07C6  6A 00		     1C 		push	IRAM_Segment		;
 07C8  1F		     1C 		pop	ds			;
 07C9  BB 0000 R	     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C 
			     1C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			     1C 		push	SRAM_Segment		;（WonderWitch等）
			     1C 		pop	ds			;
			     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C endif	;-----------------------
			     1C 
			     1C else	;--------------------------------	;WonderWitch版
			     1C 		push	SRAM_Segment		;
			     1C 		pop	ds			;
			     1C 		mov	bx,ds:[ProcContext_heap]
			     1C endif	;--------------------------------
			      C 
			      C ;構造体アドレスの設定
 07CC  8D B7 0380	      C 	lea	si,[bx + WTD_WorkAdd_System]
			      C 
			      C ;---------------------------------------------------------------
			      C ;取得
 07D0  33 C0		      C 	xor	ax,ax				;ax←0
 07D2  8A 44 21		      C 	mov	al,ds:[si].WTD_Sys_VolumeMusic	;
			      C 
			      C ;---------------------------------------------------------------
			      C 
			      C 	ret				;終了
 07D5  1F		   *	    pop    ds
 07D6  5E		   *	    pop    si
 07D7  5B		   *	    pop    bx
 07D8  CB		   *	    ret    00000h
 07D9			      C _GetMusicVolume	endp			;
			      C ;===============================================================|
			      C ;	void	(far *SetEffectVolume)(char volume);		|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		iVolume	音量					|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		効果音のマスターボリュームの設定		|
			      C ;===============================================================|
 07D9			      C _SetEffectVolume	proc far c	uses ax bx si ds,
			      C 	cVolume:byte
			      C 
			      C ;---------------------------------------------------------------
			      C ;ワークアドレスの取得
			      C 
			      C 	WTD_WorkGet	ds,bx			;ワークエリアアドレスの取得
			     1C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			     1C 
			     1C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
 07D9  55		   *	    push   bp
 07DA  8B EC		   *	    mov    bp, sp
 07DC  50		   *	    push   ax
 07DD  53		   *	    push   bx
 07DE  56		   *	    push   si
 07DF  1E		   *	    push   ds
 07E0  6A 00		     1C 		push	IRAM_Segment		;
 07E2  1F		     1C 		pop	ds			;
 07E3  BB 0000 R	     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C 
			     1C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			     1C 		push	SRAM_Segment		;（WonderWitch等）
			     1C 		pop	ds			;
			     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C endif	;-----------------------
			     1C 
			     1C else	;--------------------------------	;WonderWitch版
			     1C 		push	SRAM_Segment		;
			     1C 		pop	ds			;
			     1C 		mov	bx,ds:[ProcContext_heap]
			     1C endif	;--------------------------------
			      C 
			      C ;構造体アドレスの設定
 07E6  8D B7 0380	      C 	lea	si,[bx + WTD_WorkAdd_System]
			      C 
			      C ;---------------------------------------------------------------
			      C ;設定
 07EA  8A 46 06		      C 	mov	al,cVolume			;
 07ED  88 44 22		      C 	mov	ds:[si].WTD_Sys_VolumeEffect,al	;
			      C 
			      C ;---------------------------------------------------------------
			      C 
			      C 	ret				;終了
 07F0  1F		   *	    pop    ds
 07F1  5E		   *	    pop    si
 07F2  5B		   *	    pop    bx
 07F3  58		   *	    pop    ax
 07F4  5D		   *	    pop    bp
 07F5  CB		   *	    ret    00000h
 07F6			      C _SetEffectVolume	endp		;
			      C ;===============================================================|
			      C ;	char	(far *GetEffectVolume)();			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		ボリューム					|
			      C ;	処理							|
			      C ;		効果音のマスターボリュームの取得		|
			      C ;===============================================================|
 07F6			      C _GetEffectVolume	proc far c	uses bx si ds
			      C 
			      C ;---------------------------------------------------------------
			      C ;ワークアドレスの取得
			      C 
			      C 	WTD_WorkGet	ds,bx			;ワークエリアアドレスの取得
			     1C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			     1C 
			     1C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
 07F6  53		   *	    push   bx
 07F7  56		   *	    push   si
 07F8  1E		   *	    push   ds
 07F9  6A 00		     1C 		push	IRAM_Segment		;
 07FB  1F		     1C 		pop	ds			;
 07FC  BB 0000 R	     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C 
			     1C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			     1C 		push	SRAM_Segment		;（WonderWitch等）
			     1C 		pop	ds			;
			     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C endif	;-----------------------
			     1C 
			     1C else	;--------------------------------	;WonderWitch版
			     1C 		push	SRAM_Segment		;
			     1C 		pop	ds			;
			     1C 		mov	bx,ds:[ProcContext_heap]
			     1C endif	;--------------------------------
			      C 
			      C ;構造体アドレスの設定
 07FF  8D B7 0380	      C 	lea	si,[bx + WTD_WorkAdd_System]
			      C 
			      C ;---------------------------------------------------------------
			      C ;取得
 0803  33 C0		      C 	xor	ax,ax				;ax←0
 0805  8A 44 22		      C 	mov	al,ds:[si].WTD_Sys_VolumeEffect	;
			      C 
			      C ;---------------------------------------------------------------
			      C 
			      C 	ret				;終了
 0808  1F		   *	    pop    ds
 0809  5E		   *	    pop    si
 080A  5B		   *	    pop    bx
 080B  CB		   *	    ret    00000h
 080C			      C _GetEffectVolume	endp		;
			      C ;===============================================================|
			      C ;	void	(far *SetPcmVolume)(char volume);		|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		bit0,1	右の音量	bit2,3	左の音量	|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		PCM Voice の音量を設定する。			|
			      C ;===============================================================|
 080C			      C _SetPcmVolume	proc far c	uses ax bx si ds,
			      C 	cVolume:byte
			      C 
			      C ;---------------------------------------------------------------
			      C ;ワークアドレスの取得
			      C 
			      C 	WTD_WorkGet	ds,bx			;ワークエリアアドレスの取得
			     1C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			     1C 
			     1C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
 080C  55		   *	    push   bp
 080D  8B EC		   *	    mov    bp, sp
 080F  50		   *	    push   ax
 0810  53		   *	    push   bx
 0811  56		   *	    push   si
 0812  1E		   *	    push   ds
 0813  6A 00		     1C 		push	IRAM_Segment		;
 0815  1F		     1C 		pop	ds			;
 0816  BB 0000 R	     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C 
			     1C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			     1C 		push	SRAM_Segment		;（WonderWitch等）
			     1C 		pop	ds			;
			     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C endif	;-----------------------
			     1C 
			     1C else	;--------------------------------	;WonderWitch版
			     1C 		push	SRAM_Segment		;
			     1C 		pop	ds			;
			     1C 		mov	bx,ds:[ProcContext_heap]
			     1C endif	;--------------------------------
			      C 
			      C ;構造体アドレスの設定
 0819  8D B7 0380	      C 	lea	si,[bx + WTD_WorkAdd_System]
			      C 
			      C ;---------------------------------------------------------------
			      C ;設定
 081D  8A 46 06		      C 	mov	al,cVolume			;
 0820  88 44 23		      C 	mov	ds:[si].WTD_Sys_VolumePcm,al	;al←Set Data
 0823  B4 0F		      C 	mov	ah,0fh				;ah←Set Bit
 0825  E8 1286		      C 	call	SP_Set_VolumePCM		;
			      C 
			      C ;---------------------------------------------------------------
			      C 
			      C 	ret				;終了
 0828  1F		   *	    pop    ds
 0829  5E		   *	    pop    si
 082A  5B		   *	    pop    bx
 082B  58		   *	    pop    ax
 082C  5D		   *	    pop    bp
 082D  CB		   *	    ret    00000h
 082E			      C _SetPcmVolume	endp			;
			      C ;===============================================================|
			      C ;	char	(far *GetPcmVolume)();				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		音量						|
			      C ;	処理							|
			      C ;		PCM Voice の音量を取得する。			|
			      C ;===============================================================|
 082E			      C _GetPcmVolume	proc far c	uses bx si ds
			      C 
			      C ;---------------------------------------------------------------
			      C ;ワークアドレスの取得
			      C 
			      C 	WTD_WorkGet	ds,bx			;ワークエリアアドレスの取得
			     1C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			     1C 
			     1C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
 082E  53		   *	    push   bx
 082F  56		   *	    push   si
 0830  1E		   *	    push   ds
 0831  6A 00		     1C 		push	IRAM_Segment		;
 0833  1F		     1C 		pop	ds			;
 0834  BB 0000 R	     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C 
			     1C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			     1C 		push	SRAM_Segment		;（WonderWitch等）
			     1C 		pop	ds			;
			     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C endif	;-----------------------
			     1C 
			     1C else	;--------------------------------	;WonderWitch版
			     1C 		push	SRAM_Segment		;
			     1C 		pop	ds			;
			     1C 		mov	bx,ds:[ProcContext_heap]
			     1C endif	;--------------------------------
			      C 
			      C ;構造体アドレスの設定
 0837  8D B7 0380	      C 	lea	si,[bx + WTD_WorkAdd_System]
			      C 
			      C ;---------------------------------------------------------------
			      C ;取得
 083B  33 C0		      C 	xor	ax,ax				;ax←0
 083D  8A 44 23		      C 	mov	al,ds:[si].WTD_Sys_VolumePcm	;
			      C 
			      C ;---------------------------------------------------------------
			      C 
			      C 	ret				;終了
 0840  1F		   *	    pop    ds
 0841  5E		   *	    pop    si
 0842  5B		   *	    pop    bx
 0843  CB		   *	    ret    00000h
 0844			      C _GetPcmVolume	endp			;
			      C ;===============================================================|
			      C ;	void	(far *SetFIFO)(int size,char far *FIFO);	|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		int	size	FIFOバッファのサイズ		|
			      C ;		char far *FIFO	FIFOバッファのアドレス		|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		FIFOバッファを設定する。			|
			      C ;===============================================================|
 0844			      C _SetFIFO	proc far c	uses ax bx di si ds es,
			      C 	szFIFO:word,
			      C 	fptFIFO:far ptr byte
			      C 
			      C ifndef	hyoka;-------------------------------
 0844  55		   *	    push   bp
 0845  8B EC		   *	    mov    bp, sp
 0847  50		   *	    push   ax
 0848  53		   *	    push   bx
 0849  57		   *	    push   di
 084A  56		   *	    push   si
 084B  1E		   *	    push   ds
 084C  06		   *	    push   es
 084D  9C		      C 	pushf				;フラグ保存
			      C 
			      C ;---------------------------------------------------------------
			      C ;ワークアドレスの取得
			      C 
			      C 	WTD_WorkGet	ds,bx			;ワークエリアアドレスの取得
			     1C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			     1C 
			     1C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
 084E  6A 00		     1C 		push	IRAM_Segment		;
 0850  1F		     1C 		pop	ds			;
 0851  BB 0000 R	     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C 
			     1C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			     1C 		push	SRAM_Segment		;（WonderWitch等）
			     1C 		pop	ds			;
			     1C 		mov	bx,offset DGROUP:_WTD_Work
			     1C endif	;-----------------------
			     1C 
			     1C else	;--------------------------------	;WonderWitch版
			     1C 		push	SRAM_Segment		;
			     1C 		pop	ds			;
			     1C 		mov	bx,ds:[ProcContext_heap]
			     1C endif	;--------------------------------
			      C 
			      C ;構造体アドレスの設定
 0854  8D B7 0380	      C 	lea	si,[bx + WTD_WorkAdd_System]
			      C 
			      C ;---------------------------------------------------------------
			      C 
 0858  FA		      C 	cli
			      C 	.repeat				;FIFOバッファが空になるまで待つ。
 0859			   *@C0028:
 0859  8B 44 2A		      C 	mov	ax,ds:[si].WTD_Sys_ComFIFO_Cnt	
			      C 	.until	(ax==ds:[si].WTD_Sys_ComFIFO_Adr)
 085C  3B 44 2C		   *	    cmp    ax, ds : [si] . WTD_Sys_ComFIFO_Adr
 085F  75 F8		   *	    jne    @C0028
 0861  FB		      C 	sti
			      C 
 0862  8B 46 06		      C 	mov	ax,szFIFO			;
 0865  89 44 2E		      C 	mov	ds:[si].WTD_Sys_ComFIFO_Size,ax	;
			      C 
 0868  C4 46 08		      C 	les	ax,fptFIFO			;
 086B  06		      C 	push	es				;引数の取得	Segment
 086C  50		      C 	push	ax				;		Offset
 086D  0E		      C 	push	cs				;データ変換
 086E  E8 FEFC		      C 	call	near ptr _ChangeFar		;dxax = wtdIL.ChangeFar(*FIFO);
 0871  83 C4 04		      C 	add	sp,+4				;
 0874  89 44 1C		      C 	mov	ds:[si].WTD_Sys_ComFIFO_Offset,ax
 0877  89 54 1E		      C 	mov	ds:[si].WTD_Sys_ComFIFO_Segment,dx
			      C 
			      C ;---------------------------------------------------------------
			      C 
 087A  9D		      C 	popf				;レジスタ復帰
			      C endif;----------------------------------------
			      C 
			      C 	ret				;
 087B  07		   *	    pop    es
 087C  1F		   *	    pop    ds
 087D  5E		   *	    pop    si
 087E  5F		   *	    pop    di
 087F  5B		   *	    pop    bx
 0880  58		   *	    pop    ax
 0881  5D		   *	    pop    bp
 0882  CB		   *	    ret    00000h
 0883			      C _SetFIFO	endp			;
			      C 
				include	wtd_int.asm			;割り込み　メインルーチン
			      C ;=======================================================================|
			      C ;									|
			      C ;		Wander Swan Total Sound Driver				|
			      C ;				Interrupt main program			|
			      C ;									|
			      C ;					Programmed by			|
			      C ;						A.Watanabe		|
			      C ;									|
			      C ;=======================================================================|
			      C ;****************************************************************
			      C ;*								*
			      C ;*			定数					*
			      C ;*								*
			      C ;****************************************************************
			      C ;
			      C ;	現状は無し
			      C ;
			      C ;****************************************************************
			      C ;*								*
			      C ;*			データテーブル				*
			      C ;*								*
			      C ;****************************************************************
			      C ;===============================================================|
			      C ;			Volume					|
			      C ;===============================================================|
			      C ;								|
			      C ;	Table = 256 * log(volume +1) / log(257)			|
			      C ;								|
			      C ;===============================================================|
			      C 	even
 0884			      C I_Volume_Table:
			      C ;		00h,01h,02h,03h,04h,05h,06h,07h,08h,09h,0Ah,0Bh,0Ch,0Dh,0Eh,0Fh
 0884  00 1F 32 3F 4A 52      C 	db	  0, 31, 50, 63, 74, 82, 89, 95,101,106,110,114,118,121,124,127
       59 5F 65 6A 6E 72
       76 79 7C 7F
 0894  82 85 87 8A 8C 8E      C 	db	130,133,135,138,140,142,144,146,148,150,152,153,155,156,158,159
       90 92 94 96 98 99
       9B 9C 9E 9F
 08A4  A1 A2 A4 A5 A6 A7      C 	db	161,162,164,165,166,167,169,170,171,172,173,174,175,176,177,178
       A9 AA AB AC AD AE
       AF B0 B1 B2
 08B4  B3 B4 B5 B6 B7 B8      C 	db	179,180,181,182,183,184,184,185,186,187,188,188,189,190,191,191
       B8 B9 BA BB BC BC
       BD BE BF BF
 08C4  C0 C1 C1 C2 C3 C3      C 	db	192,193,193,194,195,195,196,197,197,198,199,199,200,200,201,202
       C4 C5 C5 C6 C7 C7
       C8 C8 C9 CA
 08D4  CA CB CB CC CC CD      C 	db	202,203,203,204,204,205,206,206,207,207,208,208,209,209,210,210
       CE CE CF CF D0 D0
       D1 D1 D2 D2
 08E4  D3 D3 D3 D4 D4 D5      C 	db	211,211,211,212,212,213,213,214,214,215,215,216,216,216,217,217
       D5 D6 D6 D7 D7 D8
       D8 D8 D9 D9
 08F4  DA DA DA DB DB DC      C 	db	218,218,218,219,219,220,220,220,221,221,222,222,222,223,223,223
       DC DC DD DD DE DE
       DE DF DF DF
 0904  E0 E0 E0 E1 E1 E1      C 	db	224,224,224,225,225,225,226,226,226,227,227,227,228,228,228,229
       E2 E2 E2 E3 E3 E3
       E4 E4 E4 E5
 0914  E5 E5 E6 E6 E6 E7      C 	db	229,229,230,230,230,231,231,231,232,232,232,232,233,233,233,234
       E7 E7 E8 E8 E8 E8
       E9 E9 E9 EA
 0924  EA EA EA EB EB EB      C 	db	234,234,234,235,235,235,236,236,236,236,237,237,237,238,238,238
       EC EC EC EC ED ED
       ED EE EE EE
 0934  EE EF EF EF EF F0      C 	db	238,239,239,239,239,240,240,240,240,241,241,241,241,242,242,242
       F0 F0 F0 F1 F1 F1
       F1 F2 F2 F2
 0944  F2 F3 F3 F3 F3 F3      C 	db	242,243,243,243,243,243,244,244,244,244,245,245,245,245,246,246
       F4 F4 F4 F4 F5 F5
       F5 F5 F6 F6
 0954  F6 F6 F6 F7 F7 F7      C 	db	246,246,246,247,247,247,247,247,248,248,248,248,249,249,249,249
       F7 F7 F8 F8 F8 F8
       F9 F9 F9 F9
 0964  F9 FA FA FA FA FA      C 	db	249,250,250,250,250,250,251,251,251,251,251,252,252,252,252,252
       FB FB FB FB FB FC
       FC FC FC FC
 0974  FD FD FD FD FD FD      C 	db	253,253,253,253,253,253,254,254,254,254,254,255,255,255,255,255
       FE FE FE FE FE FF
       FF FF FF FF
			      C ;===============================================================|
			      C ;			Frection(Key)				|
			      C ;===============================================================|
			      C ;								|
			      C ;	Table = (3.072[MHz] / (32 * frection)) * 2^7		|
			      C ;								|
			      C ;		Frection : a = 440[Hz]				|
			      C ;								|
			      C ;								|
			      C ;	DeviceOut = 2048 - (Table / 2^(3 + Octave))		|
			      C ;								|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 0984			      C I_Frection_Table:
 0984  B782		      C 	dw	46978			;c	Bend Range ≒ 4
 0986  AD2C		      C 	dw	44332			;c#		( 3〜 6)
 0988  A373		      C 	dw	41843			;d	
 098A  9A47		      C 	dw	39495			;d#	
 098C  919E		      C 	dw	37278			;e	
 098E  8972		      C 	dw	35186			;f	
 0990  81BB		      C 	dw	33211			;f#	
 0992  7A73		      C 	dw	31347			;g	
 0994  73F7		      C 	dw	29687			;g#	
 0996  6D12		      C 	dw	27922			;a	
 0998  66F8		      C 	dw	26360			;a#	
 099A  6130		      C 	dw	24880			;b	
			      C ;****************************************************************
			      C ;*								*
			      C ;*			割り込みルーチン			*
			      C ;*				演奏・効果音・ＰＣＭ制御	*
			      C ;*								*
			      C ;****************************************************************
			      C ;*								*
			      C ;*	　演奏処理						*
			      C ;*								*
			      C ;*	●引数・返値（この値は保つ必要がある。）		*
			      C ;*		ds:bx	共有構造体アドレス			*
			      C ;*		ds:bp	ワークベースアドレス			*
			      C ;*								*
			      C ;*	●レジスタ割り振り					*
			      C ;*		ax	汎用(主に計算)				*
			      C ;*		ds:bx	共有構造体アドレス			*
			      C ;*		cx	汎用(主にカウンタ)			*
			      C ;*		dx	汎用(主に計算)				*
			      C ;*		ds:di	個別構造体				*
			      C ;*		es:si	演奏アドレス				*
			      C ;*		ds:bp	ワークベースアドレス			*
			      C ;*								*
			      C ;****************************************************************
			      C ;===============================================================|
			      C ;		Interrupt Main					|
			      C ;===============================================================|
			      C ;								|
			      C ;	●処理							|
			      C ;		　演奏ルーチンの呼び出し、			|
			      C ;		タイマーの制御を行うルーチン。			|
			      C ;								|
			      C ;	●使用レジスタ						|
			      C ;		ds:bp	ワーク領域先頭アドレス			|
			      C ;		ds:bx	パート共通構造体			|
			      C ;								|
			      C ;===============================================================|
			      C 	Public	I_Start
			      C 	even					;偶数アドレス配置
 099C			      C I_Start:
 099C  55		      C 	push	bp				;
 099D  50		      C 	push	ax				;
 099E  53		      C 	push	bx				;
 099F  51		      C 	push	cx				;
 09A0  56		      C 	push	si				;
 09A1  57		      C 	push	di				;
 09A2  1E		      C 	push	ds				;レジスタ保存
			      C 
			      C ;---------------------------------------------------------------
			      C ;EOIの発行
 09A3  FA		      C 	cli					;割り込み不可
 09A4  B0 80		      C 	mov	al,Int_HblankSet		;
 09A6  E6 B6		      C 	out	Int_Eoi,al			;出力
			      C 
			      C ;	in	al,Int_Enable			;
			      C ;	and	al,INT_HblankReset		;シリアル送信エンプティー
			      C ;	out	Int_Enable,al			;割り込み禁止
			      C 
			      C ;---------------------------------------------------------------
			      C ;バンクの設定
			      C 
			      C ifndef	IRAM		;DGROUP=IRAMの場合、不要
			      C 	;'/ram0'アクセス中は、処理をしない。
			      C 	in	al,BankSram			;現在のSRAM Bankを得る
			      C 	.if	(al==BANK_USERDS0)||(al==BANK_USERDS1)
			      C endif
			      C 
			      C ;---------------------------------------------------------------
			      C ;ワークエリアアドレスの取得
			      C 
			      C 	WTD_WorkGet	ds,bp			;ワークエリアアドレスの取得
			     1C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			     1C 
			     1C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
 09A8  6A 00		     1C 		push	IRAM_Segment		;
 09AA  1F		     1C 		pop	ds			;
 09AB  BD 0000 R	     1C 		mov	bp,offset DGROUP:_WTD_Work
			     1C 
			     1C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			     1C 		push	SRAM_Segment		;（WonderWitch等）
			     1C 		pop	ds			;
			     1C 		mov	bp,offset DGROUP:_WTD_Work
			     1C endif	;-----------------------
			     1C 
			     1C else	;--------------------------------	;WonderWitch版
			     1C 		push	SRAM_Segment		;
			     1C 		pop	ds			;
			     1C 		mov	bp,ds:[ProcContext_heap]
			     1C endif	;--------------------------------
 09AE  8D 9E 0380	      C 	lea	bx,[bp + WTD_WorkAdd_System]	;ds;bx←共通構造体
			      C 
			      C ;===============================================================|
			      C ;	PCM Voice の処理（ with CPU Power）			|
			      C ;===============================================================|
			      C ;	●レジスタ使用						|
			      C ;		di	PCM Voice制御用構造体 のポインタ	|
			      C ;		si	*.wav のポインタ			|
			      C ;	※	cx	使用不可				|
			      C ;	※	dx	使用不可				|
			      C ;	※	es	使用不可				|
			      C ;===============================================================|
			      C 
			      C 	;-----------------------------------------------
			      C 	;タイマーをエミュレートするか？
			      C 	.if	(ds:[bx].WTD_Sys_Flag & WTD_Sys_TimerEmulate)
 09B2  F7 07 0080	   *	    test   ds : [bx] . WTD_Sys_Flag, WTD_Sys_TimerEmulate
 09B6  74 42		   *	    je     @C002A
			      C 
			      C 	    ;------------------------------------------------
			      C 	    ;タイマーをエミュレートする時に追加される処理。	;
			      C 	    ;CALL命令と、ret命令の6clockが勿体ない		;
			      C 	    ;------------------------------------------------
			      C 	    ;PCM Voice をCPUパワーで鳴らす？
			      C 	    .if	(ds:[bx].WTD_Sys_Flag & WTD_Sys_Pcm)
 09B8  F7 07 0004	   *	    test   ds : [bx] . WTD_Sys_Flag, WTD_Sys_Pcm
 09BC  74 34		   *	    je     @C002C
			      C 	;
			      C 	;	to do	Sound-DMA を使わないモードかチェック
			      C 	;
			      C 
			      C 		;レジスタ設定
			      C 	;	mov	di,bp					;
			      C 	;	add	di,WTD_WorkAdd_PCM			;di←パート個別構造体
 09BE  8D BE 0580	      C 		lea	di,[bp + WTD_WorkAdd_PCM]
			      C 
			      C 		;アドレス取得
 09C2  1E		      C 		push	ds					;レジスタ保存
 09C3  C5 75 08		      C 		lds	si,dword ptr ds:[di].WTD_PcmAddress	;es:si←Play Address
			      C 		;データ取得
			      C 	;	mov	al,ds:[si]				;(注意：PipeLine)
			      C 	;	inc	si					;フラグも変化させる
 09C6  AC		      C 		lodsb
 09C7  1F		      C 		pop	ds					;レジスタ復帰
			      C 		;データ出力
 09C8  E6 89		      C 		out	PCM_Com_VolumeCh2,al			;出力
			      C 
			      C 		;アドレス保存
 09CA  89 75 08		      C 		mov	word ptr ds:[di].WTD_PcmAddress+0,si	;アドレス保存
			      C 		;ポインタチェック（セグメント境界？）
			      C 		.if	(si==0)
 09CD  0B F6		   *	    or	si, si
 09CF  75 05		   *	    jne    @C002E
 09D1  81 45 0A 1000	      C 			add	word ptr ds:[di].WTD_PcmAddress+2,1000h
			      C 		.endif
			      C 
			      C 		;終了？
 09D6			   *@C002E:
 09D6  83 6D 0C 01	      C 		sub	word ptr ds:[di].WTD_PcmSize+0,1	;PcmSize ディクリメント
 09DA  83 5D 0E 00	      C 		sbb	word ptr ds:[di].WTD_PcmSize+2,0	;
 09DE  8B 45 0C		      C 		mov	ax,word ptr ds:[di].WTD_PcmSize+0	;
 09E1  0B 45 0E		      C 		or	ax,word ptr ds:[di].WTD_PcmSize+2	;
			      C 		.if	(zero?)					;
 09E4  75 0C		   *	    jne    @C0030
			      C 			;PCM Voice 発音終了
 09E6  83 27 FB		      C 			and	ds:[bx].WTD_Sys_Flag,WTD_Sys_PcmR
 09E9  81 27 DFFF	      C 			and	ds:[bx].WTD_Sys_Flag,WTD_Sys_EffectMask2R
 09ED  B5 81		      C 			mov	ch,81h				;設定復帰ch2
 09EF  E8 0526		      C 			call	I_Effect_Return			;
			      C 		.endif
			      C 	    .endif
 09F2			   *@C0030:
			      C 
			      C 	    ;---------------				;
			      C 	    ;テンポ用カウンター　ディクリメント		;
 09F2			   *@C002C:
 09F2  FF 4F 26		      C 	    dec	ds:[bx].WTD_Sys_TempoCounter		;
 09F5  74 03 E9 0083	      C 	    jnz	I_MusicEffectStep			;演奏を飛ばす。
			      C 
			      C 	.endif
 09FA			   *@C002A:
			      C 
			      C 	;-----------------------------------------------
			      C 	;PCM Voice を Sound DMA で鳴らしている。
			      C 	.if	(ds:[bx].WTD_Sys_Flag & WTD_Sys_Pcm)
 09FA  F7 07 0004	   *	    test   ds : [bx] . WTD_Sys_Flag, WTD_Sys_Pcm
 09FE  74 10		   *	    je     @C0032
			      C 	;
			      C 	;	to do	Sound-DMA を使うモードかチェック
			      C 	;
			      C 	;   in	al, サウンドDMA
			      C 	   .if	!(al & 80h)				;
 0A00  A8 80		   *	    test   al, 080h
 0A02  75 0C		   *	    jne    @C0034
 0A04  83 27 FB		      C 		and	ds:[bx].WTD_Sys_Flag,WTD_Sys_PcmR
 0A07  81 27 DFFF	      C 		and	ds:[bx].WTD_Sys_Flag,WTD_Sys_EffectMask2R
 0A0B  B5 81		      C 		mov	ch,81h				;設定復帰ch2
 0A0D  E8 0508		      C 		call	I_Effect_Return			;
			      C 	   .endif
			      C 	.endif
 0A10			   *@C0034:
 0A10			   *@C0032:
			      C 
			      C ;===============================================================|
			      C ;	演奏 ＆ 効果音処理					|
			      C ;===============================================================|
			      C ;	●レジスタ使用						|
			      C ;		ds:di	個別構造体		破壊ok		|
			      C ;	（	es:si	演奏アドレス		破壊ok	）	|
			      C ;		ax	汎用(主に計算)		破壊ok		|
			      C ;		cx	汎用(主にカウンタ)	破壊ok		|
			      C ;		dx	汎用(主に計算)		破壊ok		|
			      C ;===============================================================|
			      C ;演奏ルーチン
 0A10  52		      C 	push	dx				;
 0A11  06		      C 	push	es
			      C 
			      C 	;演奏あるか？
			      C 	.if	(ds:[bx].WTD_Sys_Flag & WTD_Sys_Music)
 0A12  F7 07 0001	   *	    test   ds : [bx] . WTD_Sys_Flag, WTD_Sys_Music
 0A16  74 1A		   *	    je     @C0036
			      C 
			      C 		;レジスタ設定
 0A18  8D BE 0600	      C 		lea	di,[bp + WTD_WorkAdd_Ch0]
 0A1C  8E 47 08		      C 		mov	es,ds:[bx].WTD_Sys_MusicSegment	;es←演奏データセグメント
			      C 
			      C 		;演奏処理ルーチンの呼び出し
 0A1F  33 C9		      C 		xor	cx,cx				;製品版は最大'20'。
 0A21  8A 4F 28		      C 		mov	cl,ds:[bx].WTD_Sys_MusicPart	;廉価版は最大' 4'。
			      C 		.while	(cx!=0)
 0A24  EB 08		   *	    jmp    @C0038
 0A26			   *@C0039:
 0A26  E8 005D		      C 			call	I_Play			;
 0A29  81 C7 0080	      C 			add	di,WTD_WorkChSize	;構造体のサイズは80h(0x80)
 0A2D  49		      C 			dec	cx			;
			      C 		.endw
 0A2E			   *@C0038:
 0A2E  0B C9		   *	    or	cx, cx
 0A30  75 F4		   *	    jne    @C0039
			      C 
			      C 	.endif
 0A32			   *@C0036:
			      C 
			      C ;---------------------------------------------------------------
			      C ;効果音ルーチン
			      C 
			      C 	;効果音あるか？
			      C 	.if	(ds:[bx].WTD_Sys_Flag & WTD_Sys_Effect)
 0A32  F7 07 0002	   *	    test   ds : [bx] . WTD_Sys_Flag, WTD_Sys_Effect
 0A36  74 1A		   *	    je     @C003B
			      C 
			      C 		;レジスタ設定
 0A38  8D BE 0400	      C 		lea	di,[bp + WTD_WorkAdd_Ech0]
 0A3C  8E 47 0C		      C 		mov	es,ds:[bx].WTD_Sys_EffectSegment	;es←効果音データセグメント
			      C 
			      C 		;演奏処理ルーチンの呼び出し
 0A3F  33 C9		      C 		xor	cx,cx				;
 0A41  8A 4F 29		      C 		mov	cl,ds:[bx].WTD_Sys_EffectPart	;最大'3'。
			      C 		.while	(cx!=0)
 0A44  EB 08		   *	    jmp    @C003D
 0A46			   *@C003E:
 0A46  E8 003D		      C 			call	I_Play			;
 0A49  81 C7 0080	      C 			add	di,WTD_WorkChSize	;構造体のサイズは80h(0x80)
 0A4D  49		      C 			dec	cx			;
			      C 		.endw
 0A4E			   *@C003D:
 0A4E  0B C9		   *	    or	cx, cx
 0A50  75 F4		   *	    jne    @C003E
			      C 
			      C 	.endif
 0A52			   *@C003B:
			      C 
			      C ;---------------------------------------------------------------
			      C ;PCM Vioce効果音が発生しており、尚かつ終了であるならば、
			      C ;タイマーを戻す。
			      C 
			      C 	;タイマーエミュレート中であるか？
			      C 	.if	(ds:[bx].WTD_Sys_Flag & WTD_Sys_TimerEmulate)
 0A52  F7 07 0080	   *	    test   ds : [bx] . WTD_Sys_Flag, WTD_Sys_TimerEmulate
 0A56  74 23		   *	    je     @C0040
			      C 
			      C 	    ;PcmVioce処理終了？
			      C 	    .if	(ds:[bx].WTD_Sys_Flag & WTD_Sys_Pcm)
 0A58  F7 07 0004	   *	    test   ds : [bx] . WTD_Sys_Flag, WTD_Sys_Pcm
 0A5C  74 0E		   *	    je     @C0042
			      C 
			      C 		;●PcmVioce処理継続の場合
			      C 		;タイマー設定
 0A5E  B8 0001		      C 		mov	ax,1				;割り込み周期は最速
 0A61  E8 0EFA		      C 		call	T_Set_Frection			;(12KHz)
			      C 		;タイマーカウンタ設定
 0A64  8B 47 24		      C 		mov	ax,ds:[bx].WTD_Sys_Tempo	;
 0A67  89 47 26		      C 		mov	ds:[bx].WTD_Sys_TempoCounter,ax	;TempoCounter
			      C 
			      C 	    .else
 0A6A  EB 0F		   *	    jmp    @C0044
 0A6C			   *@C0042:
			      C 
			      C 		;●PcmVioce処理終了の場合。
			      C 		;タイマー設定
 0A6C  8B 47 24		      C 		mov	ax,ds:[bx].WTD_Sys_Tempo	;タイマーの設定
 0A6F  E8 0EEC		      C 		call	T_Set_Frection			;
			      C 		;タイマーカウンタ設定
			      C 	;	xor	ax,ax				;ax←0
 0A72  C7 47 26 0000	      C 		mov	ds:[bx].WTD_Sys_TempoCounter,0	;TempoCounter = 0
			      C 		;フラグ初期化
			      C 	;	and	ds:[bx].WTD_Sys_Flag,WTD_Sys_PcmR		;PCM効果音ディセーブル
			      C 	;	and	ds:[bx].WTD_Sys_Flag,WTD_Sys_PcmEndR		;このフラグは廃止
			      C 	;	and	ds:[bx].WTD_Sys_Flag,WTD_Sys_EffectMask2R	;ch2 効果音マスクRes
 0A77  81 27 FF7F	      C 		and	ds:[bx].WTD_Sys_Flag,WTD_Sys_TimerEmulateR	;タイマーエミュレートRes
			      C 	;	mov	ch,81h				;設定復帰ch2
			      C 	;	call	I_Effect_Return			;
			      C 
			      C 	    .endif
			      C 	.endif
 0A7B			   *@C0044:
 0A7B			   *@C0040:
			      C 
 0A7B  07		      C 	pop	es
 0A7C  5A		      C 	pop	dx				;
			      C 
			      C ;===============================================================|
 0A7D			      C I_MusicEffectStep:					;
			      C 
			      C ;
			      C ;---------------------------------------------------------------
			      C ;バンクの復帰
			      C ifndef	IRAM		;DGROUP=IRAMの場合、不要
			      C ;
			      C 	.endif
			      C 
			      C endif
			      C ;---------------------------------------------------------------
			      C ;割り込みの終了
			      C 
			      C ;	cli				;割り込み禁止
			      C ;	in	al,Int_Enable		;
			      C ;	or	al,INT_HblankSet	;タイマー
			      C ;	out	Int_Enable,al		;割り込み許可
			      C 
 0A7D  1F		      C 	pop	ds				;レジスタ復帰
 0A7E  5F		      C 	pop	di				;
 0A7F  5E		      C 	pop	si				;
 0A80  59		      C 	pop	cx				;
 0A81  5B		      C 	pop	bx				;
 0A82  58		      C 	pop	ax				;
 0A83  5D		      C 	pop	bp				;
 0A84  CF		      C 	iret					;
			      C ;===============================================================|
			      C ;		Music Control Main				|
			      C ;===============================================================|
			      C ;	●引数							|
			      C ;		ds:bp	ワークベースアドレス	引数		|
			      C ;		ds:bx	共有構造体アドレス	引数		|
			      C ;		ds:di	個別構造体		引数		|
			      C ;	●レジスタ使用						|
			      C ;		es:si	演奏アドレス		引数		|
			      C ;		cx	何パート目？		破壊NG		|
			      C ;		ax	ゲートタイム計算用	破壊ok		|
			      C ;		dx	汎用(主に計算)		破壊ok		|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 0A86			      C I_Play	proc	near	uses	cx	;
			      C 
			      C 	;演奏チェック
 0A86  51		   *	    push   cx
			      C 	.if	!(ds:[di].WTD_FlagControl&WTD_Ctrl_PlayEnd)
 0A87  F7 05 8000	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_PlayEnd
 0A8B  74 03 E9 00B7	   *	    jne    @C0045
			      C 
			      C 		;音長カウンター・ディクリメント
 0A90  FF 4D 16		      C 		dec	ds:[di].WTD_LengCounter
 0A93  8B 45 14		      C 		mov	ax,ds:[di].WTD_Leng			;
 0A96  2B 45 16		      C 		sub	ax,ds:[di].WTD_LengCounter		;ax←経過時間
			      C 
			      C 
			      C 		;音長による、キーオンディレイ
			      C 		.if	(ax==ds:[di].WTD_KeyOnDelay)		;'k'コマンドの判定
 0A99  3B 45 1C		   *	    cmp    ax, ds : [di] . WTD_KeyOnDelay
 0A9C  75 03		   *	    jne    @C0047
 0A9E  E8 00E9		      C 			call	I_Play_KeyOn			;
			      C 		.endif
			      C 
			      C 
			      C 		;音長による、音色制御２
			      C 		.if	( !(ds:[di].WTD_ProgramDecay&80h) && (ds:[di].WTD_Key!=0ffh) && (ax==ds:[di].WTD_ProgramDecayRate) )
 0AA1			   *@C0047:
 0AA1  F6 45 77 80	   *	    test   ds : [di] . WTD_ProgramDecay, 080h
 0AA5  75 18		   *	    jne    @C0049
 0AA7  80 7D 1F FF	   *	    cmp    ds : [di] . WTD_Key, 0FFh
 0AAB  74 12		   *	    je     @C0049
 0AAD  3B 45 78		   *	    cmp    ax, ds : [di] . WTD_ProgramDecayRate
 0AB0  75 0D		   *	    jne    @C0049
 0AB2  50		      C 			push	ax				;
 0AB3  8A 45 77		      C 			mov	al,ds:[di].WTD_ProgramDecay	;
 0AB6  24 7F		      C 			and	al,07fh				;上位bitのマスク
 0AB8  BA 1804 R	      C 			mov	dx,offset CGROUP:I_Table_Voice	;
 0ABB  E8 0BCC		      C 			call	I_Table_Jump			;
 0ABE  58		      C 			pop	ax				;
			      C 		.endif
			      C 
			      C 
			      C 		;音長による、音色制御
			      C 		.if	( !(ds:[di].WTD_Program2nd&80h) && (ds:[di].WTD_Key!=0ffh) && (ax==ds:[di].WTD_ProgramRate) )
 0ABF			   *@C0049:
 0ABF  F6 45 75 80	   *	    test   ds : [di] . WTD_Program2nd, 080h
 0AC3  75 18		   *	    jne    @C004D
 0AC5  80 7D 1F FF	   *	    cmp    ds : [di] . WTD_Key, 0FFh
 0AC9  74 12		   *	    je     @C004D
 0ACB  3B 45 72		   *	    cmp    ax, ds : [di] . WTD_ProgramRate
 0ACE  75 0D		   *	    jne    @C004D
 0AD0  50		      C 			push	ax				;
 0AD1  8A 45 75		      C 			mov	al,ds:[di].WTD_Program2nd	;
 0AD4  24 7F		      C 			and	al,07fh				;上位bitのマスク
 0AD6  BA 1804 R	      C 			mov	dx,offset CGROUP:I_Table_Voice	;
 0AD9  E8 0BAE		      C 			call	I_Table_Jump			;
 0ADC  58		      C 			pop	ax				;
			      C 		.endif
			      C 
			      C 
			      C 		;音長による、ゲートタイム制御
			      C 		.if	(ax!=ds:[di].WTD_GateTimeStepFirst)	;'u'コマンドでkeyoffするか？
 0ADD			   *@C004D:
 0ADD  3B 45 58		   *	    cmp    ax, ds : [di] . WTD_GateTimeStepFirst
 0AE0  74 40		   *	    je     @C0051
			      C 
 0AE2  8B 45 14		      C 			mov	ax,ds:[di].WTD_Leng		;'Q','U','q'コマンドの判定
 0AE5  8A 6D 55		      C 			mov	ch,ds:[di].WTD_GateTime8	;ch←GateTime8
 0AE8  D0 C5		      C 			rol	ch,1				;
 0AEA  D0 ED		      C 			shr	ch,1				;Bit 7 Reset & Bit 7 -> Cy Flag
			      C 			.if	(!Carry?)
 0AEC  72 15		   *	    jb     @C0053
 0AEE  BA 0008		      C 				mov	dx,8			;'Q'コマンド
 0AF1  2A D5		      C 				sub	dl,ch			;dx = 8 − ch
 0AF3  F7 E2		      C 				mul	dx			;dx:ax = ax × dx
 0AF5  D1 EA		      C 				shr	dx,1			;
 0AF7  D1 E8		      C 				shr	ax,1			;
 0AF9  D1 EA		      C 				shr	dx,1			;
 0AFB  D1 E8		      C 				shr	ax,1			;
 0AFD  D1 EA		      C 				shr	dx,1			;
 0AFF  D1 E8		      C 				shr	ax,1			;ax = dx:ax ÷ cl
			      C 			.else
 0B01  EB 0D		   *	    jmp    @C0055
 0B03			   *@C0053:
 0B03  B1 64		      C 				mov	cl,100			;cl = 100
 0B05  BA 0064		      C 				mov	dx,100			;dx = 100
 0B08  2A D5		      C 				sub	dl,ch			;dx = dx − ch
 0B0A  F7 E2		      C 				mul	dx			;dx:ax = ax × dx
 0B0C  32 ED		      C 				xor	ch,ch			;
 0B0E  F7 F1		      C 				div	cx			;ax = dx:ax ÷ cl
			      C 			.endif
			      C 
			      C 
 0B10			   *@C0055:
 0B10  03 45 56		      C 			add	ax,ds:[di].WTD_GateTimeStepLast	;ax = ax + WTD_GateTimeStepLast
			      C 			.if	(Carry?)			;オーバーフローしたら、
 0B13  73 03		   *	    jae    @C0056
 0B15  B8 FFFF		      C 				mov	ax,0ffffh		;最大値に修正。
			      C 			.endif					;
			      C 			.if	(ax==ds:[di].WTD_LengCounter)	;
 0B18			   *@C0056:
 0B18  3B 45 16		   *	    cmp    ax, ds : [di] . WTD_LengCounter
 0B1B  75 0C		   *	    jne    @C0058
 0B1D  E8 00FC		      C 				call	I_Play_KeyOff		;
			      C 			.endif
			      C 
			      C 		.else
 0B20  EB 07		   *	    jmp    @C005A
 0B22			   *@C0051:
 0B22  80 65 02 FE	      C 			and	ds:[di].WTD_FlagTai, 0FEh	;Tai関係なしにKeyOff
 0B26  E8 00F3		      C 			call	I_Play_KeyOff			;
			      C 		.endif
			      C 
			      C 
			      C 		;音長カウンタ０ならば、コマンド処理
			      C 		.if	(ds:[di].WTD_LengCounter==0)		;音長カウンタ＝０？
 0B29			   *@C005A:
 0B29			   *@C0058:
 0B29  83 7D 16 00	   *	    cmp    ds : [di] . WTD_LengCounter, 000h
 0B2D  75 18		   *	    jne    @C005B
			      C 
 0B2F  8B 75 06		      C 			mov	si,ds:[di].WTD_Address		;es:si←Play Address
 0B32  E8 0035		      C 			call	I_Play_Loop			;制御ルーチンへ。
 0B35  89 75 06		      C 			mov	ds:[di].WTD_Address,si		;
			      C 
			      C 	;		;演奏終了？　＆　KeyOnDelayは０？
			      C 			.if	(!(ds:[di].WTD_FlagControl&WTD_Ctrl_PlayEnd) && (ds:[di].WTD_KeyOnDelay==0))
 0B38  F7 05 8000	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_PlayEnd
 0B3C  75 09		   *	    jne    @C005D
 0B3E  83 7D 1C 00	   *	    cmp    ds : [di] . WTD_KeyOnDelay, 000h
 0B42  75 03		   *	    jne    @C005D
 0B44  E8 0043		      C 				call	I_Play_KeyOn		;であれば、KeyOn
			      C 			.endif
			      C 		.endif
 0B47			   *@C005D:
			      C 
			      C 
			      C 	.endif
 0B47			   *@C005B:
 0B47			   *@C0045:
			      C 
 0B47  8B 05		      C 	mov	ax, ds:[di].WTD_FlagControl
			      C 	.if	!( (ds:[bx] & WTD_Sys_Music) && (ax & WTD_Ctrl_PlayEnd) && (ax & WTD_Ctrl_Effect) )
 0B49  F7 07 0001	   *	    test   ds : [bx], WTD_Sys_Music
 0B4D  74 0A		   *	    je     @C0061
 0B4F  A9 8000		   *	    test   ax, WTD_Ctrl_PlayEnd
 0B52  74 05		   *	    je     @C0061
 0B54  A9 4000		   *	    test   ax, WTD_Ctrl_Effect
 0B57  75 0F		   *	    jne    @C0060
 0B59			   *@C0061:
			      C 		;制御ルーチンへ
 0B59  E8 0224		      C 		call	I_Play_Pan			;パン制御
 0B5C  E8 0169		      C 		call	I_Play_Volume			;音量制御
			      C 		.if	(ds:[di].WTD_ExprSet!=0)	;　音量０でなかったら
 0B5F  80 7D 40 00	   *	    cmp    ds : [di] . WTD_ExprSet, 000h
 0B63  74 03		   *	    je     @C0064
 0B65  E8 0110		      C 			call	I_Play_Frection		;音程制御
			      C 		.endif
			      C 	.endif
 0B68			   *@C0064:
 0B68			   *@C0060:
			      C 
			      C 	ret				;
 0B68  59		   *	    pop    cx
 0B69  C3		   *	    ret    00000h
 0B6A			      C I_Play	endp
			      C ;****************************************************************
			      C ;*								*
			      C ;*			割り込みルーチン			*
			      C ;*				演奏・効果音制御部		*
			      C ;*				ループ				*
			      C ;*								*
			      C ;****************************************************************
			      C ;===============================================================|
			      C ;	●引数							|
			      C ;		ds:bp	ワークベースアドレス	引数		|
			      C ;		ds:bx	共有構造体アドレス	引数		|
			      C ;		ds:di	個別構造体		引数		|
			      C ;		es:si	演奏アドレス		引数		|
			      C ;	●レジスタ使用						|
			      C ;		cx	何パート目？		破壊ok		|
			      C ;		ax	ゲートタイム計算用	破壊ok		|
			      C ;		dx	汎用(主に計算)		破壊ok		|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 0B6A			      C I_Play_Loop	proc	near		;
			      C 
			      C 	.while	( !(ds:[di].WTD_FlagControl&WTD_Ctrl_PlayEnd) && (ds:[di].WTD_LengCounter==0) )
 0B6A  EB 10		   *	    jmp    @C0066
 0B6C			   *@C0067:
			      C 
			      C 		;演奏データ読み込み
 0B6C  26: AC		      C 		lodsb	es:[si]
			      C 
			      C 		;コマンドタイプチェック
 0B6E  D0 C0		      C 		rol	al,1			;
 0B70  D0 E8		      C 		shr	al,1			;cy←Command Type
			      C 
			      C 		;それぞれへ条件コール
			      C 		.if	(Carry?)
 0B72  73 05		   *	    jae    @C0068
 0B74  E8 047B		      C 			call	I_PlayKey		;
			      C 		.else
 0B77  EB 03		   *	    jmp    @C006A
 0B79			   *@C0068:
 0B79  E8 05E4		      C 			call	I_PlayCommand		;
			      C 		.endif
			      C 
			      C 	.endw
 0B7C			   *@C006A:
 0B7C			   *@C0066:
 0B7C  F7 05 8000	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_PlayEnd
 0B80  75 06		   *	    jne    @C006B
 0B82  83 7D 16 00	   *	    cmp    ds : [di] . WTD_LengCounter, 000h
 0B86  74 E4		   *	    je     @C0067
 0B88			   *@C006B:
			      C 
 0B88  C3		      C 	ret				;
 0B89			      C I_Play_Loop	endp
			      C ;****************************************************************
			      C ;*								*
			      C ;*			割り込みルーチン			*
			      C ;*				演奏・効果音制御部		*
			      C ;*				KeyOn,KeyOff制御		*
			      C ;*								*
			      C ;****************************************************************
			      C ;*	●引数							*
			      C ;*		ds:bp	ワークベースアドレス	引数		*
			      C ;*		ds:bx	共有構造体アドレス	引数		*
			      C ;*		ds:di	個別構造体		引数		*
			      C ;*		es:si	演奏アドレス		引数		*
			      C ;*	●レジスタ使用						*
			      C ;*		ax	汎用(主に計算)		破壊NG		*
			      C ;*		cx	制御Flag		破壊NG		*
			      C ;*		dx	LFO/EMB制御構造体	破壊ok		*
			      C ;****************************************************************
			      C ;===============================================================|
			      C ;			KeyOn (Hardware,Software)		|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 0B8A			      C I_Play_KeyOn	proc	near	uses	ax cx
			      C 
			      C 	;休符ではない ＆＆ 前回タイではない
 0B8A  50		   *	    push   ax
 0B8B  51		   *	    push   cx
			      C 	.if	((ds:[di].WTD_Key!=0ffh) && !(ds:[di].WTD_FlagTai & 02h))
 0B8C  80 7D 1F FF	   *	    cmp    ds : [di] . WTD_Key, 0FFh
 0B90  75 03 E9 0084	   *	    je     @C006D
 0B95  F6 45 02 02	   *	    test   ds : [di] . WTD_FlagTai, 002h
 0B99  75 7E		   *	    jne    @C006D
			      C 
			      C 		;音色制御
 0B9B  8A 45 75		      C 		mov	al,ds:[di].WTD_Program2nd	;'@'コマンド必要性の確認
 0B9E  22 45 76		      C 		and	al,ds:[di].WTD_Program3rd	;第2,3パラメータの指定が無かったら、処理は無し。
			      C 		.if	!(al&080h)
 0BA1  A8 80		   *	    test   al, 080h
 0BA3  75 0B		   *	    jne    @C0070
 0BA5  8A 45 74		      C 			mov	al,ds:[di].WTD_Program1st	;
 0BA8  24 7F		      C 			and	al,07fh				;上位bitのマスク
 0BAA  BA 1804 R	      C 			mov	dx,offset CGROUP:I_Table_Voice	;
 0BAD  E8 0ADA		      C 			call	I_Table_Jump			;
			      C 		.endif
			      C 
			      C 		;音量Embは処理必要。
			      C 		.if	(ds:[di].WTD_FlagControl&WTD_Ctrl_ExprEmb)
 0BB0			   *@C0070:
 0BB0  F7 05 0008	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_ExprEmb
 0BB4  74 0B		   *	    je     @C0072
 0BB6  B9 0100		      C 			mov	cx,WTD_Ctrl_EmbVol		;
 0BB9  BA 004D		      C 			mov	dx,WTD_ExprEmb			;
 0BBC  E8 023D		      C 			call	I_Play_KeyOn_Emb		;
			      C 		.else
 0BBF  EB 04		   *	    jmp    @C0074
 0BC1			   *@C0072:
 0BC1  C6 45 51 FF	      C 			mov	ds:[di].WTD_ExprEmbLevelSet,0ffh
			      C 		.endif
			      C 
			      C 	;	.if	(ds:[di].WTD_FlagControl&0037h)	;音量Emb以外の確認。ソフトウェア処理がなかったら飛ばす。
			      C 
			      C 		;音程Emb
			      C 		.if	(ds:[di].WTD_FlagControl&WTD_Ctrl_BendEmb)
 0BC5			   *@C0074:
 0BC5  F7 05 0002	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_BendEmb
 0BC9  74 09		   *	    je     @C0075
 0BCB  B9 0080		      C 			mov	cx,WTD_Ctrl_EmbFreq		;
 0BCE  BA 0039		      C 			mov	dx,WTD_BendEmb			;
 0BD1  E8 0228		      C 			call	I_Play_KeyOn_Emb		;
			      C 		.endif
			      C 
			      C 		;パンEmb
			      C 		.if	(ds:[di].WTD_FlagControl&WTD_Ctrl_PanEmb)
 0BD4			   *@C0075:
 0BD4  F7 05 0020	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_PanEmb
 0BD8  74 09		   *	    je     @C0077
 0BDA  B9 0200		      C 			mov	cx,WTD_Ctrl_EmbPan		;
 0BDD  BA 006D		      C 			mov	dx,WTD_PanEmb			;
 0BE0  E8 0219		      C 			call	I_Play_KeyOn_Emb		;
			      C 		.endif
			      C 
			      C 		;音量LFO
			      C 		.if	(ds:[di].WTD_FlagControl&WTD_Ctrl_ExprLFO)
 0BE3			   *@C0077:
 0BE3  F7 05 0004	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_ExprLfo
 0BE7  74 06		   *	    je     @C0079
 0BE9  BA 0044		      C 			mov	dx,WTD_ExprLFO			;
 0BEC  E8 01F1		      C 			call	I_Play_KeyOn_LFO		;
			      C 		.endif
			      C 
			      C 		;音程LFO
			      C 		.if	(ds:[di].WTD_FlagControl&WTD_Ctrl_BendLfo)
 0BEF			   *@C0079:
 0BEF  F7 05 0001	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_BendLfo
 0BF3  74 06		   *	    je     @C007B
 0BF5  BA 0030		      C 			mov	dx,WTD_BendLFO			;
 0BF8  E8 01E5		      C 			call	I_Play_KeyOn_LFO		;
			      C 		.endif
			      C 
			      C 		;パンLFO
			      C 		.if	(ds:[di].WTD_FlagControl&WTD_Ctrl_PanLFO)
 0BFB			   *@C007B:
 0BFB  F7 05 0010	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_PanLfo
 0BFF  74 06		   *	    je     @C007D
 0C01  BA 0064		      C 			mov	dx,WTD_PanLFO			;
 0C04  E8 01D9		      C 			call	I_Play_KeyOn_LFO		;
			      C 		.endif
			      C 
			      C ;		.endif
			      C 
			      C ifndef	hyoka	;--------------------------------廉価版は無し
			      C 		;モジュレーション
 0C07			   *@C007D:
 0C07  33 C0		      C 		xor	ax,ax					;
			      C 		.if	(ds:[di].WTD_ModLevelSet!=al)		;
 0C09  38 45 5E		   *	    cmp    ds : [di] . WTD_ModLevelSet, al
 0C0C  74 0B		   *	    je     @C007F
 0C0E  88 45 5E		      C 			mov	ds:[di].WTD_ModLevelSet,al	;
 0C11  B1 01		      C 			mov	cl,MIDI_Ctrl_Mod		;
 0C13  BA 189E R	      C 			mov	dx,offset CGROUP:I_Table_CtrlChgB
 0C16  E8 0A71		      C 			call	I_Table_Jump			;モジュレーションを０にする。
			      C 		.endif
			      C endif	;----------------------------------------
			      C 
			      C 	.endif
 0C19			   *@C007F:
 0C19			   *@C006D:
			      C 	ret				;
 0C19  59		   *	    pop    cx
 0C1A  58		   *	    pop    ax
 0C1B  C3		   *	    ret    00000h
 0C1C			      C I_Play_KeyOn	endp
			      C ;===============================================================|
			      C ;			KeyOff (Hardware,Software)		|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 0C1C			      C I_Play_KeyOff	proc	near	uses	ax cx
			      C 
 0C1C  50		   *	    push   ax
 0C1D  51		   *	    push   cx
			      C 	.if	!(ds:[di].WTD_FlagTai & 01h)
 0C1E  F6 45 02 01	   *	    test   ds : [di] . WTD_FlagTai, 001h
 0C22  75 50		   *	    jne    @C0081
			      C 
			      C 		;ハードウェアをKeyOff
 0C24  BA 1716 R	      C 		mov	dx,offset CGROUP:I_Table_KeyOff	;
 0C27  E8 0A60		      C 		call	I_Table_Jump			;KeyOff
			      C 
			      C 		;音色制御
			      C 		.if	!(ds:[di].WTD_Program3rd&80h)	;'@'コマンド	必要性の確認
 0C2A  F6 45 76 80	   *	    test   ds : [di] . WTD_Program3rd, 080h
 0C2E  75 0B		   *	    jne    @C0083
 0C30  8A 45 76		      C 			mov	al,ds:[di].WTD_Program3rd	;
 0C33  24 7F		      C 			and	al,07fh				;上位bitのマスク
 0C35  BA 1804 R	      C 			mov	dx,offset CGROUP:I_Table_Voice	;
 0C38  E8 0A4F		      C 			call	I_Table_Jump			;
			      C 		.endif
			      C 
			      C 		;音量Emb
			      C 		.if	(ds:[di].WTD_FlagControl&WTD_Ctrl_ExprEmb)
 0C3B			   *@C0083:
 0C3B  F7 05 0008	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_ExprEmb
 0C3F  74 0B		   *	    je     @C0085
 0C41  B9 0100		      C 			mov	cx,WTD_Ctrl_EmbVol		;
 0C44  BA 004D		      C 			mov	dx,WTD_ExprEmb			;
 0C47  E8 01E8		      C 			call	I_Play_KeyOff_Emb		;
			      C 		.else
 0C4A  EB 0A		   *	    jmp    @C0087
 0C4C			   *@C0085:
			      C 			.if	(ds:[di].WTD_Channel&80h)	;MIDIパートの場合は操作しない。
 0C4C  F6 45 05 80	   *	    test   ds : [di] . WTD_Channel, 080h
 0C50  74 04		   *	    je     @C0088
 0C52  C6 45 51 00	      C 				mov	ds:[di].WTD_ExprEmbLevelSet,000h
			      C 			.endif
			      C 		.endif
 0C56			   *@C0088:
			      C 
			      C 		;音程Emb
			      C 		.if	(ds:[di].WTD_FlagControl&WTD_Ctrl_BendEmb)
 0C56			   *@C0087:
 0C56  F7 05 0002	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_BendEmb
 0C5A  74 09		   *	    je     @C008A
 0C5C  B9 0080		      C 			mov	cx,WTD_Ctrl_EmbFreq		;
 0C5F  BA 0039		      C 			mov	dx,WTD_BendEmb			;
 0C62  E8 01CD		      C 			call	I_Play_KeyOff_Emb		;
			      C 		.endif
			      C 
			      C 		;パンEmb
			      C 		.if	(ds:[di].WTD_FlagControl&WTD_Ctrl_PanEmb)
 0C65			   *@C008A:
 0C65  F7 05 0020	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_PanEmb
 0C69  74 09		   *	    je     @C008C
 0C6B  B9 0200		      C 			mov	cx,WTD_Ctrl_EmbPan		;
 0C6E  BA 006D		      C 			mov	dx,WTD_PanEmb			;
 0C71  E8 01BE		      C 			call	I_Play_KeyOff_Emb		;
			      C 		.endif
			      C 
			      C 	.endif
 0C74			   *@C008C:
 0C74			   *@C0081:
			      C 	ret				;
 0C74  59		   *	    pop    cx
 0C75  58		   *	    pop    ax
 0C76  C3		   *	    ret    00000h
 0C77			      C I_Play_KeyOff	endp
			      C ;****************************************************************
			      C ;*								*
			      C ;*			割り込みルーチン			*
			      C ;*				演奏・効果音制御部		*
			      C ;*				音程・音量制御			*
			      C ;****************************************************************
			      C ;*	●引数							*
			      C ;*		ds:bp	ワークベースアドレス	引数		*
			      C ;*		ds:bx	共有構造体アドレス	引数		*
			      C ;*		ds:di	個別構造体		引数		*
			      C ;*		es:si	演奏アドレス		引数		*
			      C ;*	●レジスタ使用						*
			      C ;*		ax	汎用(主に計算)		破壊ok		*
			      C ;*		cx	汎用			破壊ok		*
			      C ;*		dx	汎用			破壊ok		*
			      C ;****************************************************************
			      C ;===============================================================|
			      C ;			音程制御 (Detune,LFO,Emb合成)		|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 0C78			      C I_Play_Frection	proc	near		;
			      C 
			      C ifndef	hyoka	;--------------------------------廉価版は無し
			      C 	;モジュレーション制御(MIDI)
 0C78  8B 45 14		      C 	mov	ax,ds:[di].WTD_Leng		;モジュレーション
 0C7B  2B 45 16		      C 	sub	ax,ds:[di].WTD_LengCounter	;
			      C 	.if	(ax==ds:[di].WTD_ModDecay)
 0C7E  3B 45 5B		   *	    cmp    ax, ds : [di] . WTD_ModDecay
 0C81  75 0E		   *	    jne    @C008E
 0C83  8A 45 5D		      C 	  mov	al,ds:[di].WTD_ModLevel		;
 0C86  88 45 5E		      C 	  mov	ds:[di].WTD_ModLevelSet,al	;
 0C89  B1 01		      C 	  mov	cl,MIDI_Ctrl_Mod		;
 0C8B  BA 189E R	      C 	  mov	dx,offset CGROUP:I_Table_CtrlChgB
 0C8E  E8 09F9		      C 	  call	I_Table_Jump			;モジュレーションをかける。
			      C 	.endif
 0C91			   *@C008E:
			      C endif	;----------------------------------------
			      C 
			      C 
			      C 	;音程読み込み
 0C91  8B 45 2C		      C 	mov	ax,ds:[di].WTD_Bend	;
			      C 
			      C 	;ディチューンの加算
 0C94  03 45 2E		      C 	add	ax,ds:[di].WTD_BendDetune
			      C 
			      C 	;音程LFO処理
			      C 	.if	(ds:[di].WTD_FlagControl & WTD_Ctrl_BendLFO)
 0C97  F7 05 0001	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_BendLfo
 0C9B  74 08		   *	    je     @C0090
 0C9D  BA 0030		      C 		mov	dx,WTD_BendLFO		;
 0CA0  E8 023D		      C 		call	I_Play_LFO		;
 0CA3  03 C2		      C 		add	ax,dx			;
			      C 	.endif
 0CA5			   *@C0090:
			      C 
			      C 	;音量Emb処理
			      C 	.if	(ds:[di].WTD_FlagControl & WTD_Ctrl_BendEmb)
 0CA5  F7 05 0002	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_BendEmb
 0CA9  74 15		   *	    je     @C0092
 0CAB  B9 0080		      C 		mov	cx,WTD_Ctrl_EmbFreq	;
 0CAE  BA 0039		      C 		mov	dx,WTD_BendEmb		;
 0CB1  E8 01B2		      C 		call	I_Play_Emb		;
 0CB4  80 EA 80		      C 		sub	dl,80h			
			      C 		.if	(carry?)
 0CB7  73 02		   *	    jae    @C0094
 0CB9  B6 FF		      C 		  mov	dh,0ffh			;dx←dl(符号付)
			      C 		.endif
 0CBB			   *@C0094:
 0CBB  C1 E2 06		      C 		shl	dx,6			;×2^6
 0CBE  03 C2		      C 		add	ax,dx			;加算
			      C 	.endif
 0CC0			   *@C0092:
			      C 
			      C 	;音程の出力
 0CC0  BA 17D0 R	      C 	mov	dx,offset CGROUP:I_Table_Frection
 0CC3  E8 09C4		      C 	call	I_Table_Jump		;音程セット
			      C 
 0CC6  C3		      C 	ret				;
 0CC7			      C I_Play_Frection	endp
			      C ;===============================================================|
			      C ;			音量制御 (Detune,LFO,Emb合成)		|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 0CC8			      C I_Play_Volume	proc	near		;
			      C 
 0CC8  33 C0		      C 	xor	ax,ax			;
			      C 
 0CCA  8A 55 20		      C 	mov	dl, ds:[di].WTD_KeySet + 0	;
			      C ifndef	hyoka	;--------------------------------廉価版は無し
 0CCD  22 55 21		      C 	and	dl, ds:[di].WTD_KeySet + 1	;
 0CD0  22 55 22		      C 	and	dl, ds:[di].WTD_KeySet + 2	;
 0CD3  22 55 23		      C 	and	dl, ds:[di].WTD_KeySet + 3	;
 0CD6  22 55 24		      C 	and	dl, ds:[di].WTD_KeySet + 4	;
 0CD9  22 55 25		      C 	and	dl, ds:[di].WTD_KeySet + 5	;
 0CDC  22 55 26		      C 	and	dl, ds:[di].WTD_KeySet + 6	;
 0CDF  22 55 27		      C 	and	dl, ds:[di].WTD_KeySet + 7	;
			      C endif	;----------------------------------------
			      C 
			      C 	;休符でないか、音量＝０でない場合に実行
 0CE2  80 FA FF		      C 	cmp	dl, 0FFh
 0CE5  75 0F		      C 	jnz	I_Play_Volume_Step1
			      C 
			      C 	.if	(ds:[di].WTD_ExprEmbLevelSet != 0)
 0CE7  80 7D 51 00	   *	    cmp    ds : [di] . WTD_ExprEmbLevelSet, 000h
 0CEB  75 03 E9 0089	   *	    je     @C0096
			      C 
			      C 		;リリース機能を使う？
			      C 		.if	(ds:[di].WTD_ReleaseVolume == 0FFh)
 0CF0  80 7D 3E FF	   *	    cmp    ds : [di] . WTD_ReleaseVolume, 0FFh
 0CF4  75 50		   *	    jne    @C0098
			      C 
 0CF6			      C I_Play_Volume_Step1:
			      C 			;音量読み込み＆14bitに変換
 0CF6  8A 45 41		      C 			mov	al,ds:[di].WTD_Expr	;
 0CF9  40		      C 			inc	ax			;
 0CFA  C1 E0 07		      C 			shl	ax,7			;128倍にする。
 0CFD  48		      C 			dec	ax			;（Range:0〜16383）
			      C 
			      C 			;ディチューンの加算
 0CFE  03 45 42		      C 			add	ax,ds:[di].WTD_ExprDetune
			      C 
			      C 			;音量LFO処理
			      C 			.if	(ds:[di].WTD_FlagControl & WTD_Ctrl_ExprLFO)
 0D01  F7 05 0004	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_ExprLfo
 0D05  74 08		   *	    je     @C009A
 0D07  BA 0044		      C 				mov	dx,WTD_ExprLFO		;
 0D0A  E8 01D3		      C 				call	I_Play_LFO		;
 0D0D  03 C2		      C 				add	ax,dx			;
			      C 			.endif
			      C 
			      C 			;音量Emb処理
			      C 			.if	(ds:[di].WTD_FlagControl & WTD_Ctrl_ExprEmb)
 0D0F			   *@C009A:
 0D0F  F7 05 0008	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_ExprEmb
 0D13  74 09		   *	    je     @C009C
 0D15  B9 0100		      C 				mov	cx,WTD_Ctrl_EmbVol	;
 0D18  BA 004D		      C 				mov	dx,WTD_ExprEmb		;
 0D1B  E8 0148		      C 				call	I_Play_Emb		;
			      C 		;		mov	ds:[di].WTD_ExprEmbLevelSet,dl	;エンベロープ値
			      C 			.endif
			      C 
			      C 			;音量を、7bitに補正
 0D1E			   *@C009C:
 0D1E  40		      C 			inc	ax			;
 0D1F  C1 E8 07		      C 			shr	ax,7			;ax←{(ax+1)÷128}-1
 0D22  48		      C 			dec	ax			;（Range:0〜127）
			      C 			.if	(ah==0)
 0D23  0A E4		   *	    or	ah, ah
 0D25  75 09		   *	    jne    @C009E
			      C 				.if	(al>=80h)
 0D27  3C 80		   *	    cmp    al, 080h
 0D29  72 07		   *	    jb     @C00A0
 0D2B  B8 007F		      C 				  mov	ax,07fh		;if (128=>ax>255){ax = 0x7F;};
			      C 				.endif
			      C 			.else
 0D2E  EB 02		   *	    jmp    @C00A2
 0D30			   *@C009E:
 0D30  33 C0		      C 				xor	ax,ax		;ax = 0x00;
			      C 			.endif
			      C 
			      C 			;エンベロープ音量の合成
 0D32			   *@C00A2:
 0D32			   *@C00A0:
 0D32  33 C9		      C 			xor	cx,cx			;
 0D34  8A C8		      C 			mov	cl,al			;
 0D36  41		      C 			inc	cx				;cx←音量+1
 0D37  33 C0		      C 			xor	ax,ax				;ax←0
 0D39  8A 45 51		      C 			mov	al,ds:[di].WTD_ExprEmbLevelSet	;ax←音量
 0D3C  40		      C 			inc	ax				;ax←ソフト音量+1
 0D3D  F7 E1		      C 			mul	cx			;
 0D3F  48		      C 			dec	ax			;
 0D40  D1 E0		      C 			shl	ax,1			;al←((Vol.+1)×(SoftVol.+1)-1)／128
 0D42  8A C4		      C 			mov	al,ah			;(Range:0〜255)
			      C 
			      C 		.else
 0D44  EB 09		   *	    jmp    @C00A3
 0D46			   *@C0098:
 0D46  8A 45 3E		      C 			mov	al,ds:[di].WTD_ReleaseVolume
 0D49  F9		      C 			stc
 0D4A  D0 C0		      C 			rol	al, 1
 0D4C  88 45 51		      C 			mov	ds:[di].WTD_ExprEmbLevelSet, al
			      C 		.endif
			      C 
			      C 
			      C 		;ソフトウェア音量の合成
 0D4F			   *@C00A3:
 0D4F  33 C9		      C 		xor	cx,cx			;
 0D51  8A C8		      C 		mov	cl,al			;
 0D53  41		      C 		inc	cx			;cx←音量+1
 0D54  33 C0		      C 		xor	ax,ax			;ax←0
			      C 		.if	(ds:[di].WTD_FlagControl & WTD_Ctrl_Effect)
 0D56  F7 05 4000	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_Effect
 0D5A  74 05		   *	    je     @C00A4
 0D5C  8A 47 22		      C 		  mov	al,ds:[bx].WTD_Sys_VolumeEffect	;ax←効果音音量
			      C 		.else
 0D5F  EB 03		   *	    jmp    @C00A6
 0D61			   *@C00A4:
 0D61  8A 47 21		      C 		  mov	al,ds:[bx].WTD_Sys_VolumeMusic	;ax←音楽音量
			      C 		.endif
			      C 
			      C 
			      C 	;	mov	bx,offset CGROUP:I_Volume_Table	;log演算
			      C 	;	xlat
			      C 	;	xor	ah,ah
 0D64			   *@C00A6:
 0D64  8B F0		      C 		mov	si,ax			;
 0D66  81 E6 00FF	      C 		and	si,00ffh		;
 0D6A  2E: 8A 84 0884 R	      C 		mov	al,byte ptr cs:[CGROUP:I_Volume_Table + si]
			      C 
 0D6F  40		      C 		inc	ax			;ax←ソフト音量+1
 0D70  F7 E1		      C 		mul	cx			;
 0D72  48		      C 		dec	ax			;al←((2*Vol.+1)×(SoftVol.+1)／256)-1
 0D73  8A C4		      C 		mov	al,ah			;(Range:0〜255)
 0D75  D0 E8		      C 		shr	al,1			;al÷2 (Range:0〜127)
			      C 
			      C 	.else
 0D77  EB 00		   *	    jmp    @C00A7
 0D79			   *@C0096:
			      C 
			      C 	.endif
 0D79			   *@C00A7:
			      C 
			      C 	;音量の出力
 0D79  BA 173E R	      C 	mov	dx,offset CGROUP:I_Table_Volume
 0D7C  E8 090B		      C 	call	I_Table_Jump		;音量セット
			      C 
 0D7F  C3		      C 	ret				;
 0D80			      C I_Play_Volume	endp
			      C ;===============================================================|
			      C ;			パンポット制御 (LFO,Emb合成)		|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 0D80			      C I_Play_Pan	proc	near		;
			      C 
			      C 	;パンポット読み込み
 0D80  8A 45 61		      C 	mov	al,ds:[di].WTD_Pan	;
 0D83  83 E0 7F		      C 	and	ax,0007fh		;
			      C 
			      C 	;ソフトウェア処理がなかったら飛ばす。
			      C       .if	(ds:[di].WTD_FlagControl & (WTD_Ctrl_PanLFO + WTD_Ctrl_PanEmb))
 0D86  F7 05 0030	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_PanLfo + WTD_Ctrl_PanEmb
 0D8A  74 42		   *	    je     @C00A8
			      C 
			      C 	;128倍にする。
 0D8C  40		      C 	inc	ax			;
 0D8D  C1 E0 07		      C 	shl	ax,7			;
 0D90  48		      C 	dec	ax			;（Range:0〜16383）
			      C 
			      C 	;パンポットLFO処理
			      C 	.if	(ds:[di].WTD_FlagControl & WTD_Ctrl_PanLFO)
 0D91  F7 05 0010	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_PanLfo
 0D95  74 08		   *	    je     @C00AA
 0D97  BA 0064		      C 		mov	dx,WTD_PanLFO		;
 0D9A  E8 0143		      C 		call	I_Play_LFO		;
 0D9D  03 C2		      C 		add	ax,dx			;
			      C 	.endif
			      C 
			      C 	;パンポットEmb処理
			      C 	.if	(ds:[di].WTD_FlagControl & WTD_Ctrl_PanEmb)
 0D9F			   *@C00AA:
 0D9F  F7 05 0020	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_PanEmb
 0DA3  74 15		   *	    je     @C00AC
 0DA5  B9 0200		      C 		mov	cx,WTD_Ctrl_EmbPan	;
 0DA8  BA 006D		      C 		mov	dx,WTD_PanEmb		;
 0DAB  E8 00B8		      C 		call	I_Play_Emb		;
 0DAE  80 EA 80		      C 		sub	dl,80h			;
			      C 		.if	(carry?)
 0DB1  73 02		   *	    jae    @C00AE
 0DB3  B6 FF		      C 		  mov	dh,0ffh			;dx←dl(符号付)
			      C 		.endif
 0DB5			   *@C00AE:
 0DB5  C1 E2 06		      C 		shl	dx,6			;×2^6
 0DB8  03 C2		      C 		add	ax,dx			;加算
			      C 	.endif
			      C 
			      C 	;パンポットを、7bitに補正
 0DBA			   *@C00AC:
 0DBA  40		      C 	inc	ax			;
 0DBB  C1 E8 07		      C 	shr	ax,7			;ax←{(ax+1)÷128}-1
 0DBE  48		      C 	dec	ax			;（Range:0〜127）
			      C 
			      C 	.if	(ah==0)
 0DBF  0A E4		   *	    or	ah, ah
 0DC1  75 09		   *	    jne    @C00B0
			      C 		.if	(al>=80h)
 0DC3  3C 80		   *	    cmp    al, 080h
 0DC5  72 07		   *	    jb     @C00B2
 0DC7  B8 007F		      C 		  mov	ax,07fh		;if (128=>ax>255){ax = 0x7F;};
			      C 		.endif
			      C 	.else
 0DCA  EB 02		   *	    jmp    @C00B4
 0DCC			   *@C00B0:
 0DCC  33 C0		      C 		xor	ax,ax		;ax = 0x00;
			      C 	.endif
			      C 
			      C       .endif
 0DCE			   *@C00B4:
 0DCE			   *@C00B2:
 0DCE			   *@C00A8:
			      C 
			      C 	;パンポットの出力
			      C 	.if	(ds:[di].WTD_PanSet!=al)
 0DCE  38 45 60		   *	    cmp    ds : [di] . WTD_PanSet, al
 0DD1  74 0B		   *	    je     @C00B5
 0DD3  88 45 60		      C 	  mov	ds:[di].WTD_PanSet,al	;書き込み
			      C ifndef	hyoka	;------------------------廉価版は無し
 0DD6  B1 0A		      C 	  mov	cl,MIDI_Ctrl_Pan	;
 0DD8  BA 189E R	      C 	  mov	dx,offset CGROUP:I_Table_CtrlChgB
 0DDB  E8 08AC		      C 	  call	I_Table_Jump		;パンポットセット
			      C endif	;--------------------------------
			      C 	.endif
 0DDE			   *@C00B5:
			      C 
 0DDE  C3		      C 	ret				;
 0DDF			      C I_Play_Pan	endp
			      C ;****************************************************************
			      C ;*								*
			      C ;*			割り込みルーチン			*
			      C ;*				演奏・効果音制御部		*
			      C ;*				音程・音量LFO,Emb制御		*
			      C ;*				音程、音量で同一のルーチン	*
			      C ;*								*
			      C ;****************************************************************
			      C ;*	●引数							*
			      C ;*		ds:bp	ワークベースアドレス	引数		*
			      C ;*		ds:bx	共有構造体アドレス	引数		*
			      C ;*		ds:di	個別構造体		引数		*
			      C ;*		es:si	演奏アドレス		引数		*
			      C ;*		dx	ワークアドレス先頭	返り値になる	*
			      C ;*		cx	制御Flag		破壊ok		*
			      C ;*	●レジスタ使用						*
			      C ;*		ax	汎用(主に計算)		破壊NG		*
			      C ;*	●返り値						*
			      C ;*		dx	変位(レベル)				*
			      C ;****************************************************************
			      C ;===============================================================|
			      C ;			LFO処理	KeyOn				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 0DE0			      C I_Play_KeyOn_LFO	proc	near	uses	ax di
			      C 
			      C ;	mov	bp,dx					;
 0DE0  50		   *	    push   ax
 0DE1  57		   *	    push   di
 0DE2  03 FA		      C 	add	di,dx
			      C 
			      C 	;カウンター(Rate)の初期化
 0DE4  8A 25		      C 	mov	ah,ds:[di].WTD_ChLfo_DecayRate		;DR
 0DE6  02 65 01		      C 	add	ah,ds:[di].WTD_ChLfo_SpeedRate		;SR
 0DE9  88 65 05		      C 	mov	ds:[di].WTD_ChLfo_RateCounter,ah	;
			      C 
			      C 	;カウンター(Count)の初期化
 0DEC  8A 65 04		      C 	mov	ah,ds:[di].WTD_ChLfo_Count		;
 0DEF  D0 EC		      C 	shr	ah,1					;ah = ah / 2	←ミスだけど
			      C ;	.if	(ah==1)
			      C ;	  xor	ah,ah					;互換性の為、これを入れる。
			      C ;	.endif
 0DF1  88 65 08		      C 	mov	ds:[di].WTD_ChLfo_CountCounter,ah	;
			      C 
			      C 	;レベルの初期化
 0DF4  33 C0		      C 	xor	ax,ax					;
 0DF6  89 45 06		      C 	mov	ds:[di].WTD_ChLfo_LevelSet,ax		;
			      C 
			      C 	ret						;
 0DF9  5F		   *	    pop    di
 0DFA  58		   *	    pop    ax
 0DFB  C3		   *	    ret    00000h
 0DFC			      C I_Play_KeyOn_LFO	endp
			      C ;===============================================================|
			      C ;			Emb処理	KeyOn				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 0DFC			      C I_Play_KeyOn_Emb	proc	near	uses	ax di si
			      C 
 0DFC  50		   *	    push   ax
 0DFD  57		   *	    push   di
 0DFE  56		   *	    push   si
 0DFF  8D 35		      C 	lea	si,[di]
 0E01  03 FA		      C 	add	di,dx
			      C 
 0E03  33 C0		      C 	xor	ax,ax
 0E05  8A 05		      C 	mov	al,ds:[di].WTD_ChEmb_Address	;
 0E07  24 F0		      C 	and	al,0f0h				;
 0E09  88 05		      C 	mov	ds:[di].WTD_ChEmb_Address,al	;位置初期化
			      C 	.if	(ds:[si].WTD_FlagControl & cx)
 0E0B  85 0C		   *	    test   ds : [si] . WTD_FlagControl, cx
 0E0D  74 02		   *	    je     @C00B7
 0E0F  B4 01		      C 	  mov	ah,01h				;
			      C 	.endif
 0E11			   *@C00B7:
			      C 
 0E11  8D B6 0200	      C 	lea	si,[bp + WTD_WorkAdd_Emb]	;エンベロープアドレス
 0E15  03 F0		      C 	add	si,ax				;データアドレス
 0E17  AD		      C 	lodsw					;
 0E18  8B 14		      C 	mov	dx,ds:[si]			;
			      C 
 0E1A  88 45 01		      C 	mov	ds:[di].WTD_ChEmb_Rate,al	;
			      C 	.if	(ah&80h)
 0E1D  F6 C4 80		   *	    test   ah, 080h
 0E20  74 02		   *	    je     @C00B9
 0E22  F6 DC		      C 	  neg	ah				;
			      C 	.endif
 0E24			   *@C00B9:
 0E24  88 65 02		      C 	mov	ds:[di].WTD_ChEmb_Counter,ah	;
 0E27  88 55 03		      C 	mov	ds:[di].WTD_ChEmb_MaxMin,dl	;
 0E2A  88 75 04		      C 	mov	ds:[di].WTD_ChEmb_LevelSet,dh	;
			      C 
			      C 	ret					;
 0E2D  5E		   *	    pop    si
 0E2E  5F		   *	    pop    di
 0E2F  58		   *	    pop    ax
 0E30  C3		   *	    ret    00000h
 0E31			      C I_Play_KeyOn_Emb	endp
			      C ;===============================================================|
			      C ;			Emb処理	KeyOff				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 0E32			      C I_Play_KeyOff_Emb	proc	near	uses ax di si
			      C 
 0E32  50		   *	    push   ax
 0E33  57		   *	    push   di
 0E34  56		   *	    push   si
 0E35  8D 35		      C 	lea	si,[di]
 0E37  03 FA		      C 	add	di,dx
			      C 
 0E39  33 C0		      C 	xor	ax,ax
 0E3B  8A 05		      C 	mov	al,ds:[di].WTD_ChEmb_Address	;
 0E3D  24 F0		      C 	and	al,0f0h				;
 0E3F  0C 0C		      C 	or	al,00cH				;
 0E41  88 05		      C 	mov	ds:[di].WTD_ChEmb_Address,al	;位置初期化
			      C 	.if	(ds:[si].WTD_FlagControl & cx)
 0E43  85 0C		   *	    test   ds : [si] . WTD_FlagControl, cx
 0E45  74 02		   *	    je     @C00BB
 0E47  B4 01		      C 	  mov	ah,01h				;
			      C 	.endif
 0E49			   *@C00BB:
			      C 
 0E49  8D B6 0200	      C 	lea	si,[bp + WTD_WorkAdd_Emb]	;エンベロープアドレス
 0E4D  03 F0		      C 	add	si,ax				;データアドレス
 0E4F  AD		      C 	lodsw					;
 0E50  8B 14		      C 	mov	dx,ds:[si]			;
			      C 
 0E52  88 45 01		      C 	mov	ds:[di].WTD_ChEmb_Rate,al	;
			      C 	.if	(ah&80h)
 0E55  F6 C4 80		   *	    test   ah, 080h
 0E58  74 02		   *	    je     @C00BD
 0E5A  F6 DC		      C 	  neg	ah				;
			      C 	.endif
 0E5C			   *@C00BD:
 0E5C  88 65 02		      C 	mov	ds:[di].WTD_ChEmb_Counter,ah	;
 0E5F  88 55 03		      C 	mov	ds:[di].WTD_ChEmb_MaxMin,dl	;
			      C 
			      C 	ret					;
 0E62  5E		   *	    pop    si
 0E63  5F		   *	    pop    di
 0E64  58		   *	    pop    ax
 0E65  C3		   *	    ret    00000h
 0E66			      C I_Play_KeyOff_Emb	endp
			      C ;===============================================================|
			      C ;			Emb処理	メイン				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 0E66			      C I_Play_Emb	proc	near	uses	ax di si
			      C 
 0E66  50		   *	    push   ax
 0E67  57		   *	    push   di
 0E68  56		   *	    push   si
 0E69  8D 35		      C 	lea	si,[di]
 0E6B  03 FA		      C 	add	di,dx
			      C 
			      C ;	mov	al, ds:[di].WTD_ChEmb_Address
			      C ;	and	al, 00Fh
			      C ;	.if	!((ds:[di].WTD_ChEmb_LevelSet == 0) && (al == 00Ch))
			      C 
			      C 	  ;●Speed処理
 0E6D  FE 4D 02		      C 	  dec	ds:[di].WTD_ChEmb_Counter
			      C 	  .if	(zero?)
 0E70  75 65		   *	    jne    @C00BF
			      C 
			      C 		;●アドレスの設定
 0E72  33 C0		      C 		xor	ax,ax
 0E74  8A 05		      C 		mov	al,ds:[di].WTD_ChEmb_Address
			      C 		.if	(ds:[si].WTD_FlagControl & cx)
 0E76  85 0C		   *	    test   ds : [si] . WTD_FlagControl, cx
 0E78  74 02		   *	    je     @C00C1
 0E7A  B4 01		      C 			mov	ah,01h			;ax←Address
			      C 		.endif
 0E7C			   *@C00C1:
 0E7C  8D B6 0200	      C 		lea	si,[bp + WTD_WorkAdd_Emb]	;エンベロープアドレス
 0E80  03 F0		      C 		add	si,ax				;si←データアドレス
			      C 
			      C 		;●Count再設定
 0E82  8A 64 01		      C 		mov	ah,ds:[si].WTD_Emb_AS		;
			      C 		.if	(ah & 80h)
 0E85  F6 C4 80		   *	    test   ah, 080h
 0E88  74 02		   *	    je     @C00C3
 0E8A  F6 DC		      C 			neg	ah			;
			      C 		.endif
 0E8C			   *@C00C3:
 0E8C  88 65 02		      C 		mov	ds:[di].WTD_ChEmb_Counter,ah	;
			      C 
			      C 		;●Rate ＆ Level処理
 0E8F  8A 45 04		      C 		mov	al,ds:[di].WTD_ChEmb_LevelSet
			      C 		.if	(ds:[si].WTD_Emb_AS & 80h)	;比較(正 or 負)
 0E92  F6 44 01 80	   *	    test   ds : [si] . WTD_Emb_AS, 080h
 0E96  74 0B		   *	    je     @C00C5
 0E98  2A 04		      C 		  sub	al,ds:[si].WTD_Emb_AR		;負
 0E9A  72 10		      C 		  jc	I_Play_Emb_Step3		;
 0E9C  3A 44 02		      C 		  cmp	al,ds:[si].WTD_Emb_AL		;最小値チェック
 0E9F  73 33		      C 		  jnc	I_Play_Emb_StepEnd		;
			      C 		.else
 0EA1  EB 09		   *	    jmp    @C00C7
 0EA3			   *@C00C5:
 0EA3  02 04		      C 		  add	al,ds:[si].WTD_Emb_AR		;正
 0EA5  72 05		      C 		  jc	I_Play_Emb_Step3		;
 0EA7  3A 44 02		      C 		  cmp	al,ds:[si].WTD_Emb_AL		;最大値チェック
 0EAA  72 28		      C 		  jc	I_Play_Emb_StepEnd		;
			      C 		.endif
			      C 
			      C 		;●最大値を超えた場合
 0EAC			      C I_Play_Emb_Step3:					;
 0EAC			   *@C00C7:
 0EAC  8A 44 02		      C 		mov	al,ds:[si].WTD_Emb_AL		;
 0EAF  8A 25		      C 		mov	ah,ds:[di].WTD_ChEmb_Address	;
 0EB1  80 E4 0F		      C 		and	ah,0fh				;
			      C 
			      C 		.if	(ah<08h)
 0EB4  80 FC 08		   *	    cmp    ah, 008h
 0EB7  73 1B		   *	    jae    @C00C8
 0EB9  50		      C 		  push	ax				;
 0EBA  80 05 04		      C 		  add	ds:[di].WTD_ChEmb_Address,04h	;
 0EBD  83 C6 04		      C 		  add	si,4				;アドレスの設定
 0EC0  AD		      C 		  lodsw					;
 0EC1  8B 14		      C 		  mov	dx,ds:[si]			;
 0EC3  88 45 01		      C 		  mov	ds:[di].WTD_ChEmb_Rate,al	;
			      C 		  .if	(ah&80h)
 0EC6  F6 C4 80		   *	    test   ah, 080h
 0EC9  74 02		   *	    je     @C00CA
 0ECB  F6 DC		      C 			neg	ah			;
			      C 		  .endif
 0ECD			   *@C00CA:
 0ECD  88 65 02		      C 		  mov	ds:[di].WTD_ChEmb_Counter,ah	;
 0ED0  88 55 03		      C 		  mov	ds:[di].WTD_ChEmb_MaxMin,dl	;
 0ED3  58		      C 		  pop	ax				;
			      C 		.endif
 0ED4			      C I_Play_Emb_StepEnd:					;
			      C 
 0ED4			   *@C00C8:
 0ED4  88 45 04		      C 		mov	ds:[di].WTD_ChEmb_LevelSet,al	
			      C 
			      C 	  .endif
 0ED7			   *@C00BF:
			      C ;	.endif
			      C 
 0ED7  33 D2		      C 	xor	dx,dx				;
 0ED9  8A 55 04		      C 	mov	dl,ds:[di].WTD_ChEmb_LevelSet	;
			      C 
			      C 	ret					;
 0EDC  5E		   *	    pop    si
 0EDD  5F		   *	    pop    di
 0EDE  58		   *	    pop    ax
 0EDF  C3		   *	    ret    00000h
 0EE0			      C I_Play_Emb	endp
			      C ;===============================================================|
			      C ;			LFO処理	メイン				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 0EE0			      C I_Play_LFO	proc	near	uses	ax di
			      C 
 0EE0  50		   *	    push   ax
 0EE1  57		   *	    push   di
 0EE2  03 FA		      C 	add	di,dx
			      C 
			      C 	;Rate処理
 0EE4  FE 4D 05		      C 	dec	ds:[di].WTD_ChLfo_RateCounter		;
			      C 	.if	(zero?)
 0EE7  75 29		   *	    jne    @C00CC
 0EE9  8A 45 01		      C 		mov	al,ds:[di].WTD_ChLfo_SpeedRate		;
 0EEC  88 45 05		      C 		mov	ds:[di].WTD_ChLfo_RateCounter,al	;
			      C 
			      C 		;Level処理(dx←Level)
 0EEF  8B 55 06		      C 		mov	dx,ds:[di].WTD_ChLfo_LevelSet		;dx←Level
 0EF2  8A 45 08		      C 		mov	al,ds:[di].WTD_ChLfo_CountCounter	;
			      C 	;	shr	al,1	;※
			      C 		.if	(al>ds:[di].WTD_ChLfo_Count)		;加減算の分岐
 0EF5  3A 45 04		   *	    cmp    al, ds : [di] . WTD_ChLfo_Count
 0EF8  76 05		   *	    jbe    @C00CE
 0EFA  2B 55 02		      C 		  sub	dx,ds:[di].WTD_ChLfo_Level		;減算
			      C 		.else
 0EFD  EB 03		   *	    jmp    @C00D0
 0EFF			   *@C00CE:
 0EFF  03 55 02		      C 		  add	dx,ds:[di].WTD_ChLfo_Level		;加算
			      C 		.endif
 0F02			   *@C00D0:
 0F02  89 55 06		      C 		mov	ds:[di].WTD_ChLfo_LevelSet,dx		;保存
			      C 
			      C 		;Count処理
 0F05  FE 4D 08		      C 		dec	ds:[di].WTD_ChLfo_CountCounter		;
			      C 		.if	(zero?)
 0F08  75 08		   *	    jne    @C00D1
 0F0A  8A 45 04		      C 		  mov	al,ds:[di].WTD_ChLfo_Count		;カウンター初期化
 0F0D  D0 E0		      C 		  shl	al,1					;al = al × 2	（何故？）
 0F0F  88 45 08		      C 		  mov	ds:[di].WTD_ChLfo_CountCounter,al	;
			      C 		.endif
			      C 	.endif
 0F12			   *@C00D1:
 0F12			   *@C00CC:
			      C 
 0F12  8B 55 06		      C 	mov	dx,DS:[di].WTD_ChLfo_LevelSet		;dx←LFOのレベル
			      C 
			      C 	ret					;
 0F15  5F		   *	    pop    di
 0F16  58		   *	    pop    ax
 0F17  C3		   *	    ret    00000h
 0F18			      C I_Play_LFO	endp
			      C ;****************************************************************
			      C ;*								*
			      C ;*			効果音終了時の設定復帰			*
			      C ;*								*
			      C ;****************************************************************
			      C ;*	●引数							*
			      C ;*		ch	チャンネル				*
			      C ;*		ds:bx	System Sturuc				*
			      C ;*		ds:di	Part Sturuc				*
			      C ;****************************************************************
			      C 	even				;偶数アドレス配置
 0F18			      C I_Effect_Return	proc	near			;
 0F18  60		      C 	pusha					;レジスタ保存
			      C 
			      C ;---------------------------------------------------------------
			      C ;フラグのリセット
 0F19  8A CD		      C 	mov	cl,ch				;
 0F1B  80 E1 07		      C 	and	cl,07h				;
 0F1E  FE C1		      C 	inc	cl				;
 0F20  B8 F7FF		      C 	mov	ax,0f7ffh			;
 0F23  D3 C0		      C 	rol	ax,cl				;
 0F25  21 07		      C 	and	ds:[bx].WTD_Sys_Flag,ax		;
			      C ;---------------------------------------------------------------
			      C ;Channel Modeの復帰
 0F27  8B 07		      C 	mov	ax,ds:[bx].WTD_Sys_Flag		;ah←Channel Mode Flag
 0F29  80 E4 0F		      C 	and	ah,0fh				;ah←その他のFlagをMask
 0F2C  C0 E4 04		      C 	shl	ah,4				;
 0F2F  86 E0		      C 	xchg	ah,al				;
 0F31  B4 08		      C 	mov	ah,08h				;ah←08h
 0F33  8A CD		      C 	mov	cl,ch				;
 0F35  80 E1 07		      C 	and	cl,07h				;上位5bitマスク
 0F38  FE C1		      C 	inc	cl				;
 0F3A  D2 E4		      C 	shl	ah,cl				;ah = ah*2^cl (SetBit)
 0F3C  E8 0AF5		      C 	call	SP_Set_Channel			;
			      C 
			      C ;---------------------------------------------------------------
			      C ;パート個別
			      C 
			      C 	;パート検索
 0F3F  B1 14		      C 	mov	cl,MusicMaxPart			;20回ループ
 0F41  8D BE 0600	      C 	lea	di,[bp + WTD_WorkAdd_Ch0]	;
			      C 	.repeat
 0F45			   *@C00D3:
			      C 	  .if	(ds:[di].WTD_Channel == ch)
 0F45  38 6D 05		   *	    cmp    ds : [di] . WTD_Channel, ch
 0F48  75 5A		   *	    jne    @C00D4
			      C 
 0F4A  06		      C 	    push	es
 0F4B  8E 47 08		      C 	    mov	es, ds:[bx].WTD_Sys_MusicSegment
			      C 	    .if	!(ds:[di].WTD_FlagControl & WTD_Ctrl_PlayEnd)
 0F4E  F7 05 8000	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_PlayEnd
 0F52  75 3B		   *	    jne    @C00D6
			      C 
			      C 
			      C 		;復帰
 0F54  80 E5 03		      C 		and	ch,03h				;チャンネル情報だけにする。
			      C 
			      C 		;周波数
 0F57  8B 45 2A		      C 		mov	ax,ds:[di].WTD_FrectionSet	;周波数の復帰
 0F5A  E8 0A45		      C 		call	SP_Set_Frection			;
			      C 
			      C 		;音量
 0F5D  8A 45 3F		      C 		mov	al,ds:[di].WTD_ExprPanSet	;音量の復帰
 0F60  E8 0A67		      C 		call	SP_Set_Volume			;
			      C 
			      C 		;音色
 0F63  8A 45 11		      C 		mov	al, ds:[di].WTD_Voice
 0F66  FE 45 11		      C 		inc	ds:[di].WTD_Voice
 0F69  E8 089C		      C 		call	I_SP_Voice
			      C 
			      C 		.if	(ch == 2)
 0F6C  80 FD 02		   *	    cmp    ch, 002h
 0F6F  75 0B		   *	    jne    @C00D8
			      C 			;スウィープ値(ch=02h)
 0F71  8A 45 12		      C 			mov	al,ds:[di].WTD_SweepLevel	;
 0F74  8A 65 13		      C 			mov	ah,ds:[di].WTD_SweepTime	;
 0F77  E8 0A78		      C 			call	SP_Set_Sweep			;
			      C 		.elseif	(ch == 3)
 0F7A  EB 25		   *	    jmp    @C00DA
 0F7C			   *@C00D8:
 0F7C  80 FD 03		   *	    cmp    ch, 003h
 0F7F  75 20		   *	    jne    @C00DB
			      C 			;ノイズモード(ch=03h)
 0F81  B4 1F		      C 			mov	ah,01fh				;
 0F83  8A 45 12		      C 			mov	al,ds:[di].WTD_NoiseMode	;
 0F86  0C 18		      C 			or	al,018h				;
 0F88  22 C4		      C 			and	al,ah				;
 0F8A  E8 0A87		      C 			call	SP_Set_Noise			;
			      C 		.endif
			      C 
			      C 	    .else
 0F8D  EB 12		   *	    jmp    @C00DD
 0F8F			   *@C00D6:
			      C 		.if	(ds:[bx].WTD_Sys_Flag & WTD_Sys_Music)
 0F8F  F7 07 0001	   *	    test   ds : [bx] . WTD_Sys_Flag, WTD_Sys_Music
 0F93  74 0C		   *	    je     @C00DE
 0F95  B8 0000		      C 			mov	ax,0			;エクスプレッション = 0
 0F98  E8 0A2F		      C 			call	SP_Set_Volume			;
 0F9B  B8 0000		      C 			mov	ax,0			;音色 = 0
 0F9E  E8 0AB3		      C 			call	SP_Set_Voice
			      C 		.endif
			      C 	    .endif
 0FA1			   *@C00DE:
 0FA1			   *@C00DD:
 0FA1			   *@C00DB:
 0FA1			   *@C00DA:
 0FA1  07		      C 	    pop		es
			      C 	    .break
 0FA2  EB 08		   *	    jmp    @C00E1
			      C 	  .endif
 0FA4			   *@C00D4:
 0FA4  81 C7 0080	      C 	  add	di,WTD_WorkChSize		;構造体のサイズは80h(0x80)
 0FA8  FE C9		      C 	  dec	cl
			      C 	.until	(zero?)
 0FAA  75 99		   *	    jne    @C00D3
 0FAC			   *@C00E1:
			      C 
			      C ;---------------------------------------------------------------
 0FAC			      C I_Effect_Return_End:
 0FAC  61		      C 	popa					;レジスタ復帰
 0FAD  C3		      C 	ret					;
 0FAE			      C I_Effect_Return	endp
			      C 
				include	wtd_icmd.asm			;割り込み　コマンド解釈部
			      C ;=======================================================================|
			      C ;									|
			      C ;		Wander Swan Total Sound Driver				|
			      C ;				Interrupt command program		|
			      C ;									|
			      C ;					Programmed by			|
			      C ;						A.Watanabe		|
			      C ;									|
			      C ;=======================================================================|
			      C ;****************************************************************
			      C ;*								*
			      C ;*			割り込みルーチン			*
			      C ;*				データ読み込み			*
			      C ;*								*
			      C ;****************************************************************
			      C ;===============================================================|
			      C ;		Command Read					|
			      C ;===============================================================|
			      C ;	●処理							|
			      C ;		　データの読み込み				|
			      C ;		　ワークフラグが立っていた場合は、ワークから	|
			      C ;	●引数							|
			      C ;		es:si	演奏中のアドレス			|
			      C ;	●返値							|
			      C ;		es:si	次の引数又はコマンドのアドレス		|
			      C ;		al(ax)	引数					|
			      C ;								|
			      C ;===============================================================|
			      C ;●8bit版========================================================
 0FAE			      C I_Read8	proc	near			;
 0FAE  26: AC		      C 	lodsb	es:[si]			;
 0FB0  F7 05 0800	      C 	test	ds:[di].WTD_FlagControl,WTD_Ctrl_WorkSw
 0FB4  74 09		      C 	jz	I_Read8_End		;ワークからであるか？
			      C 
 0FB6  53		      C 	push	bx			;	{ワーク読み込み}
 0FB7  8A 7D 52		      C 	mov	bh,ds:[di].WTD_WorkAddress
 0FBA  8A D8		      C 	mov	bl,al			;bx←ワークオフセットアドレス
 0FBC  8A 07		      C 	mov	al,ds:[bx]		;
 0FBE  5B		      C 	pop	bx			;
			      C 
 0FBF			      C I_Read8_End:				;
 0FBF  C3		      C 	ret				;終了
 0FC0			      C I_Read8	endp
			      C ;●16bit版=======================================================
 0FC0			      C I_Read16	proc	near		;
 0FC0  26: AD		      C 	lodsw	es:[si]
 0FC2  F7 05 0800	      C 	test	ds:[di].WTD_FlagControl,WTD_Ctrl_WorkSw
 0FC6  74 09		      C 	jz	I_Read16_End		;ワークからであるか？
			      C 
 0FC8  53		      C 	push	bx			;	{ワーク読み込み}
 0FC9  8A 7D 52		      C 	mov	bh,ds:[di].WTD_WorkAddress
 0FCC  8A D8		      C 	mov	bl,al			;bx←ワークオフセットアドレス
 0FCE  8B 07		      C 	mov	ax,ds:[bx]		;
 0FD0  5B		      C 	pop	bx			;
			      C 
 0FD1			      C I_Read16_End:				;
 0FD1  C3		      C 	ret				;終了
 0FD2			      C I_Read16	endp
			      C ;****************************************************************
			      C ;*								*
			      C ;*			割り込みルーチン			*
			      C ;*				演奏・効果音制御部		*
			      C ;*				音階コマンド(80h〜FFh)		*
			      C ;*								*
			      C ;****************************************************************
			      C ;===============================================================|
			      C ;		オートの臨時記号処理(未解決？)			|
			      C ;===============================================================|
			      C ;	●引数							|
			      C ;		al	Note Number				|
			      C ;		cl	音程（0〜7）				|
			      C ;		ds:[di]	パート個別構造体			|
			      C ;	●返値							|
			      C ;		al	Noto Number (自動臨時記号追加後)	|
			      C ;===============================================================|
			      C 	even					;偶数アドレス配置
 0FD2			      C I_PlayKey_Auto	proc	near	uses cx		;
			      C 
 0FD2  51		   *	    push   cx
 0FD3  80 E1 07		      C 	and	cl,07h				;cl←音程(0〜7)
			      C 
			      C ;＃処理
 0FD6  8A 6D 03		      C 	mov	ch,ds:[di].WTD_FlagSharp	;
 0FD9  D2 ED		      C 	shr	ch,cl				;
			      C 	.if	(carry?)			;チェック
 0FDB  73 02		   *	    jae    @C00E3
 0FDD  FE C0		      C 		inc	al			;KeyCode ++
			      C 	.endif
 0FDF			   *@C00E3:
			      C 
			      C ;ｂ処理
 0FDF  8A 6D 04		      C 	mov	ch,ds:[di].WTD_FlagFlat		;
 0FE2  D2 ED		      C 	shr	ch,cl				;
			      C 	.if	(carry?)			;チェック
 0FE4  73 02		   *	    jae    @C00E5
 0FE6  FE C8		      C 		dec	al			;KeyCode --
			      C 	.endif
 0FE8			   *@C00E5:
			      C 
			      C 	ret				;
 0FE8  59		   *	    pop    cx
 0FE9  C3		   *	    ret    00000h
 0FEA			      C I_PlayKey_Auto	endp
			      C ;===============================================================|
			      C ;		音符コマンドの処理				|
			      C ;===============================================================|
			      C ;	●引数							|
			      C ;		ds:bp	ワークベースアドレス	引数		|
			      C ;		ds:bx	共有構造体アドレス	引数		|
			      C ;		ds:di	個別構造体		引数		|
			      C ;		es:si	演奏アドレス		引数		|
			      C ;		al	音符コマンド（00h〜7Fh）破壊ok		|
			      C ;	●レジスタ使用						|
			      C ;		cx	汎用			破壊ok		|
			      C ;		dx	汎用			破壊ok		|
			      C ;===============================================================|
			      C ;音階コード
			      C 	even				;偶数アドレス配置
 0FEA			      C I_PlayKey_Code:
 0FEA  00		      C 	db	0			;c
 0FEB  02		      C 	db	2			;d
 0FEC  04		      C 	db	4			;e
 0FED  05		      C 	db	5			;f
 0FEE  07		      C 	db	7			;g
 0FEF  09		      C 	db	9			;a
 0FF0  0B		      C 	db	11			;b
			      C ;---------------------------------------------------------------
			      C 	even				;偶数アドレス配置
 0FF2			      C I_PlayKey	proc	near	uses bx
			      C 
 0FF2  53		   *	    push   bx
 0FF3  8A C8		      C 	mov	cl,al				;cl←コマンド
 0FF5  83 E0 07		      C 	and	ax,07h				;al←音階情報(0〜7)
 0FF8  83 E8 01		      C 	sub	ax,1				;
			      C 
			      C 	;音符だった場合	（こっちの方が高頻度）
			      C 	.if	(!carry?)
 0FFB  72 3B		   *	    jb     @C00E7
 0FFD  8B D8		      C 		mov	bx,ax			;
			      C 
 0FFF  B0 0C		      C 		mov	al,12			;
 1001  F6 6D 54		      C 		imul	byte ptr ds:[di].WTD_Octave	;パイプラインの為、これを先に。
 1004  2E: 8A AF 0FEA R	      C 		mov	ch,byte ptr cs:[bx + CGROUP:I_PlayKey_Code]
 1009  02 C5		      C 		add	al,ch			;al←Key Code
			      C 
			      C 		;半音演算処理
 100B  8A E9		      C 		mov	ch,cl
 100D  80 E5 18		      C 		and	ch,018h			;臨時記号にマスク
			      C 
			      C 		;臨時記号
			      C 		.if	(ch==08h)		;♭？
 1010  80 FD 08		   *	    cmp    ch, 008h
 1013  75 04		   *	    jne    @C00E9
 1015  FE C0		      C 			inc	al
			      C 		.elseif	(ch==10h)		;＃？
 1017  EB 07		   *	    jmp    @C00EB
 1019			   *@C00E9:
 1019  80 FD 10		   *	    cmp    ch, 010h
 101C  75 02		   *	    jne    @C00EC
 101E  FE C8		      C 			dec	al
			      C 		.endif
			      C 
			      C 		;自動臨時記号
			      C 		.if	(ch!=18h)		;ナチュラル以外？
 1020			   *@C00EC:
 1020			   *@C00EB:
 1020  80 FD 18		   *	    cmp    ch, 018h
 1023  74 03		   *	    je     @C00EE
 1025  E8 FFAA		      C 			call	I_PlayKey_Auto	;自動半音処理
			      C 		.endif
			      C 
 1028			   *@C00EE:
 1028  04 0C		      C 		add	al,12			;KeyCode補正(MIDI単位)
 102A  88 45 1F		      C 		mov	ds:[di].WTD_Key,al	;音程保存
			      C 
			      C 		;ハードウェアをKeyOn
 102D  02 45 1E		      C 		add	al,ds:[di].WTD_KeyShift	
 1030  BA 16AE R	      C 		mov	dx,offset CGROUP:I_Table_KeyOn
 1033  E8 0654		      C 		call	I_Table_Jump		;KeyOn
			      C 
			      C 	;休符だった場合
			      C 	.else
 1036  EB 03		   *	    jmp    @C00F0
 1038			   *@C00E7:
 1038  88 45 1F		      C 		mov	ds:[di].WTD_Key,al	;音程保存（休符:0FFh）
			      C 
			      C 	.endif
 103B			   *@C00F0:
			      C 
			      C 
			      C 
			      C 	;タイフラグチェック
 103B  F6 C1 20		      C 	test	cl,020h				;タイフラグチェック（cy←0）
			      C 	.if	!(zero?)
 103E  74 01		   *	    je     @C00F1
 1040  F9		      C 		stc				;cy←1
			      C 	.endif
 1041			   *@C00F1:
 1041  D0 55 02		      C 	rcl	ds:[di].WTD_FlagTai,1		;シフト
			      C 
			      C 
			      C 
			      C 	;音長フラグのチェック
			      C 	;音長指定無しの場合
			      C 	.if	!(cl&40h)
 1044  F6 C1 40		   *	    test   cl, 040h
 1047  75 05		   *	    jne    @C00F3
 1049  8B 45 18		      C 		mov	ax,ds:[di].WTD_LengDefault
			      C 	;音長指定有りの場合
			      C 	.else
 104C  EB 0A		   *	    jmp    @C00F5
 104E			   *@C00F3:
 104E  33 C0		      C 		xor	ax,ax			;
 1050  26: AC		      C 		lodsb	es:[si]			;ax←音長
			      C 		.if	(al==0ffh)
 1052  3C FF		   *	    cmp    al, 0FFh
 1054  75 02		   *	    jne    @C00F6
 1056  26: AD		      C 			lodsw	es:[si]		;
			      C 		.endif
			      C 	.endif
 1058			   *@C00F6:
 1058			   *@C00F5:
			      C 
 1058  89 45 14		      C 	mov	ds:[di].WTD_Leng,ax		;
 105B  89 45 16		      C 	mov	ds:[di].WTD_LengCounter,ax	;
			      C 
			      C 
			      C 
 105E			      C I_PlayKey_StepE:			;
			      C 	ret				;レジスタ復帰
 105E  5B		   *	    pop    bx
 105F  C3		   *	    ret    00000h
 1060			      C I_PlayKey	endp
			      C ;****************************************************************
			      C ;*								*
			      C ;*			割り込みルーチン			*
			      C ;*				演奏・効果音制御部		*
			      C ;*				補助コマンド(00h〜7Fh)		*
			      C ;*								*
			      C ;****************************************************************
			      C ;===============================================================|
			      C ;			ジャンプテーブル			|
			      C ;===============================================================|
			      C ;コマンド処理のあるアドレス
			      C 	even				;偶数アドレス配置
 1060			      C I_PlayCommand_JumpTable:
 1060  1176 R		      C 	dw	offset CGROUP:I_Com00	;00 	
 1062  1176 R		      C 	dw	offset CGROUP:I_Com01	;01 	
 1064  1176 R		      C 	dw	offset CGROUP:I_Com02	;02 	
 1066  1176 R		      C 	dw	offset CGROUP:I_Com03	;03 	
 1068  1176 R		      C 	dw	offset CGROUP:I_Com04	;04 	
 106A  1176 R		      C 	dw	offset CGROUP:I_Com05	;05 	
 106C  1176 R		      C 	dw	offset CGROUP:I_Com06	;06 	
 106E  1176 R		      C 	dw	offset CGROUP:I_Com07	;07 	
 1070  1176 R		      C 	dw	offset CGROUP:I_Com08	;08 	
 1072  1176 R		      C 	dw	offset CGROUP:I_Com09	;09 	
 1074  1176 R		      C 	dw	offset CGROUP:I_Com0a	;0a 	
 1076  1176 R		      C 	dw	offset CGROUP:I_Com0b	;0b 	
 1078  1176 R		      C 	dw	offset CGROUP:I_Com0c	;0c 	
 107A  1176 R		      C 	dw	offset CGROUP:I_Com0d	;0d 	
 107C  1176 R		      C 	dw	offset CGROUP:I_Com0e	;0e 	
 107E  1176 R		      C 	dw	offset CGROUP:I_Com0f	;0f 	
 1080  1176 R		      C 	dw	offset CGROUP:I_Com10	;10 	
 1082  1176 R		      C 	dw	offset CGROUP:I_Com11	;11 	
 1084  1176 R		      C 	dw	offset CGROUP:I_Com12	;12 	
 1086  1176 R		      C 	dw	offset CGROUP:I_Com13	;13 	
 1088  1176 R		      C 	dw	offset CGROUP:I_Com14	;14 	
 108A  1176 R		      C 	dw	offset CGROUP:I_Com15	;15 	
 108C  1176 R		      C 	dw	offset CGROUP:I_Com16	;16 	
 108E  1176 R		      C 	dw	offset CGROUP:I_Com17	;17 	
 1090  1176 R		      C 	dw	offset CGROUP:I_Com18	;18 	
 1092  1176 R		      C 	dw	offset CGROUP:I_Com19	;19 	
 1094  1176 R		      C 	dw	offset CGROUP:I_Com1a	;1a 	
 1096  1176 R		      C 	dw	offset CGROUP:I_Com1b	;1b 	
 1098  1176 R		      C 	dw	offset CGROUP:I_Com1c	;1c 	
 109A  1176 R		      C 	dw	offset CGROUP:I_Com1d	;1d 	
 109C  1176 R		      C 	dw	offset CGROUP:I_Com1e	;1e 	
 109E  1176 R		      C 	dw	offset CGROUP:I_Com1f	;1f 	
 10A0  1176 R		      C 	dw	offset CGROUP:I_Com20	;20  	
 10A2  1178 R		      C 	dw	offset CGROUP:I_Com21	;21 !	Work Switch
 10A4  117E R		      C 	dw	offset CGROUP:I_Com22	;22 "	Work Base Address
 10A6  1186 R		      C 	dw	offset CGROUP:I_Com23	;23 #		(MML:Sharp)
 10A8  1188 R		      C 	dw	offset CGROUP:I_Com24	;24 $		(MML:Macro)
 10AA  118A R		      C 	dw	offset CGROUP:I_Com25	;25 %		(MML:Step)
 10AC  118C R		      C 	dw	offset CGROUP:I_Com26	;26 &		(MML:Tai)
 10AE  118E R		      C 	dw	offset CGROUP:I_Com27	;27 '	Acsent
 10B0  1198 R		      C 	dw	offset CGROUP:I_Com28	;28 (	Volume down
 10B2  11A6 R		      C 	dw	offset CGROUP:I_Com29	;29 )	Volume up
 10B4  11B4 R		      C 	dw	offset CGROUP:I_Com2a	;2a *	LFO Switch
 10B6  11D8 R		      C 	dw	offset CGROUP:I_Com2b	;2b +		(MML:Sharp)
 10B8  11DA R		      C 	dw	offset CGROUP:I_Com2c	;2c ,		(MML:Channel)
 10BA  11DC R		      C 	dw	offset CGROUP:I_Com2d	;2d -		(MML:Flat)
 10BC  11DE R		      C 	dw	offset CGROUP:I_Com2e	;2e .		(MML:Leng*1.5)
 10BE  11E0 R		      C 	dw	offset CGROUP:I_Com2f	;2f /	Emb. Switch
 10C0  1206 R		      C 	dw	offset CGROUP:I_Com30	;30 0	Work mov
 10C2  1216 R		      C 	dw	offset CGROUP:I_Com31	;31 1	Work add
 10C4  1228 R		      C 	dw	offset CGROUP:I_Com32	;32 2	Work sub
 10C6  123A R		      C 	dw	offset CGROUP:I_Com33	;33 3	Work and
 10C8  124C R		      C 	dw	offset CGROUP:I_Com34	;34 4	Work or
 10CA  125E R		      C 	dw	offset CGROUP:I_Com35	;35 5	Work xor
 10CC  1270 R		      C 	dw	offset CGROUP:I_Com36	;36 6	Work set
 10CE  1288 R		      C 	dw	offset CGROUP:I_Com37	;37 7	Work res
 10D0  12A0 R		      C 	dw	offset CGROUP:I_Com38	;38 8	Work cmp
 10D2  12B2 R		      C 	dw	offset CGROUP:I_Com39	;39 9	Work test
 10D4  12E0 R		      C 	dw	offset CGROUP:I_Com3a	;3a :	Loop Jump
 10D6  12F6 R		      C 	dw	offset CGROUP:I_Com3b	;3b ;	Loop Jump Flag
 10D8  1310 R		      C 	dw	offset CGROUP:I_Com3c	;3c <	Octave down
 10DA  1314 R		      C 	dw	offset CGROUP:I_Com3d	;3d =		(MML:Natural)
 10DC  1316 R		      C 	dw	offset CGROUP:I_Com3e	;3e >	Octave up
 10DE  131A R		      C 	dw	offset CGROUP:I_Com3f	;3f ?	
 10E0  131C R		      C 	dw	offset CGROUP:I_Com40	;40 @	Voice
 10E2  1374 R		      C 	dw	offset CGROUP:I_Com41	;41 A	
 10E4  1376 R		      C 	dw	offset CGROUP:I_Com42	;42 B	Bend , Bend Range(MIDI PRN)
 10E6  13A2 R		      C 	dw	offset CGROUP:I_Com43	;43 C	Track / Channel , Sound Type
 10E8  13BC R		      C 	dw	offset CGROUP:I_Com44	;44 D	Drection Detune
 10EA  13C4 R		      C 	dw	offset CGROUP:I_Com45	;45 E	Emb.
 10EC  141C R		      C 	dw	offset CGROUP:I_Com46	;46 F	Volume(MIDI ctrl:00x7)
 10EE  1428 R		      C 	dw	offset CGROUP:I_Com47	;47 G	Channel Pressior(MIDI:0xD0)
 10F0  1432 R		      C 	dw	offset CGROUP:I_Com48	;48 H	Bank(MIDI ctrl:0x00)
 10F2  143E R		      C 	dw	offset CGROUP:I_Com49	;49 I	
 10F4  1440 R		      C 	dw	offset CGROUP:I_Com4a	;4a J	
 10F6  1442 R		      C 	dw	offset CGROUP:I_Com4b	;4b K	Key On Delay
 10F8  144A R		      C 	dw	offset CGROUP:I_Com4c	;4c L	Loop
 10FA  146A R		      C 	dw	offset CGROUP:I_Com4d	;4d M	Mod(MIDI Ctrl:0x01)
 10FC  1478 R		      C 	dw	offset CGROUP:I_Com4e	;4e N	NPRN(MIDI Ctrl:0x62)
 10FE  149A R		      C 	dw	offset CGROUP:I_Com4f	;4f O	
 1100  14AA R		      C 	dw	offset CGROUP:I_Com50	;50 P	Mode Sw(WS) / Damper(MIDI)
 1102  14B4 R		      C 	dw	offset CGROUP:I_Com51	;51 Q	Gate time
 1104  14BC R		      C 	dw	offset CGROUP:I_Com52	;52 R	
 1106  14C8 R		      C 	dw	offset CGROUP:I_Com53	;53 S	
 1108  14D8 R		      C 	dw	offset CGROUP:I_Com54	;54 T	Filter(MIDI ctrl:)
 110A  14E4 R		      C 	dw	offset CGROUP:I_Com55	;55 U	Gate time
 110C  14EE R		      C 	dw	offset CGROUP:I_Com56	;56 V	Expression Detune
 110E  14F6 R		      C 	dw	offset CGROUP:I_Com57	;57 W	
 1110  1502 R		      C 	dw	offset CGROUP:I_Com58	;58 X	Excluesiv Send(MIDI:0xF0)
 1112  1514 R		      C 	dw	offset CGROUP:I_Com59	;59 Y	
 1114  1516 R		      C 	dw	offset CGROUP:I_Com5a	;5a Z	Send Data(MIDI)
 1116  152A R		      C 	dw	offset CGROUP:I_Com5b	;5b [	Loop
 1118  153A R		      C 	dw	offset CGROUP:I_Com5c	;5c \	
 111A  153C R		      C 	dw	offset CGROUP:I_Com5d	;5d ]	Loop End
 111C  1552 R		      C 	dw	offset CGROUP:I_Com5e	;5e ^	Lengs add
 111E  1554 R		      C 	dw	offset CGROUP:I_Com5f	;5f _	Key Trance
 1120  155C R		      C 	dw	offset CGROUP:I_Com60	;60 `	
 1122  155E R		      C 	dw	offset CGROUP:I_Com61	;61 a	(MML:La)
 1124  1560 R		      C 	dw	offset CGROUP:I_Com62	;62 b	(MML:Si)
 1126  1562 R		      C 	dw	offset CGROUP:I_Com63	;63 c	(MML:Do)
 1128  1564 R		      C 	dw	offset CGROUP:I_Com64	;64 d	(MML:Re)
 112A  1566 R		      C 	dw	offset CGROUP:I_Com65	;65 e	(MML:Mi)
 112C  1568 R		      C 	dw	offset CGROUP:I_Com66	;66 f	(MML:Fa)
 112E  156A R		      C 	dw	offset CGROUP:I_Com67	;67 g	(MML:So)
 1130  156C R		      C 	dw	offset CGROUP:I_Com68	;68 h	
 1132  156E R		      C 	dw	offset CGROUP:I_Com69	;69 i	
 1134  1570 R		      C 	dw	offset CGROUP:I_Com6a	;6a j	
 1136  1572 R		      C 	dw	offset CGROUP:I_Com6b	;6b k	velocity(MIDI)
 1138  157A R		      C 	dw	offset CGROUP:I_Com6c	;6c l	lengs
 113A  1588 R		      C 	dw	offset CGROUP:I_Com6d	;6d m	LFO
 113C  15BA R		      C 	dw	offset CGROUP:I_Com6e	;6e n	Noise mode
 113E  15CA R		      C 	dw	offset CGROUP:I_Com6f	;6f o	Octave
 1140  15D2 R		      C 	dw	offset CGROUP:I_Com70	;70 p	Pan.
 1142  15DA R		      C 	dw	offset CGROUP:I_Com71	;71 q	Gate time
 1144  15E2 R		      C 	dw	offset CGROUP:I_Com72	;72 r	hol.
 1146  15E4 R		      C 	dw	offset CGROUP:I_Com73	;73 s	Sweep
 1148  1600 R		      C 	dw	offset CGROUP:I_Com74	;74 t	tempo(HBLANK)
 114A  161C R		      C 	dw	offset CGROUP:I_Com75	;75 u	Gate time
 114C  1624 R		      C 	dw	offset CGROUP:I_Com76	;76 v	Volume (WS/MIDI)
 114E  1648 R		      C 	dw	offset CGROUP:I_Com77	;77 w	
 1150  164A R		      C 	dw	offset CGROUP:I_Com78	;78 x		(MML:Hex)
 1152  1652 R		      C 	dw	offset CGROUP:I_Com79	;79 y	
 1154  1662 R		      C 	dw	offset CGROUP:I_Com7a	;7a z	
 1156  1664 R		      C 	dw	offset CGROUP:I_Com7b	;7b {	Auto trance
 1158  1682 R		      C 	dw	offset CGROUP:I_Com7c	;7c |	
 115A  1684 R		      C 	dw	offset CGROUP:I_Com7d	;7d }	
 115C  1686 R		      C 	dw	offset CGROUP:I_Com7e	;7e ~	
 115E  1688 R		      C 	dw	offset CGROUP:I_Com7f	;7f 	
			      C ;===============================================================|
			      C ;		コマンドによる分岐				|
			      C ;			いわゆる、Ｃ言語でいう'switch'文と同等	|
			      C ;===============================================================|
			      C ;	●引数							|
			      C ;		ds:bp	ワークベースアドレス	引数		|
			      C ;		ds:bx	共有構造体アドレス	引数		|
			      C ;		ds:di	個別構造体		引数		|
			      C ;		es:si	演奏アドレス		引数		|
			      C ;		al	音符コマンド（00h〜7Fh）破壊ok		|
			      C ;	●レジスタ使用						|
			      C ;		cx	汎用			破壊ok		|
			      C ;		dx	汎用			破壊ok		|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1160			      C I_PlayCommand	proc	near
			      C 
 1160  53		      C 	push	bx			;
 1161  8B D8		      C 	mov	bx,ax			
 1163  83 E3 7F		      C 	and	bx,007fh		;
 1166  D1 E3		      C 	shl	bx,1			;
 1168  2E: 8B 97 1060 R	      C 	mov	dx,word ptr cs:[I_PlayCommand_JumpTable + bx]
 116D  5B		      C 	pop	bx			;
			      C 
 116E  FF D2		      C 	call	dx			;サブルーチンの呼び出し
			      C 
 1170  81 25 F7FF	      C 	and	ds:[di].WTD_FlagControl,WTD_Ctrl_WorkSwR
			      C 
 1174  C3		      C 	ret				;ワーク・スイッチのリセット
 1175			      C I_PlayCommand	endp			;
			      C ;===============================================================|
			      C ;		NULL						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1176			      C I_Com00:				;
 1176			      C I_Com01:				;
 1176			      C I_Com02:				;
 1176			      C I_Com03:				;
 1176			      C I_Com04:				;
 1176			      C I_Com05:				;
 1176			      C I_Com06:				;
 1176			      C I_Com07:				;
 1176			      C I_Com08:				;
 1176			      C I_Com09:				;
 1176			      C I_Com0a:				;
 1176			      C I_Com0b:				;
 1176			      C I_Com0c:				;
 1176			      C I_Com0d:				;
 1176			      C I_Com0e:				;
 1176			      C I_Com0f:				;
 1176			      C I_Com10:				;
 1176			      C I_Com11:				;
 1176			      C I_Com12:				;
 1176			      C I_Com13:				;
 1176			      C I_Com14:				;
 1176			      C I_Com15:				;
 1176			      C I_Com16:				;
 1176			      C I_Com17:				;
 1176			      C I_Com18:				;
 1176			      C I_Com19:				;
 1176			      C I_Com1a:				;
 1176			      C I_Com1b:				;
 1176			      C I_Com1c:				;
 1176			      C I_Com1d:				;
 1176			      C I_Com1e:				;
 1176			      C I_Com1f:				;
 1176			      C I_Com20:				;
 1176  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Work Switch					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1178			      C I_Com21:				;
 1178  81 0D 0800	      C 	or	ds:[di].WTD_FlagControl,WTD_Ctrl_WorkSw
 117C  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Work Base Address Set				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 117E			      C I_Com22:				;
 117E  E8 FE2D		      C 	call	I_Read8			;
 1181  88 45 52		      C 	mov	ds:[di].WTD_WorkAddress,al
 1184  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		MML:Sharp					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1186			      C I_Com23:				;
 1186  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		MML:Macro					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1188			      C I_Com24:				;
 1188  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		MML:Step					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 118A			      C I_Com25:				;
 118A  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		MML:Tai						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 118C			      C I_Com26:				;
 118C  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Acsent						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 118E			      C I_Com27:				;
 118E  E8 FE1D		      C 	call	I_Read8			;
 1191  88 45 29		      C 	mov	ds:[di].WTD_AcsentVelocity,al
 1194  83 0D 40		      C 	or	ds:[di].WTD_FlagControl,WTD_Ctrl_Acsent
 1197  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Volume down					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1198			      C I_Com28:				;
 1198  8A 45 5A		      C 	mov	al,ds:[di].WTD_VolumeUpDown
 119B  28 45 41		      C 	sub	ds:[di].WTD_Expr,al	;
			      C 	.if	(carry?)		;
 119E  73 04		   *	    jae    @C00F8
 11A0  C6 45 41 00	      C 		mov	ds:[di].WTD_Expr,0
			      C 	.endif				;
 11A4			   *@C00F8:
 11A4  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Volume up					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 11A6			      C I_Com29:				;
 11A6  8A 45 5A		      C 	mov	al,ds:[di].WTD_VolumeUpDown
 11A9  00 45 41		      C 	add	ds:[di].WTD_Expr,al	;
			      C 	.if	(carry?)		;
 11AC  73 04		   *	    jae    @C00FA
 11AE  C6 45 41 7F	      C 		mov	ds:[di].WTD_Expr,127
			      C 	.endif				;
 11B2			   *@C00FA:
 11B2  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		LFO Switch					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 11B4			      C I_Com2a:				;
 11B4  53		      C 	push	bx			;
			      C 
			      C ;	mov	cl,es:[si]		;cl = 0,1,2
			      C ;	inc	si			;
 11B5  26: AC		      C 	lodsb	es:[si]
 11B7  8A C8		      C 	mov	cl,al
 11B9  D0 E1		      C 	shl	cl,1			;cl = 0,2,4 (bit)
			      C 
 11BB  33 C0		      C 	xor	ax,ax			;
 11BD  E8 FDEE		      C 	call	I_Read8			;
 11C0  83 E0 01		      C 	and	ax,00001h		;Bit Mask
 11C3  BB FFFE		      C 	mov	bx,0FFFEh		;Bit Mask
			      C 	.if	(cl!=0)
 11C6  0A C9		   *	    or	cl, cl
 11C8  74 04		   *	    je     @C00FC
 11CA  D3 E0		      C 		shl	ax,cl		;ax = 01h,04h,10h
 11CC  D3 C3		      C 		rol	bx,cl		;
			      C 	.endif
 11CE			   *@C00FC:
			      C 
 11CE  83 E0 15		      C 	and	ax,015h			;Bit Mask
 11D1  21 1D		      C 	and	word ptr ds:[di].WTD_FlagControl,bx
 11D3  09 05		      C 	or	word ptr ds:[di].WTD_FlagControl,ax
			      C 
 11D5  5B		      C 	pop	bx			;
 11D6  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		MML:Sharp					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 11D8			      C I_Com2b:				;
 11D8  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		MML:Channel					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 11DA			      C I_Com2c:				;
 11DA  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		MML:Flat					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 11DC			      C I_Com2d:				;
 11DC  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		MML:Lengs×1.5					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 11DE			      C I_Com2e:				;
 11DE  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Emb. Switch					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 11E0			      C I_Com2f:				;
 11E0  53		      C 	push	bx			;
			      C 
			      C ;	mov	cl,es:[si]		;cl = 0,1,2
			      C ;	inc	si			;
 11E1  26: AC		      C 	lodsb	es:[si]
 11E3  8A C8		      C 	mov	cl,al
 11E5  D0 E1		      C 	shl	cl,1			;cl = 0,2,4 (bit)
 11E7  FE C1		      C 	inc	cl			;cl = 1,3,5 (bit)
			      C 
 11E9  33 C0		      C 	xor	ax,ax			;
 11EB  E8 FDC0		      C 	call	I_Read8			;
 11EE  83 E0 01		      C 	and	ax,00001h		;Bit Mask
 11F1  BB FFFE		      C 	mov	bx,0FFFEh		;Bit Mask
			      C 
			      C 	.if	(cl!=0)
 11F4  0A C9		   *	    or	cl, cl
 11F6  74 04		   *	    je     @C00FE
 11F8  D3 E0		      C 		shl	ax,cl		;al = 02h,08h,20h
 11FA  D3 C3		      C 		rol	bx,cl		;
			      C 	.endif
 11FC			   *@C00FE:
			      C 
 11FC  83 E0 2A		      C 	and	ax,02Ah			;Bit Mask
 11FF  21 1D		      C 	and	ds:[di].WTD_FlagControl,bx
 1201  09 05		      C 	or	ds:[di].WTD_FlagControl,ax
			      C 
 1203  5B		      C 	pop	bx			;
 1204  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Work	mov	LD				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1206			      C I_Com30:				;
 1206  53		      C 	push	bx			;
			      C ;アドレスの取得
 1207  8A 65 52		      C 	mov	ah,ds:[di].WTD_WorkAddress
 120A  E8 FDA1		      C 	call	I_Read8			;
 120D  8B D8		      C 	mov	bx,ax			;bx←アドレス
 120F  E8 FD9C		      C 	call	I_Read8			;al←数値
			      C 
 1212  88 07		      C 	mov	ds:[bx],al		;代入
			      C 
 1214  5B		      C 	pop	bx			;
 1215  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Work	add	ADD				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1216			      C I_Com31:				;
 1216  53		      C 	push	bx			;
			      C ;アドレスの取得
 1217  8A 65 52		      C 	mov	ah,ds:[di].WTD_WorkAddress
 121A  E8 FD91		      C 	call	I_Read8			;
 121D  8B D8		      C 	mov	bx,ax			;bx←アドレス
 121F  E8 FD8C		      C 	call	I_Read8			;al←数値
			      C 
 1222  00 07		      C 	add	ds:[bx],al		;加算
 1224  5B		      C 	pop	bx			;
			      C 
 1225  E9 009A		      C 	jmp	I_Com3x_Flag		;フラグ変化
			      C ;	ret				;
			      C ;===============================================================|
			      C ;		Work	sub	SUB				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1228			      C I_Com32:				;
 1228  53		      C 	push	bx			;
			      C ;アドレスの取得
 1229  8A 65 52		      C 	mov	ah,ds:[di].WTD_WorkAddress
 122C  E8 FD7F		      C 	call	I_Read8			;
 122F  8B D8		      C 	mov	bx,ax			;bx←アドレス
 1231  E8 FD7A		      C 	call	I_Read8			;al←数値
			      C 
 1234  28 07		      C 	sub	ds:[bx],al		;加算
 1236  5B		      C 	pop	bx			;
			      C 
 1237  E9 0088		      C 	jmp	I_Com3x_Flag		;フラグ変化
			      C ;	ret				;
			      C ;===============================================================|
			      C ;		Work	and	AND				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 123A			      C I_Com33:				;
 123A  53		      C 	push	bx			;
			      C ;アドレスの取得
 123B  8A 65 52		      C 	mov	ah,ds:[di].WTD_WorkAddress
 123E  E8 FD6D		      C 	call	I_Read8			;
 1241  8B D8		      C 	mov	bx,ax			;bx←アドレス
 1243  E8 FD68		      C 	call	I_Read8			;al←数値
			      C 
 1246  20 07		      C 	and	ds:[bx],al		;加算
 1248  5B		      C 	pop	bx			;
			      C 
 1249  EB 77		      C 	jmp	I_Com3x_Flag		;フラグ変化
			      C ;	ret				;
			      C ;===============================================================|
			      C ;		Work	or	OR				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 124C			      C I_Com34:				;
 124C  53		      C 	push	bx			;
			      C ;アドレスの取得
 124D  8A 65 52		      C 	mov	ah,ds:[di].WTD_WorkAddress
 1250  E8 FD5B		      C 	call	I_Read8			;
 1253  8B D8		      C 	mov	bx,ax			;bx←アドレス
 1255  E8 FD56		      C 	call	I_Read8			;al←数値
			      C 
 1258  08 07		      C 	or	ds:[bx],al		;加算
 125A  5B		      C 	pop	bx			;
			      C 
 125B  EB 65		      C 	jmp	I_Com3x_Flag		;フラグ変化
			      C ;	ret				;
			      C ;===============================================================|
			      C ;		Work	xor	XOR				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 125E			      C I_Com35:				;
 125E  53		      C 	push	bx			;
			      C ;アドレスの取得
 125F  8A 65 52		      C 	mov	ah,ds:[di].WTD_WorkAddress
 1262  E8 FD49		      C 	call	I_Read8			;
 1265  8B D8		      C 	mov	bx,ax			;bx←アドレス
 1267  E8 FD44		      C 	call	I_Read8			;al←数値
			      C 
 126A  30 07		      C 	xor	ds:[bx],al		;加算
 126C  5B		      C 	pop	bx			;
			      C 
 126D  EB 53		      C 	jmp	I_Com3x_Flag		;フラグ変化
			      C ;	ret				;
			      C ;===============================================================|
			      C ;		Work		SET				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1270			      C I_Com36:				;
 1270  53		      C 	push	bx			;
			      C 
			      C 	;アドレスの取得
 1271  8A 65 52		      C 	mov	ah,ds:[di].WTD_WorkAddress
 1274  E8 FD37		      C 	call	I_Read8			;
 1277  8B D8		      C 	mov	bx,ax			;bx←アドレス
 1279  E8 FD32		      C 	call	I_Read8			;al←数値
			      C 
 127C  8A C8		      C 	mov	cl,al			;
 127E  B0 01		      C 	mov	al,001h			;
 1280  D2 E0		      C 	shl	al,cl			;
			      C 
 1282  08 07		      C 	or	ds:[bx],al		;ビットセット
			      C 
 1284  5B		      C 	pop	bx			;
 1285  EB 3B		      C 	jmp	I_Com3x_Flag		;フラグ変化
			      C ;	ret				;
			      C ;===============================================================|
			      C ;		Work		RES				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1288			      C I_Com37:				;
 1288  53		      C 	push	bx			;
			      C 
			      C 	;アドレスの取得
 1289  8A 65 52		      C 	mov	ah,ds:[di].WTD_WorkAddress
 128C  E8 FD1F		      C 	call	I_Read8			;
 128F  8B D8		      C 	mov	bx,ax			;bx←アドレス
 1291  E8 FD1A		      C 	call	I_Read8			;al←数値
			      C 
 1294  8A C8		      C 	mov	cl,al			;
 1296  B0 FE		      C 	mov	al,0FEh			;
 1298  D2 C0		      C 	rol	al,cl			;
			      C 
 129A  20 07		      C 	and	ds:[bx],al		;ビットリセット
			      C 
 129C  5B		      C 	pop	bx			;
 129D  EB 23		      C 	jmp	I_Com3x_Flag		;フラグ変化
			      C ;	ret				;
			      C ;===============================================================|
			      C ;		Work	cmp	CP				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 12A0			      C I_Com38:				;
 12A0  53		      C 	push	bx			;
			      C ;アドレスの取得
 12A1  8A 65 52		      C 	mov	ah,ds:[di].WTD_WorkAddress
 12A4  E8 FD07		      C 	call	I_Read8			;
 12A7  8B D8		      C 	mov	bx,ax			;bx←アドレス
 12A9  E8 FD02		      C 	call	I_Read8			;al←数値
			      C 
 12AC  38 07		      C 	cmp	ds:[bx],al		;加算
 12AE  5B		      C 	pop	bx			;
			      C 
 12AF  EB 11		      C 	jmp	I_Com3x_Flag		;フラグ変化
			      C ;	ret				;
			      C ;===============================================================|
			      C ;		work	test					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 12B2			      C I_Com39:				;
 12B2  53		      C 	push	bx			;
			      C ;アドレスの取得
 12B3  8A 65 52		      C 	mov	ah,ds:[di].WTD_WorkAddress
 12B6  E8 FCF5		      C 	call	I_Read8			;
 12B9  8B D8		      C 	mov	bx,ax			;bx←アドレス
 12BB  E8 FCF0		      C 	call	I_Read8			;al←数値
			      C 
 12BE  84 07		      C 	test	ds:[bx],al		;加算
 12C0  5B		      C 	pop	bx			;
			      C 
			      C ;	jmp	I_Com3x_Flag		;フラグ変化
			      C ;	ret				;
			      C ;===============================================================|
			      C ;		Work	フラグ変化				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 12C2			      C I_Com3x_Flag:
			      C 
			      C 	;キャリーフラグ
 12C2  9C		      C 	pushf				;レジスタ保存
			      C 	.if	(carry?)
 12C3  73 06		   *	    jae    @C0100
 12C5  81 0D 1000	      C 		or	ds:[di].WTD_FlagControl,WTD_Ctrl_WorkCy
			      C 	.else
 12C9  EB 04		   *	    jmp    @C0102
 12CB			   *@C0100:
 12CB  81 25 EFFF	      C 		and	ds:[di].WTD_FlagControl,WTD_Ctrl_WorkCyR
			      C 	.endif
 12CF			   *@C0102:
 12CF  9D		      C 	popf				;レジスタ復帰
			      C 
			      C 	;ゼローフラグ
 12D0  9C		      C 	pushf				;レジスタ保存
			      C 	.if	(zero?)
 12D1  75 06		   *	    jne    @C0103
 12D3  81 0D 2000	      C 		or	ds:[di].WTD_FlagControl,WTD_Ctrl_WorkZe
			      C 	.else
 12D7  EB 04		   *	    jmp    @C0105
 12D9			   *@C0103:
 12D9  81 25 DFFF	      C 		and	ds:[di].WTD_FlagControl,WTD_Ctrl_WorkZeR
			      C 	.endif
 12DD			   *@C0105:
 12DD  9D		      C 	popf				;レジスタ復帰
			      C 
 12DE  C3		      C 	ret
			      C ;===============================================================|
			      C ;		Loop Jump					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 12E0			      C I_Com3a:				;
 12E0  53		      C 	push	bx			;
			      C 
			      C 	;読み込み
 12E1  26: AD		      C 	lodsw	es:[si]
			      C 
			      C 	;カウンタ・読み込み
 12E3  33 DB		      C 	xor	bx,bx			;
 12E5  8A 5D 10		      C 	mov	bl,ds:[di].WTD_LoopCountPointer
			      C 
			      C 	;チェック
			      C 	.if	(ds:[di + bx].WTD_LoopCount==1)
 12E8  80 79 08 01	   *	    cmp    ds : [di + bx] . WTD_LoopCount, 001h
 12EC  75 05		   *	    jne    @C0106
 12EE  FE 4D 10		      C 		dec	ds:[di].WTD_LoopCountPointer
 12F1  8B F0		      C 		mov	si,ax		;
			      C 	.endif
 12F3			   *@C0106:
			      C 
 12F3  5B		      C 	pop	bx			;
 12F4  C3		      C 	ret				;終了
			      C ;===============================================================|
			      C ;		Loop Jump Flags					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 12F6			      C I_Com3b:				;
 12F6  8B 05		      C 	mov	ax,ds:[di].WTD_FlagControl
 12F8  25 3000		      C 	and	ax,WTD_Ctrl_WorkCy + WTD_Ctrl_WorkZe
 12FB  C1 E8 04		      C 	shr	ax,4			;
 12FE  E8 FCAD		      C 	call	I_Read8			;dh←WTD内部のフラグ
 1301  8B D0		      C 	mov	dx,ax			;dl←曲データ中のフラグ
			      C 
 1303  26: AD		      C 	lodsw	es:[si]			;ax←ループ先
			      C 
			      C 	;チェック
			      C 	.if	(dl==dh)
 1305  38 F2		   *	    cmp    dl, dh
 1307  75 05		   *	    jne    @C0108
 1309  FE 4D 10		      C 		dec	ds:[di].WTD_LoopCountPointer
 130C  8B F0		      C 		mov	si,ax		;ループ抜け
			      C 	.endif
 130E			   *@C0108:
			      C 
 130E  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Octave down					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1310			      C I_Com3c:				;
 1310  FE 4D 54		      C 	dec	ds:[di].WTD_Octave	;
 1313  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		MML:Natural					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1314			      C I_Com3d:				;
 1314  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Octave up					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1316			      C I_Com3e:				;
 1316  FE 45 54		      C 	inc	ds:[di].WTD_Octave	;
 1319  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		NULL '?'					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 131A			      C I_Com3f:				;
 131A  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Voice / Program					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 131C			      C I_Com40:				;
 131C  E8 FC8F		      C 	call	I_Read8			;音色拡張子はあるか？
 131F  D0 C0		      C 	rol	al,1			;
 1321  D0 E8		      C 	shr	al,1			;Bit 7 Reset & Bit 7 -> Cy Flag
			      C 
			      C 	.if	(!carry?)
 1323  72 0B		   *	    jb     @C010A
 1325			      C I_Com40_1st:
 1325  88 45 74		      C 		mov	ds:[di].WTD_Program1st,al
 1328  BA 1804 R	      C 		mov	dx,offset CGROUP:I_Table_Voice
 132B  E9 035C		      C 		jmp	I_Table_Jump
			      C 	.else
 132E  EB 2D		   *	    jmp    @C010C
 1330			   *@C010A:
 1330  8A E0		      C 		mov	ah,al		;
 1332  E8 FC79		      C 		call	I_Read8		;
			      C 		.if	(ah==01h)
 1335  80 FC 01		   *	    cmp    ah, 001h
 1338  75 0B		   *	    jne    @C010D
 133A  88 45 75		      C 			mov	ds:[di].WTD_Program2nd,al
 133D  E8 FC80		      C 			call	I_Read16
 1340  89 45 72		      C 			mov	ds:[di].WTD_ProgramRate,ax
			      C 		.elseif	(ah==03h)
 1343  EB 18		   *	    jmp    @C010F
 1345			   *@C010D:
 1345  80 FC 03		   *	    cmp    ah, 003h
 1348  75 0B		   *	    jne    @C0110
 134A  88 45 77		      C 			mov	ds:[di].WTD_ProgramDecay,al
 134D  E8 FC70		      C 			call	I_Read16
 1350  89 45 78		      C 			mov	ds:[di].WTD_ProgramDecayRate,ax
			      C 		.else
 1353  EB 08		   *	    jmp    @C0112
 1355			   *@C0110:
 1355  80 FC 02		      C 			cmp	ah,02h
 1358  75 CB		      C 			jnz	I_Com40_1st
 135A  88 45 76		      C 			mov	ds:[di].WTD_Program3rd,al
			      C ;		.else	;(ah==00h)	デフォルト
			      C ;			jmp	I_Com40_1st
			      C 		.endif
			      C 	.endif
 135D			   *@C0112:
 135D			   *@C010F:
 135D			   *@C010C:
			      C 
 135D  8A 45 75		      C 	mov	al,ds:[di].WTD_Program2nd	;'@'コマンド必要性の確認
 1360  22 45 76		      C 	and	al,ds:[di].WTD_Program3rd	;第2,3パラメータの指定が無かったら、戻す。
			      C 	.if	(al&080h)
 1363  A8 80		   *	    test   al, 080h
 1365  74 0B		   *	    je     @C0113
 1367  8A 45 74		      C 		mov	al,ds:[di].WTD_Program1st	;
 136A  24 7F		      C 		and	al,07fh				;上位bitのマスク
 136C  BA 1804 R	      C 		mov	dx,offset CGROUP:I_Table_Voice	;
 136F  E8 0318		      C 		call	I_Table_Jump			;
			      C 	.endif
 1372			   *@C0113:
			      C 
 1372  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		NULL 'A'					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1374			      C I_Com41:				;
 1374  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Bend & Bend Range(MIDI)				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1376			      C I_Com42:				;
 1376  E8 FC47		      C 	call	I_Read16		;
 1379  D1 C0		      C 	rol	ax,1			;
 137B  D1 E8		      C 	shr	ax,1			;Bit 7 Reset & Bit 7 -> Cy Flag
 137D  89 45 2C		      C 	mov	ds:[di].WTD_Bend,ax	;
			      C 	.if	(carry?)
 1380  73 1F		   *	    jae    @C0115
			      C 
			      C ifndef	hyoka	;------------------------廉価版は無し
 1382  B0 00		      C 	mov	al,00h			;
 1384  B1 64		      C 	mov	cl,MIDI_Ctrl_RegLSB	;
 1386  BA 189E R	      C 	mov	dx,offset CGROUP:I_Table_CtrlChgB
 1389  E8 02FE		      C 	call	I_Table_Jump		;
			      C 
 138C  B0 00		      C 	mov	al,00h			;
 138E  B1 65		      C 	mov	cl,MIDI_Ctrl_RegMSB	;
 1390  BA 189E R	      C 	mov	dx,offset CGROUP:I_Table_CtrlChgB
 1393  E8 02F4		      C 	call	I_Table_Jump		;
			      C endif	;--------------------------------
			      C 
 1396  E8 FC15		      C 	call	I_Read8			;
			      C 
			      C ifndef	hyoka	;------------------------廉価版は無し
 1399  B1 06		      C 	mov	cl,MIDI_Ctrl_DataEntly	;
 139B  BA 189E R	      C 	mov	dx,offset CGROUP:I_Table_CtrlChgB
 139E  E9 02E9		      C 	jmp	I_Table_Jump		;※call → jmp
			      C endif	;--------------------------------
			      C 
			      C 	.endif
 13A1			   *@C0115:
 13A1  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Track / Sound Type				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 13A2			      C I_Com43:				;
 13A2  E8 FC09		      C 	call	I_Read8			;
 13A5  88 45 05		      C 	mov	ds:[di].WTD_Channel,al	;
			      C 
			      C 	;効果音？
			      C 	.if	(ds:[di].WTD_FlagControl&WTD_Ctrl_Effect)
 13A8  F7 05 4000	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_Effect
 13AC  74 0D		   *	    je     @C0117
 13AE  24 07		      C 		and	al,07h		;
 13B0  8A C8		      C 		mov	cl,al		;
 13B2  FE C1		      C 		inc	cl		;
 13B4  B8 0800		      C 		mov	ax,0800h	;
 13B7  D3 E0		      C 		shl	ax,cl		;
 13B9  09 07		      C 		or	ds:[bx].WTD_Sys_Flag,ax
			      C 	.endif
 13BB			   *@C0117:
			      C 
 13BB  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Frection Detune					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 13BC			      C I_Com44:				;
 13BC  E8 FC01		      C 	call	I_Read16		;
 13BF  89 45 2E		      C 	mov	ds:[di].WTD_BendDetune,ax
 13C2  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Emblop						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 13C4			      C I_Com45:				;
 13C4  53		      C 	push	bx			;
			      C 
 13C5  26: AC		      C 	lodsb	es:[si]
			      C 
			      C 
 13C7  50		      C 	push	ax			;保存
 13C8  33 C0		      C 	xor	ax,ax			;
 13CA  E8 FBE1		      C 	call	I_Read8			;ax←エンベロープ番号
 13CD  83 E0 1F		      C 	and	ax,001fh		;
 13D0  C1 E0 04		      C 	shl	ax,4			;ax←ax×16
 13D3  5B		      C 	pop	bx			;復帰
			      C 
 13D4  8A FC		      C 	mov	bh,ah			;bh←上位ビット
			      C 
			      C 	.if	(bl==0)		;音程
 13D6  0A DB		   *	    or	bl, bl
 13D8  75 12		   *	    jne    @C0119
 13DA  80 65 39 0F	      C 		and	ds:[di].WTD_BendEmbAddress,00fh	;
 13DE  08 45 39		      C 		or	ds:[di].WTD_BendEmbAddress,al	;
			      C 
			      C ;		mov	ax,ds:[di].WTD_FlagControl	;
 13E1  D1 EB		      C 		shr	bx,1				;bx bit 7  =  No. bit 5
 13E3  81 E3 0080	      C 		and	bx,WTD_Ctrl_EmbFreq		;
 13E7  B8 FF7F		      C 		mov	ax,WTD_Ctrl_EmbFreqR		;
			      C ;		or	ax,bx				;
			      C ;		mov	ds:[di].WTD_FlagControl,ax
			      C 
			      C 	.elseif	(bl==1)		;音量
 13EA  EB 2A		   *	    jmp    @C011B
 13EC			   *@C0119:
 13EC  80 FB 01		   *	    cmp    bl, 001h
 13EF  75 10		   *	    jne    @C011C
 13F1  80 65 4D 0F	      C 		and	ds:[di].WTD_ExprEmbAddress,00fh	;
 13F5  08 45 4D		      C 		or	ds:[di].WTD_ExprEmbAddress,al	;
			      C 
			      C ;		mov	ax,ds:[di].WTD_FlagControl	;bx bit 8  =  No. bit 5
 13F8  81 E3 0100	      C 		and	bx,WTD_Ctrl_EmbVol		;
 13FC  B8 FEFF		      C 		mov	ax,WTD_Ctrl_EmbVolR		;
			      C ;		or	ax,bx				;
			      C ;		mov	ds:[di].WTD_FlagControl,ax
			      C 
			      C 	.elseif	(bl==2)		;パン
 13FF  EB 15		   *	    jmp    @C011E
 1401			   *@C011C:
 1401  80 FB 02		   *	    cmp    bl, 002h
 1404  75 10		   *	    jne    @C011F
 1406  80 65 6D 0F	      C 		and	ds:[di].WTD_PanEmbAddress,00fh	;
 140A  08 45 6D		      C 		or	ds:[di].WTD_PanEmbAddress,al	;
			      C 
			      C ;		mov	ax,ds:[di].WTD_FlagControl	;
 140D  D1 E3		      C 		shl	bx,1				;bx bit 9  =  No. bit 5
 140F  81 E3 0200	      C 		and	bx,WTD_Ctrl_EmbPan		;
 1413  B8 FDFF		      C 		mov	ax,WTD_Ctrl_EmbPanR		;
			      C ;		or	ax,bx				;
			      C ;		mov	ds:[di].WTD_FlagControl,ax
			      C 	.endif
 1416			   *@C011F:
 1416			   *@C011E:
 1416			   *@C011B:
			      C 
 1416  21 05		      C 	and	ds:[di].WTD_FlagControl,ax
 1418  09 1D		      C 	or	ds:[di].WTD_FlagControl,bx
			      C 
 141A			      C I_Com45_End:				;
 141A  5B		      C 	pop	bx			;
 141B  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Volume(MIDI ctrl:0x07)				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 141C			      C I_Com46:				;
 141C  E8 FB8F		      C 	call	I_Read8			;
			      C 
			      C ifndef	hyoka	;------------------------廉価版は無し
 141F  B1 07		      C 	mov	cl,MIDI_Ctrl_Volume	;
 1421  BA 189E R	      C 	mov	dx,offset CGROUP:I_Table_CtrlChgB
 1424  E9 0263		      C 	jmp	I_Table_Jump		;※call → jmp
			      C endif	;--------------------------------
			      C 
 1427  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Channel Pressior(MIDI)				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1428			      C I_Com47:				;
 1428  E8 FB83		      C 	call	I_Read8			;
 142B  BA 1894 R	      C 	mov	dx,offset CGROUP:I_Table_PolyChPress
 142E  E9 0259		      C 	jmp	I_Table_Jump		;
			      C ;	ret				;
			      C ;===============================================================|
			      C ;		Program Bank Select(MIDI)			|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1432			      C I_Com48:				;
 1432  E8 FB8B		      C 	call	I_Read16		;
			      C 
			      C ifndef	hyoka	;------------------------廉価版は無し
 1435  B1 00		      C 	mov	cl,MIDI_Ctrl_Bank	;
 1437  BA 18B4 R	      C 	mov	dx,offset CGROUP:I_Table_CtrlChgW
 143A  E9 024D		      C 	jmp	I_Table_Jump		;※call → jmp
			      C endif	;--------------------------------
			      C 
 143D  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		NULL 'I'					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 143E			      C I_Com49:				;
 143E  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		NULL 'J'					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1440			      C I_Com4a:				;
 1440  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Key on  Delay					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1442			      C I_Com4b:				;
 1442  E8 FB7B		      C 	call	I_Read16		;
 1445  89 45 1C		      C 	mov	ds:[di].WTD_KeyOnDelay,ax
 1448  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Loop	'L'					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 144A			      C I_Com4c:				;
 144A  26: AD		      C 	lodsw	es:[si]
			      C 
			      C 	;無限ループ	（こっちの方が、高頻度）
			      C 	.if	(ax==0)
 144C  0B C0		   *	    or	ax, ax
 144E  75 17		   *	    jne    @C0121
 1450  81 0D 8000	      C 		or	ds:[di].WTD_FlagControl,WTD_Ctrl_PlayEnd
 1454  8A 6D 05		      C 		mov	ch,byte ptr ds:[di].WTD_Channel
			      C 
			      C 		.if	((ds:[di].WTD_FlagControl&WTD_Ctrl_Effect) && (ch>=80h))
 1457  F7 05 4000	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_Effect
 145B  74 0C		   *	    je     @C0123
 145D  80 FD 80		   *	    cmp    ch, 080h
 1460  72 07		   *	    jb     @C0123
 1462  E9 FAB3		      C 			jmp	I_Effect_Return	;効果音からの復帰	※call → jmp
			      C 		.endif
			      C 	;演奏終了
			      C 	.else
 1465  EB 02		   *	    jmp    @C0126
 1467			   *@C0121:
 1467  8B F0		      C 		mov	si,ax		;ループ
			      C 	.endif
 1469			   *@C0126:
 1469			   *@C0123:
 1469  C3		      C 	ret				;
			      C 
			      C ;===============================================================|
			      C ;		Modration(MIDI ctrl:0x??)			|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 146A			      C I_Com4d:				;
 146A  E8 FB53		      C 	call	I_Read16		;
 146D  89 45 5B		      C 	mov	ds:[di].WTD_ModDecay,ax	;
 1470  E8 FB3B		      C 	call	I_Read8			;
 1473  88 45 5D		      C 	mov	ds:[di].WTD_ModLevel,al	;
			      C 
			      C ;ifndef	hyoka	;------------------------廉価版は無し
			      C ;	mov	cl,MIDI_Ctrl_Mod	;
			      C ;	mov	dx,offset CGROUP:I_Table_CtrlChgB
			      C ;	jmp	I_Table_Jump		;※call → jmp
			      C ;endif	;--------------------------------
			      C 
 1476  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		NPRN(MIDI)					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1478			      C I_Com4e:				;
 1478  E8 FB33		      C 	call	I_Read8			;
			      C 
			      C ifndef	hyoka	;------------------------廉価版は無し
 147B  B1 62		      C 	mov	cl,MIDI_Ctrl_NonRegLSB	;
 147D  BA 189E R	      C 	mov	dx,offset CGROUP:I_Table_CtrlChgB
 1480  E8 0207		      C 	call	I_Table_Jump		;
			      C endif	;--------------------------------
			      C 
 1483  E8 FB28		      C 	call	I_Read8			;
			      C 
			      C ifndef	hyoka	;------------------------廉価版は無し
 1486  B1 63		      C 	mov	cl,MIDI_Ctrl_NonRegMSB	;
 1488  BA 189E R	      C 	mov	dx,offset CGROUP:I_Table_CtrlChgB
 148B  E8 01FC		      C 	call	I_Table_Jump		;
			      C endif	;--------------------------------
			      C 
 148E  E8 FB1D		      C 	call	I_Read8			;
			      C 
			      C ifndef	hyoka	;------------------------廉価版は無し
 1491  B1 06		      C 	mov	cl,MIDI_Ctrl_DataEntly	;
 1493  BA 189E R	      C 	mov	dx,offset CGROUP:I_Table_CtrlChgB
 1496  E9 01F1		      C 	jmp	I_Table_Jump		;※call → jmp
			      C endif	;--------------------------------
			      C 
 1499  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		ソヌーテート					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 149A			      C I_Com4f:				;
 149A  E8 FB11		      C 	call	I_Read8			;
 149D  C0 E0 06		      C 	shl	al,6			;
			      C 
			      C ifndef	hyoka	;------------------------廉価版は無し
 14A0  B1 42		      C 	mov	cl,MIDI_Ctrl_S		;
 14A2  BA 189E R	      C 	mov	dx,offset CGROUP:I_Table_CtrlChgB
 14A5  E9 01E2		      C 	jmp	I_Table_Jump		;※call → jmp
			      C endif	;--------------------------------
			      C 
 14A8  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		PCM Mode / MIDI Damper				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 14AA			      C I_Com50:				;
 14AA  E8 FB01		      C 	call	I_Read8			;
 14AD  BA 18CA R	      C 	mov	dx,offset CGROUP:I_Table_Mode
 14B0  E9 01D7		      C 	jmp	I_Table_Jump		;設定
			      C ;	ret				;終了
			      C ;===============================================================|
			      C ;		Gate time 'Q'					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 14B4			      C I_Com51:				;
 14B4  E8 FAF7		      C 	call	I_Read8			;
 14B7  88 45 55		      C 	mov	ds:[di].WTD_GateTime8,al
 14BA  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Bress						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 14BC			      C I_Com52:				;
 14BC  E8 FAEF		      C 	call	I_Read8			;
			      C 
			      C ifndef	hyoka	;------------------------廉価版は無し
 14BF  B1 02		      C 	mov	cl,MIDI_Ctrl_Bress	;
 14C1  BA 189E R	      C 	mov	dx,offset CGROUP:I_Table_CtrlChgB
 14C4  E9 01C3		      C 	jmp	I_Table_Jump		;※call → jmp
			      C endif	;--------------------------------
			      C 
 14C7  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Soft						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 14C8			      C I_Com53:				;
 14C8  E8 FAE3		      C 	call	I_Read8			;
 14CB  C0 E0 06		      C 	shl	al,6			;
			      C 
			      C ifndef	hyoka	;------------------------廉価版は無し
 14CE  B1 43		      C 	mov	cl,MIDI_Ctrl_Soft	;
 14D0  BA 189E R	      C 	mov	dx,offset CGROUP:I_Table_CtrlChgB
 14D3  E9 01B4		      C 	jmp	I_Table_Jump		;※call → jmp
			      C endif	;--------------------------------
			      C 
 14D6  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Foot						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 14D8			      C I_Com54:				;
 14D8  E8 FAD3		      C 	call	I_Read8			;
			      C 
			      C ifndef	hyoka	;------------------------廉価版は無し
 14DB  B1 04		      C 	mov	cl,MIDI_Ctrl_Foot	;
 14DD  BA 189E R	      C 	mov	dx,offset CGROUP:I_Table_CtrlChgB
 14E0  E9 01A7		      C 	jmp	I_Table_Jump		;※call → jmp
			      C endif	;--------------------------------
			      C 
 14E3  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Gate Time(U)					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 14E4			      C I_Com55:				;
 14E4  E8 FAC7		      C 	call	I_Read8			;
 14E7  0C 80		      C 	or	al,080h			;
 14E9  88 45 55		      C 	mov	ds:[di].WTD_GateTime8,al
 14EC  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Expression Detune				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 14EE			      C I_Com56:				;
 14EE  E8 FACF		      C 	call	I_Read16		;
 14F1  89 45 42		      C 	mov	ds:[di].WTD_ExprDetune,ax
 14F4  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Balance						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 14F6			      C I_Com57:				;
 14F6  E8 FAB5		      C 	call	I_Read8			;
			      C 
			      C ifndef	hyoka	;------------------------廉価版は無し
 14F9  B1 08		      C 	mov	cl,MIDI_Ctrl_Blance	;
 14FB  BA 189E R	      C 	mov	dx,offset CGROUP:I_Table_CtrlChgB
 14FE  E9 0189		      C 	jmp	I_Table_Jump		;※call → jmp
			      C endif	;--------------------------------
			      C 
 1501  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Excluesiv Send(MIDI)				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1502			      C I_Com58:				;
 1502  1E		      C 	push	ds			;
			      C 
 1503			      C I_Com58_Step1:				;
 1503  26: AC		      C 	lodsb	es:[si]
			      C 
			      C ifndef	hyoka
 1505  E8 06EC		      C 	call	C_Send			;送信
			      C endif
			      C 
 1508  3C F7		      C 	cmp	al,0f7h			;0xF7だったら終わり。
 150A  75 F7		      C 	jnz	I_Com58_Step1		;
			      C 
			      C 	;ランニングステータスの初期化
 150C  3E: C6 86 03B0 00      C 	mov	ds:[bp].WTD_WorkAdd_System+WTD_Sys_RunningStatus,0
			      C 
 1512  1F		      C 	pop	ds			;
 1513  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		NULL 'Y'					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1514			      C I_Com59:				;
 1514  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		MIDI Send Data(MIDI)				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1516			      C I_Com5a:				;
			      C 
			      C ;	xor	cx,cx
			      C ;	mov	cl,es:[si]		;
			      C ;	inc	si			;
 1516  33 C0		      C 	xor	ax,ax
 1518  26: AC		      C 	lodsb	es:[si]
 151A  8B C8		      C 	mov	cx,ax
			      C 
			      C 	.repeat
 151C			   *@C0127:
 151C  26: AC		      C 		lodsb	es:[si]
			      C ifndef	hyoka
 151E  E8 06D3		      C 		call	C_Send		;送信
			      C endif
			      C 	.untilcxz
 1521  E2 F9		   *	    loop   @C0127
			      C 
			      C 	;ランニングステータスの初期化
 1523  3E: C6 86 03B0 00      C 	mov	ds:[bp].WTD_WorkAdd_System+WTD_Sys_RunningStatus,0
			      C 
 1529  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Loop Start					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 152A			      C I_Com5b:				;
			      C 
			      C 	;読み込み
 152A  26: AC		      C 	lodsb	es:[si]
			      C 
			      C 	;設定
 152C  FE 45 10		      C 	inc	ds:[di].WTD_LoopCountPointer
			      C 
			      C 	;カウンタ書き込み
 152F  53		      C 	push	bx			;
 1530  33 DB		      C 	xor	bx,bx			;
 1532  8A 5D 10		      C 	mov	bl,ds:[di].WTD_LoopCountPointer
 1535  88 41 08		      C 	mov	ds:[di + bx].WTD_LoopCount,al
 1538  5B		      C 	pop	bx			;
			      C 
			      C 	;終了
 1539  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		NULL '\'					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 153A			      C I_Com5c:				;
 153A  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Loop End					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 153C			      C I_Com5d:				;
			      C 
			      C 	;読み込み
			      C ;	mov	dx,es:[si]		;
			      C ;	inc	si			;
			      C ;	inc	si			;
 153C  26: AD		      C 	lodsw	es:[si]
			      C 
			      C 	;カウンタ・ディクリメント
 153E  53		      C 	push	bx			;
 153F  33 DB		      C 	xor	bx,bx			;
 1541  8A 5D 10		      C 	mov	bl,ds:[di].WTD_LoopCountPointer
 1544  FE 49 08		      C 	dec	ds:[di + bx].WTD_LoopCount	;Zeは立つ Cy変化無し
 1547  5B		      C 	pop	bx			;
			      C 	.if	(zero?)
 1548  75 05		   *	    jne    @C0128
 154A  FE 4D 10		      C 		dec	ds:[di].WTD_LoopCountPointer
			      C 	.else
 154D  EB 02		   *	    jmp    @C012A
 154F			   *@C0128:
 154F  8B F0		      C 		mov	si,ax		;
			      C 	.endif
 1551			   *@C012A:
			      C 
 1551  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Tai (add lengs)					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1552			      C I_Com5e:				;
 1552  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Key Trance					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1554			      C I_Com5f:				;
 1554  E8 FA57		      C 	call	I_Read8			;
 1557  88 45 1E		      C 	mov	ds:[di].WTD_KeyShift,al	;
 155A  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		NULL '`'					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 155C			      C I_Com60:				;
 155C  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		MML:a						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 155E			      C I_Com61:				;
 155E  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		MML:b						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1560			      C I_Com62:				;
 1560  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		MML:c						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1562			      C I_Com63:				;
 1562  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		MML:d						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1564			      C I_Com64:				;
 1564  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		MML:e						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1566			      C I_Com65:				;
 1566  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		MML:f						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1568			      C I_Com66:				;
 1568  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		MML:g						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 156A			      C I_Com67:				;
 156A  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		NULL 'h'					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 156C			      C I_Com68:				;
 156C  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		NULL 'i'					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 156E			      C I_Com69:				;
 156E  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		NULL 'j'					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1570			      C I_Com6a:				;
 1570  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Velocity(MIDI)					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1572			      C I_Com6b:				;
 1572  E8 FA39		      C 	call	I_Read8			;
 1575  88 45 3F		      C 	mov	ds:[di].WTD_Velocity,al	;
 1578  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		lengs						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 157A			      C I_Com6c:				;
 157A  33 C0		      C 	xor	ax,ax			;
 157C  26: AC		      C 	lodsb	es:[si]
			      C 	.if	(al==0FFh)
 157E  3C FF		   *	    cmp    al, 0FFh
 1580  75 02		   *	    jne    @C012B
 1582  26: AD		      C 		lodsw	es:[si]
			      C 	.endif
 1584			   *@C012B:
 1584  89 45 18		      C 	mov	ds:[di].WTD_LengDefault,ax
 1587  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		LFO						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1588			      C I_Com6d:				;
 1588  53		      C 	push	bx			;
			      C 
 1589  26: AC		      C 	lodsb	es:[si]
			      C 
			      C 	.if	(al==0)
 158B  0A C0		   *	    or	al, al
 158D  75 05		   *	    jne    @C012D
 158F  8D 5D 30		      C 		lea	bx,[di + WTD_BendLFO]
			      C 	.elseif	(al==2)
 1592  EB 0C		   *	    jmp    @C012F
 1594			   *@C012D:
 1594  3C 02		   *	    cmp    al, 002h
 1596  75 05		   *	    jne    @C0130
 1598  8D 5D 64		      C 		lea	bx,[di + WTD_PanLFO]
			      C 	.else	;(al==1)	デフォルトはEPにしておく
 159B  EB 03		   *	    jmp    @C0132
 159D			   *@C0130:
 159D  8D 5D 44		      C 		lea	bx,[di + WTD_ExprLFO]
			      C 	.endif
 15A0			   *@C0132:
 15A0			   *@C012F:
			      C 
 15A0  E8 FA0B		      C 	call	I_Read8			;DR
 15A3  88 07		      C 	mov	ds:[bx].WTD_ChLfo_DecayRate,al
			      C 
 15A5  E8 FA06		      C 	call	I_Read8			;SR
 15A8  88 47 01		      C 	mov	ds:[bx].WTD_ChLfo_SpeedRate,al
			      C 
 15AB  E8 FA12		      C 	call	I_Read16		;Lv
 15AE  89 47 02		      C 	mov	ds:[bx].WTD_ChLfo_Level,ax
			      C 
 15B1  E8 F9FA		      C 	call	I_Read8			;Cnt
 15B4  88 47 04		      C 	mov	ds:[bx].WTD_ChLfo_Count,al
			      C 
 15B7  5B		      C 	pop	bx			;
 15B8  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Noise mode					|
			      C ;---------------------------------------------------------------|
			      C ;	0x00〜0x07	Set the noise mode 			|
			      C ;	(0〜7)		bit 0-2 : Noise mode (0〜7)		|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 15BA			      C I_Com6e:				;
 15BA  E8 F9F1		      C 	call	I_Read8			;al ← 引数
			      C 
 15BD  88 45 12		      C 	mov	ds:[di].WTD_NoiseMode,al
 15C0  0C 18		      C 	or	al,18h			;
 15C2  B4 1F		      C 	mov	ah,1fh			;
 15C4  B5 03		      C 	mov	ch, 3			;
 15C6  E9 044B		      C 	jmp	SP_Set_Noise		;※call → jmp
			      C 
 15C9  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Octave						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 15CA			      C I_Com6f:				;
 15CA  E8 F9E1		      C 	call	I_Read8			;
 15CD  88 45 54		      C 	mov	ds:[di].WTD_Octave,al	;
 15D0  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Panpot						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 15D2			      C I_Com70:				;
 15D2  E8 F9D9		      C 	call	I_Read8			;
 15D5  88 45 61		      C 	mov	ds:[di].WTD_Pan,al	;
 15D8  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Gate time 'q'					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 15DA			      C I_Com71:				;
 15DA  E8 F9E3		      C 	call	I_Read16		;
 15DD  89 45 56		      C 	mov	ds:[di].WTD_GateTimeStepLast,ax
 15E0  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		mml:r						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 15E2			      C I_Com72:				;
 15E2  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Sweep 						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 15E4			      C I_Com73:				;
 15E4  E8 F9C7		      C 	call	I_Read8			;
 15E7  8A E0		      C 	mov	ah,al			;
 15E9  E8 F9C2		      C 	call	I_Read8			;
 15EC  86 C4		      C 	xchg	al,ah			;
			      C 
			      C 	;PCM Ch2であるか？
			      C 	.if	(ds:[di].WTD_Channel==82h)
 15EE  80 7D 05 82	   *	    cmp    ds : [di] . WTD_Channel, 082h
 15F2  75 0B		   *	    jne    @C0133
 15F4  88 45 12		      C 		mov	ds:[di].WTD_SweepLevel,al
 15F7  88 65 13		      C 		mov	ds:[di].WTD_SweepTime,ah
 15FA  B5 02		      C 		mov	ch, 2		;
 15FC  E9 03F3		      C 		jmp	SP_Set_Sweep	;Sweep Modeの設定	※call → jmp
			      C 	.endif
 15FF			   *@C0133:
 15FF  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		tempo						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1600			      C I_Com74:				;
 1600  E8 F9BD		      C 	call	I_Read16		;データは読む。
			      C 
			      C 	;効果音の場合、処理無し。
			      C 	.if	!(ds:[di].WTD_FlagControl&WTD_Ctrl_Effect)
 1603  F7 05 4000	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_Effect
 1607  75 11		   *	    jne    @C0135
 1609  3E: 89 86 03A4	      C 		mov	ds:[bp].WTD_WorkAdd_System+WTD_Sys_Tempo,ax
			      C 		.if	!((ds:[bp].WTD_WorkAdd_System+WTD_Sys_Flag)&WTD_Sys_TimerEmulate)
 160E  3E: F7 86 0380
       0080		   *	    test   ds : [bp] . WTD_WorkAdd_System + WTD_Sys_Flag, WTD_Sys_TimerEmulate
 1615  75 03		   *	    jne    @C0137
 1617  E9 0344		      C 			jmp	T_Set_Frection	;タイマーセット	※call → jmp
			      C 		.endif
			      C 	.endif
 161A			   *@C0137:
 161A			   *@C0135:
			      C 
 161A  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Gate time 'u'					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 161C			      C I_Com75:				;
 161C  E8 F9A1		      C 	call	I_Read16		;
 161F  89 45 58		      C 	mov	ds:[di].WTD_GateTimeStepFirst,ax
 1622  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Volume						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1624			      C I_Com76:				;
 1624  E8 F987		      C 	call	I_Read8			;
 1627  D0 C0		      C 	rol	al,1
 1629  D0 E8		      C 	shr	al,1
			      C 	.if	(carry?)
 162B  73 0B		   *	    jae    @C0139
			      C 		.if	(al == 07Fh)
 162D  3C 7F		   *	    cmp    al, 07Fh
 162F  75 02		   *	    jne    @C013B
 1631  B0 FF		      C 			mov	al, 0FFh
			      C 		.endif
 1633			   *@C013B:
 1633  88 45 3E		      C 		mov	ds:[di].WTD_ReleaseVolume,al
			      C 	.else
 1636  EB 0F		   *	    jmp    @C013D
 1638			   *@C0139:
 1638  88 45 41		      C 		mov	ds:[di].WTD_Expr,al	;
			      C 		.if	(al == 0)
 163B  0A C0		   *	    or	al, al
 163D  75 08		   *	    jne    @C013E
 163F  88 45 51		      C 			mov	ds:[di].WTD_ExprEmbLevelSet, al
 1642  BA 173E R	      C 			mov	dx,offset CGROUP:I_Table_Volume
 1645  EB 43		      C 			jmp	I_Table_Jump		;音量セット
			      C 		.endif
			      C 	.endif
 1647			   *@C013E:
 1647			   *@C013D:
 1647  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		NULL 'w'					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1648			      C I_Com77:				;
 1648  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		x						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 164A			      C I_Com78:				;
 164A  E8 F961		      C 	call	I_Read8			;
 164D  88 45 5A		      C 	mov	ds:[di].WTD_VolumeUpDown,al
 1650  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Control Change(MIDI)				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1652			      C I_Com79:				;
			      C 
 1652  E8 F959		      C 	call	I_Read8			;
 1655  8A C8		      C 	mov	cl,al			;
 1657  E8 F954		      C 	call	I_Read8			;
			      C 
 165A  BA 189E R	      C 	mov	dx,offset CGROUP:I_Table_CtrlChgB
 165D  E8 002A		      C 	call	I_Table_Jump		;
			      C 
 1660  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		NULL 'z'					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1662			      C I_Com7a:				;
 1662  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		Key Trance (major / minor)			|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1664			      C I_Com7b:				;
 1664  26: AC		      C 	lodsb	es:[si]
			      C 
			      C 	.if	(al!=0)
 1666  0A C0		   *	    or	al, al
 1668  74 10		   *	    je     @C0140
 166A  D0 C0		      C 		rol	al,1		;
 166C  D0 E8		      C 		shr	al,1		;Bit 7 Reset & Bit 7 -> Cy Flag
			      C 		.if	(!carry?)
 166E  72 05		   *	    jb     @C0142
 1670  88 45 03		      C 			mov	ds:[di].WTD_FlagSharp,al
			      C 		.else
 1673  EB 0B		   *	    jmp    @C0144
 1675			   *@C0142:
 1675  88 45 04		      C 			mov	ds:[di].WTD_FlagFlat,al	;
			      C 		.endif
			      C 	.else
 1678  EB 06		   *	    jmp    @C0145
 167A			   *@C0140:
 167A  88 45 03		      C 		mov	ds:[di].WTD_FlagSharp,al
 167D  88 45 04		      C 		mov	ds:[di].WTD_FlagFlat,al
			      C 	.endif
 1680			   *@C0145:
 1680			   *@C0144:
			      C 
 1680  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		NULL '|'					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1682			      C I_Com7c:				;
 1682  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		NULL '}'					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1684			      C I_Com7d:				;
 1684  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		NULL '~'					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1686			      C I_Com7e:				;
 1686  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;		NULL ?						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1688			      C I_Com7f:				;
 1688  C3		      C 	ret				;
			      C 
				include	wtd_idev.asm			;割り込み　デバイス制御部
			      C ;=======================================================================|
			      C ;									|
			      C ;		Wander Swan Total Sound Driver				|
			      C ;				Interrupt device accsess program	|
			      C ;									|
			      C ;					Programmed by			|
			      C ;						A.Watanabe		|
			      C ;									|
			      C ;=======================================================================|
			      C ;****************************************************************
			      C ;*								*
			      C ;*			割り込みルーチン			*
			      C ;*				演奏・効果音制御部		*
			      C ;*				デバイス出力			*
			      C ;*								*
			      C ;****************************************************************
			      C ;===============================================================|
			      C ;		デバイスによるルーチンの分岐			|
			      C ;===============================================================|
			      C ;	●引数							|
			      C ;		ds:bp	ワークベースアドレス		引数	|
			      C ;		ds:bx	共有構造体アドレス		引数	|
			      C ;		ds:di	個別構造体			引数	|
			      C ;		es;si	演奏アドレス			引数	|
			      C ;		dx	ジャンプテーブルのアドレス	引数	|
			      C ;		cx	汎用				(引数)	|
			      C ;	●レジスタ使用						|
			      C ;		ax	汎用（主に計算用）			|
			      C ;								|
			      C ;	ルーチンに渡す引数					|
			      C ;		cl	汎用（主にカウンタ用）			|
			      C ;		ch	現在のチャンネル			|
			      C ;		dx						|
			      C ;		ss:[bp + 04h]	呼び出し元のCXレジスタ。	|
			      C ;		ss:[bp + 06h]	呼び出し元のDXレジスタ。	|
			      C ;		ss:[bp + 08h]	呼び出し元のBPレジスタ。	|
			      C ;		　DXレジスタを使う場合、ルーチンで以下の処理が必要。
			      C ;		push	bp					|
			      C ;		mov	bp,sp					|
			      C ;		（中略）					|
			      C ;		pop	bp					|
			      C ;		ret						|
			      C ;								|
			      C ;	デバイスアクセス部で、bpレジスタを使用しているので、	|
			      C ;	注意する。						|
			      C ;								|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 168A			      C I_Table_Jump:				;
 168A  55		      C 	push	bp			;
 168B  52		      C 	push	dx			;
 168C  51		      C 	push	cx			;
 168D  53		      C 	push	bx			;
 168E  50		      C 	push	ax			;レジスタ保存
			      C 
			      C ;---------------------------------------------------------------
			      C 
			      C 	;ジャンプテーブルアドレスの設定
 168F  8B DA		      C 	mov	bx,dx			;bx←dx(Jump table address)
			      C 	;チャンネル・音源情報の取得
			      C ;	xor	ax,ax			;後でandでbit resetしてる。
 1691  8A 45 05		      C 	mov	al,ds:[di].WTD_Channel	;ax←Channel
			      C 
			      C 	;チャンネルと音源情報の個別化
			      C 	;ch←チャンネル情報
 1694  8A E8		      C 	mov	ch,al			;
 1696  80 E5 0F		      C 	and	ch,0fh			;ch←チャンネル(音源情報無し)
			      C 	;ax←音源情報×２
 1699  C1 E8 06		      C 	shr	ax,6			;ax←音源タイプ(負論理)
 169C  F7 D0		      C 	not	ax			;ax←正論理にする。
 169E  83 E0 02		      C 	and	ax,02h			;ax←音源タイプ以外を消す。
			      C 	;ジャンプアドレス格納アドレスの取得
 16A1  03 D8		      C 	add	bx,ax			;bx←音源タイプを加算
			      C 
			      C 	;ジャンプアドレスの取得
 16A3  2E: 8B 17	      C 	mov	dx,word ptr cs:[bx]	;
			      C 
			      C ;---------------------------------------------------------------
			      C 
			      C 	;不必要なレジスタの復帰
 16A6  58		      C 	pop	ax			;レジスタ復帰
 16A7  5B		      C 	pop	bx			;
			      C 	;ルーチン呼び出し
 16A8  FF D2		      C 	call	dx			;呼び出し
			      C 	;残ったレジスタの復帰
 16AA  59		      C 	pop	cx			;
 16AB  5A		      C 	pop	dx			;残りのレジスタ復帰
 16AC  5D		      C 	pop	bp			;
			      C 
			      C 	;終了
 16AD  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;			KeyOn					|
			      C ;===============================================================|
			      C ;	引数							|
			      C ;		al	キー・コード				|
			      C ;	返値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		デバイスをKeyOnする。				|
			      C ;		休符の場合は、このルーチンを呼ばない。		|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
			      C ;-------------[	  Table   ]-------------
 16AE			      C I_Table_KeyOn:				
 16AE  16B2 R		      C 	dw	I_SP_KeyOn		
 16B0  16D4 R		      C 	dw	I_SM_KeyOn		
			      C ;-------------[	WS内蔵PCM ]-------------
			      C 	even				;偶数アドレス配置
 16B2			      C I_SP_KeyOn:				;
 16B2  53		      C 	push	bx			;
 16B3  50		      C 	push	ax			;レジスタ保存
			      C 
 16B4  88 45 20		      C 	mov	ds:[di].WTD_KeySet,al	;今回のデータを書き込み
			      C 
			      C 	;キーコードの分解（キー，オクターブ）
 16B7  32 E4		      C 	xor	ah,ah				;ax←KeyCode
 16B9  B1 0C		      C 	mov	cl,12				;
 16BB  F6 F9		      C 	idiv	cl				;ah←Key(余) / al←Octave(商)
			      C 	;オクターブの書き込み
 16BD  FE C8		      C 	dec	al				;オクターブ補正(Drv値)
 16BF  88 45 53		      C 	mov	ds:[di].WTD_OctaveSet,al	;オクターブ書き込み
			      C 
			      C 	;テーブル読み込み（ベンド変換）
			      C ;	mov	al,ah				;
			      C ;	mov	ah,0				;ax←Key
			      C ;	shl	ax,1				;
			      C ;	mov	bx,offset CGROUP:I_Frection_Table
			      C ;	add	bx,ax				;
			      C ;	mov	ax,cs:[bx]			;ax←Pitch Bend
			      C 
 16C2  33 DB		      C 	xor	bx,bx
 16C4  8A DC		      C 	mov	bl,ah
 16C6  D1 E3		      C 	shl	bx,1
 16C8  2E: 8B 87 0984 R	      C 	mov	ax,cs:[bx + CGROUP:I_Frection_Table]
			      C 
			      C 	;ベンドの書き込み
 16CD  89 45 2C		      C 	mov	ds:[di].WTD_Frection,ax		;Bendとして処理
			      C 	;（ハードウェアにKeyOnは無い。）
			      C 
 16D0  58		      C 	pop	ax			;レジスタ復帰
 16D1  5B		      C 	pop	bx			;
 16D2  C3		      C 	ret				;
			      C ;-------------[	外部MIDI  ]-------------
			      C 	even				;偶数アドレス配置
 16D4			      C I_SM_KeyOn:				;
			      C ifndef	hyoka	;------------------------廉価版は無し
 16D4  53		      C 	push	bx			;
 16D5  50		      C 	push	ax			;レジスタ保存
			      C 
			      C 	;実際に出力したオクターブ。
			      C 	;（MIDI制御では要らないけど、ビュアー用に計算しておく。）
			      C 	;レジスタ保存
 16D6  50		      C 	push	ax				;
 16D7  51		      C 	push	cx				;
			      C 	;キーコードの分解（キー，オクターブ）
 16D8  32 E4		      C 	xor	ah,ah				;ax←KeyCode
 16DA  B1 0C		      C 	mov	cl,12				;
 16DC  F6 F9		      C 	idiv	cl				;ah←Key(余) / al←Octave(商)
			      C 	;オクターブの書き込み
 16DE  FE C8		      C 	dec	al				;
 16E0  88 45 53		      C 	mov	ds:[di].WTD_OctaveSet,al	;オクターブ書き込み
			      C 	;レジスタ復帰
 16E3  59		      C 	pop	cx				;
 16E4  58		      C 	pop	ax				;
			      C 
			      C 	;バッファ書き込み
 16E5  33 DB		      C 	xor	bx,bx				;
 16E7  8A 5D 28		      C 	mov	bl,ds:[di].WTD_KeySetPointer	;ポインタ読み込み
 16EA  8A 41 20		      C 	mov	al,ds:[di+bx].WTD_KeySet	;バッファ読み込み
			      C 	.if	(al!=0ffh)			;内容は空？
 16ED  3C FF		   *	    cmp    al, 0FFh
 16EF  74 03		   *	    je     @C0146
 16F1  E8 041C		      C 		call	SM_KeyOff		;空ということにする。
			      C 	.endif
 16F4			   *@C0146:
 16F4  58		      C 	pop	ax				;
 16F5  50		      C 	push	ax				;ax←引数を復帰
 16F6  88 41 20		      C 	mov	ds:[di+bx].WTD_KeySet,al	;今回のデータを書き込み
 16F9  43		      C 	inc	bx				;ポインタインクリメント
 16FA  83 E3 07		      C 	and	bx,07h				;
 16FD  88 5D 28		      C 	mov	ds:[di].WTD_KeySetPointer,bl	;ポインタ保存
			      C 
			      C 	;送信
 1700  8A 65 3F		      C 	mov	ah,ds:[di].WTD_Velocity	;ah←ベロシティー
			      C 	.if	(ds:[di].WTD_FlagControl&WTD_Ctrl_Acsent)
 1703  F7 05 0040	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_Acsent
 1707  74 06		   *	    je     @C0148
 1709  8A 65 29		      C 		mov	ah,ds:[di].WTD_AcsentVelocity	;もしアクセントだったら、それ用。
 170C  83 25 BF		      C 		and	ds:[di].WTD_FlagControl,WTD_Ctrl_AcsentR
			      C 	.endif
 170F			   *@C0148:
 170F  E8 0400		      C 	call	SM_KeyOn		;デバイス出力。
			      C 
 1712  58		      C 	pop	ax			;レジスタ復帰
 1713  5B		      C 	pop	bx			;
			      C endif	;--------------------------------
 1714  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;			KeyOff					|
			      C ;===============================================================|
			      C ;	引数							|
			      C ;		無し						|
			      C ;	返値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		デバイスをKeyOffする。				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
			      C ;-------------[	  Table   ]-------------
 1716			      C I_Table_KeyOff:				
 1716  171A R		      C 	dw	I_SP_KeyOff		
 1718  1720 R		      C 	dw	I_SM_KeyOff		
			      C ;-------------[	WS内蔵PCM ]-------------
			      C 	even				;偶数アドレス配置
 171A			      C I_SP_KeyOff:				;
 171A  C6 45 20 FF	      C 	mov	ds:[di].WTD_KeySet,0ffh	;空データの書き込み
 171E  C3		      C 	ret				;
			      C ;-------------[	外部MIDI  ]-------------
			      C 	even				;偶数アドレス配置
 1720			      C I_SM_KeyOff:				;
			      C ifndef	hyoka	;------------------------廉価版は無し
 1720  53		      C 	push	bx			;
 1721  50		      C 	push	ax			;レジスタ保存
			      C 
			      C 	;バッファに書かれている内容を全てkeyOffし、空にする。
 1722  B1 08		      C 	mov	cl,8				;８回ループ
 1724  33 DB		      C 	xor	bx,bx				;
			      C 	.repeat
 1726			   *@C014A:
 1726  8A 41 20		      C 		mov	al,ds:[di+bx].WTD_KeySet	;バッファ読み込み
 1729  C6 41 20 FF	      C 		mov	ds:[di+bx].WTD_KeySet,0ffh	;空データの書き込み
 172D  43		      C 		inc	bx				;
			      C 		.if	(al!=0ffh)			;
 172E  3C FF		   *	    cmp    al, 0FFh
 1730  74 03		   *	    je     @C014B
 1732  E8 03DB		      C 			call	SM_KeyOff		;KeyOffの送信
			      C 		.endif
 1735			   *@C014B:
 1735  FE C9		      C 		dec	cl
			      C 	.until	(cl == 0)
 1737  0A C9		   *	    or	cl, cl
 1739  75 EB		   *	    jne    @C014A
			      C ;
			      C ;	　ポインタは面倒だから戻さない。
			      C ;	どうせ、クルクル回っているから、処理時間が無駄。
			      C ;
 173B  58		      C 	pop	ax			;レジスタ復帰
 173C  5B		      C 	pop	bx			;
			      C endif	;--------------------------------
 173D  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;			Volume					|
			      C ;===============================================================|
			      C ;	引数							|
			      C ;		al←ボリューム					|
			      C ;	返値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		音量を出力する。				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
			      C ;-------------[	  Table   ]-------------
 173E			      C I_Table_Volume:				
 173E  1742 R		      C 	dw	I_SP_Volume		
 1740  17C0 R		      C 	dw	I_SM_Volume		
			      C ;-------------[	WS内蔵PCM ]-------------
			      C 	even				;偶数アドレス配置
 1742			      C I_SP_Volume	proc	near	uses	ax bx
			      C 
 1742  50		   *	    push   ax
 1743  53		   *	    push   bx
 1744  51		      C 	push	cx			;chを保存
			      C 
			      C 	;音量保存。
 1745  88 45 40		      C 	mov	ds:[di].WTD_ExprSet,al	;
 1748  98		      C 	cbw				;ax←al
 1749  D1 E0		      C 	shl	ax,1			;(Range:0〜255)
 174B  8B C8		      C 	mov	cx,ax			;cx←音量
			      C 
			      C 	;パンポット読み込み
 174D  8A 45 60		      C 	mov	al,ds:[di].WTD_PanSet		;
			      C 	.if	!(ds:[di].WTD_Pan&080h)		;
 1750  F6 45 61 80	   *	    test   ds : [di] . WTD_Pan, 080h
 1754  75 1F		   *	    jne    @C014E
			      C 
			      C 		;パンポットは、リニアに変化。
 1756  BA 007F		      C 		mov	dx,007fh			;
 1759  23 C2		      C 		and	ax,dx				;
 175B  2B D0		      C 		sub	dx,ax				;
 175D  C1 E0 02		      C 		shl	ax,2				;ax←右の音量
 1760  C1 E2 02		      C 		shl	dx,2				;dx←左の音量
			      C 
			      C 		.if	(ah!=0)				;
 1763  0A E4		   *	    or	ah, ah
 1765  74 03		   *	    je     @C0150
 1767  B8 00FF		      C 			mov	ax,00ffh		;右のLimit処理
			      C 		.endif					;
			      C 
			      C 		.if	(dh!=0)				;
 176A			   *@C0150:
 176A  0A F6		   *	    or	dh, dh
 176C  74 03		   *	    je     @C0152
 176E  BA 00FF		      C 			mov	dx,00ffh		;左のLimit処理
			      C 		.endif					;
			      C 
 1771			   *@C0152:
 1771  8A E2		      C 		mov	ah,dl				;al←右のレベル
			      C 	.else
 1773  EB 13		   *	    jmp    @C0154
 1775			   *@C014E:
			      C 
			      C 		;パンポットの次元を[dB]に変換
 1775  D0 E0		      C 		shl	al,1				;
 1777  B4 FF		      C 		mov	ah,0ffh				;al←右のレベル
 1779  2A E0		      C 		sub	ah,al				;ah←左のレベル
			      C 
 177B  1E		      C 		push	ds				;
 177C  0E		      C 		push	cs				;
 177D  1F		      C 		pop	ds				;
 177E  BB 0884 R	      C 		mov	bx,offset CGROUP:I_Volume_Table	;
 1781  86 C4		      C 		xchg	al,ah				;
 1783  D7		      C 		xlat					;
 1784  86 C4		      C 		xchg	al,ah				;ah←左のレベル
 1786  D7		      C 		xlat					;al←右のレベル
 1787  1F		      C 		pop	ds				;
			      C 
			      C 	.endif
 1788			   *@C0154:
			      C 
			      C 
			      C 
			      C 	;パンポットの合成
 1788  91		      C 	xchg	cx,ax		;cx←左右の音量
 1789  50		      C 	push	ax		;ax←音量
			      C 
			      C 	;左演算
 178A  40		      C 	inc	ax			;ax←音量+1
 178B  51		      C 	push	cx			;
 178C  8A CD		      C 	mov	cl,ch			;
 178E  32 ED		      C 	xor	ch,ch			;
 1790  41		      C 	inc	cx			;cx←左のレベル+1
 1791  F7 E1		      C 	mul	cx			;
 1793  48		      C 	dec	ax			;
 1794  59		      C 	pop	cx			;
 1795  8A EC		      C 	mov	ch,ah			;ch←左の音量
			      C 
 1797  58		      C 	pop	ax
			      C 
			      C 	;右演算
 1798  40		      C 	inc	ax			;ax←音量+1
 1799  51		      C 	push	cx			;
 179A  32 ED		      C 	xor	ch,ch			;
 179C  41		      C 	inc	cx			;cx←右のレベル+1
 179D  F7 E1		      C 	mul	cx			;
 179F  48		      C 	dec	ax			;
 17A0  59		      C 	pop	cx			;
 17A1  8A CC		      C 	mov	cl,ah			;cl←右の音量
			      C 
			      C 	;合成
 17A3  80 E5 F0		      C 	and	ch,0f0h			;上位4bitのみ
 17A6  80 E1 F0		      C 	and	cl,0f0h			;上位4bitのみ
 17A9  C0 E9 04		      C 	shr	cl,4			;
 17AC  0A E9		      C 	or	ch,cl			;
 17AE  8A C5		      C 	mov	al,ch			;al←左右の音量
			      C 
 17B0  59		      C 	pop	cx			;チャンネル情報を戻す。
			      C 
			      C 	.if	(ds:[di].WTD_ExprPanSet!=al)	;前回と同じだったらいらない。
 17B1  38 45 3F		   *	    cmp    ds : [di] . WTD_ExprPanSet, al
 17B4  74 06		   *	    je     @C0155
 17B6  88 45 3F		      C 		mov	ds:[di].WTD_ExprPanSet,al
 17B9  E8 020E		      C 		call	SP_Set_Volume
			      C 	.endif
 17BC			   *@C0155:
			      C 
			      C 	ret				;
 17BC  5B		   *	    pop    bx
 17BD  58		   *	    pop    ax
 17BE  C3		   *	    ret    00000h
 17BF			      C I_SP_Volume	endp
			      C ;-------------[	外部MIDI  ]-------------
			      C 	even				;偶数アドレス配置
 17C0			      C I_SM_Volume:				;
			      C ifndef	hyoka	;------------------------廉価版は無し
			      C 	.if	(ds:[di].WTD_ExprSet!=al)	;前回と同じだったらいらない。
 17C0  38 45 40		   *	    cmp    ds : [di] . WTD_ExprSet, al
 17C3  74 0A		   *	    je     @C0157
 17C5  51		      C 		push	cx			;レジスタ保存
 17C6  88 45 40		      C 		mov	ds:[di].WTD_ExprSet,al	;
 17C9  B1 0B		      C 		mov	cl,MIDI_Ctrl_Expression	;
 17CB  E8 0368		      C 		call	SM_ControlByte		;
 17CE  59		      C 		pop	cx			;レジスタ復帰
			      C 	.endif
 17CF			   *@C0157:
			      C endif	;--------------------------------
 17CF  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;			Frection(Pitch　Bend)			|
			      C ;===============================================================|
			      C ;	引数							|
			      C ;		ax←Bend(Frection)				|
			      C ;	返値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		周波数／ピッチベンドを出力する。		|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
			      C ;-------------[	  Table   ]-------------
 17D0			      C I_Table_Frection:			
 17D0  17D4 R		      C 	dw	I_SP_Frection		
 17D2  17F8 R		      C 	dw	I_SM_Frection		
			      C ;-------------[	WS内蔵PCM ]-------------
			      C 	even				;偶数アドレス配置
			      C ;DeviceOut = 2048 - (Table / 2^(3 + Octave))
 17D4			      C I_SP_Frection:				;
 17D4  50		      C 	push	ax			;レジスタ保存
 17D5  53		      C 	push	bx			;
			      C 
			      C 	;オクターブ処理
 17D6  8A 4D 53		      C 	mov	cl,ds:[di].WTD_OctaveSet
 17D9  80 C1 03		      C 	add	cl,3			;
 17DC  D3 E8		      C 	shr	ax,cl			;
 17DE  8B D8		      C 	mov	bx,ax			;
 17E0  B8 0800		      C 	mov	ax,2048			;
 17E3  2B C3		      C 	sub	ax,bx			;
			      C 	.if	(Carry?)		;
 17E5  73 02		   *	    jae    @C0159
 17E7  33 C0		      C 		xor	ax,ax		;オーバーフローしたら、０にする。
			      C 	.endif
 17E9			   *@C0159:
			      C 
			      C 	;出力
			      C 	.if	(ds:[di].WTD_FrectionSet!=ax)	;前回と同じだったらいらない。
 17E9  39 45 2A		   *	    cmp    ds : [di] . WTD_BendSet, ax
 17EC  74 06		   *	    je     @C015B
 17EE  89 45 2A		      C 		mov	ds:[di].WTD_FrectionSet,ax
 17F1  E8 01AE		      C 		call	SP_Set_Frection		;周波数の設定
			      C 	.endif
 17F4			   *@C015B:
			      C 
 17F4  5B		      C 	pop	bx			;
 17F5  58		      C 	pop	ax			;レジスタ復帰
 17F6  C3		      C 	ret				;
			      C ;-------------[	外部MIDI  ]-------------
			      C 	even				;偶数アドレス配置
 17F8			      C I_SM_Frection:				;
			      C ifndef	hyoka	;------------------------廉価版は無し
			      C 	.if	(ds:[di].WTD_BendSet!=ax)	;前回と同じだったらいらない。
 17F8  39 45 2A		   *	    cmp    ds : [di] . WTD_BendSet, ax
 17FB  74 06		   *	    je     @C015D
 17FD  89 45 2A		      C 		mov	ds:[di].WTD_BendSet,ax	;
 1800  E8 03B5		      C 		call	SM_PitchBend		;
			      C 	.endif
 1803			   *@C015D:
			      C endif	;--------------------------------
 1803  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;			Voice & Program				|
			      C ;===============================================================|
			      C ;	引数							|
			      C ;		al←音色番号					|
			      C ;	返値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		音色を転送する。				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
			      C ;-------------[	  Table   ]-------------
 1804			      C I_Table_Voice:				
 1804  1808 R		      C 	dw	I_SP_Voice		
 1806  187E R		      C 	dw	I_SM_Voice		
			      C ;-------------[	WS内蔵PCM ]-------------
			      C 	even				;偶数アドレス配置
 1808			      C I_SP_Voice:				;
			      C 	.if	(ds:[di].WTD_Voice!=al)	;前回と同じだったらいらない。
 1808  38 45 11		   *	    cmp    ds : [di] . WTD_Program, al
 180B  74 6F		   *	    je     @C015F
			      C 
 180D  50		      C 		push	ax			;
 180E  56		      C 		push	si			;レジスタ保存
			      C 
 180F  88 45 11		      C 		mov	ds:[di].WTD_Voice,al	;音色番号保存
 1812  32 E4		      C 		xor	ah,ah			;ax ← 音色番号
			      C 
			      C 		.if	(al < 16)
 1814  3C 10		   *	    cmp    al, 010h
 1816  73 0E		   *	    jae    @C0161
 1818  C1 E0 04		      C 			shl	ax,4			;ax←al×16
 181B  8D B6 0100	      C 			lea	si,[bp + WTD_WorkAdd_Wave]
 181F  03 F0		      C 			add	si,ax			;ds:si←音色のあるアドレス
			      C 
 1821  E8 0230		      C 			call	SP_Set_Voice		;音色セット
			      C 		.else
 1824  EB 54		   *	    jmp    @C0163
 1826			   *@C0161:
 1826  51		      C 			push	cx
 1827  52		      C 			push	dx
			      C 
 1828  8A CD		      C 			mov	cl,ch
 182A  FE C1		      C 			inc	cl
 182C  BA 0800		      C 			mov	dx,00800h
 182F  D3 E2		      C 			shl	dx,cl
			      C 
			      C 			.if	((ds:[di].WTD_FlagControl & WTD_Ctrl_Effect) || !(ds:[bx].WTD_Sys_Flag & dx))
 1831  F7 05 4000	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_Effect
 1835  75 04		   *	    jne    @C0165
 1837  85 17		   *	    test   ds : [bx] . WTD_Sys_Flag, dx
 1839  75 3D		   *	    jne    @C0164
 183B			   *@C0165:
			      C 
 183B  8B 77 06		      C 				mov	si, ds:[bx].WTD_Sys_MusicOffset	;アドレスの設定
 183E  26: 8A 4C 09	      C 				mov	cl, es:[si].WTD_Mus_Voice
 1842  26: 8B 74 0E	      C 				mov	si, es:[si].WTD_Mus_DataAdr
			      C 				.while	(cl > 0)
 1846  EB 2B		   *	    jmp    @C0167
 1848			   *@C0168:
			      C 				   .if	(al == es:[si])
 1848  26: 3A 04	   *	    cmp    al, es : [si]
 184B  75 21		   *	    jne    @C0169
			      C 
 184D  51		      C 					push	cx
 184E  57		      C 					push	di
 184F  1E		      C 					push	ds
 1850  06		      C 					push	es
			      C 
 1851  81 E1 0300	      C 					and	cx, PCM_Channel_mask	;
 1855  8B 7F 32		      C 					mov	di, ds:[bx].WTD_Sys_VoiceTableOffset
 1858  C1 E9 04		      C 					shr	cx, 4			;
 185B  46		      C 					inc	si
 185C  03 F9		      C 					add	di, cx			;es:di←0000h:0180h + ch × 16
			      C 
 185E  06		      C 					push	es
 185F  1F		      C 					pop	ds
 1860  6A 00		      C 					push	IRAM_Segment		;es←0000h
 1862  07		      C 					pop	es			;
			      C 
 1863  B9 0008		      C 					mov	cx, 8			;16byte転送する。
 1866  F3/ A5		      C 					rep	movsw			;転送
			      C 
 1868  07		      C 					pop	es
 1869  1F		      C 					pop	ds
 186A  5F		      C 					pop	di
 186B  59		      C 					pop	cx
			      C 					.break
 186C  EB 0A		   *	    jmp    @C016B
			      C 				   .endif
 186E			   *@C0169:
 186E  83 C6 11		      C 				   add	si, 17
 1871  FE C9		      C 				   dec	cl
			      C 				.endw
 1873			   *@C0167:
 1873  80 F9 00		   *	    cmp    cl, 000h
 1876  77 D0		   *	    ja     @C0168
			      C 			.endif
 1878			   *@C016B:
 1878			   *@C0164:
 1878  5A		      C 			pop	dx
 1879  59		      C 			pop	cx
			      C 		.endif
			      C 
 187A			   *@C0163:
 187A  5E		      C 		pop	si			;レジスタ復帰
 187B  58		      C 		pop	ax			;
			      C 
			      C 	.endif
 187C			   *@C015F:
 187C  C3		      C 	ret				;
			      C ;-------------[	外部MIDI  ]-------------
			      C 	even				;偶数アドレス配置
 187E			      C I_SM_Voice:				;
			      C ifndef	hyoka	;------------------------廉価版は無し
			      C 	.if	(ds:[di].WTD_Program!=al)	;前回と同じだったらいらない。
 187E  38 45 11		   *	    cmp    ds : [di] . WTD_Program, al
 1881  74 06		   *	    je     @C016D
 1883  88 45 11		      C 		mov	ds:[di].WTD_Program,al	;
 1886  E8 02ED		      C 		call	SM_Program		;
			      C 	.endif
 1889			   *@C016D:
			      C endif	;-------------------------------
 1889  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;			Poly Key Pressior			|
			      C ;===============================================================|
			      C ;	引数							|
			      C ;		al←Key						|
			      C ;		ah←pressior					|
			      C ;	返値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		ポリフォニック　キー　プレッシャーの送信	|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
			      C ;-------------[	  Table   ]-------------
 188A			      C I_Table_PolyKeyPress:			
 188A  188E R		      C 	dw	I_SP_PolyKeyPress	
 188C  1890 R		      C 	dw	I_SM_PolyKeyPress	
			      C ;-------------[	WS内蔵PCM ]-------------
			      C 	even				;偶数アドレス配置
 188E			      C I_SP_PolyKeyPress:			;
			      C ;	処理無し			;
 188E  C3		      C 	ret				;
			      C ;-------------[	外部MIDI  ]-------------
			      C 	even				;偶数アドレス配置
 1890			      C I_SM_PolyKeyPress:			;
			      C ifndef	hyoka	;------------------------廉価版は無し
 1890  E8 0291		      C 	call	SM_KeyPress		;
			      C endif	;--------------------------------
 1893  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;			Poly Channel Pressior			|
			      C ;===============================================================|
			      C ;	引数							|
			      C ;		al←pressior					|
			      C ;	返値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		ポリフォニック　キー　プレッシャーの送信	|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
			      C ;-------------[	  Table   ]-------------
 1894			      C I_Table_PolyChPress:			
 1894  1898 R		      C 	dw	I_SP_PolyChPress	
 1896  189A R		      C 	dw	I_SM_PolyChPress	
			      C ;-------------[	WS内蔵PCM ]-------------
			      C 	even				;偶数アドレス配置
 1898			      C I_SP_PolyChPress:			;
			      C ;	処理無し			;
 1898  C3		      C 	ret				;
			      C ;-------------[	外部MIDI  ]-------------
			      C 	even				;偶数アドレス配置
 189A			      C I_SM_PolyChPress:			;
			      C ifndef	hyoka	;------------------------廉価版は無し
 189A  E8 0305		      C 	call	SM_ChPress		;
			      C endif	;--------------------------------
 189D  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;			Control Change Byte			|
			      C ;===============================================================|
			      C ;	引数							|
			      C ;		al←データ					|
			      C ;		cl←機能番号					|
			      C ;	返値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		コントロールチェンジの送信			|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
			      C ;-------------[	  Table   ]-------------
 189E			      C I_Table_CtrlChgB:			
 189E  18A2 R		      C 	dw	I_SP_CtrlChgB		
 18A0  18A4 R		      C 	dw	I_SM_CtrlChgB		
			      C ;-------------[	WS内蔵PCM ]-------------
			      C 	even				;偶数アドレス配置
 18A2			      C I_SP_CtrlChgB:				;
			      C ;	処理無し			;
 18A2  C3		      C 	ret				;
			      C ;-------------[	外部MIDI  ]-------------
			      C 	even				;偶数アドレス配置
 18A4			      C I_SM_CtrlChgB:				;
			      C ifndef	hyoka	;------------------------廉価版は無し
 18A4  55		      C 	push	bp			;
 18A5  8B EC		      C 	mov	bp,sp			;
 18A7  51		      C 	push	cx			;レジスタ保存
			      C 
 18A8  8A 4E 04		      C 	mov	cl,[bp + 04h]		;
 18AB  8B 6E 08		      C 	mov	bp,[bp + 08h]		;bpレジスタの復帰
 18AE  E8 0285		      C 	call	SM_ControlByte		;
			      C 
 18B1  59		      C 	pop	cx			;レジスタ復帰
 18B2  5D		      C 	pop	bp			;
			      C endif	;--------------------------------
 18B3  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;			Control Change Word			|
			      C ;===============================================================|
			      C ;	引数							|
			      C ;		ax←データ					|
			      C ;		cl←機能番号					|
			      C ;	返値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		コントロールチェンジの送信			|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
			      C ;-------------[	  Table   ]-------------
 18B4			      C I_Table_CtrlChgW:			
 18B4  18B8 R		      C 	dw	I_SP_CtrlChgW		
 18B6  18BA R		      C 	dw	I_SM_CtrlChgW		
			      C ;-------------[	WS内蔵PCM ]-------------
			      C 	even				;偶数アドレス配置
 18B8			      C I_SP_CtrlChgW:				;
			      C ;	処理無し			;
 18B8  C3		      C 	ret				;
			      C ;-------------[	外部MIDI  ]-------------
			      C 	even				;偶数アドレス配置
 18BA			      C I_SM_CtrlChgW:				;
			      C ifndef	hyoka	;------------------------廉価版は無し
 18BA  55		      C 	push	bp			;
 18BB  8B EC		      C 	mov	bp,sp			;
 18BD  51		      C 	push	cx			;レジスタ保存
			      C 
 18BE  8A 4E 04		      C 	mov	cl,[bp + 04h]		;
 18C1  8B 6E 08		      C 	mov	bp,[bp + 08h]		;bpレジスタの復帰
 18C4  E8 0287		      C 	call	SM_ControlWord		;
			      C 
 18C7  59		      C 	pop	cx			;レジスタ復帰
 18C8  5D		      C 	pop	bp			;
			      C endif	;--------------------------------
 18C9  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;	WS内蔵PCM Channelモード	/ MIDI Dumper Switch		|
			      C ;===============================================================|
			      C ;	引数							|
			      C ;		al←モードスイッチ				|
			      C ;	返値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		モード						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
			      C ;-------------[	  Table   ]-------------
 18CA			      C I_Table_Mode:				
 18CA  18CE R		      C 	dw	I_SP_Mode		
 18CC  18F6 R		      C 	dw	I_SM_Mode		
			      C ;-------------[	WS内蔵PCM ]-------------
			      C 	even				;偶数アドレス配置
 18CE			      C I_SP_Mode:				;
 18CE  51		      C 	push	cx			;
 18CF  50		      C 	push	ax			;レジスタ保存
			      C 
 18D0  83 E0 01		      C 	and	ax, 0001h		;and	al,01h
 18D3  0D 0100		      C 	or	ax, 0100h		;set	0,ah
 18D6  8A CD		      C 	mov	cl, ch			;
 18D8  D3 E0		      C 	shl	ax, cl
			      C 
			      C 	.if	!(ds:[di].WTD_FlagControl & WTD_Ctrl_Effect)
 18DA  F7 05 4000	   *	    test   ds : [di] . WTD_FlagControl, WTD_Ctrl_Effect
 18DE  75 0D		   *	    jne    @C016F
 18E0  52		      C 		push	dx
			      C 
 18E1  BA FEFF		      C 		mov	dx, WTD_Sys_ChannelMode1R
 18E4  D3 C2		      C 		rol	dx, cl
 18E6  23 17		      C 		and	dx, ds:[bx].WTD_Sys_Flag
 18E8  0A F0		      C 		or	dh, al
 18EA  89 17		      C 		mov	ds:[bx].WTD_Sys_Flag, dx
			      C 
 18EC  5A		      C 		pop	dx
			      C 	.endif
 18ED			   *@C016F:
			      C 
 18ED  C1 E0 04		      C 	shl	ax,4			;
 18F0  E8 0141		      C 	call	SP_Set_Channel		;
			      C 
 18F3  58		      C 	pop	ax			;レジスタ復帰
 18F4  59		      C 	pop	cx			;
 18F5  C3		      C 	ret				;
			      C ;-------------[	外部MIDI  ]-------------
			      C 	even				;偶数アドレス配置
 18F6			      C I_SM_Mode:				;
			      C ifndef	hyoka	;------------------------廉価版は無し
 18F6  51		      C 	push	cx			;レジスタ保存
			      C 
 18F7  C0 E0 06		      C 	shl	al,6			;数値を64倍する。
 18FA  24 40		      C 	and	al,40h			;0か64だけ。
 18FC  B1 40		      C 	mov	cl,MIDI_Ctrl_Hold	;
 18FE  E8 024D		      C 	call	SM_ControlWord		;ダンパースイッチの送信
			      C 
 1901  59		      C 	pop	cx			;レジスタ復帰
			      C endif	;--------------------------------
 1902  C3		      C 	ret				;
			      C 
				include	wtd_icom.asm			;割り込み　シリアル通信制御
			      C ;=======================================================================|
			      C ;									|
			      C ;		Wander Swan Total Sound Driver				|
			      C ;			Interrupt main program				|
			      C ;				Serial Control				|
			      C ;									|
			      C ;					Programmed by			|
			      C ;						A.Watanabe		|
			      C ;									|
			      C ;=======================================================================|
			      C ifndef	hyoka
			      C ;****************************************************************
			      C ;*								*
			      C ;*			割り込みメインルーチン			*
			      C ;*								*
			      C ;****************************************************************
			      C ;===============================================================|
			      C ;		Interrupt Main					|
			      C ;===============================================================|
			      C ;								|
			      C ;	●処理							|
			      C ;		シリアル通信の制御を行うルーチン。		|
			      C ;								|
			      C ;	●使用レジスタ						|
			      C ;		ds:bp	ワーク領域先頭アドレス			|
			      C ;		ds:bx	パート共通構造体			|
			      C ;								|
			      C ;===============================================================|
			      C 	Public	IC_Start
			      C 	even					;偶数アドレス配置
 1904			      C IC_Start:
 1904  50		      C 	push	ax				;
 1905  53		      C 	push	bx				;
 1906  55		      C 	push	bp				;
 1907  1E		      C 	push	ds				;レジスタ保存
			      C 
			      C ;---------------------------------------------------------------
			      C 
 1908  E4 B2		      C 	in	al,Int_Enable		;
 190A  24 FE		      C 	and	al,INT_CommSendReset	;シリアル送信エンプティー
 190C  E6 B2		      C 	out	Int_Enable,al		;割り込み禁止
			      C 
			      C ;---------------------------------------------------------------
			      C ;EOIの発行
			      C 
			      C ;End Of Interrupt
 190E  B0 01		      C 	mov	al,INT_CommSendSet		;
 1910  E6 B6		      C 	out	Int_Eoi,al			;出力
			      C 
			      C ;---------------------------------------------------------------
			      C ;バンクの設定
			      C ifndef	IRAM		;DGROUP=IRAMの場合、不要
			      C 	in	al,BankSram			;現在のSRAM Bankを得る
			      C 	cmp	al,BANK_USERDS0			;ユーザ領域を示していたら、
			      C 	jz	IC_Start_Step1			;この処理は行わない。
			      C 	cmp	al,BANK_USERDS1			;
			      C 	jz	IC_Start_Step1			;'/ram0'アクセス中は、
			      C 	jmp	IC_Start_End			;処理をしない。
			      C endif
			      C 
 1912			      C IC_Start_Step1:
			      C ;	push	ax				;
			      C 
			      C ;---------------------------------------------------------------
			      C ;ワークエリアアドレスの取得
			      C 
			      C 	WTD_WorkGet	ds,bp			;ワークエリアアドレスの取得
			     1C ifdef	library	;------------------------	;※　ライブラリ版のみ必要
			     1C 
			     1C ifdef	IRAM	;---------------		;D-GROUP ＝ I-RAMの場合
 1912  6A 00		     1C 		push	IRAM_Segment		;
 1914  1F		     1C 		pop	ds			;
 1915  BD 0000 R	     1C 		mov	bp,offset DGROUP:_WTD_Work
			     1C 
			     1C else	;-----------------------		;D-GROUP ≠ S-RAMの場合
			     1C 		push	SRAM_Segment		;（WonderWitch等）
			     1C 		pop	ds			;
			     1C 		mov	bp,offset DGROUP:_WTD_Work
			     1C endif	;-----------------------
			     1C 
			     1C else	;--------------------------------	;WonderWitch版
			     1C 		push	SRAM_Segment		;
			     1C 		pop	ds			;
			     1C 		mov	bp,ds:[ProcContext_heap]
			     1C endif	;--------------------------------
			      C 
			      C ;---------------------------------------------------------------
			      C ;通信
 1918			      C IC_Start_Step2:					;
 1918  E8 034F		      C 	call	IC_Send				;送信
			      C ;---------------------------------------------------------------
			      C ;バンクの復帰
			      C ifndef	IRAM		;DGROUP=IRAMの場合、不要
			      C ;
			      C ;	pop	ax				;復帰
			      C ;	out	BankSram,al			;設定する。
			      C ;
			      C endif
			      C ;---------------------------------------------------------------
			      C ;割り込みの終了
			      C 
 191B			      C IC_Start_End:
			      C 
 191B  1F		      C 	pop	ds				;レジスタ復帰
 191C  5D		      C 	pop	bp				;
 191D  5B		      C 	pop	bx				;
 191E  58		      C 	pop	ax				;
 191F  CF		      C 	iret					;
			      C ;===============================================================|
			      C endif
			      C 
				include	wtd_tim.asm			;タイマー制御用サブルーチン
			      C ;=======================================================================|
			      C ;									|
			      C ;		Wander Swan Total Sound Driver				|
			      C ;				Timer Control				|
			      C ;									|
			      C ;					Programmed by			|
			      C ;						A.Watanabe		|
			      C ;									|
			      C ;=======================================================================|
			      C ;===============================================================|
			      C ;			I/O Address				|
			      C ;===============================================================|
 = 00B0			      C Int_Base		equ	0b0h	;
 = 00B2			      C Int_Enable		equ	0b2h	;
 = 00B4			      C Int_Case		equ	0b4h	;
 = 00B6			      C Int_Eoi			equ	0b6h	;
 = 00C1			      C BankSram		equ	0c1h	;
 = 00A2			      C TIMER_Status		equ	0a2h	;Timer Status
 = 00A4			      C TIMER_MaxCountH		equ	0a4h	;Hblank Load Count
 = 00A6			      C TIMER_MaxCountV		equ	0a6h	;Vblank Load Count
 = 00A8			      C TIMER_CounterH		equ	0a8h	;Hblank Down Counter
 = 00AA			      C TIMER_CounterV		equ	0aah	;Vblank Down Counter
			      C ;===============================================================|
			      C ;			INT Status bit flag			|
			      C ;===============================================================|
 = 0080			      C INT_HblankSet		equ	080h	;Hblank値セット　(or)
 = 007F			      C INT_HblankReset		equ	07fh	;Hblank値リセット(and)
			      C ;===============================================================|
			      C ;			COMM Status bit flag			|
			      C ;===============================================================|
 = 0001			      C Timer_H_Enable		equ	001h	;Hblank Int. Enable	(or)
 = 00FE			      C Timer_H_Disable		equ	0feh	;Hblank Int. Disable	(and)
 = 0002			      C Timer_H_auto		equ	002h	;Vblank auto preset mode(or)
 = 00FD			      C Timer_H_shot		equ	0fdh	;Vblank 1 shot mode	(and)
 = 0004			      C Timer_V_Enable		equ	004h	;Vblank Int. Enable 	(or)
 = 00FB			      C Timer_V_Disable		equ	0fbh	;Vblank Int. Disable	(and)
 = 0008			      C Timer_V_auto		equ	008h	;Vblank auto preset mode(or)
 = 00F7			      C Timer_V_shot		equ	0f7h	;Vblank 1 shot mode	(and)
			      C ;===============================================================|
			      C ;			定数					|
			      C ;===============================================================|
 = 0303			      C Timer_Open		equ	0303h	;Hblank Enable / Auto mode
 = 0100			      C Timer_Close		equ	0100h	;Hblank Disable
			      C ;
			      C ;	Frection = 12000 / ( timebase × tempo / 60 )
			      C ;	Frection = 0AFC80h / (timebase × tempo )
			      C ;
 = 007D			      C Timer_Tempo120		equ	125	;timebase 48 / Tempo 120
			      C ;===============================================================|
			      C ;		ハードウェア割り込みのベースベクトルの取得	|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		al	ベースベクトル				|
			      C ;	処理							|
			      C ;		I/Oから、割り込みベクタを読む			|
			      C ;===============================================================|
			      C 		even			;偶数アドレス配置
 1920			      C IntVector_Get	proc near		;
 1920  E4 B0		      C 		in	al,Int_Base	;読み込み
 1922  C3		      C 		ret			;
 1923			      C IntVector_Get	endp			;
			      C ;===============================================================|
			      C ;		タイマーの動作開始				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		deviceの初期設定				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1924			      C T_open	proc near			;
 1924  50		      C 	push	ax			;レジスタ保存
			      C 
 1925  B8 0303		      C 	mov	ax,Timer_Open		;Set
 1928  E8 0029		      C 	call	T_Set_Status		;
			      C 
 192B  E8 001C		      C 	call	T_init			;割り込み周期の設定
			      C 
 192E  E4 B2		      C 	in	al,Int_Enable		;
 1930  0C 80		      C 	or	al,Int_HblankSet	;
 1932  E6 B2		      C 	out	Int_Enable,al		;
			      C 
 1934  58		      C 	pop	ax			;レジスタ復帰
 1935  C3		      C 	ret				;
 1936			      C T_open	endp				;
			      C ;===============================================================|
			      C ;		タイマーの動作終了				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		deviceの初期化					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1936			      C T_close	proc near			;
 1936  50		      C 	push	ax			;レジスタ保存
			      C 
 1937  B8 0100		      C 	mov	ax,Timer_Close		;Reset
 193A  E8 0017		      C 	call	T_Set_Status		;
			      C 
 193D  E4 B2		      C 	in	al,Int_Enable		;
 193F  24 7F		      C 	and	al,Int_HblankReset	;
 1941  E6 B2		      C 	out	Int_Enable,al		;
 1943  B0 7F		      C 	mov	al,Int_HblankReset	;
 1945  E6 B6		      C 	out	Int_Eoi,al		;出力
			      C 
 1947  58		      C 	pop	ax			;レジスタ復帰
 1948  C3		      C 	ret				;
 1949			      C T_close	endp				;
			      C ;===============================================================|
			      C ;		タイマーの初期設定				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		タイマー周期をTempo120にする。			|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 194A			      C T_init	proc near			;
 194A  50		      C 	push	ax			;レジスタ保存
			      C 
 194B  B8 007D		      C 	mov	ax,Timer_Tempo120	;
 194E  E8 000D		      C 	call	T_Set_Frection		;
			      C 
 1951  58		      C 	pop	ax			;レジスタ復帰
 1952  C3		      C 	ret				;
 1953			      C T_init	endp				;
			      C ;===============================================================|
			      C ;		タイマーモードの設定				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		AL	Output mode				|
			      C ;		AH	Set bit					|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		モードの設定					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1954			      C T_Set_Status	proc near		;
 1954  52		      C 	push	dx			;レジスタ保存
 1955  BA 00A2		      C 	mov	dx,TIMER_Status		;dx←I/O Address
 1958  E8 016F		      C 	call	SP_Set_with_mask	;
 195B  5A		      C 	pop	dx			;レジスタ復帰
 195C  C3		      C 	ret				;
 195D			      C T_Set_Status	endp			;
			      C ;===============================================================|
			      C ;		タイマー周期の設定				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		AX	割り込み周期				|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		モードの設定					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 195E			      C T_Set_Frection	proc near		;
 195E  E7 A4		      C 	out	Timer_MaxCountH,ax	;出力
 1960  C3		      C 	ret				;
 1961			      C T_Set_Frection	endp			;
			      C 
				include	wtd_snd.asm			;サウンド制御用サブルーチン
			      C ;=======================================================================|
			      C ;									|
			      C ;		Wander Swan Total Sound Driver				|
			      C ;				Sound Control				|
			      C ;									|
			      C ;					Programmed by			|
			      C ;						A.Watanabe		|
			      C ;									|
			      C ;=======================================================================|
			      C ;****************************************************************
			      C ;*								*
			      C ;*		Ｗａｎｄｅｒ　Ｓｗａｎ　内蔵ＰＣＭ		*
			      C ;*								*
			      C ;****************************************************************
			      C ;===============================================================|
			      C ;			I/O Address				|
			      C ;===============================================================|
 = 0080			      C PCM_Com_Frection	equ	080h			;周波数
 = 0080			      C PCM_Com_FrectionCh1	equ	PCM_Com_Frection + 0	;周波数
 = 0082			      C PCM_Com_FrectionCh2	equ	PCM_Com_Frection + 2	;周波数
 = 0084			      C PCM_Com_FrectionCh3	equ	PCM_Com_Frection + 4	;周波数
 = 0086			      C PCM_Com_FrectionCh4	equ	PCM_Com_Frection + 6	;周波数
 = 0088			      C PCM_Com_Volume		equ	088h			;音量
 = 0088			      C PCM_Com_VolumeCh1	equ	PCM_Com_Volume + 0	;音量
 = 0089			      C PCM_Com_VolumeCh2	equ	PCM_Com_Volume + 1	;音量
 = 008A			      C PCM_Com_VolumeCh3	equ	PCM_Com_Volume + 2	;音量
 = 008B			      C PCM_Com_VolumeCh4	equ	PCM_Com_Volume + 3	;音量
 = Pcm_Com_VolumeCh2	      C PCM_Com_PCMVoice	equ	Pcm_Com_VolumeCh2	;PCM Voice
 = 008C			      C PCM_Com_Sweep		equ	08Ch			;Sweep
 = 008C			      C PCM_Com_SweepLevel	equ	PCM_Com_Sweep + 0	;Sweep Level
 = 008D			      C PCM_Com_SweepTime	equ	PCM_Com_Sweep + 1	;Sweep time
 = 008E			      C PCM_Com_Noise		equ	08Eh			;Noise mode
 = 008F			      C PCM_Com_VoiceAddress	equ	08Fh			;音色Wave table address
 = 0090			      C PCM_Com_Channel		equ	090h			;Channel mode
 = 0091			      C PCM_Com_Output		equ	091h			;Output mode
 = 0092			      C PCM_Com_Random		equ	092h			;Random get
 = 0094			      C PCM_Com_VolumePCM	equ	094h			;PCM Voice Volume
 = 0095			      C PCM_Com_VoiceCtrl	equ	095h			;PCM Voice Control
			      C ;===============================================================|
			      C ;			Work Address				|
			      C ;===============================================================|
			      C ;PCM_Wrok_Segment	equ	0000h	;FreyaBIOS Work Area
			      C ;PCM_Wrok_VoiceTable	equ	0180h	;FreyaBIOS Work Area
			      C ;===============================================================|
			      C ;			定数					|
			      C ;===============================================================|
 = 0300			      C PCM_Channel_mask	equ	0300h	;マスク
 = 2020			      C PcmVoiceMode_Set	equ	2020h	;Channel Mode  PCM Voice Mode Set
 = 2000			      C PcmVoiceMode_Reset	equ	2000h	;Channel Mode  PCM Voice Mode Reset
			      C ;===============================================================|
			      C ;		サウンドの初期化				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		ds:[si]	共通構造体				|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		deviceの初期化					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1962			      C SP_init	proc near			;
 1962  50		      C 	push	ax			;
 1963  51		      C 	push	cx			;
 1964  57		      C 	push	di			;
 1965  06		      C 	push	es			;レジスタ保存
			      C 
 1966  8B 44 32		      C 	mov	ax,ds:[si].WTD_Sys_VoiceTableOffset
 1969  E8 0120		      C 	call	SP_Set_VoiceAdd		;音色テーブルの設定
			      C 
 196C  6A 00		      C 	push	IRAM_Segment		;
 196E  07		      C 	pop	es			;
 196F  8B F8		      C 	mov	di,ax			;es:di←0000h:0180h
			      C 
 1971  33 C0		      C 	xor	ax,ax			;各デバイスの初期化
 1973  B9 0020		      C 	mov	cx,0020h		;64byte転送
 1976  F3/ AB		      C 	rep	stosw			;音色の初期化
 1978  33 C0		      C 	xor	ax,ax			;
 197A  E6 88		      C 	out	PCM_Com_VolumeCh1,al	;
 197C  E6 89		      C 	out	PCM_Com_VolumeCh2,al	;
 197E  E6 8A		      C 	out	PCM_Com_VolumeCh3,al	;
 1980  E6 8B		      C 	out	PCM_Com_VolumeCh4,al	;
 1982  E6 8C		      C 	out	PCM_Com_SweepLevel,al	;
 1984  E6 8D		      C 	out	PCM_Com_SweepTime,al	;
 1986  E6 8E		      C 	out	PCM_Com_Noise,al	;
 1988  B0 0F		      C 	mov	al,00fh			;
 198A  E6 90		      C 	out	PCM_Com_Channel,al	;
 198C  B0 0F		      C 	mov	al,00fh			;
 198E  E6 91		      C 	out	PCM_Com_Output,al	;
 1990  E6 94		      C 	out	PCM_Com_VolumePCM,al	;
 1992  B8 07FF		      C 	mov	ax, 07FFh
 1995  E7 80		      C 	out	PCM_Com_FrectionCh1,ax	;
 1997  E7 82		      C 	out	PCM_Com_FrectionCh2,ax	;
 1999  E7 84		      C 	out	PCM_Com_FrectionCh3,ax	;
 199B  E7 86		      C 	out	PCM_Com_FrectionCh4,ax	;
			      C 
			      C ;		to do	WSC check
			      C ;	mov	al,0FFh			;
			      C ;	out	PCM_Com_VoiceCtrl,al	;
			      C 
 199D  07		      C 	pop	es			;レジスタ復帰
 199E  5F		      C 	pop	di			;
 199F  59		      C 	pop	cx			;
 19A0  58		      C 	pop	ax			;
 19A1  C3		      C 	ret				;
 19A2			      C SP_init	endp				;
			      C ;===============================================================|
			      C ;			周波数のセット				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		CH	Channel					|
			      C ;		AX	Frection				|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		周波数のセット					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 19A2			      C SP_Set_Frection	proc near		;
 19A2  51		      C 	push	cx			;
 19A3  52		      C 	push	dx			;レジスタ保存
			      C 
 19A4  F7 05 4000	      C 	test	ds:[di].WTD_FlagControl,WTD_Ctrl_Effect
 19A8  75 10		      C 	jnz	SP_Set_Frection_Step	;効果音パート？
 19AA  8A CD		      C 	mov	cl,ch			;
 19AC  FE C1		      C 	inc	cl			;
 19AE  BA 0800		      C 	mov	dx,00800h		;
 19B1  D3 E2		      C 	shl	dx,cl			;
 19B3  3E: 85 96 0380	      C 	test	ds:[bp].WTD_WorkAdd_System+WTD_Sys_Flag,dx
 19B8  75 0D		      C 	jnz	SP_Set_Frection_End	;効果音鳴っているか？
			      C 
 19BA			      C SP_Set_Frection_Step:			;
 19BA  BA 0080		      C 	mov	dx,PCM_Com_Frection	;dx←I/O Address base
 19BD  81 E1 0300	      C 	and	cx,PCM_Channel_mask	;
 19C1  C1 E9 07		      C 	shr	cx,7			;cx = ch * 2
 19C4  03 D1		      C 	add	dx,cx			;dx←I/O Address
 19C6  EF		      C 	out	dx,ax			;out(dx),ax
			      C 
 19C7			      C SP_Set_Frection_End:			;
 19C7  5A		      C 	pop	dx			;レジスタ復帰
 19C8  59		      C 	pop	cx			;
 19C9  C3		      C 	ret				;
 19CA			      C SP_Set_Frection	endp			;
			      C ;===============================================================|
			      C ;			音量のセット				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		CH	Channel					|
			      C ;		AL	Volume					|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		音量のセット					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 19CA			      C SP_Set_Volume	proc near		;
 19CA  51		      C 	push	cx			;
 19CB  52		      C 	push	dx			;レジスタ保存
			      C 
 19CC  F7 05 4000	      C 	test	ds:[di].WTD_FlagControl,WTD_Ctrl_Effect
 19D0  75 10		      C 	jnz	SP_Set_Volume_Step	;効果音パート？
 19D2  8A CD		      C 	mov	cl,ch			;
 19D4  FE C1		      C 	inc	cl			;
 19D6  BA 0800		      C 	mov	dx,00800h		;
 19D9  D3 E2		      C 	shl	dx,cl			;
 19DB  3E: 85 96 0380	      C 	test	ds:[bp].WTD_WorkAdd_System+WTD_Sys_Flag,dx
 19E0  75 0D		      C 	jnz	SP_Set_Volume_End	;効果音鳴っているか？
			      C 
 19E2			      C SP_Set_Volume_Step:			;
 19E2  BA 0088		      C 	mov	dx,PCM_Com_Volume	;dx←I/O Address base
 19E5  81 E1 0300	      C 	and	cx,PCM_Channel_mask	;
 19E9  C1 E9 08		      C 	shr	cx,8			;cx = cl
 19EC  03 D1		      C 	add	dx,cx			;dx←I/O Address
 19EE  EE		      C 	out	dx,al			;out(dx),ax
			      C 
 19EF			      C SP_Set_Volume_End:			;
 19EF  5A		      C 	pop	dx			;レジスタ復帰
 19F0  59		      C 	pop	cx			;
 19F1  C3		      C 	ret				;
 19F2			      C SP_Set_Volume	endp			;
			      C ;===============================================================|
			      C ;			スウィープのセット			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		AL	Sweep Level				|
			      C ;		AH	Sweep Time				|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		スウィープの設定				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 19F2			      C SP_Set_Sweep	proc near		;
 19F2  52		      C 	push	dx
			      C 
 19F3  F7 05 4000	      C 	test	ds:[di].WTD_FlagControl,WTD_Ctrl_Effect
 19F7  75 10		      C 	jnz	SP_Set_Sweep_Step	;効果音パート？
 19F9  8A CD		      C 	mov	cl,ch			;
 19FB  FE C1		      C 	inc	cl			;
 19FD  BA 0800		      C 	mov	dx,00800h		;
 1A00  D3 E2		      C 	shl	dx,cl			;
 1A02  3E: 85 96 0380	      C 	test	ds:[bp].WTD_WorkAdd_System+WTD_Sys_Flag,dx
 1A07  75 08		      C 	jnz	SP_Set_Sweep_End	;効果音鳴っているか？
			      C 
 1A09			      C SP_Set_Sweep_Step:			;
 1A09  E6 8C		      C 	out	PCM_Com_SweepLevel,al	;出力
 1A0B  86 C4		      C 	xchg	al,ah			;
 1A0D  E6 8D		      C 	out	PCM_Com_SweepTime,al	;出力
 1A0F  86 C4		      C 	xchg	al,ah			;
			      C 
 1A11			      C SP_Set_Sweep_End:			;
 1A11  5A		      C 	pop	dx			;
 1A12  C3		      C 	ret				;
 1A13			      C SP_Set_Sweep	endp			;
			      C ;===============================================================|
			      C ;			ノイズモードのセット			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		AL	Set Data				|
			      C ;		AH	Set bit					|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		ノイズモードの設定				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1A14			      C SP_Set_Noise	proc near		;
 1A14  52		      C 	push	dx			;レジスタの保存
			      C 
 1A15  F7 05 4000	      C 	test	ds:[di].WTD_FlagControl,WTD_Ctrl_Effect
 1A19  75 10		      C 	jnz	SP_Set_Noise_Step	;効果音パート？
 1A1B  8A CD		      C 	mov	cl,ch			;
 1A1D  FE C1		      C 	inc	cl			;
 1A1F  BA 0800		      C 	mov	dx,00800h		;
 1A22  D3 E2		      C 	shl	dx,cl			;
 1A24  3E: 85 96 0380	      C 	test	ds:[bp].WTD_WorkAdd_System+WTD_Sys_Flag,dx
 1A29  75 06		      C 	jnz	SP_Set_Noise_End	;効果音鳴っているか？
			      C 
 1A2B			      C SP_Set_Noise_Step:			;
 1A2B  BA 008E		      C 	mov	dx,PCM_Com_Noise	;dx←I/O Address
 1A2E  E8 0099		      C 	call	SP_Set_with_mask	;
			      C 
 1A31			      C SP_Set_Noise_End:			;
 1A31  5A		      C 	pop	dx			;
 1A32  C3		      C 	ret				;レジスタの復帰
 1A33			      C SP_Set_Noise	endp			;
			      C ;===============================================================|
			      C ;			Channel modeの設定			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		AL	Channel mode				|
			      C ;		AH	Set bit					|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		チャンネルモードの設定				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1A34			      C SP_Set_Channel	proc near		;
 1A34  52		      C 	push	dx			;レジスタの保存
			      C 
 1A35  F7 05 4000	      C 	test	ds:[di].WTD_FlagControl,WTD_Ctrl_Effect
 1A39  75 10		      C 	jnz	SP_Set_Channel_Step	;効果音パート？
 1A3B  8A CD		      C 	mov	cl,ch			;
 1A3D  FE C1		      C 	inc	cl			;
 1A3F  BA 0800		      C 	mov	dx,00800h		;
 1A42  D3 E2		      C 	shl	dx,cl			;
 1A44  3E: 85 96 0380	      C 	test	ds:[bp].WTD_WorkAdd_System+WTD_Sys_Flag,dx
 1A49  75 06		      C 	jnz	SP_Set_Channel_End	;効果音鳴っているか？
			      C 
 1A4B			      C SP_Set_Channel_Step:			;
 1A4B  BA 0090		      C 	mov	dx,PCM_Com_Channel	;dx←I/O Address
 1A4E  E8 0079		      C 	call	SP_Set_with_mask	;
			      C 
 1A51			      C SP_Set_Channel_End:			;
 1A51  5A		      C 	pop	dx			;
 1A52  C3		      C 	ret				;レジスタの復帰
 1A53			      C SP_Set_Channel	endp			;
			      C ;===============================================================|
			      C ;			音色の設定				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		CH	チャンネル				|
			      C ;		DS:SI	音色データのアドレス			|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		音色を設定する					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1A54			      C SP_Set_Voice	proc	near		;
 1A54  51		      C 	push	cx			;
 1A55  52		      C 	push	dx			;
 1A56  57		      C 	push	di			;
 1A57  56		      C 	push	si			;
 1A58  06		      C 	push	es			;レジスタ保存
			      C 
 1A59  F7 05 4000	      C 	test	ds:[di].WTD_FlagControl,WTD_Ctrl_Effect
 1A5D  75 10		      C 	jnz	SP_Set_Voice_Step	;効果音パート？
 1A5F  8A CD		      C 	mov	cl,ch			;
 1A61  FE C1		      C 	inc	cl			;
 1A63  BA 0800		      C 	mov	dx,00800h		;
 1A66  D3 E2		      C 	shl	dx,cl			;
 1A68  3E: 85 96 0380	      C 	test	ds:[bp].WTD_WorkAdd_System+WTD_Sys_Flag,dx
 1A6D  75 17		      C 	jnz	SP_Set_Voice_End	;効果音鳴っているか？
			      C 
 1A6F			      C SP_Set_Voice_Step:			;
			      C 
 1A6F  FC		      C 	cld				;インクリメントモード
			      C 
 1A70  6A 00		      C 	push	IRAM_Segment		;es←0000h
 1A72  07		      C 	pop	es			;
			      C ;	mov	di,PCM_Wrok_VoiceTable	;0180h(音色テーブルアドレス)
 1A73  3E: 8B BE 03B2	      C 	mov	di,ds:[bp].WTD_WorkAdd_System+WTD_Sys_VoiceTableOffset
 1A78  81 E1 0300	      C 	and	cx,PCM_Channel_mask	;
 1A7C  C1 E9 04		      C 	shr	cx,4			;
 1A7F  03 F9		      C 	add	di,cx			;es:di←0000h:0180h + ch × 16
 1A81  B9 0008		      C 	mov	cx,8			;16byte転送する。
 1A84  F3/ A5		      C 	rep	movsw			;転送
			      C 
 1A86			      C SP_Set_Voice_End:			;
 1A86  07		      C 	pop	es			;レジスタ復帰
 1A87  5E		      C 	pop	si			;
 1A88  5F		      C 	pop	di			;
 1A89  5A		      C 	pop	dx
 1A8A  59		      C 	pop	cx			;
 1A8B  C3		      C 	ret				;
 1A8C			      C SP_Set_Voice	endp			;
			      C ;***************************************************************
			      C ;*			システム				*
			      C ;***************************************************************
			      C ;===============================================================|
			      C ;			音色テーブルのアドレス			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		AX	Address					|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		音色テーブルのアドレス設定			|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1A8C			      C SP_Set_VoiceAdd	proc near	uses ax	;
 1A8C  50		   *	    push   ax
 1A8D  C1 E8 06		      C 	shr	ax,6			;64Byte単位。64で割る。
 1A90  E6 8F		      C 	out	PCM_Com_VoiceAddress,al	;出力
			      C 	ret				;
 1A92  58		   *	    pop    ax
 1A93  C3		   *	    ret    00000h
 1A94			      C SP_Set_VoiceAdd	endp			;
			      C ;===============================================================|
			      C ;			Channel modeの取得			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		AX	Channel mode(ah = 00h)			|
			      C ;	処理							|
			      C ;		チャンネルモードの取得				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1A94			      C SP_Get_Channel	proc near		;
 1A94  33 C0		      C 	xor	ax,ax			;
 1A96  E4 90		      C 	in	al,PCM_Com_Channel	;入力
 1A98  C3		      C 	ret				;
 1A99			      C SP_Get_Channel	endp			;
			      C ;===============================================================|
			      C ;			Output modeの設定			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		AL	Output mode				|
			      C ;		AH	Set bit					|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		出力モードの設定				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1A9A			      C SP_Set_Output	proc near	uses dx	;
 1A9A  52		   *	    push   dx
 1A9B  BA 0091		      C 	mov	dx,PCM_Com_Output	;dx←I/O Address
 1A9E  E8 0029		      C 	call	SP_Set_with_mask	;
			      C 	ret				;レジスタの復帰
 1AA1  5A		   *	    pop    dx
 1AA2  C3		   *	    ret    00000h
 1AA3			      C SP_Set_Output	endp			;
			      C ;===============================================================|
			      C ;			Output modeの取得			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		AX	Output mode (AH = 0)			|
			      C ;	処理							|
			      C ;		出力モードの取得				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1AA4			      C SP_Get_Output	proc near		;
 1AA4  33 C0		      C 	xor	ax,ax			;
 1AA6  E4 91		      C 	in	al,PCM_Com_Output	;入力
 1AA8  C3		      C 	ret				;
 1AA9			      C SP_Get_Output	endp			;
			      C ;===============================================================|
			      C ;			疑似乱数の取得				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		AX	疑似乱数				|
			      C ;	処理							|
			      C ;		疑似乱数の取得					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1AAA			      C SP_Get_Random	proc near		;
 1AAA  E5 92		      C 	in	ax,PCM_Com_Random	;入力
 1AAC  C3		      C 	ret				;
 1AAD			      C SP_Get_Random	endp			;
			      C ;===============================================================|
			      C ;			PCM Volume Volumeの設定			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		AL	PCM Voice Volume			|
			      C ;		AH	Set bit					|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		出力モードの設定				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1AAE			      C SP_Set_VolumePCM	proc near	uses dx
 1AAE  52		   *	    push   dx
 1AAF  BA 0094		      C 	mov	dx,PCM_Com_VolumePCM	;dx←I/O Address
 1AB2  E8 0015		      C 	call	SP_Set_with_mask	;
			      C 	ret				;レジスタの復帰
 1AB5  5A		   *	    pop    dx
 1AB6  C3		   *	    ret    00000h
 1AB7			      C SP_Set_VolumePCM	endp		;
			      C ;===============================================================|
			      C ;			PCM Volume Volumeの設定			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		AL	PCM Voice Volume			|
			      C ;		AH	Set bit					|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		出力モードの設定				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1AB8			      C SP_Get_VolumePCM	proc near	;
 1AB8  E4 94		      C 	in	al,PCM_Com_VolumePCM	;入力
 1ABA  C3		      C 	ret				;
 1ABB			      C SP_Get_VolumePCM	endp		;
			      C 
			      C ;===============================================================|
			      C ;			PCM Volume Volumeの設定			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		AL	PCM Voice Volume			|
			      C ;		AH	Set bit					|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		出力モードの設定				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1ABC			      C SP_Set_PCMVoice		proc near	uses dx
 1ABC  52		   *	    push   dx
 1ABD  BA 0095		      C 	mov	dx,PCM_Com_VoiceCtrl	;dx←I/O Address
 1AC0  E8 0007		      C 	call	SP_Set_with_mask	;
			      C 	ret				;レジスタの復帰
 1AC3  5A		   *	    pop    dx
 1AC4  C3		   *	    ret    00000h
 1AC5			      C SP_Set_PCMVoice		endp		;
			      C ;===============================================================|
			      C ;			PCM Volume Volumeの設定			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		AL	PCM Voice Volume			|
			      C ;		AH	Set bit					|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		出力モードの設定				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1AC6			      C SP_Get_PCMVoice	proc near		;
 1AC6  E4 95		      C 	in	al,PCM_Com_VoiceCtrl	;入力
 1AC8  C3		      C 	ret				;
 1AC9			      C SP_Get_PCMVoice	endp			;
			      C 
			      C ;---------------------------------------------------------------|
			      C ;		マスクを利用して一部出力			|
			      C ;---------------------------------------------------------------|
			      C ;	dx		i/o address				|
			      C ;	al		set data				|
			      C ;	ah		set bit					|
			      C ;---------------------------------------------------------------|
			      C 	even				;偶数アドレス配置
 1ACA			      C SP_Set_with_mask	proc	near	uses ax cx
			      C 
 1ACA  50		   *	    push   ax
 1ACB  51		   *	    push   cx
 1ACC  22 C4		      C 	and	al,ah			;マスク
 1ACE  8A C8		      C 	mov	cl,al			;ch←Set Data
 1AD0  F6 D4		      C 	not	ah			;マスクデータの反転
 1AD2  EC		      C 	in	al,dx			;入力
 1AD3  22 C4		      C 	and	al,ah			;マスク
 1AD5  0A C1		      C 	or	al,cl			;論理和
 1AD7  EE		      C 	out	dx,al			;出力
			      C 
			      C 	ret				;
 1AD8  59		   *	    pop    cx
 1AD9  58		   *	    pop    ax
 1ADA  C3		   *	    ret    00000h
 1ADB			      C SP_Set_with_mask	endp
			      C ;****************************************************************
			      C ;*								*
			      C ;*			ＭＩＤＩ制御				*
			      C ;*				JIS X 6054-1			*
			      C ;*				JIS X 6054-2 参照		*
			      C ;*								*
			      C ;****************************************************************
			      C ifndef	hyoka
			      C ;===============================================================|
			      C ;			コマンド				|
			      C ;===============================================================|
 = 0080			      C MIDI_Com_KeyOff		equ	080h	;
 = 0090			      C MIDI_Com_KeyOn		equ	090h	;
 = 00A0			      C MIDI_Com_KeyPress	equ	0A0h	;
 = 00B0			      C MIDI_Com_Control	equ	0B0h	;
 = 00C0			      C MIDI_Com_Program	equ	0C0h	;
 = 00D0			      C MIDI_Com_ChPress	equ	0D0h	;
 = 00E0			      C MIDI_Com_PitchBend	equ	0E0h	;
 = 00F0			      C MIDI_Com_Exclucive	equ	0F0h	;
			      C ;===============================================================|
			      C ;			コントロールコード			|
			      C ;===============================================================|
 = 0020			      C MIDI_Ctrl_MSB		equ	20h	;
 = 0000			      C MIDI_Ctrl_Bank		equ	00h	;
 = 0001			      C MIDI_Ctrl_Mod		equ	01h	;
 = 0002			      C MIDI_Ctrl_Bress		equ	02h	;
 = 0004			      C MIDI_Ctrl_Foot		equ	04h	;
 = 0005			      C MIDI_Ctrl_PolTime	equ	05h	;
 = 0006			      C MIDI_Ctrl_DataEntly	equ	06h	;
 = 0007			      C MIDI_Ctrl_Volume	equ	07h	;
 = 0008			      C MIDI_Ctrl_Blance	equ	08h	;
 = 000A			      C MIDI_Ctrl_Pan		equ	0Ah	;
 = 000B			      C MIDI_Ctrl_Expression	equ	0Bh	;
 = 000C			      C MIDI_Ctrl_Effect1	equ	0Ch	;
 = 000D			      C MIDI_Ctrl_Effect2	equ	0Dh	;
 = 0040			      C MIDI_Ctrl_Hold		equ	40h	;
 = 0041			      C MIDI_Ctrl_PolSW		equ	41h	;ポルタメントスイッチ
 = 0042			      C MIDI_Ctrl_S		equ	42h	;ソヌーテート
 = 0043			      C MIDI_Ctrl_Soft		equ	43h	;ソフトペダル
 = 0044			      C MIDI_Ctrl_Legert	equ	44h	;レガートスイッチ
 = 0045			      C MIDI_Ctrl_Hold2		equ	45h	;ホールド
 = 0054			      C MIDI_Ctrl_PolControl	equ	54h	;ポルタメントコントロール
 = 005B			      C MIDI_Ctrl_Reverv	equ	5Bh	;リバーブ
 = 005C			      C MIDI_Ctrl_Tremono	equ	5Ch	;トレモノ
 = 005D			      C MIDI_Ctrl_Chorus	equ	5Dh	;コーラス
 = 005E			      C MIDI_Ctrl_Delay		equ	5Eh	;ディレイ
 = 005F			      C MIDI_Ctrl_F		equ	5Fh	;フェザー
 = 0060			      C MIDI_Ctrl_DataInc	equ	60h	;
 = 0061			      C MIDI_Ctrl_DaraDec	equ	61h	;
 = 0062			      C MIDI_Ctrl_NonRegLSB	equ	62h	;ディレイ
 = 0063			      C MIDI_Ctrl_NonRegMSB	equ	63h	;フェザー
 = 0064			      C MIDI_Ctrl_RegLSB	equ	64h	;
 = 0065			      C MIDI_Ctrl_RegMSB	equ	65h	;
			      C ;===============================================================|
			      C ;			レジスタードパラメータ			|
			      C ;===============================================================|
			      C ;				LSB-MSB
 = 0000			      C MIDI_Reg_PitchBend	equ	0000h	;ピッチベンドセンシティビティ
 = 0001			      C MIDI_Reg_Fain		equ	0001h	;ファインチューン
 = 0002			      C MIDI_Reg_Cose		equ	0002h	;コースチューン
 = 0003			      C MIDI_Reg_CProgram	equ	0003h	;チューニングプログラムセレクト
 = 0004			      C MIDI_Reg_CBank		equ	0004h	;チューニングバンクセレクト
 = 7F7F			      C MIDI_Reg_NULL		equ	7F7Fh	;ヌル
			      C ;===============================================================|
			      C ;			定数					|
			      C ;===============================================================|
 = 000F			      C MIDI_Channel_mask	equ	0Fh	;マスク
			      C ;===============================================================|
			      C ;			エクスクルーシブ			|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1ADC 06 F0 7E 7F 09 01	      C MIDI_Ex_GmReset		db	6,0f0h,7eh,7fh,09h,01h,0f7h
       F7
 1AE3 00		      C MIDI_Ex_GsReset		db	0
 1AE4 00		      C MIDI_Ex_XgReset		db	0
			      C ;===============================================================|
			      C ;			MIDI Running Status			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		al	MIDI Command				|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		ランニング・ステータスを考慮したコマンド送信	|
			      C ;===============================================================|
 1AE5			      C SM_Send_With_Running_Status:		;
 1AE5  3E: 38 86 03B0	      C 	cmp	ds:[bp].WTD_WorkAdd_System+WTD_Sys_RunningStatus,al
 1AEA  74 08		      C 	jz	SM_Send_With_Running_Status_e
 1AEC  E8 0105		      C 	call	C_Send			;コマンドの送信
 1AEF  3E: 88 86 03B0	      C 	mov	ds:[bp].WTD_WorkAdd_System+WTD_Sys_RunningStatus,al
 1AF4			      C SM_Send_With_Running_Status_e:		;
 1AF4  C3		      C 	ret				;
			      C ;===============================================================|
			      C ;			MIDIの初期化				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;			GM Resetの送信				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1AF6			      C SM_init	proc near			;
 1AF6  51		      C 	push	cx			;
 1AF7  56		      C 	push	si			;
 1AF8  06		      C 	push	es			;レジスタ保存
			      C 
 1AF9  0E		      C 	push	cs			;
 1AFA  07		      C 	pop	es			;ds←cs
 1AFB  33 C9		      C 	xor	cx,cx			;cx←MIDI_Ex_GmReset
 1AFD  26: 8A 0E 1ADC R	      C 	mov	cl,byte ptr es:[MIDI_Ex_GmReset]
 1B02  BE 1ADD R	      C 	mov	si,offset CGROUP:MIDI_Ex_GmReset + 1
 1B05  E8 0154		      C 	call	C_Send_Block		;ブロック送信
			      C 
			      C 	;ランニングステータスの初期化
 1B08  C6 44 30 00	      C 	mov	ds:[si].WTD_Sys_RunningStatus,0
			      C 
 1B0C  07		      C 	pop	es			;レジスタ復帰
 1B0D  5E		      C 	pop	si			;
 1B0E  59		      C 	pop	cx			;
 1B0F  C3		      C 	ret				;
 1B10			      C SM_init	endp				;
			      C ;===============================================================|
			      C ;			KeyOff					|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		CH	Track					|
			      C ;		AL	Key					|
			      C ;	返り値							|
			      C ;		AH	00h					|
			      C ;	処理							|
			      C ;		KeyOff						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1B10			      C SM_KeyOff:				;
 1B10  32 E4		      C 	xor	ah,ah			;発音停止(KeyOff)
			      C ;===============================================================|
			      C ;			KeyOn					|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		CH	Track					|
			      C ;		AH	Velocity (0:KeyOff)			|
			      C ;		AL	Key					|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		KeyOn						|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1B12			      C SM_KeyOn	proc near		;
 1B12  51		      C 	push	cx			;レジスタ保存
			      C 
 1B13  50		      C 	push	ax			;レジスタ保存
 1B14  B0 90		      C 	mov	al,MIDI_Com_KeyOn	;
 1B16  80 E5 0F		      C 	and	ch,MIDI_Channel_mask	;
 1B19  0A C5		      C 	or	al,ch			;
 1B1B  E8 FFC7		      C 	call	SM_Send_With_Running_Status	;コマンドの送信
 1B1E  58		      C 	pop	ax			;レジスタ復帰
 1B1F  E8 012E		      C 	call	C_Send_Word		;データの送信
			      C 
 1B22  59		      C 	pop	cx			;レジスタ復帰
 1B23  C3		      C 	ret				;
 1B24			      C SM_KeyOn	endp			;
			      C ;===============================================================|
			      C ;			Poly Key Press				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		CH	Track					|
			      C ;		AH	Pressior				|
			      C ;		AL	Key					|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		キープレッシャー（アフタータッチ）の送信	|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1B24			      C SM_KeyPress	proc near		;
 1B24  51		      C 	push	cx			;レジスタ保存
			      C 
 1B25  50		      C 	push	ax			;レジスタ保存
 1B26  B0 A0		      C 	mov	al,MIDI_Com_KeyPress	;
 1B28  80 E5 0F		      C 	and	ch,MIDI_Channel_mask	;
 1B2B  0A C5		      C 	or	al,ch			;
 1B2D  E8 FFB5		      C 	call	SM_Send_With_Running_Status	;コマンドの送信
 1B30  58		      C 	pop	ax			;レジスタ復帰
 1B31  E8 011C		      C 	call	C_Send_Word		;データの送信
			      C 
 1B34  59		      C 	pop	cx			;レジスタ復帰
 1B35  C3		      C 	ret				;
 1B36			      C SM_KeyPress	endp			;
			      C ;===============================================================|
			      C ;			Control Change Byte			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		CH	Track					|
			      C ;		CL	Reg.					|
			      C ;		AL	Data					|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		Control Change					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1B36			      C SM_ControlByte	proc near		;
 1B36  50		      C 	push	ax			;
 1B37  51		      C 	push	cx			;レジスタ保存
			      C 
 1B38  50		      C 	push	ax			;保存
 1B39  B0 B0		      C 	mov	al,MIDI_Com_Control	;
 1B3B  80 E5 0F		      C 	and	ch,MIDI_Channel_mask	;
 1B3E  0A C5		      C 	or	al,ch			;
 1B40  E8 FFA2		      C 	call	SM_Send_With_Running_Status	;コマンドの送信
 1B43  58		      C 	pop	ax			;復帰
 1B44  8A E0		      C 	mov	ah,al			;
 1B46  8A C1		      C 	mov	al,cl			;
 1B48  E8 0105		      C 	call	C_Send_Word		;データの送信
			      C 
 1B4B  59		      C 	pop	cx			;レジスタ復帰
 1B4C  58		      C 	pop	ax			;
 1B4D  C3		      C 	ret				;
 1B4E			      C SM_ControlByte	endp			;
			      C ;===============================================================|
			      C ;			Control Change Word			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		CH	Track					|
			      C ;		CL	Reg.					|
			      C ;		AX	Data					|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		Control Change					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1B4E			      C SM_ControlWord	proc near		;
 1B4E  50		      C 	push	ax			;
 1B4F  51		      C 	push	cx			;レジスタ保存
			      C 
 1B50  D1 E0		      C 	shl	ax,1			;
 1B52  D0 E8		      C 	shr	al,1			;
 1B54  25 7F7F		      C 	and	ax,07f7fh		;データの分離
			      C 
 1B57  50		      C 	push	ax			;保存
 1B58  B0 B0		      C 	mov	al,MIDI_Com_Control	;
 1B5A  80 E5 0F		      C 	and	ch,MIDI_Channel_mask	;
 1B5D  0A C5		      C 	or	al,ch			;
 1B5F  E8 FF83		      C 	call	SM_Send_With_Running_Status	;コマンドの送信
 1B62  58		      C 	pop	ax			;復帰
 1B63  50		      C 	push	ax			;
 1B64  8A C1		      C 	mov	al,cl			;
 1B66  E8 00E7		      C 	call	C_Send_Word		;レジスタ(ah)，データの送信(ah(LSB))
 1B69  58		      C 	pop	ax			;復帰
 1B6A  8A E0		      C 	mov	ah,al			;
 1B6C  8A C1		      C 	mov	al,cl			;
 1B6E  04 20		      C 	add	al,MIDI_Ctrl_MSB	;
 1B70  E8 00DD		      C 	call	C_Send_Word		;レジスタ(ah)，データの送信(al(MSB))
			      C 
 1B73  59		      C 	pop	cx			;レジスタ復帰
 1B74  58		      C 	pop	ax			;
 1B75  C3		      C 	ret				;
 1B76			      C SM_ControlWord	endp			;
			      C ;===============================================================|
			      C ;			Program Change				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		CH	Track					|
			      C ;		AL	Program					|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		Program Change					|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1B76			      C SM_Program	proc near		;
 1B76  50		      C 	push	ax			;
 1B77  51		      C 	push	cx			;レジスタ保存
			      C 
 1B78  8A E0		      C 	mov	ah,al			;
 1B7A  B0 C0		      C 	mov	al,MIDI_Com_Program	;
 1B7C  80 E5 0F		      C 	and	ch,MIDI_Channel_mask	;
 1B7F  0A C5		      C 	or	al,ch			;
 1B81  E8 FF61		      C 	call	SM_Send_With_Running_Status	;コマンドの送信
 1B84  8A C4		      C 	mov	al,ah			;
 1B86  E8 006B		      C 	call	C_Send			;データの送信
			      C 
 1B89  59		      C 	pop	cx			;レジスタ復帰
 1B8A  58		      C 	pop	ax			;
 1B8B  C3		      C 	ret				;
 1B8C			      C SM_Program	endp			;
			      C ;===============================================================|
			      C ;			Program Change with Bank		|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		CH	Track					|
			      C ;		AL	Program					|
			      C ;		BX	Bank(AH:Msb,AL:Lsb)			|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		Program ChangeとBank Selectの送信		|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1B8C			      C SM_BankProgram	proc near		;
 1B8C  51		      C 	push	cx			;レジスタの保存
			      C 
 1B8D  50		      C 	push	ax			;
 1B8E  B1 00		      C 	mov	cl,MIDI_Ctrl_Bank	;バンクセレクト
 1B90  8B C3		      C 	mov	ax,bx			;バンク
 1B92  D0 E0		      C 	shl	al,1			;
 1B94  D1 E8		      C 	shr	ax,1			;
 1B96  25 3FFF		      C 	and	ax,03fffh		;データ合成
 1B99  E8 FFB2		      C 	call	SM_ControlWord		;
 1B9C  58		      C 	pop	ax			;
 1B9D  E8 FFD6		      C 	call	SM_Program		;プログラムチェンジ
			      C 	
 1BA0  59		      C 	pop	cx			;レジスタの復帰
 1BA1  C3		      C 	ret				;
 1BA2			      C SM_BankProgram	endp			;
			      C ;===============================================================|
			      C ;			Poly Ch Press				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		CH	Track					|
			      C ;		AL	Pressior				|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		キープレッシャー（アフタータッチ）の送信	|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1BA2			      C SM_ChPress	proc near		;
 1BA2  51		      C 	push	cx			;
 1BA3  50		      C 	push	ax			;レジスタ保存
			      C 
 1BA4  8A E0		      C 	mov	ah,al			;
 1BA6  B0 A0		      C 	mov	al,MIDI_Com_KeyPress	;
 1BA8  80 E5 0F		      C 	and	ch,MIDI_Channel_mask	;
 1BAB  0A C5		      C 	or	al,ch			;
 1BAD  E8 FF35		      C 	call	SM_Send_With_Running_Status	;コマンドの送信
 1BB0  8A C4		      C 	mov	al,ah			;
 1BB2  E8 003F		      C 	call	C_Send			;データの送信
			      C 
 1BB5  58		      C 	pop	ax			;レジスタ復帰
 1BB6  59		      C 	pop	cx			;
 1BB7  C3		      C 	ret				;
 1BB8			      C SM_ChPress	endp			;
			      C ;===============================================================|
			      C ;			Pitch Bend				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		CH	Track					|
			      C ;		AX	Pitch Bend				|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		Pitch Bendの送信				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1BB8			      C SM_PitchBend	proc near		;
 1BB8  51		      C 	push	cx			;レジスタ保存
			      C 
 1BB9  50		      C 	push	ax			;レジスタ保存
 1BBA  B0 E0		      C 	mov	al,MIDI_Com_PitchBend	;
 1BBC  80 E5 0F		      C 	and	ch,MIDI_Channel_mask	;
 1BBF  0A C5		      C 	or	al,ch			;
 1BC1  E8 FF21		      C 	call	SM_Send_With_Running_Status	;コマンドの送信
 1BC4  58		      C 	pop	ax			;レジスタ復帰
 1BC5  50		      C 	push	ax			;レジスタ保存
 1BC6  D1 E0		      C 	shl	ax,1			;
 1BC8  D0 E8		      C 	shr	al,1			;
 1BCA  25 7F7F		      C 	and	ax,07f7fh		;データの分離
 1BCD  E8 0080		      C 	call	C_Send_Word		;データの送信
 1BD0  58		      C 	pop	ax			;レジスタ復帰
			      C 
 1BD1  59		      C 	pop	cx			;レジスタ復帰
 1BD2  C3		      C 	ret				;
 1BD3			      C SM_PitchBend	endp			;
			      C ;===============================================================|
			      C endif
			      C 
				include	wtd_com.asm			;シリアル制御用サブルーチン
			      C ;=======================================================================|
			      C ;									|
			      C ;		Wander Swan Total Sound Driver				|
			      C ;				Serial Control				|
			      C ;									|
			      C ;					Programmed by			|
			      C ;						A.Watanabe		|
			      C ;									|
			      C ;=======================================================================|
			      C ifndef	hyoka
			      C ;===============================================================|
			      C ;			I/O Address				|
			      C ;===============================================================|
 = 00B1			      C COMM_DATA		equ	0b1h	;Send / Receive data
 = 00B3			      C COMM_STATUS		equ	0b3h	;Serial Status
			      C ;===============================================================|
			      C ;			INT Status bit flag			|
			      C ;===============================================================|
 = 0001			      C INT_CommSendSet		equ	001h	;CommSend値セット　(or)
 = 00FE			      C INT_CommSendReset	equ	0feh	;CommSend値リセット(and)
			      C ;===============================================================|
			      C ;			COMM Status bit flag			|
			      C ;===============================================================|
 = 0001			      C COMM_Receive		equ	001h	;受信データ有り（受信可）
 = 0002			      C COMM_OverRun		equ	002h	;オーバーラン・エラー
 = 0004			      C COMM_SendEmpty		equ	004h	;送信バッファ空（送信可）
 = 0020			      C COMM_OrReset		equ	020h	;オーバーラン・エラーのリセット
 = 0000			      C COMM_Baudrate9K		equ	000h	;ボーレート（ 9600 [bps])(+)
 = 0040			      C COMM_Baudrate38k	equ	040h	;ボーレート（38400 [bps])(+)
 = 0080			      C COMM_Enable		equ	080h	;通信イネーブル(or)
 = 007F			      C COMM_Disable		equ	07fh	;通信ディセーブル(and)
			      C ;===============================================================|
			      C ;			定数					|
			      C ;===============================================================|
 = FFFF			      C COMM_TimeOut		equ	0ffffh	;タイムアウトの時間
			      C ;===============================================================|
			      C ;			通信回線を開く				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		回線を38400bpsに設定、通信回線を開く。		|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1BD4			      C C_Open	proc near	uses ax		;
			      C 	
 1BD4  50		   *	    push   ax
 1BD5  B0 E0		      C 	mov	al,COMM_OrReset + COMM_Baudrate38k + COMM_Enable
 1BD7  E6 B3		      C 	out	COMM_Status,al		;
			      C 
			      C 	ret				;
 1BD9  58		   *	    pop    ax
 1BDA  C3		   *	    ret    00000h
 1BDB			      C C_Open	endp				;
			      C ;===============================================================|
			      C ;			通信回線を閉じる			|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		無し						|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		通信回線を閉じる。				|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1BDC			      C C_Close	proc near	uses ax		;
			      C 
 1BDC  50		   *	    push   ax
			      C 	.repeat
 1BDD			   *@C0171:
 1BDD  E4 B3		      C 	  in	al,COMM_Status			;ステータス読み込み
			      C 	  .break  .if	!(al&COMM_Enable)	;通信機能はイネーブル？
 1BDF  A8 80		   *	    test   al, COMM_Enable
 1BE1  74 04		   *	    je     @C0173
			      C 	.until		 (al&COMM_SendEmpty)	;送信データ空？
 1BE3  A8 04		   *	    test   al, COMM_SendEmpty
 1BE5  74 F6		   *	    je     @C0171
 1BE7			   *@C0173:
 1BE7  24 7F		      C 	and	al,COMM_Disable		;通信ディセーブル設定。
 1BE9  E6 B3		      C 	out	COMM_Status,al		;出力
			      C 
 1BEB  E4 B2		      C 	in	al,Int_Enable		;
 1BED  24 FE		      C 	and	al,INT_CommSendReset	;シリアル送信エンプティー
 1BEF  E6 B2		      C 	out	Int_Enable,al		;割り込み禁止
			      C 
			      C 	ret				;
 1BF1  58		   *	    pop    ax
 1BF2  C3		   *	    ret    00000h
 1BF3			      C C_Close	endp				;
			      C ;===============================================================|
			      C ;			1 byte送信				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		al	send data				|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		回線にデータを出力する。			|
			      C ;		送信中だったら、FIFOへ書き込み			|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1BF4			      C C_Send	proc near	uses ax bx cx di si es
			      C 
 1BF4  50		   *	    push   ax
 1BF5  53		   *	    push   bx
 1BF6  51		   *	    push   cx
 1BF7  57		   *	    push   di
 1BF8  56		   *	    push   si
 1BF9  06		   *	    push   es
 1BFA  9C		      C 	pushf				;
 1BFB  FA		      C 	cli
			      C 
 1BFC  8B C8		      C 	mov	cx,ax
			      C 
 1BFE  E4 B2		      C 	in	al,Int_Enable		;
 1C00  24 FE		      C 	and	al,INT_CommSendReset	;シリアル送信エンプティー
 1C02  E6 B2		      C 	out	Int_Enable,al		;割り込み禁止
			      C 
			      C 	;ハードウェア送信バッファ ＆ ソフトウェアFIFOバッファ が両方とも空であるかチェック。
 1C04  3E: 8B 9E 03AA	      C 	mov	bx,word ptr ds:[bp].WTD_WorkAdd_System+WTD_Sys_ComFIFO_Cnt
 1C09  8D B6 03AC	      C 	lea	si,word ptr ds:[bp].WTD_WorkAdd_System+WTD_Sys_ComFIFO_Adr
 1C0D  E4 B3		      C 	in	al,COMM_Status		;ステータス読み込み
			      C 	.if	((!(al & COMM_SendEmpty))||(bx != word ptr ds:[si]))
 1C0F  A8 04		   *	    test   al, COMM_SendEmpty
 1C11  74 04		   *	    je     @C0177
 1C13  3B 1C		   *	    cmp    bx, word ptr ds : [si]
 1C15  74 2C		   *	    je     @C0176
 1C17			   *@C0177:
			      C 		;空ではなかった。（まだ送信中）
 1C17  8B FB		      C 		mov	di,bx			;di ← 現在の書き込みポインタ
 1C19  43		      C 		inc	bx			
			      C 		.if	(bx >= word ptr ds:[bp].WTD_WorkAdd_System+WTD_Sys_ComFIFO_Size)
 1C1A  3E: 3B 9E 03AE	   *	    cmp    bx, word ptr ds : [bp] . WTD_WorkAdd_System + WTD_Sys_ComFIFO_Size
 1C1F  72 02		   *	    jb     @C0179
 1C21  33 DB		      C 			xor	bx,bx		;
			      C 		.endif				;bx ← 次の書き込みポインタ
			      C 		.while	(bx == word ptr ds:[si])
 1C23			   *@C0179:
 1C23  EB 03		   *	    jmp    @C017B
 1C25			   *@C017C:
 1C25  E8 0042		      C 			call	IC_Send		;FIFOの送信を試みる。
			      C 		.endw				;FIFOに空きが出来るまで繰り返す。
 1C28			   *@C017B:
 1C28  3B 1C		   *	    cmp    bx, word ptr ds : [si]
 1C2A  74 F9		   *	    je     @C017C
 1C2C  3E: 89 9E 03AA	      C 		mov	word ptr ds:[bp].WTD_WorkAdd_System+WTD_Sys_ComFIFO_Cnt,bx
			      C 
 1C31  3E: C4 9E 039C	      C 		les	bx,dword ptr ds:[bp].(WTD_WorkAdd_System+WTD_Sys_ComFIFO_Offset)
 1C36  8B C1		      C 		mov	ax,cx			;al←送信データ
 1C38  26: 88 01	      C 		mov	byte ptr es:[di+bx],al	;FIFOバッファに書き込み
			      C 
 1C3B  E4 B2		      C 		in	al,Int_Enable		;バッファにデータが来たので、
 1C3D  0C 01		      C 		or	al,INT_CommSendSet	;シリアル送信エンプティー
 1C3F  E6 B2		      C 		out	Int_Enable,al		;割り込み許可
			      C 
			      C 	.else
 1C41  EB 04		   *	    jmp    @C017E
 1C43			   *@C0176:
			      C 		;どっちも空だったら、FIFO割り込み使わないで直接出力する。
 1C43  8B C1		      C 		mov	ax,cx			;al←送信データ
 1C45  E6 B1		      C 		out	COMM_DATA,al		;送信
			      C 	.endif
 1C47			   *@C017E:
			      C 
 1C47  9D		      C 	popf				;
			      C 	ret				;
 1C48  07		   *	    pop    es
 1C49  5E		   *	    pop    si
 1C4A  5F		   *	    pop    di
 1C4B  59		   *	    pop    cx
 1C4C  5B		   *	    pop    bx
 1C4D  58		   *	    pop    ax
 1C4E  C3		   *	    ret    00000h
			      C ;----------------------------------------------------------------
			      C ;C_Send_0:
			      C ;	mov	di,ds:[bp].WTD_WorkAdd_System+WTD_Sys_ComFIFO_Cnt
			      C ;;	mov	di,ax			;ax←FIFOポインタCnt
			      C ;
			      C ;	mov	bx,ds:[bp].WTD_WorkAdd_System+WTD_Sys_ComFIFO_Cnt
			      C ;
			      C ;	inc	word ptr ds:[bp].WTD_WorkAdd_System+WTD_Sys_ComFIFO_Cnt
			      C ;	mov	ax,word ptr ds:[bp].WTD_WorkAdd_System+WTD_Sys_ComFIFO_Cnt
			      C ;	cmp	ax,word ptr ds:[bp].WTD_WorkAdd_System+WTD_Sys_ComFIFO_Size
			      C ;	jnz	C_Send_1		;
			      C ;	mov	word ptr ds:[bp].WTD_WorkAdd_System+WTD_Sys_ComFIFO_Cnt,0
			      C ;C_Send_1:				;
			      C ;	mov	ax,word ptr ds:[bp].WTD_WorkAdd_System+WTD_Sys_ComFIFO_Cnt
			      C ;	cmp	ax,word ptr ds:[bp].WTD_WorkAdd_System+WTD_Sys_ComFIFO_Adr
			      C ;	jnz	C_Send_3		;FIFOバッファはいっぱい？
			      C ;	mov	word ptr ds:[bp].WTD_WorkAdd_System+WTD_Sys_ComFIFO_Cnt,bx
			      C ;	call	IC_Send			;FIFOの送信を試みて、
			      C ;	jmp	C_Send_1		;やり直し。
			      C ;
			      C ;C_Send_3:				;
			      C ;;	mov	bx,word ptr ds:[bp].WTD_WorkAdd_System+WTD_Sys_ComFIFO_Offset
			      C ;;	mov	es,word ptr ds:[bp].WTD_WorkAdd_System+WTD_Sys_ComFIFO_Segment
			      C ;	les	bx,dword ptr ds:[bp].(WTD_WorkAdd_System+WTD_Sys_ComFIFO_Offset)
			      C ;	pop	ax			;FIFOバッファに書き込み
			      C ;	push	ax			;
			      C ;	mov	byte ptr es:[di+bx],al	;
			      C ;
			      C ;C_Send_e:
			      C ;	in	al,Int_Enable		;バッファにデータが来たので、
			      C ;	or	al,INT_CommSendSet	;シリアル送信エンプティー
			      C ;	out	Int_Enable,al		;割り込み許可
			      C ;
			      C ;	pop	ax			;
			      C ;	pop	bx			;
			      C ;	pop	di			;レジスタ復帰
			      C ;	pop	es			;
			      C ;	popf				;
			      C ;	ret				;
 1C4F			      C C_Send	endp				;
			      C ;===============================================================|
			      C ;			2 byte送信				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		ax	send data(al:LSB,ah:MSB)		|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		回線にデータを出力する。			|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1C50			      C C_Send_Word	proc near		;
 1C50  E8 FFA1		      C 	call	C_Send			;
 1C53  86 C4		      C 	xchg	al,ah			;
 1C55  E8 FF9C		      C 	call	C_Send			;
 1C58  86 C4		      C 	xchg	al,ah			;
 1C5A  C3		      C 	ret				;
 1C5B			      C C_Send_Word	endp			;
			      C ;===============================================================|
			      C ;			ブロック送信				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		CX	Size					|
			      C ;		DS:SI	Data Address				|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		回線にデータを出力する。			|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1C5C			      C C_Send_Block	proc near	uses ax cx si
			      C 
 1C5C  50		   *	    push   ax
 1C5D  51		   *	    push   cx
 1C5E  56		   *	    push   si
			      C 	.repeat
 1C5F			   *@C017F:
 1C5F  AC		      C 		lodsb			;
 1C60  E8 FF91		      C 		call	C_Send		;送信
			      C 	.untilcxz
 1C63  E2 FA		   *	    loop   @C017F
			      C 
			      C 	ret				;
 1C65  5E		   *	    pop    si
 1C66  59		   *	    pop    cx
 1C67  58		   *	    pop    ax
 1C68  C3		   *	    ret    00000h
 1C69			      C C_Send_Block	endp			;
			      C ;===============================================================|
			      C ;			1 byte送信				|
			      C ;===============================================================|
			      C ;	引き数							|
			      C ;		FIFO	send data				|
			      C ;	返り値							|
			      C ;		無し						|
			      C ;	処理							|
			      C ;		FIFOから回線にデータを出力する。		|
			      C ;===============================================================|
			      C 	even				;偶数アドレス配置
 1C6A			      C IC_Send	proc	near	uses ax bx dx di es
 1C6A  50		   *	    push   ax
 1C6B  53		   *	    push   bx
 1C6C  52		   *	    push   dx
 1C6D  57		   *	    push   di
 1C6E  06		   *	    push   es
 1C6F  9C		      C 	pushf				;
 1C70  FA		      C 	cli				;
			      C 
			      C ;---------------------------------------------------------------
 1C71  E4 B2		      C 	in	al,Int_Enable		;
 1C73  24 FE		      C 	and	al,INT_CommSendReset	;シリアル送信エンプティー
 1C75  E6 B2		      C 	out	Int_Enable,al		;割り込み禁止
			      C 
 1C77  3E: 8B 96 03AA	      C 	mov	dx,word ptr ds:[bp].WTD_WorkAdd_System+WTD_Sys_ComFIFO_Cnt
 1C7C  3E: 8B 9E 03AC	      C 	mov	bx,word ptr ds:[bp].WTD_WorkAdd_System+WTD_Sys_ComFIFO_Adr
			      C 	.if	(dx != bx)			;空だったら処理しない。
 1C81  3B D3		   *	    cmp    dx, bx
 1C83  74 2D		   *	    je     @C0180
			      C 
			      C 	   ;まだハードウェアで送信中だったら、FIFO送信はしない。
 1C85  E4 B3		      C 	   in	al,COMM_Status			;ステータス読み込み
			      C 	   .if	(al & COMM_SendEmpty)		;送信バッファ空？
 1C87  A8 04		   *	    test   al, COMM_SendEmpty
 1C89  74 1D		   *	    je     @C0182
 1C8B  8B FB		      C 		mov	di,bx			;di ← 現在の読み込みポインタ
 1C8D  43		      C 		inc	bx			;
			      C 		.if	(bx >= word ptr ds:[bp].WTD_WorkAdd_System+WTD_Sys_ComFIFO_Size)
 1C8E  3E: 3B 9E 03AE	   *	    cmp    bx, word ptr ds : [bp] . WTD_WorkAdd_System + WTD_Sys_ComFIFO_Size
 1C93  72 02		   *	    jb     @C0184
 1C95  33 DB		      C 			xor	bx,bx		;
			      C 		.endif				;bx ← 次の読み込みポインタ
 1C97			   *@C0184:
 1C97  3E: 89 9E 03AC	      C 		mov	word ptr ds:[bp].WTD_WorkAdd_System+WTD_Sys_ComFIFO_Adr,bx
 1C9C  53		      C 		push	bx			;
 1C9D  3E: C4 9E 039C	      C 		les	bx,dword ptr ds:[bp].(WTD_WorkAdd_System+WTD_Sys_ComFIFO_Offset)
 1CA2  26: 8A 01	      C 		mov	al,byte ptr es:[di+bx]	;
 1CA5  E6 B1		      C 		out	COMM_DATA,al		;送信
 1CA7  5B		      C 		pop	bx			;
			      C 	   .endif				;
			      C 	   .if	(dx != bx)			;空だったら処理しない。（送信後の再check）
 1CA8			   *@C0182:
 1CA8  3B D3		   *	    cmp    dx, bx
 1CAA  74 06		   *	    je     @C0186
 1CAC  E4 B2		      C 		in	al,Int_Enable		;
 1CAE  0C 01		      C 		or	al,INT_CommSendSet	;シリアル送信エンプティー
 1CB0  E6 B2		      C 		out	Int_Enable,al		;割り込み許可
			      C 	   .endif
			      C 	.endif
 1CB2			   *@C0186:
 1CB2			   *@C0180:
			      C 
 1CB2  9D		      C 	popf				;
			      C 	ret				;
 1CB3  07		   *	    pop    es
 1CB4  5F		   *	    pop    di
 1CB5  5A		   *	    pop    dx
 1CB6  5B		   *	    pop    bx
 1CB7  58		   *	    pop    ax
 1CB8  C3		   *	    ret    00000h
 1CB9			      C IC_Send	endp
			      C ;===============================================================|
			      C endif
			      C 

 1CB9				_TEXT	ends

				;=======================================================================|
				;				グローバル変数				|
				;=======================================================================|
				ifdef	library				;※　ライブラリ版のみ必要
 0000				_BSS	segment para public 'BSS'

				include wtd_lib.asm			;ライブラリ版　データ領域
			      C ;=======================================================================|
			      C ;									|
			      C ;		Wander Swan Total Sound Driver				|
			      C ;				Work erea for library			|
			      C ;									|
			      C ;					Programmed by			|
			      C ;						A.Watanabe		|
			      C ;									|
			      C ;=======================================================================|
			      C ;****************************************************************
			      C ;*								*
			      C ;*			グローバル変数 外部宣言			*
			      C ;*								*
			      C ;****************************************************************
			      C 	public	_WTD_Work		;制御用ワーク
			      C 
			      C ;****************************************************************
			      C ;*								*
			      C ;*			グローバル変数 実体			*
			      C ;*								*
			      C ;****************************************************************
			      C ;-------------------------------
			      C ;制御用ワーク
			      C ;-------------------------------
			      C 
			      C ifdef	hyoka	;------------------------
			      C ;static	cahr		WTD_Work[0x0800]	;MIDI無し版は、2kByte要
			      C _WTD_Work:		db	0800h	dup	(?)
			      C else	;--------------------------------
			      C ;static	cahr		WTD_Work[0x1000]	;MIDI有り版は、4kByte要
 0000  1000 [		      C _WTD_Work:		db	1000h	dup	(?)
        00
       ]
			      C endif	;--------------------------------
			      C 
			      C 

 1000				_BSS	ends
				endif
				;=======================================================================|

					end
Microsoft (R) Macro Assembler Version 6.11		    04/22/12 02:03:04
WTD.asm							     Symbols 2 - 1




Macros:

                N a m e                 Type

ROM0_GET_MAP . . . . . . . . . .	Proc
ROM0_SET_MAP . . . . . . . . . .	Proc
ROM1_GET_MAP . . . . . . . . . .	Proc
ROM1_SET_MAP . . . . . . . . . .	Proc
SRAM_GET_MAP . . . . . . . . . .	Proc
SRAM_SET_MAP . . . . . . . . . .	Proc
WTD_WorkGet  . . . . . . . . . .	Proc


Structures and Unions:

                N a m e                  Size
                                         Offset      Type

ProcContext  . . . . . . . . . .	 0060
  ProcContext_id . . . . . . . .	 0000	     Byte
  ProcContext_pid  . . . . . . .	 0004	     Word
  ProcContext_ppid . . . . . . .	 0006	     Word
  ProcContext_pcbid  . . . . . .	 0008	     Word
  ProcContext_ppcbib . . . . . .	 000A	     Word
  ProcContext_ilib . . . . . . .	 000C	     DWord
  ProcContext_proc . . . . . . .	 0010	     DWord
  ProcContext_cwfs . . . . . . .	 0014	     DWord
  ProcContext_currentdir . . . .	 0018	     Byte
  ProcContext_argv . . . . . . .	 0058	     Word
  ProcContext_resource . . . . .	 005A	     DWord
  ProcContext_heap . . . . . . .	 005E	     Word
ProcControl  . . . . . . . . . .	 0010
  ProcControl_status . . . . . .	 0000	     Word
  ProcControl_exit_code  . . . .	 0002	     Word
  ProcControl_born . . . . . . .	 0004	     DWord
  ProcControl_started  . . . . .	 0008	     DWord
  ProcControl_ellapse  . . . . .	 000C	     DWord
RiffHed  . . . . . . . . . . . .	 0009
  RiffHed_Head . . . . . . . . .	 0000	     Byte
  RiffHed_Size . . . . . . . . .	 0004	     DWord
  RiffHed_Data . . . . . . . . .	 0008	     Byte
Riff . . . . . . . . . . . . . .	 000D
  Riff_Head  . . . . . . . . . .	 0000	     Byte
  Riff_Size  . . . . . . . . . .	 0004	     DWord
  Riff_Type  . . . . . . . . . .	 0008	     Byte
  Riff_Data  . . . . . . . . . .	 000C	     Byte
WTD_ChEmb  . . . . . . . . . . .	 0005
  WTD_ChEmb_Address  . . . . . .	 0000	     Byte
  WTD_ChEmb_Rate . . . . . . . .	 0001	     Byte
  WTD_ChEmb_Counter  . . . . . .	 0002	     Byte
  WTD_ChEmb_MaxMin . . . . . . .	 0003	     Byte
  WTD_ChEmb_LevelSet . . . . . .	 0004	     Byte
WTD_ChLfo  . . . . . . . . . . .	 0009
  WTD_ChLfo_DecayRate  . . . . .	 0000	     Byte
  WTD_ChLfo_SpeedRate  . . . . .	 0001	     Byte
  WTD_ChLfo_Level  . . . . . . .	 0002	     Word
  WTD_ChLfo_Count  . . . . . . .	 0004	     Byte
  WTD_ChLfo_RateCounter  . . . .	 0005	     Byte
  WTD_ChLfo_LevelSet . . . . . .	 0006	     Word
  WTD_ChLfo_CountCounter . . . .	 0008	     Byte
WTD_Emb  . . . . . . . . . . . .	 0010
  WTD_Emb_AR . . . . . . . . . .	 0000	     Byte
  WTD_Emb_AS . . . . . . . . . .	 0001	     Byte
  WTD_Emb_AL . . . . . . . . . .	 0002	     Byte
  WTD_Emb_FL . . . . . . . . . .	 0003	     Byte
  WTD_Emb_DR . . . . . . . . . .	 0004	     Byte
  WTD_Emb_DS . . . . . . . . . .	 0005	     Byte
  WTD_Emb_DL . . . . . . . . . .	 0006	     Byte
  WTD_Emb_Null1  . . . . . . . .	 0007	     Byte
  WTD_Emb_SR . . . . . . . . . .	 0008	     Byte
  WTD_Emb_SS . . . . . . . . . .	 0009	     Byte
  WTD_Emb_SL . . . . . . . . . .	 000A	     Byte
  WTD_Emb_Null2  . . . . . . . .	 000B	     Byte
  WTD_Emb_RR . . . . . . . . . .	 000C	     Byte
  WTD_Emb_RS . . . . . . . . . .	 000D	     Byte
  WTD_Emb_RL . . . . . . . . . .	 000E	     Byte
  WTD_Emb_Null3  . . . . . . . .	 000F	     Byte
WTD_MusEx  . . . . . . . . . . .	 0000
WTD_Mus  . . . . . . . . . . . .	 0012
  WTD_Mus_Name . . . . . . . . .	 0000	     Byte
  WTD_Mus_Version  . . . . . . .	 0004	     Word
  WTD_Mus_Extr . . . . . . . . .	 0006	     Word
  WTD_Mus_Emb  . . . . . . . . .	 0008	     Byte
  WTD_Mus_Voice  . . . . . . . .	 0009	     Byte
  WTD_Mus_Part . . . . . . . . .	 000A	     Byte
  WTD_Mus_TimeBase . . . . . . .	 000B	     Byte
  WTD_Mus_ExtrAdr  . . . . . . .	 000C	     Word
  WTD_Mus_DataAdr  . . . . . . .	 000E	     Word
  WTD_Mus_PartAdr  . . . . . . .	 0010	     Word
WTD_Sys  . . . . . . . . . . . .	 0034
  WTD_Sys_Flag . . . . . . . . .	 0000	     Word
  WTD_Sys_ProgramOffset  . . . .	 0002	     Word
  WTD_Sys_ProgramSegment . . . .	 0004	     Word
  WTD_Sys_MusicOffset  . . . . .	 0006	     Word
  WTD_Sys_MusicSegment . . . . .	 0008	     Word
  WTD_Sys_EffectOffset . . . . .	 000A	     Word
  WTD_Sys_EffectSegment  . . . .	 000C	     Word
  WTD_Sys_PcmOffset  . . . . . .	 000E	     Word
  WTD_Sys_PcmSegment . . . . . .	 0010	     Word
  WTD_Sys_StayOutMask  . . . . .	 0012	     Word
  WTD_Sys_OldIntvector . . . . .	 0014	     Word
  WTD_Sys_OldIntvectorCom  . . .	 0018	     Word
  WTD_Sys_ComFIFO_Offset . . . .	 001C	     Word
  WTD_Sys_ComFIFO_Segment  . . .	 001E	     Word
  WTD_Sys_Null_20  . . . . . . .	 0020	     Byte
  WTD_Sys_VolumeMusic  . . . . .	 0021	     Byte
  WTD_Sys_VolumeEffect . . . . .	 0022	     Byte
  WTD_Sys_VolumePCM  . . . . . .	 0023	     Byte
  WTD_Sys_Tempo  . . . . . . . .	 0024	     Word
  WTD_Sys_TempoCounter . . . . .	 0026	     Word
  WTD_Sys_MusicPart  . . . . . .	 0028	     Byte
  WTD_Sys_EffectPart . . . . . .	 0029	     Byte
  WTD_Sys_ComFIFO_Cnt  . . . . .	 002A	     Word
  WTD_Sys_ComFIFO_Adr  . . . . .	 002C	     Word
  WTD_Sys_ComFIFO_Size . . . . .	 002E	     Word
  WTD_Sys_RunningStatus  . . . .	 0030	     Byte
  WTD_Sys_InterruptBase  . . . .	 0031	     Byte
  WTD_Sys_VoiceTableOffset . . .	 0032	     Word
WTD  . . . . . . . . . . . . . .	 007A
  WTD_FlagControl  . . . . . . .	 0000	     Word
  WTD_FlagTai  . . . . . . . . .	 0002	     Byte
  WTD_FlagSharp  . . . . . . . .	 0003	     Byte
  WTD_FlagFlat . . . . . . . . .	 0004	     Byte
  WTD_Channel  . . . . . . . . .	 0005	     Byte
  WTD_Address  . . . . . . . . .	 0006	     Word
  WTD_LoopCount  . . . . . . . .	 0008	     Byte
  WTD_LoopCountPointer . . . . .	 0010	     Byte
  WTD_Program  . . . . . . . . .	 0011	     Byte
  WTD_SweepLevel . . . . . . . .	 0012	     Byte
  WTD_SweepTime  . . . . . . . .	 0013	     Byte
  WTD_Leng . . . . . . . . . . .	 0014	     Word
  WTD_LengCounter  . . . . . . .	 0016	     Word
  WTD_LengDefault  . . . . . . .	 0018	     Word
  WTD_KeyOffTime . . . . . . . .	 001A	     Word
  WTD_KeyOnDelay . . . . . . . .	 001C	     Word
  WTD_KeyShift . . . . . . . . .	 001E	     Byte
  WTD_Key  . . . . . . . . . . .	 001F	     Byte
  WTD_KeySet . . . . . . . . . .	 0020	     Byte
  WTD_KeySetPointer  . . . . . .	 0028	     Byte
  WTD_AcsentVelocity . . . . . .	 0029	     Byte
  WTD_BendSet  . . . . . . . . .	 002A	     Word
  WTD_Bend . . . . . . . . . . .	 002C	     Word
  WTD_BendDetune . . . . . . . .	 002E	     Word
  WTD_BendLfoDecayRate . . . . .	 0030	     Byte
  WTD_BendLfoSpeedRate . . . . .	 0031	     Byte
  WTD_BendLfoLevel . . . . . . .	 0032	     Word
  WTD_BendLfoCount . . . . . . .	 0034	     Byte
  WTD_BendLfoRateCounter . . . .	 0035	     Byte
  WTD_BendLfoLevelSet  . . . . .	 0036	     Word
  WTD_BendLfoCountCounter  . . .	 0038	     Byte
  WTD_BendEmbAddress . . . . . .	 0039	     Byte
  WTD_BendEmbRate  . . . . . . .	 003A	     Byte
  WTD_BendEmbCounter . . . . . .	 003B	     Byte
  WTD_BendEmbMaxMin  . . . . . .	 003C	     Byte
  WTD_BendEmbLevelSet  . . . . .	 003D	     Byte
  WTD_ReleaseVolume  . . . . . .	 003E	     Byte
  WTD_ExprPanSet . . . . . . . .	 003F	     Byte
  WTD_ExprSet  . . . . . . . . .	 0040	     Byte
  WTD_Expr . . . . . . . . . . .	 0041	     Byte
  WTD_ExprDetune . . . . . . . .	 0042	     Word
  WTD_ExprLfoDecayRate . . . . .	 0044	     Byte
  WTD_ExprLfoSpeedRate . . . . .	 0045	     Byte
  WTD_ExprLfoLevel . . . . . . .	 0046	     Word
  WTD_ExprLfoCount . . . . . . .	 0048	     Byte
  WTD_ExprLfoRateCounter . . . .	 0049	     Byte
  WTD_ExprLfoLevelSet  . . . . .	 004A	     Word
  WTD_ExprLfoCountCounter  . . .	 004C	     Byte
  WTD_ExprEmbAddress . . . . . .	 004D	     Byte
  WTD_ExprEmbRate  . . . . . . .	 004E	     Byte
  WTD_ExprEmbCounter . . . . . .	 004F	     Byte
  WTD_ExprEmbMaxMin  . . . . . .	 0050	     Byte
  WTD_ExprEmbLevelSet  . . . . .	 0051	     Byte
  WTD_WorkAddress  . . . . . . .	 0052	     Byte
  WTD_OctaveSet  . . . . . . . .	 0053	     Byte
  WTD_Octave . . . . . . . . . .	 0054	     Byte
  WTD_GateTime8  . . . . . . . .	 0055	     Byte
  WTD_GateTimeStepLast . . . . .	 0056	     Word
  WTD_GateTimeStepFirst  . . . .	 0058	     Word
  WTD_VolumeUpDown . . . . . . .	 005A	     Byte
  WTD_ModDecay . . . . . . . . .	 005B	     Word
  WTD_ModLevel . . . . . . . . .	 005D	     Byte
  WTD_ModLevelSet  . . . . . . .	 005E	     Byte
  WTD_Null_5F  . . . . . . . . .	 005F	     Byte
  WTD_PanSet . . . . . . . . . .	 0060	     Byte
  WTD_Pan  . . . . . . . . . . .	 0061	     Byte
  WTD_PanDetune  . . . . . . . .	 0062	     Word
  WTD_PanLfoDecayRate  . . . . .	 0064	     Byte
  WTD_PanLfoSpeedRate  . . . . .	 0065	     Byte
  WTD_PanLfoLevel  . . . . . . .	 0066	     Word
  WTD_PanLfoCount  . . . . . . .	 0068	     Byte
  WTD_PanLfoRateCounter  . . . .	 0069	     Byte
  WTD_PanLfoLevelSet . . . . . .	 006A	     Word
  WTD_PanLfoCountCounter . . . .	 006C	     Byte
  WTD_PanEmbAddress  . . . . . .	 006D	     Byte
  WTD_PanEmbRate . . . . . . . .	 006E	     Byte
  WTD_PanEmbCounter  . . . . . .	 006F	     Byte
  WTD_PanEmbMaxMin . . . . . . .	 0070	     Byte
  WTD_PanEmbLevelSet . . . . . .	 0071	     Byte
  WTD_ProgramRate  . . . . . . .	 0072	     Word
  WTD_Program1st . . . . . . . .	 0074	     Byte
  WTD_Program2nd . . . . . . . .	 0075	     Byte
  WTD_Program3rd . . . . . . . .	 0076	     Byte
  WTD_ProgramDecay . . . . . . .	 0077	     Byte
  WTD_ProgramDecayRate . . . . .	 0078	     Word
WaveData . . . . . . . . . . . .	 0009
  WaveData_Head  . . . . . . . .	 0000	     Byte
  WaveData_Size  . . . . . . . .	 0004	     DWord
  WaveData_Data  . . . . . . . .	 0008	     Byte
WaveFmt  . . . . . . . . . . . .	 0018
  WaveFmt_Head . . . . . . . . .	 0000	     Byte
  WaveFmt_Size . . . . . . . . .	 0004	     DWord
  WaveFmt_Type . . . . . . . . .	 0008	     Word
  WaveFmt_Channel  . . . . . . .	 000A	     Word
  WaveFmt_SamplingRate . . . . .	 000C	     DWord
  WaveFmt_SamplingSec  . . . . .	 0010	     DWord
  WaveFmt_DataSize . . . . . . .	 0014	     Word
  WaveFmt_ChannelSize  . . . . .	 0016	     Word
xmodeminfo . . . . . . . . . . .	 0010
  xmodeminfo_state . . . . . . .	 0000	     Word
  xmodeminfo_mode  . . . . . . .	 0002	     Byte
  xmodeminfo_retry_c . . . . . .	 0003	     Byte
  xmodeminfo_block_c . . . . . .	 0004	     Word
  xmodeminfo_block_max . . . . .	 0006	     Word
  xmodeminfo_block_sixa  . . . .	 0008	     Word
  xmodeminfo_bank  . . . . . . .	 000A	     Word
  xmodeminfo_offset  . . . . . .	 000C	     Word
  xmodeminfo_timeout_c . . . . .	 000E	     Word


Segments and Groups:

                N a m e                 Size     Length   Align   Combine Class

CGROUP . . . . . . . . . . . . .	GROUP
_TEXT  . . . . . . . . . . . . .	16 Bit	 1CB9	  Para	  Public  'CODE'	
DGROUP . . . . . . . . . . . . .	GROUP
DATA . . . . . . . . . . . . . .	16 Bit	 0000	  Para	  Public  'DATA'	
_BSS . . . . . . . . . . . . . .	16 Bit	 1000	  Para	  Public  'BSS'  


Procedures,  parameters and locals:

                N a m e                 Type     Value    Attr

C_Close  . . . . . . . . . . . .	P Near	 1BDC	  _TEXT	Length= 0017 Private
C_Open . . . . . . . . . . . . .	P Near	 1BD4	  _TEXT	Length= 0007 Private
C_Send_Block . . . . . . . . . .	P Near	 1C5C	  _TEXT	Length= 000D Private
C_Send_Word  . . . . . . . . . .	P Near	 1C50	  _TEXT	Length= 000B Private
C_Send . . . . . . . . . . . . .	P Near	 1BF4	  _TEXT	Length= 005B Private
IC_Send  . . . . . . . . . . . .	P Near	 1C6A	  _TEXT	Length= 004F Private
I_Effect_Return  . . . . . . . .	P Near	 0F18	  _TEXT	Length= 0096 Private
I_PlayCommand  . . . . . . . . .	P Near	 1160	  _TEXT	Length= 0015 Private
I_PlayKey_Auto . . . . . . . . .	P Near	 0FD2	  _TEXT	Length= 0018 Private
I_PlayKey  . . . . . . . . . . .	P Near	 0FF2	  _TEXT	Length= 006E Private
I_Play_Emb . . . . . . . . . . .	P Near	 0E66	  _TEXT	Length= 007A Private
I_Play_Frection  . . . . . . . .	P Near	 0C78	  _TEXT	Length= 004F Private
I_Play_KeyOff_Emb  . . . . . . .	P Near	 0E32	  _TEXT	Length= 0034 Private
I_Play_KeyOff  . . . . . . . . .	P Near	 0C1C	  _TEXT	Length= 005B Private
I_Play_KeyOn_Emb . . . . . . . .	P Near	 0DFC	  _TEXT	Length= 0035 Private
I_Play_KeyOn_LFO . . . . . . . .	P Near	 0DE0	  _TEXT	Length= 001C Private
I_Play_KeyOn . . . . . . . . . .	P Near	 0B8A	  _TEXT	Length= 0092 Private
I_Play_LFO . . . . . . . . . . .	P Near	 0EE0	  _TEXT	Length= 0038 Private
I_Play_Loop  . . . . . . . . . .	P Near	 0B6A	  _TEXT	Length= 001F Private
I_Play_Pan . . . . . . . . . . .	P Near	 0D80	  _TEXT	Length= 005F Private
I_Play_Volume  . . . . . . . . .	P Near	 0CC8	  _TEXT	Length= 00B8 Private
I_Play . . . . . . . . . . . . .	P Near	 0A86	  _TEXT	Length= 00E4 Private
I_Read16 . . . . . . . . . . . .	P Near	 0FC0	  _TEXT	Length= 0012 Private
I_Read8  . . . . . . . . . . . .	P Near	 0FAE	  _TEXT	Length= 0012 Private
I_SP_Volume  . . . . . . . . . .	P Near	 1742	  _TEXT	Length= 007D Private
IntVector_Get  . . . . . . . . .	P Near	 1920	  _TEXT	Length= 0003 Private
SM_BankProgram . . . . . . . . .	P Near	 1B8C	  _TEXT	Length= 0016 Private
SM_ChPress . . . . . . . . . . .	P Near	 1BA2	  _TEXT	Length= 0016 Private
SM_ControlByte . . . . . . . . .	P Near	 1B36	  _TEXT	Length= 0018 Private
SM_ControlWord . . . . . . . . .	P Near	 1B4E	  _TEXT	Length= 0028 Private
SM_KeyOn . . . . . . . . . . . .	P Near	 1B12	  _TEXT	Length= 0012 Private
SM_KeyPress  . . . . . . . . . .	P Near	 1B24	  _TEXT	Length= 0012 Private
SM_PitchBend . . . . . . . . . .	P Near	 1BB8	  _TEXT	Length= 001B Private
SM_Program . . . . . . . . . . .	P Near	 1B76	  _TEXT	Length= 0016 Private
SM_init  . . . . . . . . . . . .	P Near	 1AF6	  _TEXT	Length= 001A Private
SP_Get_Channel . . . . . . . . .	P Near	 1A94	  _TEXT	Length= 0005 Private
SP_Get_Output  . . . . . . . . .	P Near	 1AA4	  _TEXT	Length= 0005 Private
SP_Get_PCMVoice  . . . . . . . .	P Near	 1AC6	  _TEXT	Length= 0003 Private
SP_Get_Random  . . . . . . . . .	P Near	 1AAA	  _TEXT	Length= 0003 Private
SP_Get_VolumePCM . . . . . . . .	P Near	 1AB8	  _TEXT	Length= 0003 Private
SP_Set_Channel . . . . . . . . .	P Near	 1A34	  _TEXT	Length= 001F Private
SP_Set_Frection  . . . . . . . .	P Near	 19A2	  _TEXT	Length= 0028 Private
SP_Set_Noise . . . . . . . . . .	P Near	 1A14	  _TEXT	Length= 001F Private
SP_Set_Output  . . . . . . . . .	P Near	 1A9A	  _TEXT	Length= 0009 Private
SP_Set_PCMVoice  . . . . . . . .	P Near	 1ABC	  _TEXT	Length= 0009 Private
SP_Set_Sweep . . . . . . . . . .	P Near	 19F2	  _TEXT	Length= 0021 Private
SP_Set_VoiceAdd  . . . . . . . .	P Near	 1A8C	  _TEXT	Length= 0008 Private
SP_Set_Voice . . . . . . . . . .	P Near	 1A54	  _TEXT	Length= 0038 Private
SP_Set_VolumePCM . . . . . . . .	P Near	 1AAE	  _TEXT	Length= 0009 Private
SP_Set_Volume  . . . . . . . . .	P Near	 19CA	  _TEXT	Length= 0028 Private
SP_Set_with_mask . . . . . . . .	P Near	 1ACA	  _TEXT	Length= 0011 Private
SP_init  . . . . . . . . . . . .	P Near	 1962	  _TEXT	Length= 0040 Private
T_Set_Frection . . . . . . . . .	P Near	 195E	  _TEXT	Length= 0003 Private
T_Set_Status . . . . . . . . . .	P Near	 1954	  _TEXT	Length= 0009 Private
T_close  . . . . . . . . . . . .	P Near	 1936	  _TEXT	Length= 0013 Private
T_init . . . . . . . . . . . . .	P Near	 194A	  _TEXT	Length= 0009 Private
T_open . . . . . . . . . . . . .	P Near	 1924	  _TEXT	Length= 0012 Private
WTD_FunctionLoad . . . . . . . .	P Near	 0093	  _TEXT	Length= 002F Public C
  Wtd_Function . . . . . . . . .	Word	 bp + 0004
_ChangeFar . . . . . . . . . . .	P Far	 076D	  _TEXT	Length= 0013 Public C
  fptData  . . . . . . . . . . .	DWord	 bp + 0006
_EffectPlay  . . . . . . . . . .	P Far	 0407	  _TEXT	Length= 016F Public C
  fptEffect  . . . . . . . . . .	DWord	 bp + 0006
_EffectStop  . . . . . . . . . .	P Far	 0576	  _TEXT	Length= 0065 Public C
_GetEffectVolume . . . . . . . .	P Far	 07F6	  _TEXT	Length= 0016 Public C
_GetInfo . . . . . . . . . . . .	P Far	 00C2	  _TEXT	Length= 0006 Public C
_GetMusicVolume  . . . . . . . .	P Far	 07C3	  _TEXT	Length= 0016 Public C
_GetPcmVolume  . . . . . . . . .	P Far	 082E	  _TEXT	Length= 0016 Public C
_Init  . . . . . . . . . . . . .	P Far	 01C4	  _TEXT	Length= 0030 Public C
_MusicPlay . . . . . . . . . . .	P Far	 01F4	  _TEXT	Length= 017A Public C
  fptMusic . . . . . . . . . . .	DWord	 bp + 0006
_MusicStop . . . . . . . . . . .	P Far	 036E	  _TEXT	Length= 0207 Public C
_PcmPlay . . . . . . . . . . . .	P Far	 05DB	  _TEXT	Length= 00F4 Public C
  fptPCM . . . . . . . . . . . .	DWord	 bp + 0006
_PcmStop . . . . . . . . . . . .	P Far	 06CF	  _TEXT	Length= 0026 Public C
_PcmVoiceSet . . . . . . . . . .	P Far	 06F5	  _TEXT	Length= 003C Public C
  cNumber  . . . . . . . . . . .	Byte	 bp + 0006
  fptWave  . . . . . . . . . . .	DWord	 bp + 0008
_SetEffectVolume . . . . . . . .	P Far	 07D9	  _TEXT	Length= 001D Public C
  cVolume  . . . . . . . . . . .	Byte	 bp + 0006
_SetFIFO . . . . . . . . . . . .	P Far	 0844	  _TEXT	Length= 003F Public C
  szFIFO . . . . . . . . . . . .	Word	 bp + 0006
  fptFIFO  . . . . . . . . . . .	DWord	 bp + 0008
_SetMusicVolume  . . . . . . . .	P Far	 07A6	  _TEXT	Length= 001D Public C
  cVolume  . . . . . . . . . . .	Byte	 bp + 0006
_SetPcmVolume  . . . . . . . . .	P Far	 080C	  _TEXT	Length= 0022 Public C
  cVolume  . . . . . . . . . . .	Byte	 bp + 0006
_SoftEmbSet  . . . . . . . . . .	P Far	 0731	  _TEXT	Length= 003C Public C
  cNumber  . . . . . . . . . . .	Byte	 bp + 0006
  fptWave  . . . . . . . . . . .	DWord	 bp + 0008
_SoundGetChannel . . . . . . . .	P Far	 078D	  _TEXT	Length= 0004 Public C
_SoundGetOutput  . . . . . . . .	P Far	 079E	  _TEXT	Length= 0004 Public C
_SoundGetRandom  . . . . . . . .	P Far	 07A2	  _TEXT	Length= 0004 Public C
_SoundSetChannel . . . . . . . .	P Far	 0780	  _TEXT	Length= 000D Public C
  iMode  . . . . . . . . . . . .	Word	 bp + 0006
_SoundSetOutput  . . . . . . . .	P Far	 0791	  _TEXT	Length= 000D Public C
  iMode  . . . . . . . . . . . .	Word	 bp + 0006
_StayOut . . . . . . . . . . . .	P Far	 0178	  _TEXT	Length= 004C Public C
_Stay  . . . . . . . . . . . . .	P Far	 00C8	  _TEXT	Length= 00B0 Public C


Symbols:

                N a m e                 Type     Value    Attr

BANK_ERASE_FLASH . . . . . . . .	Number	 0009h	 
BANK_FILL_BLOCK  . . . . . . . .	Number	 0008h	 
BANK_GET_MAP . . . . . . . . . .	Number	 0001h	 
BANK_MAX_BANKS . . . . . . . . .	Number	 007Fh	 
BANK_OSWORK  . . . . . . . . . .	Number	 0003h	 
BANK_READ_BLOCK  . . . . . . . .	Number	 0006h	 
BANK_READ_BYTE . . . . . . . . .	Number	 0002h	 
BANK_READ_WORD . . . . . . . . .	Number	 0004h	 
BANK_ROM0_ADDRESS  . . . . . . .	Number	 2000h	 
BANK_ROM0  . . . . . . . . . . .	Number	 0001h	 
BANK_ROM1_ADDRESS  . . . . . . .	Number	 3000h	 
BANK_ROM1  . . . . . . . . . . .	Number	 0002h	 
BANK_SET_MAP . . . . . . . . . .	Number	 0000h	 
BANK_SOFTFS  . . . . . . . . . .	Number	 0000h	 
BANK_SRAM_ADDRESS  . . . . . . .	Number	 1000h	 
BANK_SRAM  . . . . . . . . . . .	Number	 0000h	 
BANK_USERDS0 . . . . . . . . . .	Number	 0002h	 
BANK_USERDS1 . . . . . . . . . .	Number	 0001h	 
BANK_WRITE_BLOCK . . . . . . . .	Number	 0007h	 
BANK_WRITE_BYTE  . . . . . . . .	Number	 0003h	 
BANK_WRITE_WORD  . . . . . . . .	Number	 0005h	 
BankSram . . . . . . . . . . . .	Number	 00C1h	 
COMM_Baudrate38k . . . . . . . .	Number	 0040h	 
COMM_Baudrate9K  . . . . . . . .	Number	 0000h	 
COMM_CLOSE . . . . . . . . . . .	Number	 0001h	 
COMM_DATA  . . . . . . . . . . .	Number	 00B1h	 
COMM_Disable . . . . . . . . . .	Number	 007Fh	 
COMM_Enable  . . . . . . . . . .	Number	 0080h	 
COMM_GET_BAUDRATE  . . . . . . .	Number	 000Ah	 
COMM_GET_CANCEL_KEY  . . . . . .	Number	 000Ch	 
COMM_OPEN  . . . . . . . . . . .	Number	 0000h	 
COMM_OrReset . . . . . . . . . .	Number	 0020h	 
COMM_OverRun . . . . . . . . . .	Number	 0002h	 
COMM_RECEIVE_BLOCK . . . . . . .	Number	 0007h	 
COMM_RECEIVE_CHAR  . . . . . . .	Number	 0003h	 
COMM_RECEIVE_WITH_TIMEOUT  . . .	Number	 0004h	 
COMM_Receive . . . . . . . . . .	Number	 0001h	 
COMM_SEND_BLOCK  . . . . . . . .	Number	 0006h	 
COMM_SEND_CHAR . . . . . . . . .	Number	 0002h	 
COMM_SEND_STRING . . . . . . . .	Number	 0005h	 
COMM_SET_BAUDRATE  . . . . . . .	Number	 0009h	 
COMM_SET_CANCEL_KEY  . . . . . .	Number	 000Bh	 
COMM_SET_TIMEOUT . . . . . . . .	Number	 0008h	 
COMM_SPEED_38400 . . . . . . . .	Number	 0001h	 
COMM_SPEED_9600  . . . . . . . .	Number	 0000h	 
COMM_STATUS  . . . . . . . . . .	Number	 00B3h	 
COMM_SendEmpty . . . . . . . . .	Number	 0004h	 
COMM_TimeOut . . . . . . . . . .	Number	 FFFFh	 
COMM_XMODEM  . . . . . . . . . .	Number	 000Dh	 
ERR_SIO_BUSY . . . . . . . . . .	Number	 8100h	 
ERR_SIO_CANCEL . . . . . . . . .	Number	 8103h	 
ERR_SIO_OK . . . . . . . . . . .	Number	 0000h	 
ERR_SIO_OVERRUN  . . . . . . . .	Number	 8102h	 
ERR_SIO_TIMEOUT  . . . . . . . .	Number	 8101h	 
ERR_XM_BLOCK_LOST  . . . . . . .	Number	 8106h	 
ERR_XM_CANCELED  . . . . . . . .	Number	 8105h	 
ERR_XM_STATECODE . . . . . . . .	Number	 8104h	 
ERR_XM_TOO_LARGE . . . . . . . .	Number	 8107h	 
E_PROC_CANTLOAD  . . . . . . . .	Number	 -0001h	  
E_PROC_SUCCESS . . . . . . . . .	Number	 0000h	 
EffectMaxPart  . . . . . . . . .	Number	 0003h	 
FROM_Segment . . . . . . . . . .	Text   	 BANK_ROM0_ADDRESS
IC_Start_End . . . . . . . . . .	L Near	 191B	  _TEXT	
IC_Start_Step1 . . . . . . . . .	L Near	 1912	  _TEXT	
IC_Start_Step2 . . . . . . . . .	L Near	 1918	  _TEXT	
IC_Start . . . . . . . . . . . .	L Near	 1904	  _TEXT	Public
IL_F00 . . . . . . . . . . . . .	Word	 000A	  _TEXT	
IL_F01 . . . . . . . . . . . . .	Word	 000E	  _TEXT	
IL_F02 . . . . . . . . . . . . .	Word	 0012	  _TEXT	
IL_F03 . . . . . . . . . . . . .	Word	 0016	  _TEXT	
IL_F04 . . . . . . . . . . . . .	Word	 001A	  _TEXT	
IL_F05 . . . . . . . . . . . . .	Word	 001E	  _TEXT	
IL_F06 . . . . . . . . . . . . .	Word	 0022	  _TEXT	
IL_F07 . . . . . . . . . . . . .	Word	 0026	  _TEXT	
IL_F08 . . . . . . . . . . . . .	Word	 002A	  _TEXT	
IL_F09 . . . . . . . . . . . . .	Word	 002E	  _TEXT	
IL_F10 . . . . . . . . . . . . .	Word	 0032	  _TEXT	
IL_F11 . . . . . . . . . . . . .	Word	 0036	  _TEXT	
IL_F12 . . . . . . . . . . . . .	Word	 003A	  _TEXT	
IL_F13 . . . . . . . . . . . . .	Word	 003E	  _TEXT	
IL_F14 . . . . . . . . . . . . .	Word	 0042	  _TEXT	
IL_F15 . . . . . . . . . . . . .	Word	 0046	  _TEXT	
IL_F16 . . . . . . . . . . . . .	Word	 004A	  _TEXT	
IL_F17 . . . . . . . . . . . . .	Word	 004E	  _TEXT	
IL_F18 . . . . . . . . . . . . .	Word	 0052	  _TEXT	
IL_F19 . . . . . . . . . . . . .	Word	 0056	  _TEXT	
IL_F20 . . . . . . . . . . . . .	Word	 005A	  _TEXT	
IL_F21 . . . . . . . . . . . . .	Word	 005E	  _TEXT	
IL_F22 . . . . . . . . . . . . .	Word	 0062	  _TEXT	
IL_F23 . . . . . . . . . . . . .	Word	 0066	  _TEXT	
IL_F_End . . . . . . . . . . . .	L Near	 006A	  _TEXT	
IL_GetInfo . . . . . . . . . . .	Word	 0006	  _TEXT	
IL_Link_Pos  . . . . . . . . . .	Word	 0000	  _TEXT	
IL_N_Methods . . . . . . . . . .	Word	 0004	  _TEXT	
ILinfoD_ClassName  . . . . . . .	Byte	 007E	  _TEXT	
ILinfoD_Depends  . . . . . . . .	Word	 008F	  _TEXT	
ILinfoD_Description  . . . . . .	Byte	 008E	  _TEXT	
ILinfoD_Name . . . . . . . . . .	Byte	 0085	  _TEXT	
ILinfoD_Version  . . . . . . . .	Byte	 0089	  _TEXT	
ILinfoD_WTD  . . . . . . . . . .	L Near	 007E	  _TEXT	
ILinfo_ClassName . . . . . . . .	Word	 006A	  _TEXT	
ILinfo_Depends . . . . . . . . .	Word	 007A	  _TEXT	
ILinfo_Description . . . . . . .	Word	 0076	  _TEXT	
ILinfo_Name  . . . . . . . . . .	Word	 006E	  _TEXT	
ILinfo_Version . . . . . . . . .	Word	 0072	  _TEXT	
ILinfo . . . . . . . . . . . . .	L Near	 006A	  _TEXT	
IL . . . . . . . . . . . . . . .	L Near	 0000	  _TEXT	
INT_BANK . . . . . . . . . . . .	Number	 0018h	 
INT_BIOS_VECTOR_BASE . . . . . .	Number	 0010h	 
INT_CASETTE  . . . . . . . . . .	Number	 002Ah	 
INT_COMM . . . . . . . . . . . .	Number	 0014h	 
INT_CommSendReset  . . . . . . .	Number	 00FEh	 
INT_CommSendSet  . . . . . . . .	Number	 0001h	 
INT_DISPLINE . . . . . . . . . .	Number	 002Ch	 
INT_DISP . . . . . . . . . . . .	Number	 0012h	 
INT_EXIT . . . . . . . . . . . .	Number	 0010h	 
INT_FILESYS  . . . . . . . . . .	Number	 0031h	 
INT_HARDHAEW_VECTOR_BASE . . . .	Number	 0028h	 
INT_HBLANK_COUNTUP . . . . . . .	Number	 002Fh	 
INT_HblankReset  . . . . . . . .	Number	 007Fh	 
INT_HblankSet  . . . . . . . . .	Number	 0080h	 
INT_ILIB . . . . . . . . . . . .	Number	 0032h	 
INT_KEY_PUSH . . . . . . . . . .	Number	 0029h	 
INT_KEY  . . . . . . . . . . . .	Number	 0011h	 
INT_PROCESS  . . . . . . . . . .	Number	 0030h	 
INT_RECEIVEREADY . . . . . . . .	Number	 002Bh	 
INT_SENDREADY  . . . . . . . . .	Number	 0028h	 
INT_SOUND  . . . . . . . . . . .	Number	 0015h	 
INT_SYSCALL_VECTOR_BASE  . . . .	Number	 0030h	 
INT_SYSTEM . . . . . . . . . . .	Number	 0017h	 
INT_TEXT . . . . . . . . . . . .	Number	 0013h	 
INT_TIMER  . . . . . . . . . . .	Number	 0016h	 
INT_VBLANK_COUNTUP . . . . . . .	Number	 002Dh	 
INT_VBLANK . . . . . . . . . . .	Number	 002Eh	 
IRAM_Segment . . . . . . . . . .	Number	 0000h	 
IRAM_SoundVoiceTable_WW  . . . .	Number	 0180h	 
IRAM_SoundVoiceTable . . . . . .	Text   	 IRAM_SoundVoiceTable_WW
IRAM . . . . . . . . . . . . . .	Text   	 1
I_Com00  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com01  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com02  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com03  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com04  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com05  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com06  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com07  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com08  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com09  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com0a  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com0b  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com0c  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com0d  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com0e  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com0f  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com10  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com11  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com12  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com13  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com14  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com15  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com16  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com17  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com18  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com19  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com1a  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com1b  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com1c  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com1d  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com1e  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com1f  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com20  . . . . . . . . . . . .	L Near	 1176	  _TEXT	
I_Com21  . . . . . . . . . . . .	L Near	 1178	  _TEXT	
I_Com22  . . . . . . . . . . . .	L Near	 117E	  _TEXT	
I_Com23  . . . . . . . . . . . .	L Near	 1186	  _TEXT	
I_Com24  . . . . . . . . . . . .	L Near	 1188	  _TEXT	
I_Com25  . . . . . . . . . . . .	L Near	 118A	  _TEXT	
I_Com26  . . . . . . . . . . . .	L Near	 118C	  _TEXT	
I_Com27  . . . . . . . . . . . .	L Near	 118E	  _TEXT	
I_Com28  . . . . . . . . . . . .	L Near	 1198	  _TEXT	
I_Com29  . . . . . . . . . . . .	L Near	 11A6	  _TEXT	
I_Com2a  . . . . . . . . . . . .	L Near	 11B4	  _TEXT	
I_Com2b  . . . . . . . . . . . .	L Near	 11D8	  _TEXT	
I_Com2c  . . . . . . . . . . . .	L Near	 11DA	  _TEXT	
I_Com2d  . . . . . . . . . . . .	L Near	 11DC	  _TEXT	
I_Com2e  . . . . . . . . . . . .	L Near	 11DE	  _TEXT	
I_Com2f  . . . . . . . . . . . .	L Near	 11E0	  _TEXT	
I_Com30  . . . . . . . . . . . .	L Near	 1206	  _TEXT	
I_Com31  . . . . . . . . . . . .	L Near	 1216	  _TEXT	
I_Com32  . . . . . . . . . . . .	L Near	 1228	  _TEXT	
I_Com33  . . . . . . . . . . . .	L Near	 123A	  _TEXT	
I_Com34  . . . . . . . . . . . .	L Near	 124C	  _TEXT	
I_Com35  . . . . . . . . . . . .	L Near	 125E	  _TEXT	
I_Com36  . . . . . . . . . . . .	L Near	 1270	  _TEXT	
I_Com37  . . . . . . . . . . . .	L Near	 1288	  _TEXT	
I_Com38  . . . . . . . . . . . .	L Near	 12A0	  _TEXT	
I_Com39  . . . . . . . . . . . .	L Near	 12B2	  _TEXT	
I_Com3a  . . . . . . . . . . . .	L Near	 12E0	  _TEXT	
I_Com3b  . . . . . . . . . . . .	L Near	 12F6	  _TEXT	
I_Com3c  . . . . . . . . . . . .	L Near	 1310	  _TEXT	
I_Com3d  . . . . . . . . . . . .	L Near	 1314	  _TEXT	
I_Com3e  . . . . . . . . . . . .	L Near	 1316	  _TEXT	
I_Com3f  . . . . . . . . . . . .	L Near	 131A	  _TEXT	
I_Com3x_Flag . . . . . . . . . .	L Near	 12C2	  _TEXT	
I_Com40_1st  . . . . . . . . . .	L Near	 1325	  _TEXT	
I_Com40  . . . . . . . . . . . .	L Near	 131C	  _TEXT	
I_Com41  . . . . . . . . . . . .	L Near	 1374	  _TEXT	
I_Com42  . . . . . . . . . . . .	L Near	 1376	  _TEXT	
I_Com43  . . . . . . . . . . . .	L Near	 13A2	  _TEXT	
I_Com44  . . . . . . . . . . . .	L Near	 13BC	  _TEXT	
I_Com45_End  . . . . . . . . . .	L Near	 141A	  _TEXT	
I_Com45  . . . . . . . . . . . .	L Near	 13C4	  _TEXT	
I_Com46  . . . . . . . . . . . .	L Near	 141C	  _TEXT	
I_Com47  . . . . . . . . . . . .	L Near	 1428	  _TEXT	
I_Com48  . . . . . . . . . . . .	L Near	 1432	  _TEXT	
I_Com49  . . . . . . . . . . . .	L Near	 143E	  _TEXT	
I_Com4a  . . . . . . . . . . . .	L Near	 1440	  _TEXT	
I_Com4b  . . . . . . . . . . . .	L Near	 1442	  _TEXT	
I_Com4c  . . . . . . . . . . . .	L Near	 144A	  _TEXT	
I_Com4d  . . . . . . . . . . . .	L Near	 146A	  _TEXT	
I_Com4e  . . . . . . . . . . . .	L Near	 1478	  _TEXT	
I_Com4f  . . . . . . . . . . . .	L Near	 149A	  _TEXT	
I_Com50  . . . . . . . . . . . .	L Near	 14AA	  _TEXT	
I_Com51  . . . . . . . . . . . .	L Near	 14B4	  _TEXT	
I_Com52  . . . . . . . . . . . .	L Near	 14BC	  _TEXT	
I_Com53  . . . . . . . . . . . .	L Near	 14C8	  _TEXT	
I_Com54  . . . . . . . . . . . .	L Near	 14D8	  _TEXT	
I_Com55  . . . . . . . . . . . .	L Near	 14E4	  _TEXT	
I_Com56  . . . . . . . . . . . .	L Near	 14EE	  _TEXT	
I_Com57  . . . . . . . . . . . .	L Near	 14F6	  _TEXT	
I_Com58_Step1  . . . . . . . . .	L Near	 1503	  _TEXT	
I_Com58  . . . . . . . . . . . .	L Near	 1502	  _TEXT	
I_Com59  . . . . . . . . . . . .	L Near	 1514	  _TEXT	
I_Com5a  . . . . . . . . . . . .	L Near	 1516	  _TEXT	
I_Com5b  . . . . . . . . . . . .	L Near	 152A	  _TEXT	
I_Com5c  . . . . . . . . . . . .	L Near	 153A	  _TEXT	
I_Com5d  . . . . . . . . . . . .	L Near	 153C	  _TEXT	
I_Com5e  . . . . . . . . . . . .	L Near	 1552	  _TEXT	
I_Com5f  . . . . . . . . . . . .	L Near	 1554	  _TEXT	
I_Com60  . . . . . . . . . . . .	L Near	 155C	  _TEXT	
I_Com61  . . . . . . . . . . . .	L Near	 155E	  _TEXT	
I_Com62  . . . . . . . . . . . .	L Near	 1560	  _TEXT	
I_Com63  . . . . . . . . . . . .	L Near	 1562	  _TEXT	
I_Com64  . . . . . . . . . . . .	L Near	 1564	  _TEXT	
I_Com65  . . . . . . . . . . . .	L Near	 1566	  _TEXT	
I_Com66  . . . . . . . . . . . .	L Near	 1568	  _TEXT	
I_Com67  . . . . . . . . . . . .	L Near	 156A	  _TEXT	
I_Com68  . . . . . . . . . . . .	L Near	 156C	  _TEXT	
I_Com69  . . . . . . . . . . . .	L Near	 156E	  _TEXT	
I_Com6a  . . . . . . . . . . . .	L Near	 1570	  _TEXT	
I_Com6b  . . . . . . . . . . . .	L Near	 1572	  _TEXT	
I_Com6c  . . . . . . . . . . . .	L Near	 157A	  _TEXT	
I_Com6d  . . . . . . . . . . . .	L Near	 1588	  _TEXT	
I_Com6e  . . . . . . . . . . . .	L Near	 15BA	  _TEXT	
I_Com6f  . . . . . . . . . . . .	L Near	 15CA	  _TEXT	
I_Com70  . . . . . . . . . . . .	L Near	 15D2	  _TEXT	
I_Com71  . . . . . . . . . . . .	L Near	 15DA	  _TEXT	
I_Com72  . . . . . . . . . . . .	L Near	 15E2	  _TEXT	
I_Com73  . . . . . . . . . . . .	L Near	 15E4	  _TEXT	
I_Com74  . . . . . . . . . . . .	L Near	 1600	  _TEXT	
I_Com75  . . . . . . . . . . . .	L Near	 161C	  _TEXT	
I_Com76  . . . . . . . . . . . .	L Near	 1624	  _TEXT	
I_Com77  . . . . . . . . . . . .	L Near	 1648	  _TEXT	
I_Com78  . . . . . . . . . . . .	L Near	 164A	  _TEXT	
I_Com79  . . . . . . . . . . . .	L Near	 1652	  _TEXT	
I_Com7a  . . . . . . . . . . . .	L Near	 1662	  _TEXT	
I_Com7b  . . . . . . . . . . . .	L Near	 1664	  _TEXT	
I_Com7c  . . . . . . . . . . . .	L Near	 1682	  _TEXT	
I_Com7d  . . . . . . . . . . . .	L Near	 1684	  _TEXT	
I_Com7e  . . . . . . . . . . . .	L Near	 1686	  _TEXT	
I_Com7f  . . . . . . . . . . . .	L Near	 1688	  _TEXT	
I_Effect_Return_End  . . . . . .	L Near	 0FAC	  _TEXT	
I_Frection_Table . . . . . . . .	L Near	 0984	  _TEXT	
I_MusicEffectStep  . . . . . . .	L Near	 0A7D	  _TEXT	
I_PlayCommand_JumpTable  . . . .	L Near	 1060	  _TEXT	
I_PlayKey_Code . . . . . . . . .	L Near	 0FEA	  _TEXT	
I_PlayKey_StepE  . . . . . . . .	L Near	 105E	  _TEXT	
I_Play_Emb_Step3 . . . . . . . .	L Near	 0EAC	  _TEXT	
I_Play_Emb_StepEnd . . . . . . .	L Near	 0ED4	  _TEXT	
I_Play_Volume_Step1  . . . . . .	L Near	 0CF6	  _TEXT	
I_Read16_End . . . . . . . . . .	L Near	 0FD1	  _TEXT	
I_Read8_End  . . . . . . . . . .	L Near	 0FBF	  _TEXT	
I_SM_CtrlChgB  . . . . . . . . .	L Near	 18A4	  _TEXT	
I_SM_CtrlChgW  . . . . . . . . .	L Near	 18BA	  _TEXT	
I_SM_Frection  . . . . . . . . .	L Near	 17F8	  _TEXT	
I_SM_KeyOff  . . . . . . . . . .	L Near	 1720	  _TEXT	
I_SM_KeyOn . . . . . . . . . . .	L Near	 16D4	  _TEXT	
I_SM_Mode  . . . . . . . . . . .	L Near	 18F6	  _TEXT	
I_SM_PolyChPress . . . . . . . .	L Near	 189A	  _TEXT	
I_SM_PolyKeyPress  . . . . . . .	L Near	 1890	  _TEXT	
I_SM_Voice . . . . . . . . . . .	L Near	 187E	  _TEXT	
I_SM_Volume  . . . . . . . . . .	L Near	 17C0	  _TEXT	
I_SP_CtrlChgB  . . . . . . . . .	L Near	 18A2	  _TEXT	
I_SP_CtrlChgW  . . . . . . . . .	L Near	 18B8	  _TEXT	
I_SP_Frection  . . . . . . . . .	L Near	 17D4	  _TEXT	
I_SP_KeyOff  . . . . . . . . . .	L Near	 171A	  _TEXT	
I_SP_KeyOn . . . . . . . . . . .	L Near	 16B2	  _TEXT	
I_SP_Mode  . . . . . . . . . . .	L Near	 18CE	  _TEXT	
I_SP_PolyChPress . . . . . . . .	L Near	 1898	  _TEXT	
I_SP_PolyKeyPress  . . . . . . .	L Near	 188E	  _TEXT	
I_SP_Voice . . . . . . . . . . .	L Near	 1808	  _TEXT	
I_Start  . . . . . . . . . . . .	L Near	 099C	  _TEXT	Public
I_Table_CtrlChgB . . . . . . . .	L Near	 189E	  _TEXT	
I_Table_CtrlChgW . . . . . . . .	L Near	 18B4	  _TEXT	
I_Table_Frection . . . . . . . .	L Near	 17D0	  _TEXT	
I_Table_Jump . . . . . . . . . .	L Near	 168A	  _TEXT	
I_Table_KeyOff . . . . . . . . .	L Near	 1716	  _TEXT	
I_Table_KeyOn  . . . . . . . . .	L Near	 16AE	  _TEXT	
I_Table_Mode . . . . . . . . . .	L Near	 18CA	  _TEXT	
I_Table_PolyChPress  . . . . . .	L Near	 1894	  _TEXT	
I_Table_PolyKeyPress . . . . . .	L Near	 188A	  _TEXT	
I_Table_Voice  . . . . . . . . .	L Near	 1804	  _TEXT	
I_Table_Volume . . . . . . . . .	L Near	 173E	  _TEXT	
I_Volume_Table . . . . . . . . .	L Near	 0884	  _TEXT	
Int_Base . . . . . . . . . . . .	Number	 00B0h	 
Int_Case . . . . . . . . . . . .	Number	 00B4h	 
Int_Enable . . . . . . . . . . .	Number	 00B2h	 
Int_Eoi  . . . . . . . . . . . .	Number	 00B6h	 
InterruptVectorBase_WW . . . . .	Text   	 INT_HARDHAEW_VECTOR_BASE
InterruptVectorBase  . . . . . .	Text   	 InterruptVectorBase_WW
MAXPROCESSES . . . . . . . . . .	Number	 0003h	 
MIDI_Channel_mask  . . . . . . .	Number	 000Fh	 
MIDI_Com_ChPress . . . . . . . .	Number	 00D0h	 
MIDI_Com_Control . . . . . . . .	Number	 00B0h	 
MIDI_Com_Exclucive . . . . . . .	Number	 00F0h	 
MIDI_Com_KeyOff  . . . . . . . .	Number	 0080h	 
MIDI_Com_KeyOn . . . . . . . . .	Number	 0090h	 
MIDI_Com_KeyPress  . . . . . . .	Number	 00A0h	 
MIDI_Com_PitchBend . . . . . . .	Number	 00E0h	 
MIDI_Com_Program . . . . . . . .	Number	 00C0h	 
MIDI_Ctrl_Bank . . . . . . . . .	Number	 0000h	 
MIDI_Ctrl_Blance . . . . . . . .	Number	 0008h	 
MIDI_Ctrl_Bress  . . . . . . . .	Number	 0002h	 
MIDI_Ctrl_Chorus . . . . . . . .	Number	 005Dh	 
MIDI_Ctrl_DaraDec  . . . . . . .	Number	 0061h	 
MIDI_Ctrl_DataEntly  . . . . . .	Number	 0006h	 
MIDI_Ctrl_DataInc  . . . . . . .	Number	 0060h	 
MIDI_Ctrl_Delay  . . . . . . . .	Number	 005Eh	 
MIDI_Ctrl_Effect1  . . . . . . .	Number	 000Ch	 
MIDI_Ctrl_Effect2  . . . . . . .	Number	 000Dh	 
MIDI_Ctrl_Expression . . . . . .	Number	 000Bh	 
MIDI_Ctrl_Foot . . . . . . . . .	Number	 0004h	 
MIDI_Ctrl_F  . . . . . . . . . .	Number	 005Fh	 
MIDI_Ctrl_Hold2  . . . . . . . .	Number	 0045h	 
MIDI_Ctrl_Hold . . . . . . . . .	Number	 0040h	 
MIDI_Ctrl_Legert . . . . . . . .	Number	 0044h	 
MIDI_Ctrl_MSB  . . . . . . . . .	Number	 0020h	 
MIDI_Ctrl_Mod  . . . . . . . . .	Number	 0001h	 
MIDI_Ctrl_NonRegLSB  . . . . . .	Number	 0062h	 
MIDI_Ctrl_NonRegMSB  . . . . . .	Number	 0063h	 
MIDI_Ctrl_Pan  . . . . . . . . .	Number	 000Ah	 
MIDI_Ctrl_PolControl . . . . . .	Number	 0054h	 
MIDI_Ctrl_PolSW  . . . . . . . .	Number	 0041h	 
MIDI_Ctrl_PolTime  . . . . . . .	Number	 0005h	 
MIDI_Ctrl_RegLSB . . . . . . . .	Number	 0064h	 
MIDI_Ctrl_RegMSB . . . . . . . .	Number	 0065h	 
MIDI_Ctrl_Reverv . . . . . . . .	Number	 005Bh	 
MIDI_Ctrl_Soft . . . . . . . . .	Number	 0043h	 
MIDI_Ctrl_S  . . . . . . . . . .	Number	 0042h	 
MIDI_Ctrl_Tremono  . . . . . . .	Number	 005Ch	 
MIDI_Ctrl_Volume . . . . . . . .	Number	 0007h	 
MIDI_Ex_GmReset  . . . . . . . .	Byte	 1ADC	  _TEXT	
MIDI_Ex_GsReset  . . . . . . . .	Byte	 1AE3	  _TEXT	
MIDI_Ex_XgReset  . . . . . . . .	Byte	 1AE4	  _TEXT	
MIDI_Reg_CBank . . . . . . . . .	Number	 0004h	 
MIDI_Reg_CProgram  . . . . . . .	Number	 0003h	 
MIDI_Reg_Cose  . . . . . . . . .	Number	 0002h	 
MIDI_Reg_Fain  . . . . . . . . .	Number	 0001h	 
MIDI_Reg_NULL  . . . . . . . . .	Number	 7F7Fh	 
MIDI_Reg_PitchBend . . . . . . .	Number	 0000h	 
MusicMaxPart . . . . . . . . . .	Number	 0014h	 
PCM_Channel_mask . . . . . . . .	Number	 0300h	 
PCM_Com_Channel  . . . . . . . .	Number	 0090h	 
PCM_Com_FrectionCh1  . . . . . .	Number	 0080h	 
PCM_Com_FrectionCh2  . . . . . .	Number	 0082h	 
PCM_Com_FrectionCh3  . . . . . .	Number	 0084h	 
PCM_Com_FrectionCh4  . . . . . .	Number	 0086h	 
PCM_Com_Frection . . . . . . . .	Number	 0080h	 
PCM_Com_Noise  . . . . . . . . .	Number	 008Eh	 
PCM_Com_Output . . . . . . . . .	Number	 0091h	 
PCM_Com_PCMVoice . . . . . . . .	Text   	 Pcm_Com_VolumeCh2
PCM_Com_Random . . . . . . . . .	Number	 0092h	 
PCM_Com_SweepLevel . . . . . . .	Number	 008Ch	 
PCM_Com_SweepTime  . . . . . . .	Number	 008Dh	 
PCM_Com_Sweep  . . . . . . . . .	Number	 008Ch	 
PCM_Com_VoiceAddress . . . . . .	Number	 008Fh	 
PCM_Com_VoiceCtrl  . . . . . . .	Number	 0095h	 
PCM_Com_VolumeCh1  . . . . . . .	Number	 0088h	 
PCM_Com_VolumeCh2  . . . . . . .	Number	 0089h	 
PCM_Com_VolumeCh3  . . . . . . .	Number	 008Ah	 
PCM_Com_VolumeCh4  . . . . . . .	Number	 008Bh	 
PCM_Com_VolumePCM  . . . . . . .	Number	 0094h	 
PCM_Com_Volume . . . . . . . . .	Number	 0088h	 
PcmVoiceMode_Reset . . . . . . .	Number	 2000h	 
PcmVoiceMode_Set . . . . . . . .	Number	 2020h	 
RTC_DATE . . . . . . . . . . . .	Number	 0002h	 
RTC_DAY_OF_WEEK  . . . . . . . .	Number	 0003h	 
RTC_DISABLE_ALARM  . . . . . . .	Number	 0006h	 
RTC_ENABLE_ALARM . . . . . . . .	Number	 0005h	 
RTC_GET_DATETIME_STRUCT  . . . .	Number	 0004h	 
RTC_GET_DATETIME . . . . . . . .	Number	 0001h	 
RTC_HOUR . . . . . . . . . . . .	Number	 0004h	 
RTC_MIN  . . . . . . . . . . . .	Number	 0005h	 
RTC_MONTH  . . . . . . . . . . .	Number	 0001h	 
RTC_RESET  . . . . . . . . . . .	Number	 0000h	 
RTC_SEC  . . . . . . . . . . . .	Number	 0006h	 
RTC_SET_DATETIME_STRUCT  . . . .	Number	 0003h	 
RTC_SET_DATETIME . . . . . . . .	Number	 0002h	 
RTC_YEAR . . . . . . . . . . . .	Number	 0000h	 
SM_KeyOff  . . . . . . . . . . .	L Near	 1B10	  _TEXT	
SM_Send_With_Running_Status_e  .	L Near	 1AF4	  _TEXT	
SM_Send_With_Running_Status  . .	L Near	 1AE5	  _TEXT	
SOUND_GET_CHANNEL  . . . . . . .	Number	 0002h	 
SOUND_GET_NOISE  . . . . . . . .	Number	 000Dh	 
SOUND_GET_OUTPUT . . . . . . . .	Number	 0004h	 
SOUND_GET_PITCH  . . . . . . . .	Number	 0007h	 
SOUND_GET_RANDOM . . . . . . . .	Number	 000Eh	 
SOUND_GET_SWEEP  . . . . . . . .	Number	 000Bh	 
SOUND_GET_VOLUME . . . . . . . .	Number	 0009h	 
SOUND_INIT . . . . . . . . . . .	Number	 0000h	 
SOUND_SET_CHANNEL  . . . . . . .	Number	 0001h	 
SOUND_SET_NOISE  . . . . . . . .	Number	 000Ch	 
SOUND_SET_OUTPUT . . . . . . . .	Number	 0003h	 
SOUND_SET_PITCH  . . . . . . . .	Number	 0006h	 
SOUND_SET_SWEEP  . . . . . . . .	Number	 000Ah	 
SOUND_SET_VOLUME . . . . . . . .	Number	 0008h	 
SOUND_SET_WAVE . . . . . . . . .	Number	 0005h	 
SP_Set_Channel_End . . . . . . .	L Near	 1A51	  _TEXT	
SP_Set_Channel_Step  . . . . . .	L Near	 1A4B	  _TEXT	
SP_Set_Frection_End  . . . . . .	L Near	 19C7	  _TEXT	
SP_Set_Frection_Step . . . . . .	L Near	 19BA	  _TEXT	
SP_Set_Noise_End . . . . . . . .	L Near	 1A31	  _TEXT	
SP_Set_Noise_Step  . . . . . . .	L Near	 1A2B	  _TEXT	
SP_Set_Sweep_End . . . . . . . .	L Near	 1A11	  _TEXT	
SP_Set_Sweep_Step  . . . . . . .	L Near	 1A09	  _TEXT	
SP_Set_Voice_End . . . . . . . .	L Near	 1A86	  _TEXT	
SP_Set_Voice_Step  . . . . . . .	L Near	 1A6F	  _TEXT	
SP_Set_Volume_End  . . . . . . .	L Near	 19EF	  _TEXT	
SP_Set_Volume_Step . . . . . . .	L Near	 19E2	  _TEXT	
SRAM_Segment . . . . . . . . . .	Text   	 BANK_SRAM_ADDRESS
SYS_INT_CASETTE  . . . . . . . .	Number	 0002h	 
SYS_INT_DISPLINE . . . . . . . .	Number	 0004h	 
SYS_INT_HBLANK_COUNTUP . . . . .	Number	 0007h	 
SYS_INT_KEY  . . . . . . . . . .	Number	 0001h	 
SYS_INT_RECEIVEREADY . . . . . .	Number	 0003h	 
SYS_INT_SENDREADY  . . . . . . .	Number	 0000h	 
SYS_INT_VBLANK_COUNTUP . . . . .	Number	 0005h	 
SYS_INT_VBLANK . . . . . . . . .	Number	 0006h	 
S_PCB_LOAD . . . . . . . . . . .	Number	 0001h	 
S_PCB_NOT_USED . . . . . . . . .	Number	 0000h	 
S_PCB_RUN  . . . . . . . . . . .	Number	 0002h	 
S_PCB_SUSPEND  . . . . . . . . .	Number	 0003h	 
TIMER_AUTOPRESET . . . . . . . .	Number	 0001h	 
TIMER_CounterH . . . . . . . . .	Number	 00A8h	 
TIMER_CounterV . . . . . . . . .	Number	 00AAh	 
TIMER_DISABLE  . . . . . . . . .	Number	 0008h	 
TIMER_ENABLE . . . . . . . . . .	Number	 0007h	 
TIMER_GET_COUNT  . . . . . . . .	Number	 0009h	 
TIMER_HBLANK . . . . . . . . . .	Number	 0000h	 
TIMER_MaxCountH  . . . . . . . .	Number	 00A4h	 
TIMER_MaxCountV  . . . . . . . .	Number	 00A6h	 
TIMER_ONESHOT  . . . . . . . . .	Number	 0000h	 
TIMER_Status . . . . . . . . . .	Number	 00A2h	 
TIMER_VBLANK . . . . . . . . . .	Number	 0001h	 
Timer_Close  . . . . . . . . . .	Number	 0100h	 
Timer_H_Disable  . . . . . . . .	Number	 00FEh	 
Timer_H_Enable . . . . . . . . .	Number	 0001h	 
Timer_H_auto . . . . . . . . . .	Number	 0002h	 
Timer_H_shot . . . . . . . . . .	Number	 00FDh	 
Timer_Open . . . . . . . . . . .	Number	 0303h	 
Timer_Tempo120 . . . . . . . . .	Number	 007Dh	 
Timer_V_Disable  . . . . . . . .	Number	 00FBh	 
Timer_V_Enable . . . . . . . . .	Number	 0004h	 
Timer_V_auto . . . . . . . . . .	Number	 0008h	 
Timer_V_shot . . . . . . . . . .	Number	 00F7h	 
WTD_BendEmb  . . . . . . . . . .	Text   	 WTD_BendEmbAddress
WTD_BendLFO  . . . . . . . . . .	Text   	 WTD_BendLfoDecayRate
WTD_Ctrl_AcsentR . . . . . . . .	Number	 FFBFh	 
WTD_Ctrl_Acsent  . . . . . . . .	Number	 0040h	 
WTD_Ctrl_BendEmbR  . . . . . . .	Number	 FFFDh	 
WTD_Ctrl_BendEmb . . . . . . . .	Number	 0002h	 
WTD_Ctrl_BendLfoR  . . . . . . .	Number	 FFFEh	 
WTD_Ctrl_BendLfo . . . . . . . .	Number	 0001h	 
WTD_Ctrl_EffectR . . . . . . . .	Number	 BFFFh	 
WTD_Ctrl_Effect  . . . . . . . .	Number	 4000h	 
WTD_Ctrl_EmbFreqR  . . . . . . .	Number	 FF7Fh	 
WTD_Ctrl_EmbFreq . . . . . . . .	Number	 0080h	 
WTD_Ctrl_EmbPanR . . . . . . . .	Number	 FDFFh	 
WTD_Ctrl_EmbPan  . . . . . . . .	Number	 0200h	 
WTD_Ctrl_EmbVolR . . . . . . . .	Number	 FEFFh	 
WTD_Ctrl_EmbVol  . . . . . . . .	Number	 0100h	 
WTD_Ctrl_ExprEmbR  . . . . . . .	Number	 FFF7h	 
WTD_Ctrl_ExprEmb . . . . . . . .	Number	 0008h	 
WTD_Ctrl_ExprLfoR  . . . . . . .	Number	 FFFBh	 
WTD_Ctrl_ExprLfo . . . . . . . .	Number	 0004h	 
WTD_Ctrl_PamEmbR . . . . . . . .	Number	 FFDFh	 
WTD_Ctrl_PanEmb  . . . . . . . .	Number	 0020h	 
WTD_Ctrl_PanLfoR . . . . . . . .	Number	 FFEFh	 
WTD_Ctrl_PanLfo  . . . . . . . .	Number	 0010h	 
WTD_Ctrl_PlayEndR  . . . . . . .	Number	 7FFFh	 
WTD_Ctrl_PlayEnd . . . . . . . .	Number	 8000h	 
WTD_Ctrl_Vol0R . . . . . . . . .	Number	 FBFFh	 
WTD_Ctrl_Vol0  . . . . . . . . .	Number	 0400h	 
WTD_Ctrl_WorkCyR . . . . . . . .	Number	 EFFFh	 
WTD_Ctrl_WorkCy  . . . . . . . .	Number	 1000h	 
WTD_Ctrl_WorkSwR . . . . . . . .	Number	 F7FFh	 
WTD_Ctrl_WorkSw  . . . . . . . .	Number	 0800h	 
WTD_Ctrl_WorkZeR . . . . . . . .	Number	 DFFFh	 
WTD_Ctrl_WorkZe  . . . . . . . .	Number	 2000h	 
WTD_ExprEmb  . . . . . . . . . .	Text   	 WTD_ExprEmbAddress
WTD_ExprLFO  . . . . . . . . . .	Text   	 WTD_ExprLfoDecayRate
WTD_FrectionSet  . . . . . . . .	Text   	 WTD_BendSet
WTD_Frection . . . . . . . . . .	Text   	 WTD_Bend
WTD_NoiseMode  . . . . . . . . .	Text   	 WTD_SweepLevel
WTD_PanEmb . . . . . . . . . . .	Text   	 WTD_PanEmbAddress
WTD_PanLFO . . . . . . . . . . .	Text   	 WTD_PanLfoDecayRate
WTD_PcmAddress . . . . . . . . .	Text   	 WTD_LoopCount
WTD_PcmSize  . . . . . . . . . .	Text   	 WTD_LoopCount+4
WTD_Sys_3R . . . . . . . . . . .	Number	 FFF7h	 
WTD_Sys_3  . . . . . . . . . . .	Number	 0008h	 
WTD_Sys_5R . . . . . . . . . . .	Number	 FFDFh	 
WTD_Sys_5  . . . . . . . . . . .	Number	 0020h	 
WTD_Sys_6R . . . . . . . . . . .	Number	 FFBFh	 
WTD_Sys_6  . . . . . . . . . . .	Number	 0040h	 
WTD_Sys_ChannelMode1R  . . . . .	Number	 FEFFh	 
WTD_Sys_ChannelMode1 . . . . . .	Number	 0100h	 
WTD_Sys_ChannelMode2R  . . . . .	Number	 FDFFh	 
WTD_Sys_ChannelMode2 . . . . . .	Number	 0200h	 
WTD_Sys_ChannelMode3R  . . . . .	Number	 FBFFh	 
WTD_Sys_ChannelMode3 . . . . . .	Number	 0400h	 
WTD_Sys_ChannelMode4R  . . . . .	Number	 F7FFh	 
WTD_Sys_ChannelMode4 . . . . . .	Number	 0800h	 
WTD_Sys_EffectMask1R . . . . . .	Number	 EFFFh	 
WTD_Sys_EffectMask1  . . . . . .	Number	 1000h	 
WTD_Sys_EffectMask2R . . . . . .	Number	 DFFFh	 
WTD_Sys_EffectMask2  . . . . . .	Number	 2000h	 
WTD_Sys_EffectMask3R . . . . . .	Number	 BFFFh	 
WTD_Sys_EffectMask3  . . . . . .	Number	 4000h	 
WTD_Sys_EffectMask4R . . . . . .	Number	 7FFFh	 
WTD_Sys_EffectMask4  . . . . . .	Number	 8000h	 
WTD_Sys_EffectR  . . . . . . . .	Number	 FFFDh	 
WTD_Sys_Effect . . . . . . . . .	Number	 0002h	 
WTD_Sys_MidiR  . . . . . . . . .	Number	 FFEFh	 
WTD_Sys_Midi . . . . . . . . . .	Number	 0010h	 
WTD_Sys_MusicR . . . . . . . . .	Number	 FFFEh	 
WTD_Sys_Music  . . . . . . . . .	Number	 0001h	 
WTD_Sys_PcmR . . . . . . . . . .	Number	 FFFBh	 
WTD_Sys_Pcm  . . . . . . . . . .	Number	 0004h	 
WTD_Sys_TimerEmulateR  . . . . .	Number	 FF7Fh	 
WTD_Sys_TimerEmulate . . . . . .	Number	 0080h	 
WTD_Velocity . . . . . . . . . .	Text   	 WTD_ExprPanSet
WTD_Voice1st . . . . . . . . . .	Text   	 WTD_Program1st
WTD_Voice2nd . . . . . . . . . .	Text   	 WTD_Program2nd
WTD_Voice3rd . . . . . . . . . .	Text   	 WTD_Program3rd
WTD_VoiceCnt . . . . . . . . . .	Text   	 WTD_ProgramCnt
WTD_VoiceRate  . . . . . . . . .	Text   	 WTD_ProgramRate
WTD_Voice  . . . . . . . . . . .	Text   	 WTD_Program
WTD_WorkAdd_Ch0  . . . . . . . .	Number	 0600h	 
WTD_WorkAdd_Ch10 . . . . . . . .	Number	 0B00h	 
WTD_WorkAdd_Ch11 . . . . . . . .	Number	 0B80h	 
WTD_WorkAdd_Ch12 . . . . . . . .	Number	 0C00h	 
WTD_WorkAdd_Ch13 . . . . . . . .	Number	 0C80h	 
WTD_WorkAdd_Ch14 . . . . . . . .	Number	 0D00h	 
WTD_WorkAdd_Ch15 . . . . . . . .	Number	 0D80h	 
WTD_WorkAdd_Ch17 . . . . . . . .	Number	 0E80h	 
WTD_WorkAdd_Ch18 . . . . . . . .	Number	 0F00h	 
WTD_WorkAdd_Ch19 . . . . . . . .	Number	 0F80h	 
WTD_WorkAdd_Ch1  . . . . . . . .	Number	 0680h	 
WTD_WorkAdd_Ch2  . . . . . . . .	Number	 0700h	 
WTD_WorkAdd_Ch3  . . . . . . . .	Number	 0780h	 
WTD_WorkAdd_Ch4  . . . . . . . .	Number	 0800h	 
WTD_WorkAdd_Ch5  . . . . . . . .	Number	 0880h	 
WTD_WorkAdd_Ch6  . . . . . . . .	Number	 0900h	 
WTD_WorkAdd_Ch7  . . . . . . . .	Number	 0980h	 
WTD_WorkAdd_Ch8  . . . . . . . .	Number	 0A00h	 
WTD_WorkAdd_Ch9  . . . . . . . .	Number	 0A80h	 
WTD_WorkAdd_Ech0 . . . . . . . .	Number	 0400h	 
WTD_WorkAdd_Ech1 . . . . . . . .	Number	 0480h	 
WTD_WorkAdd_Ech2 . . . . . . . .	Number	 0500h	 
WTD_WorkAdd_Emb  . . . . . . . .	Number	 0200h	 
WTD_WorkAdd_End  . . . . . . . .	Text   	 WTD_WorkSize
WTD_WorkAdd_PCM  . . . . . . . .	Number	 0580h	 
WTD_WorkAdd_System . . . . . . .	Number	 0380h	 
WTD_WorkAdd_User . . . . . . . .	Number	 0000h	 
WTD_WorkAdd_Wave . . . . . . . .	Number	 0100h	 
WTD_WorkChSize . . . . . . . . .	Number	 0080h	 
WTD_WorkSize . . . . . . . . . .	Number	 1000h	 
WTR_WorkAdd_Ch16 . . . . . . . .	Number	 0E00h	 
WTdIL_Version_N  . . . . . . . .	Number	 010Dh	 
WanderSwanTotalSoundDriver_  . .	L Near	 0000	  _TEXT	Public
WtdIL_Name . . . . . . . . . . .	Text   	 'WTD',0
WtdIL_Version  . . . . . . . . .	Text   	 '1.0d',0
XMODE_AUTO_ERASE . . . . . . . .	Number	 0004h	 
XMODE_RECEIVE_ENCRYPTED  . . . .	Number	 0003h	 
XMODE_RECEIVE  . . . . . . . . .	Number	 0001h	 
XMODE_SEND_ENCRYPTED . . . . . .	Number	 0002h	 
XMODE_SEND . . . . . . . . . . .	Number	 0000h	 
XM_ABORT . . . . . . . . . . . .	Number	 0006h	 
XM_BLOCK_RETRY . . . . . . . . .	Number	 0004h	 
XM_BLOCK . . . . . . . . . . . .	Number	 0003h	 
XM_CLOSE . . . . . . . . . . . .	Number	 0005h	 
XM_DONE  . . . . . . . . . . . .	Number	 0007h	 
XM_ERASE_BANK  . . . . . . . . .	Number	 0008h	 
XM_NEGO  . . . . . . . . . . . .	Number	 0002h	 
XM_START . . . . . . . . . . . .	Number	 0001h	 
_EffectPlay_End  . . . . . . . .	L Near	 0567	  _TEXT	
_EffectPlay_Step2  . . . . . . .	L Near	 04AC	  _TEXT	
_MusicPlay_Chk2  . . . . . . . .	L Near	 024D	  _TEXT	
_MusicPlay_End . . . . . . . . .	L Near	 035E	  _TEXT	
_PCMVoiceSet_End . . . . . . . .	L Near	 0728	  _TEXT	
_PcmPlay_EndJmpStep  . . . . . .	L Near	 0662	  _TEXT	
_PcmPlay_EndJmp  . . . . . . . .	L Near	 065D	  _TEXT	
_PcmPlay_End . . . . . . . . . .	L Near	 06C0	  _TEXT	
_PcmPlay_FileChkEnd2 . . . . . .	L Near	 0688	  _TEXT	
_PcmPlay_FileChkEnd  . . . . . .	L Near	 063F	  _TEXT	
_PcmPlay_FileChkLoop2  . . . . .	L Near	 066F	  _TEXT	
_PcmPlay_FileChkLoop . . . . . .	L Near	 0625	  _TEXT	
_PcmPlay_FileChkStep1  . . . . .	L Near	 0639	  _TEXT	
_PcmPlay_FileChkStep2  . . . . .	L Near	 0683	  _TEXT	
_SoftEmbSet_End  . . . . . . . .	L Near	 0764	  _TEXT	
_StayOut_End . . . . . . . . . .	L Near	 01BD	  _TEXT	
_Stay_00 . . . . . . . . . . . .	L Near	 00E3	  _TEXT	
_Stay_End  . . . . . . . . . . .	L Near	 016F	  _TEXT	
_WTD_Work  . . . . . . . . . . .	L Near	 0000	  _BSS	Public
library  . . . . . . . . . . . .	Text   	 1

	   0 Warnings
	   0 Errors
